/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
var ListGraph=function(t,e){"use strict";function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function i(t){for(var e=[],s=t.length;s--;)e.push({id:t[s]});return e}function a(t){var e=t;t.clone&&(e=t.originalNode);var s=[e];return e.clones.length&&(s=s.concat(e.clones)),s}function l(t,e,s){for(var i=a(t),n=i.length;n--;){s&&e(i[n],s);for(var o=i[n].parent.length;o--;)l(i[n].parent[o],e,i[n])}}function n(t,e){for(var s=a(t),i=s.length;i--;){e(s[i]);for(var l=s[i].childRefs.length;l--;)n(s[i].childRefs[l],e)}}function o(t,e,s){s?(l(t,e),n(t,s)):(l(t,e),n(t,e))}function r(t,e,s,i,a){var l=0,n=0,o=0,r=0;try{l=a.topLeft||0,n=a.topRight||0,o=a.bottomLeft||0,r=a.bottomRight||0}catch(c){}return"M"+(t+l)+","+e+"h"+(s-l-n)+"a"+n+","+n+" 0 0 1 "+n+","+n+"v"+(i-(n+r))+"a"+r+","+r+" 0 0 1 "+-r+","+r+"h"+(o-(s-r))+"a"+o+","+o+" 0 0 1 "+-o+","+-o+"v"+(l-(i-o))+"a"+l+","+l+" 0 0 1 "+l+","+-l+"z"}function c(t,s,i,a,l,n){var o=e.scale.pow().exponent(l||2),r=1/((n||0)+1),c=t.append("defs").append("linearGradient").attr("id",a).attr("x1",s.x).attr("y1",s.y).attr("x2",i.x).attr("y2",i.y).attr("spreadMethod","pad");c.append("stop").attr("offset",s.offset+"%").attr("stop-color",s.color).attr("stop-opacity",s.opacity);for(var h=0;n>h;h++)c.append("stop").attr("offset",s.offset+h*r*(i.offset-s.offset)+"%").attr("stop-color",i.color).attr("stop-opacity",s.opacity+o(h*r)*(i.opacity-s.opacity));c.append("stop").attr("offset",i.offset+"%").attr("stop-color",i.color).attr("stop-opacity",i.opacity)}var h={};h.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},h.createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),h.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},h.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var u="scrollbar",d=function $(t,s,i){var a=this;h.classCallCheck(this,$),this.visData=s,this.width=i,this.selection=t.append("rect").attr("class",u).call(function(t){t.each(function(t,s){e.select(this.parentNode).datum().scrollbar.el=this})}).attr("x",function(t){return t.scrollbar.x}).attr("y",function(t){return t.scrollbar.y}).attr("width",function(t){return a.width}).attr("height",function(t){return t.scrollbar.height}).attr("rx",this.width/2).attr("ry",this.width/2).classed("ready",!0)},g="list-graph",v=6,p=5,b=5,f="",y="desc",m="one",k=250,w="#e0001c",D="#60bf00",S="bar",x=function(){function t(e,s,i,a,l){function n(e){var s=u.visData.nodes[u.nodeData.depth].sortBy;e.attr("d",function(e){return t.generatePath(e,s,u.visData)}).classed("bar-magnitude",!0)}function o(t){t.attr("x",0).attr("y",u.visData.global.row.padding).attr("width",u.visData.global.column.contentWidth).attr("height",u.visData.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bar-border",!0)}function r(e){e.attr("d",function(e){return t.generatePath(e,void 0,u.visData,e.value)}).classed("bar-indicator",!0)}var c=this;h.classCallCheck(this,t);var u=this;this.data=s,this.nodeData=i,this.visData=a,this.barCollection=l,this.data.x=i.x,this.data.level=i.depth,this.height=this.visData.global.row.contentHeight/(2*this.data.length)-2*this.visData.global.cell.padding,this.activeHeight=this.visData.global.row.contentHeight-2,this.inactiveheight=2*this.visData.global.cell.padding-1,this.selection=e.selectAll(S).data(this.data).enter().append("g").attr("class",function(t){return S+" "+t.id}).classed("active",function(t){return t.id===c.visData.nodes[c.nodeData.depth].sortBy}),this.selection.append("rect").call(o),this.selection.append("path").call(n),this.selection.append("path").call(r)}return h.createClass(t,null,[{key:"generatePath",value:function(t,e,s,i,a,l){return"two"===this.barCollection.mode?this.generateTwoBarsPath(t,s,l):this.generateOneBarPath(t,e,s,i,a)}},{key:"generateOneBarPath",value:function(t,e,s,i,a){var l=0,n=2,o=s.global.row.contentHeight,c={topLeft:2,bottomLeft:2};return i&&(c={}),t.id!==e&&"undefined"==typeof i?(l=t.value*s.global.column.contentWidth-3,c={}):i?(l=i*s.global.column.contentWidth,a&&(t.value<i&&(l=t.value*s.global.column.contentWidth),n=Math.min(Math.abs(i-t.value),2)*s.global.column.contentWidth)):n=s.global.column.contentWidth*t.value,r(l,s.global.row.padding,n,o,c)}},{key:"generateTwoBarsPath",value:function(t,e,s){var i=e.global.row.contentHeight/2,a=e.global.column.contentWidth*t.value,l=e.global.row.padding,n={topLeft:2};return s&&(n={bottomLeft:2},l+=i),r(0,l,a,i,n)}}]),t}(),C="bars",P=function(){function t(s,i,a){h.classCallCheck(this,t);var l=this;this.mode=i,this.visData=a,this.selection=s.append("g").attr("class",C),this.selection.each(function(t){new x(e.select(this),t.data.bars,t,l.visData,l)})}return h.createClass(t,[{key:"update",value:function(t,s){var i=this;t.each(function(){var t=e.select(this);t.classed("active")?t.classed("active",!1):(t.classed("active",!0),this.parentNode.insertBefore(this,e.select(this.parentNode).select(".bar").node()))}),t.selectAll(".bar-magnitude").transition().duration(k).attr("d",function(t){return x.generatePath(t,s,i.visData)})}},{key:"updateIndicator",value:function(t,e,s){var i=this;e.transition().duration(0).attr("d",function(t){return x.generatePath(t,void 0,i.visData)}),t.attr("d",function(t){return x.generatePath(t,void 0,i.visData,s)}).classed("positive",function(t){return t.value>=s}),t.transition().duration(k).attr("d",function(t){return x.generatePath(t,void 0,i.visData,s,!0)})}},{key:"switchMode",value:function(t,e){var s=this;this.mode!==t&&("one"===t&&(e.global.type?(this.selection.selectAll(".bar").selectAll(".bar-magnitude").transition().duration(k).attr("d",function(t){return x.generateOneBarPath(t,e.global.type,s.visData)}),console.log("bratzen")):console.log("kacken")),"two"===t&&(this.selection.selectAll(".bar.precision").selectAll(".bar-magnitude").transition().duration(k).attr("d",function(t){return x.generateTwoBarsPath(t,s.visData)}),this.selection.selectAll(".bar.recall").selectAll(".bar-magnitude").transition().duration(k).attr("d",function(t){return x.generateTwoBarsPath(t,s.visData,!0)})),this.mode=t)}}]),t}(),B="links",M="link",W=function(){function t(s,i,a){var l=this;h.classCallCheck(this,t),this.visData=i,this.layout=a,this.groups=s.append("g").attr("class",B).call(function(t){t.each(function(t,s){e.select(this.parentNode).datum().links=this})}),this.links=this.groups.selectAll(M).data(function(t,e){return l.layout.links(e)}).enter().append("path").attr("class","link").attr("d",this.diagonal)}return h.createClass(t,[{key:"highlight",value:function(t,e){this.links.data(t,function(t){return t.id}).classed("highlight",e===!1?!1:!0)}},{key:"scroll",value:function(t,e){t.data(e).attr("d",this.diagonal).exit().remove()}},{key:"sort",value:function(t){var s=function(){e.select(this).classed("sorting",!0)},i=function(){e.select(this).classed("sorting",!1)};this.links.data(t,function(t){return t.id}).transition().duration(k).attr("d",this.diagonal).each("start",s).each("end",i)}},{key:"diagonal",get:function(){var t=this;return e.svg.diagonal().source(function(e){return{x:e.source.node.y+e.source.offsetY+t.visData.global.row.height/2,y:e.source.node.x+e.source.offsetX+t.visData.global.column.contentWidth+t.visData.global.column.padding}}).target(function(e){return{x:e.target.node.y+e.target.offsetY+t.visData.global.row.height/2,y:e.target.node.x+e.target.offsetX+t.visData.global.column.padding}}).projection(function(t){return[t.y,t.x]})}}]),t}(),O="nodes",T="node",A="clone",E=function(){function t(s,i,a,l,n){function o(t,e,s){s||(s=0),t.attr("x",function(t){return s}).attr("y",function(t){return c.visData.global.row.padding+s}).attr("width",c.visData.global.column.contentWidth-2*s).attr("height",c.visData.global.row.contentHeight-2*s).attr("rx",2-s).attr("ry",2-s).classed(e,!0)}var r=this;h.classCallCheck(this,t);var c=this;this.visData=i,this.links=a,this.events=l,this.groups=s.append("g").attr("class",O).call(function(t){t.each(function(t,s){e.select(this.parentNode).datum().nodes=this})}),this.nodes=this.groups.selectAll("."+T).data(function(t){return t.rows}).enter().append("g").classed(T,!0).classed(A,function(t){return t.clone}).attr("transform",function(t){return"translate("+(t.x+r.visData.global.column.padding)+", "+t.y+")"}),this.nodes.append("rect").call(o,"bg",1),this.nodes.on("click",function(t){c.mouseClick(this,t)}),this.nodes.on("mouseenter",function(t){c.mouseEnter(this,t)}),this.nodes.on("mouseleave",function(t){c.mouseLeave(this,t)}),this.bars=new P(this.nodes,n,this.visData),this.nodes.append("rect").call(o,"border"),this.nodes.call(function(t){t.append("foreignObject").attr("x",function(t){return r.visData.global.cell.padding}).attr("y",function(t){return r.visData.global.row.padding+r.visData.global.cell.padding}).attr("width",r.visData.global.column.contentWidth).attr("height",r.visData.global.row.contentHeight-2*r.visData.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).style("line-height",r.visData.global.row.contentHeight-2*r.visData.global.cell.padding+"px").append("xhtml:span").text(function(t){return t.data.name})})}return h.createClass(t,[{key:"mouseClick",value:function(t,e){this.events.broadcast("d3ListGraphNodeClick",{id:e.id})}},{key:"mouseEnter",value:function(t,s){var a=this,l=this,n=s;this.currentlyHighlightedLinks=[];var r=e.select(t).selectAll(".bar.active .bar-magnitude").datum(),c=function(t,e){t.hovering=2;for(var s=t.links.length;s--;)t.links[s].target.node.id===e.id&&a.currentlyHighlightedLinks.push(t.links[s].id)},h=function(t){t.hovering=2;for(var e=t.links.length;e--;)a.currentlyHighlightedLinks.push(t.links[e].id)};o(s,c,h),s.clone&&(s.originalNode.hovering=1),s.hovering=1,this.nodes.each(function(s){var i=e.select(this);if(1===s.hovering)i.classed("hovering-directly",!0);else if(2===s.hovering){i.classed("hovering-indirectly",!0),i.selectAll(".bar."+r.id).classed("copy",function(t){var e=t.id;return t.clone&&(e=t.originalNode.id),e!==n.id?!0:void 0});var a=e.select(t).selectAll(".bar."+r.id).classed("reference",!0);l.bars.updateIndicator(i.selectAll(".bar.copy .bar-indicator"),a.selectAll(".bar-indicator"),r.value)}}),this.links.highlight(i(this.currentlyHighlightedLinks)),this.events.broadcast("d3ListGraphNodeEnter",{id:s.id})}},{key:"mouseLeave",value:function(t,e){var s=function(t){return t.hovering=0};e.hovering=0,o(e,s),e.clone&&(e.originalNode.hovering=0),this.nodes.classed("hovering-directly",!1),this.nodes.classed("hovering-indirectly",!1),this.nodes.selectAll(".bar.reference").classed("reference",!1),this.links.highlight(i(this.currentlyHighlightedLinks),!1),this.events.broadcast("d3ListGraphNodeLeave",{id:e.id})}},{key:"sort",value:function(t,s){for(var i=this,a=t.length;a--;){var l=function(){e.select(this).classed("sorting",!0)},n=function(){e.select(this).classed("sorting",!1)},o=this.nodes.data(t[a].rows,function(t){return t.id});o.transition().duration(k).attr("transform",function(t){return"translate("+(t.x+i.visData.global.column.padding)+", "+t.y+")"}).each("start",l).each("end",n),s&&this.bars.update(o.selectAll(".bar"),t[a].sortBy)}}},{key:"barMode",get:function(){return this.bars.mode}}]),t}(),N="column",H="scroll-container",L=function(){function t(e,s){var i=this;h.classCallCheck(this,t),this.visData=s,this.groups=e.selectAll("g").data(this.visData.nodes).enter().append("g").attr("class",N),this.groups.append("rect").attr("class",H).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return i.visData.global.column.width}).attr("height",function(t){return i.visData.global.column.height})}return h.createClass(t,[{key:"scrollPreparation",value:function(t,s){var i=this;this.groups.each(function(a,l){var n=a.nodes.getBoundingClientRect().height+2*i.visData.global.row.padding,o=n-i.visData.global.column.height,r=o>0?Math.max(i.visData.global.column.height*i.visData.global.column.height/n,10):0;a.height=n,a.linkSelections={incoming:l>0?t.selectByColumn(l-1,".link"):null,outgoing:t.selectByColumn(l,".link")},a.scrollHeight=o,a.scrollTop=0,a.scrollbar={el:void 0,x:a.x+i.visData.global.column.width-s,y:0,width:s,height:r,scrollHeight:i.visData.global.column.height-r,scrollTop:0,heightScale:e.scale.linear().domain([0,o]).range([0,i.visData.global.column.height-r])},a.invertedHeightScale=a.scrollbar.heightScale.invert})}},{key:"height",get:function(){return this.visData.global.column.height}}]),t}(),R="div",Y="top-bar",j="ul",G="controls",_="global-controls",q=function(){function t(s,i,a){var l=this;h.classCallCheck(this,t);var n=this;this.vis=s,this.visData=a,this.el=i.select("."+Y),this.el.empty()&&(this.el=i.insert(R,":first-child").attr("class",Y)),this.controlSwitch=this.el.append("div").attr("title","Toggle global / local topbar").style("width",this.visData.global.column.padding+"px").classed("control-switch",!0).on("click",this["switch"].bind(this)),this.switchArrow=this.controlSwitch.append("svg").append("use").attr("xlink:href",this.vis.iconPath+"#arrow-down").attr("class","switch-arrow"),this.globalControls=this.el.append(j).classed(_,!0),this.globalPrecision=this.globalControls.append("li").attr("class","control-btn sort-precision").classed("active",function(){return"precision"===n.vis.currentSorting.global.type?(n.vis.currentSorting.global.el=e.select(this),!0):void 0}).on("click",function(t){n.sortAllColumns(this,"precision")}).on("mouseenter",function(){return l.highlightBars(void 0,"precision")}).on("mouseleave",function(){return l.highlightBars(void 0,"precision",!0)}),this.globalPrecisionWrapper=this.globalPrecision.append("div").attr("class","wrapper").text("Precision").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalPrecisionWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","precision"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalRecall=this.globalControls.append("li").attr("class","control-btn sort-recall").classed("active",function(){return"recall"===n.vis.currentSorting.global.type?(n.vis.currentSorting.global.el=e.select(this),!0):void 0}).on("click",function(t){n.sortAllColumns(this,"recall")}).on("mouseenter",function(){return l.highlightBars(void 0,"recall")}).on("mouseleave",function(){return l.highlightBars(void 0,"recall",!0)}),this.globalRecallWrapper=this.globalRecall.append("div").attr("class","wrapper").text("Recall").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalRecallWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","recall"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalName=this.globalControls.append("li").attr("class","control-btn sort-name").classed("active",function(){return"name"===n.vis.currentSorting.global.type?(n.vis.currentSorting.global.el=e.select(this),!0):void 0}).on("click",function(t){n.sortAllColumns(this,"name")}).on("mouseenter",function(){return l.highlightLabels()}).on("mouseleave",function(){return l.highlightLabels(!0)}),this.globalNameWrapper=this.globalName.append("div").attr("class","wrapper").text("Name").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalNameWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","name"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalNameWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-asc"),this.globalNameWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-desc"),this.globalOneBar=this.globalControls.append("li").attr("class","control-btn one-bar").classed("active","one"===this.vis.barMode).on("click",function(){n.switchBarMode(this,"one")}),this.globalOneBarWrapper=this.globalOneBar.append("div").attr("class","wrapper").text("One bar").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalOneBarWrapper.append("svg").attr("class","icon-one-bar").append("use").attr("xlink:href",this.vis.iconPath+"#one-bar"),this.globalTwoBars=this.globalControls.append("li").attr("class","control-btn two-bars").classed("active","two"===this.vis.barMode).on("click",function(){n.switchBarMode(this,"two")}),this.globalTwoBarsWrapper=this.globalTwoBars.append("div").attr("class","wrapper").text("Two bars").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalTwoBarsWrapper.append("svg").attr("class","icon-two-bars").append("use").attr("xlink:href",this.vis.iconPath+"#two-bars"),this.localControlWrapper=this.el.append("div").classed("local-controls",!0),this.localControls=this.localControlWrapper.selectAll(G).data(a.nodes).enter().append(j).classed(G,!0).style("width",this.visData.global.column.width+"px"),this.localControls.each(function(t,s){var i=e.select(this);n.vis.currentSorting.local[s]={type:t.sortBy,order:t.sortOrder,el:void 0},i.append("li").attr("class","control-btn toggle").style("width",n.visData.global.column.padding+"px").on("click",n.toggleColumn),i.append("li").attr("class","control-btn sort-precision ease-all").style({width:n.visData.global.column.contentWidth/2+"px",left:n.visData.global.column.padding+"px"}).on("click",function(t){n.sortColumn(this,t.level,"precision")}).on("mouseenter",function(){n.highlightBars(this.parentNode,"precision"),e.select(this).style("width",n.visData.global.column.contentWidth-16+"px")}).on("mouseleave",function(){n.highlightBars(this.parentNode,"precision",!0),e.select(this).style("width",n.visData.global.column.contentWidth/2+"px")}).html('<div class="expandable-label">  <span class="letter abbr">P</span>  <span class="letter abbr">r</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">i</span>  <span class="letter">s</span>  <span class="letter">i</span>  <span class="letter">o</span>  <span class="letter">n</span></div><svg class="icon-unsort invisible-default '+("precision"!==n.vis.currentSorting.local[s].type?"visible":"")+'">  <use xlink:href="'+n.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("precision"===n.vis.currentSorting.local[s].type&&1===n.vis.currentSorting.local[s].order?"visible":"")+'">  <use xlink:href="'+n.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("precision"===n.vis.currentSorting.local[s].type&&1!==n.vis.currentSorting.local[s].order?"visible":"")+'">  <use xlink:href="'+n.vis.iconPath+'#sort-desc"></use></svg>'),i.append("li").attr("class","control-btn sort-recall ease-all").style({width:n.visData.global.column.contentWidth/2+"px",left:n.visData.global.column.contentWidth/2+n.visData.global.column.padding+"px"}).on("click",function(t){n.sortColumn(this,t.level,"recall")}).on("mouseenter",function(){n.highlightBars(this.parentNode,"recall"),e.select(this).style({width:n.visData.global.column.contentWidth-16+"px",left:n.visData.global.column.padding+16+"px"})}).on("mouseleave",function(){n.highlightBars(this.parentNode,"recall",!0),e.select(this).style({width:n.visData.global.column.contentWidth/2+"px",left:n.visData.global.column.contentWidth/2+n.visData.global.column.padding+"px"})}).html('<div class="expandable-label">  <span class="letter abbr">R</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">a</span>  <span class="letter abbr">l</span>  <span class="letter">l</span></div><svg class="icon-unsort invisible-default '+("recall"!==n.vis.currentSorting.local[s].type?"visible":"")+'">  <use xlink:href="'+n.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("recall"===n.vis.currentSorting.local[s].type&&1===n.vis.currentSorting.local[s].order?"visible":"")+'">  <use xlink:href="'+n.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("recall"===n.vis.currentSorting.local[s].type&&1!==n.vis.currentSorting.local[s].order?"visible":"")+'">  <use xlink:href="'+n.vis.iconPath+'#sort-desc"></use></svg>'),i.append("li").attr("class","control-btn options").style("width",n.visData.global.column.padding+"px").on("click",n.toggleOptions).html('<svg class="icon-gear">  <use xlink:href="'+n.vis.iconPath+'#gear"></use></svg>'),n.vis.currentSorting.local[s].type&&(n.vis.currentSorting.local[s].el=i.select(".sort-"+n.vis.currentSorting.local[s].type))})}return h.createClass(t,[{key:"toggleColumn",value:function(){console.log("Toggle column")}},{key:"selectNodesColumn",value:function(t){return this.vis.selectByColumn(e.select(t).datum().level,".node")}},{key:"highlightLabels",value:function(t){this.vis.baseElD3.selectAll(".node").classed("highlight-label",!t)}},{key:"highlightBars",value:function(t,e,s){var i=t?this.selectNodesColumn(t):this.vis.baseElD3.selectAll(".node");i.classed("highlight-bar",!s).selectAll(".bar."+e).classed("highlight",!s)}},{key:"sortAllColumns",value:function(t,s){var i=!1;this.vis.currentSorting.global.type!==s&&(i=!0,this.vis.currentSorting.global.el&&this.resetSortEl(this.vis.currentSorting.global.el)),this.vis.currentSorting.global.el=e.select(t),this.vis.currentSorting.global.el.classed("active",!0),this.vis.currentSorting.global.type=s;for(var a=Object.keys(this.vis.currentSorting.local),l=0,n=a.length;n>l;l++)this.sortColumn(t,a[l],s,!0)}},{key:"sortColumn",value:function(t,s,i,a){a||(this.vis.currentSorting.global.type=void 0,this.resetSortEl(this.vis.currentSorting.global.el));var l=!1;this.vis.currentSorting.local[s].el&&this.vis.currentSorting.local[s].type!==i&&this.resetSortEl(this.vis.currentSorting.local[s].el),this.vis.currentSorting.local[s].type!==i&&(l=!0,this.vis.currentSorting.local[s].order=0),this.vis.currentSorting.local[s].el=e.select(t),this.vis.currentSorting.local[s].type=i,-1===this.vis.currentSorting.local[s].order?(this.vis.currentSorting.local[s].order=1,this.vis.currentSorting.local[s].el.select(".icon-sort-desc").classed("visible",!1),this.vis.currentSorting.local[s].el.select(".icon-sort-asc").classed("visible",!0)):(this.vis.currentSorting.local[s].order=-1,this.vis.currentSorting.local[s].el.select(".icon-sort-asc").classed("visible",!1),this.vis.currentSorting.local[s].el.select(".icon-sort-desc").classed("visible",!0)),this.vis.currentSorting.local[s].el.select(".icon-unsort").classed("visible",!1),this.vis.sortColumn(s,i,this.vis.currentSorting.local[s].order,l)}},{key:"resetSortEl",value:function(t){t.classed("active",!1),t.select(".icon-sort-desc").classed("visible",!1),t.select(".icon-sort-asc").classed("visible",!1),t.select(".icon-unsort").classed("visible",!0)}},{key:"toggleOptions",value:function(){console.log("Toggle options")}},{key:"switch",value:function(){this.el.classed("details",!this.el.classed("details"))}},{key:"switchBarMode",value:function(t,e){this.vis.nodes.barMode!==e&&("one"===e?(this.globalOneBar.classed("active",!0),this.globalTwoBars.classed("active",!1)):(this.globalOneBar.classed("active",!1),this.globalTwoBars.classed("active",!0)),this.vis.switchBarMode(e))}}]),t}(),J=function(t){function e(t){h.classCallCheck(this,e);var s=h.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return s.name=s.constructor.name,s.message=t,Error.captureStackTrace(s,s.constructor.name),s}return h.inherits(e,t),e}(Error),z=function(t){function e(t){return h.classCallCheck(this,e),h.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"D3.layout.listGraph.js has not been loaded yet."))}return h.inherits(e,t),e}(J),I=function(t){function e(t){return h.classCallCheck(this,e),h.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"Dispatcher needs to be a function."))}return h.inherits(e,t),e}(J),U=function(){function t(e,s){if(h.classCallCheck(this,t),s&&"function"!=typeof s)throw new I;this.el=e,this.dispatch=s?s:this._dispatchEvent}return h.createClass(t,[{key:"_dispatchEvent",value:function(t,e){var s=document.createEvent("CustomEvent");s.initCustomEvent(t,!1,!1,e),this.el.dispatchEvent(s)}},{key:"broadcast",value:function(t,e){this.dispatch(t,e)}}]),t}(),X=function(){function i(a,l,n,o){var r=this;if(h.classCallCheck(this,i),!e.layout.listGraph)throw new z;s(o)||(o={});var u=this;this.baseEl=a,this.baseElD3=e.select(a),this.baseElJq=t(a),this.svgD3=this.baseElD3.select("svg.base"),this.svgD3.empty()?(this.svgD3=this.baseElD3.append("svg").attr("class","base"),this.svgJq=t(this.svgD3[0])):this.svgJq=t(this.svgD3[0]),this.rootNodes=n,this.width=o.width||this.svgJq.width(),this.height=o.height||this.svgJq.height(),this.scrollbarWidth=o.scrollbarWidth||v,this.columns=o.columns||p,this.rows=o.rows||b,this.iconPath=o.iconPath||f,this.sortBy=o.sortBy,this.sortOrder=o.sortOrder||y,this.events=new U(this.baseEl,o.dispatcher),this.baseElJq.width(this.width).addClass(g),this.layout=new e.layout.listGraph([this.width,this.height],[this.columns,this.rows]),this.data=l,this.visData=this.layout.process(this.data,this.rootNodes,{sortBy:this.sortBy,sortOrder:this.sortOrder}),this.currentSorting={global:{type:this.sortBy,order:this.sortOrder},local:{}},c(this.svgD3,{color:w,offset:0,opacity:.2,x:0,y:0},{afterOffsetOpacity:1,color:w,offset:99,opacity:1,x:1,y:0},"negativeRed",4,10),c(this.svgD3,{beforeOffsetOpacity:1,color:D,offset:1,opacity:1,x:0,y:0},{color:D,offset:100,opacity:.2,x:1,y:0},"positiveGreen",.25,10),this.barMode=o.barMode||m,this.svgD3.classed(this.barMode+"-bar",!0),this.topbar=new q(this,this.baseElD3,this.visData),this.svgD3.attr("viewBox","0 0 "+this.width+" "+this.height),this.container=this.svgD3.append("g"),this.columns=new L(this.container,this.visData),this.links=new W(this.columns.groups,this.visData,this.layout),this.nodes=new E(this.columns.groups,this.visData,this.links,this.events,o.barMode||m),this.columns.scrollPreparation(this,this.scrollbarWidth),this.scrollbars=new d(this.columns.groups,this.visData,this.scrollbarWidth),this.$levels=t(this.columns.groups[0]).on("mousewheel",function(t){u.mousewheelColumn(this,t)}),this.scrollbars.selection.on("mousedown",function(){u.scrollbarMouseDown(this,e.event)}),e.select(document).on("mouseup",function(){r.globalMouseUp(e.event)}).on("mousemove",function(){r.globalMouseMove(e.event)})}return h.createClass(i,[{key:"globalMouseUp",value:function(t){if(this.activeScrollbar){var e=this.activeScrollbar.datum(),s=e.scrollbar.clientY-t.clientY;e.scrollbar.scrollTop=Math.min(Math.max(e.scrollbar.scrollTop-s,0),e.scrollbar.scrollHeight),e.scrollTop=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(s),0),-e.scrollHeight),this.activeScrollbar.classed("active",!1),this.activeScrollbar=void 0}}},{key:"globalMouseMove",value:function(t){if(this.activeScrollbar){var e=this.activeScrollbar.datum(),s=e.scrollbar.clientY-t.clientY;i.scrollY(this.activeScrollbar.node(),Math.min(Math.max(e.scrollbar.scrollTop-s,0),e.scrollbar.scrollHeight));var a=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(s),0),-e.scrollHeight);i.scrollY(e.nodes,a),this.links.scroll(e.linkSelections.outgoing,this.layout.offsetLinks(e.level,a,"source")),this.links.scroll(e.linkSelections.incoming,this.layout.offsetLinks(e.level-1,a,"target"))}}},{key:"scrollbarMouseDown",value:function(t,s){this.activeScrollbar=e.select(t).classed("active",!0),this.activeScrollbar.datum().scrollbar.clientY=s.clientY}},{key:"mousewheelColumn",value:function(t,s){s.preventDefault();var a=e.select(t).datum();a.scrollHeight>0&&(a.scrollTop=Math.max(Math.min(a.scrollTop+s.deltaY,0),-a.scrollHeight),i.scrollY(a.nodes,a.scrollTop),a.scrollbar.scrollTop=a.scrollbar.heightScale(-a.scrollTop),i.scrollY(a.scrollbar.el,a.scrollbar.scrollTop),this.links.scroll(a.linkSelections.outgoing,this.layout.offsetLinks(a.level,a.scrollTop,"source")),this.links.scroll(a.linkSelections.incoming,this.layout.offsetLinks(a.level-1,a.scrollTop,"target")))}},{key:"selectByColumn",value:function(t,s){return e.select(this.columns.groups[0][t]).selectAll(s)}},{key:"sortColumn",value:function(t,e,s,i){this.nodes.sort(this.layout.sort(t,e,s).nodes(t),i),this.links.sort(this.layout.links(t-1,t+1))}},{key:"switchBarMode",value:function(t){this.svgD3.classed("one-bar","one"===t),this.svgD3.classed("two-bar","two"===t),this.nodes.bars.switchMode(t,this.currentSorting)}},{key:"barMode",get:function(){return this.bars?this.nodes.bars.mode:this._barMode},set:function(t){this.bars&&(this.nodes.bars.mode=t),this._barMode=t}}],[{key:"scrollY",value:function(t,s){e.select(t).attr("transform","translate(0, "+s+")")}}]),i}();return X}($,d3);
//# sourceMappingURL=listGraph.min.js.map
