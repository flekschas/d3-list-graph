/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
!function(){"use strict";function t(t,a){try{d3.select(t).attr("transform","translate(0, "+a+")")}catch(e){console.err("ListGraph is not properly initialized!",e)}}function a(t,a,e,l,n){a.data(function(){return t.offsetLinks(e,l,n)}).attr("d",f).exit().remove()}function e(e,l){e.preventDefault(),this.__data__.scrollHeight>0&&(this.__data__.scrollTop=Math.max(Math.min(this.__data__.scrollTop+e.deltaY,0),-this.__data__.scrollHeight),t(this.__data__.scrollEl,this.__data__.scrollTop),this.__data__.scrollbar.el.__data__.scrollTop=this.__data__.scrollbar.heightScale(-this.__data__.scrollTop),t(this.__data__.scrollbar.el,this.__data__.scrollbar.el.__data__.scrollTop),a(l,this.__data__.linkSelections.outgoing,this.__data__.level,this.__data__.scrollTop,"source"),a(l,this.__data__.linkSelections.incoming,this.__data__.level-1,this.__data__.scrollTop,"target"))}function l(t,a){var e=this.querySelector(".nodes"),l=this.querySelector(".scrollbar"),n=e.getBoundingClientRect().height+2*a.row.padding,o=n-g,r=o>0?Math.max(g*g/o,10):0;t.height=n,t.linkSelections={incoming:this.previousSibling?d3.select(this.previousSibling).selectAll(".link"):null,outgoing:d3.select(this).selectAll(".link")},t.scrollEl=e,t.scrollHeight=o,t.scrollTop=0,t.scrollbar={el:l,x:t.x+a.column.width-u,y:0,width:u,height:r,scrollHeight:g-r,heightScale:d3.scale.linear().domain([0,o]).range([0,g-r])}}function n(t,a){for(;t.parent;)t=t.parent,a(t)}function o(t,a){for(var e=t.childRefs.length;e--;)a(t.childRefs[e]),o(t.childRefs[e],a)}function r(t,a){n(t,a),o(t,a);for(var e=t.childRefs.length;e--;)a(t.childRefs[e]),o(t.childRefs[e],a)}function i(t){t.append("foreignObject").attr("x",function(t){return t.x+d.global.column.padding+d.global.cell.padding}).attr("y",function(t){return t.y+d.global.row.padding+d.global.cell.padding}).attr("width",d.global.column.contentWidth).attr("height",d.global.row.contentHeight/2-2*d.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).append("xhtml:span").text(function(t){return t.data.name})}function c(t,a,e,l,n){t.attr("class",l).attr("x",a.x+d.global.column.padding+d.global.cell.padding).attr("y",function(t,l){return a.y+d.global.row.padding+d.global.row.contentHeight/2+e*l+d.global.cell.padding*(1+2*l)}).attr("width",function(t){return(n?t.value:1)*(d.global.column.contentWidth-2*d.global.cell.padding)}).attr("height",e)}function s(t){var a=t.datum(),e=a.data.bars,l=d.global.row.contentHeight/(2*a.data.bars.length)-2*d.global.cell.padding,n=t.selectAll(".bar").data(e).enter().append("g").attr("class","bar");n.append("rect").call(c,a,l,"bar-border"),n.append("rect").call(c,a,l,"bar-magnitude",!0)}function _(t){t.append("g").classed("bars",!0).call(s)}var d,h=800,g=200,u=6,p=new D3LayoutListGraph([h,g],[5,5]),f=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),b=d3.select("body").append("svg").attr("width",h).attr("height",g),v=b.append("g");d3.json("data.json",function(n,o){if(n)throw n;d=p.process(o,["1","2"]),f.source(function(t){return{x:t.source.y+t.source.offsetY+d.global.row.height/2,y:t.source.x+t.source.offsetX+d.global.column.contentWidth+d.global.column.padding}}).target(function(t){return{x:t.target.y+t.target.offsetY+d.global.row.height/2,y:t.target.x+t.target.offsetX+d.global.column.padding}}).projection(function(t){return[t.y,t.x]});var c=v.selectAll("g").data(d.nodes).enter().append("g").attr("class","level");c.append("rect").attr("class","scroll-container").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return d.global.column.width}).attr("height",function(t){return d.global.column.height});var s=c.append("g").attr("class","links"),h=(s.selectAll(".link").data(function(t,a){return p.links(a)}).enter().append("path").attr("class","link").attr("d",f),c.append("g").attr("class","nodes")),g=h.selectAll("g.node").data(function(t){return t.rows}).enter().append("g").classed("node",!0).classed("clone",function(t){return t.clone});g.append("rect").attr("x",function(t){return t.x+d.global.column.padding}).attr("y",function(t){return t.y+d.global.row.padding}).attr("width",d.global.column.contentWidth).attr("height",d.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bg",!0),g.on("mouseover",function(t){t.hovering=1,r(t,function(t){t.hovering=2}),d3.select(this).classed("hovering-directly",!0),g.classed("hovering-indirectly",function(t){return 2===t.hovering})}),g.on("mouseout",function(t){t.hovering=0,r(t,function(t){t.hovering=0}),d3.select(this).classed("hovering-directly",!1),g.classed("hovering-indirectly",!1)}),g.call(i),g.each(function(t){d3.select(this).call(_)});var b=c.append("rect").classed("scrollbar",!0);c.each(function(t){l.call(this,t,d.global)}),b.attr("x",function(t){return t.scrollbar.x}).attr("y",function(t){return t.scrollbar.y}).attr("width",function(t){return u}).attr("height",function(t){return t.scrollbar.height}).attr("rx",u/2).attr("ry",u/2).classed("ready",!0);var m;$(c[0]).on("mousewheel",function(t){e.call(this,t,p)}),$(b[0]).each(function(){this.__data__={clientY:null,scrollTop:0};for(var t=Object.keys(this.parentNode.__data__.scrollbar),a=t.length;a--;)this.__data__[t[a]]=this.parentNode.__data__.scrollbar[t[a]];this.__data__.invertedHeightScale=this.__data__.heightScale.invert,this.__data__.contentEl=this.parentNode.querySelector(".nodes")}).on("mousedown",function(t){m=this,m.__data__.clientY=t.clientY,d3.select(m).classed("active",!0)}),$(document).on("mouseup",function(t){if(m){var a=m.__data__.clientY-t.clientY;m.__data__.scrollTop=Math.min(Math.max(m.__data__.scrollTop-a,0),m.__data__.scrollHeight);var e=m.__data__.contentEl;e.__data__.scrollTop=Math.max(Math.min(e.__data__.scrollTop+m.__data__.invertedHeightScale(a),0),-e.__data__.scrollHeight),d3.select(m).classed("active",!1),m=void 0}}).on("mousemove",function(e){if(m){var l=m.__data__.clientY-e.clientY;t(m,Math.min(Math.max(m.__data__.scrollTop-l,0),m.__data__.scrollHeight));var n=m.__data__.contentEl,o=Math.max(Math.min(n.__data__.scrollTop+m.__data__.invertedHeightScale(l),0),-n.__data__.scrollHeight);t(n,o),a(p,n.__data__.linkSelections.outgoing,n.__data__.level,o,"source"),a(p,n.__data__.linkSelections.incoming,n.__data__.level-1,o,"target")}})})}();
//# sourceMappingURL=listGraph.min.js.map
