/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
var ListGraph=function(t,e){"use strict";function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function s(t){var e=i(t)?Z.call(t):"";return e==J||e==Q}function o(t){return t&&t.Object===Object?t:null}function n(t){return"number"==typeof t&&lt(t)}function l(t){var e=t;t.clone&&(e=t.originalNode);var i=[e];return e.clones.length&&(i=i.concat(e.clones)),i}function a(t,e,i,s,o){for(var r=s?l(t):[t],c=r.length;c--;)if(o&&e(r[c],o),!n(i)||i>0)for(var h=Object.keys(r[c].parents),d=h.length;d--;)a(r[c].parents[h[d]],e,i-1,s,r[c])}function r(t,e,i,s){for(var o=s?l(t):[t],a=o.length;a--;)if(e(o[a]),!n(i)||i>0)for(var c=o[a].childRefs.length;c--;)r(o[a].childRefs[c],e,i-1,s)}function c(t,e,i,s,o){i?(a(t,e,s,o),r(t,i,s,o)):(a(t,e,s,o),r(t,e,s,o))}function h(t,e){for(var i=Object.keys(t.parents),s=i.length;s--;)for(var o=t.parents[i[s]].childRefs.length;o--;)e(t.parents[i[s]].childRefs[o]);if(t.siblings)for(var n=Object.keys(t.siblings),s=n.length;s--;)e(t.siblings[n[s]])}function d(t,e,i,s,o){var n=o.topLeft||0,l=o.topRight||0,a=o.bottomLeft||0,r=o.bottomRight||0;return"M"+(t+n)+","+e+"h"+(i-n-l)+"a"+l+","+l+" 0 0 1 "+l+","+l+"v"+(s-(l+r))+"a"+r+","+r+" 0 0 1 "+-r+","+r+"h"+(a-(i-r))+"a"+a+","+a+" 0 0 1 "+-a+","+-a+"v"+(n-(s-a))+"a"+n+","+n+" 0 0 1 "+n+","+-n+"z"}function u(t){function i(t){t.each(function(){s[0].push(this)})}for(var s=e.selectAll(".d3-list-graph-not-existent"),o=t.length;o--;)i(t[o]);return s}function v(t,e){0===t.size()&&e();var i=0;t.each(function(){return++i}).each("end",function(){for(var t=arguments.length,s=Array(t),o=0;t>o;o++)s[o]=arguments[o];--i||e.apply(this,s)})}function g(t,i,s,o,n,l,a,r){var c=e.behavior.drag(),h=a||{};i&&c.on("dragstart",function(){"function"==typeof a&&(h=a()),i()}),s&&c.on("drag",function(t){s.call(this,t,n,l,h,r)}),o&&c.on("dragend",o),t.each(function(t){var i=e.select(this);t||(t={dragX:0,dragY:0},i.datum(t)),i.call(c)})}function p(t,i,s,o,n){function l(t,e){var i=void 0;if(e)try{i=Math.min(e.max,Math.max(e.min,t))}catch(s){throw new At}return i}for(var a=n.length;a--;)if(n[a]())return;var r=e.select(this);i&&i.length&&(r=u(i)),"horizontal"===s||"vertical"===s?("horizontal"===s&&(t.dragX+=e.event.dx,t.dragX=l(t.dragX+e.event.dx,o.x),r.style("transform","translateX("+t.dragX+"px)")),"vertical"===s&&(t.dragY+=e.event.dy,t.dragX=l(t.dragY+e.event.dy,o.y),r.style("transform","translateY("+t.dragY+"px)"))):(t.dragX+=e.event.dx,t.dragY+=e.event.dy,r.style("transform","translate("+t.dragX+"px,"+t.dragY+"px)"))}function f(t,e,i){return i?t||e:"undefined"!=typeof t?t:e}var b={};b.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},b.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),b.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},b.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var y=function(t){function e(t){b.classCallCheck(this,e);var i=b.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.name=i.constructor.name,i.message=t,Error.captureStackTrace(i,i.constructor.name),i}return b.inherits(e,t),e}(Error),k=function(t){function e(t){return b.classCallCheck(this,e),b.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"D3.layout.listGraph.js has not been loaded yet."))}return b.inherits(e,t),e}(y),m=function(t){function e(t){return b.classCallCheck(this,e),b.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"Dispatcher needs to be a function."))}return b.inherits(e,t),e}(y),w="list-graph",D=6,L=5,S=5,x="",N=-1,C="one",B=!0,M=0,O=0,P=!1,A=!1,W=!1,H=150,q=250,R="div",E="top-bar",T="ul",I="controls",V="global-controls",F=function(){function t(i,s,o){var n=this;b.classCallCheck(this,t);var l=this;this.vis=i,this.visData=o,this.el=s.select("."+E),this.el.empty()&&(this.el=s.insert(R,":first-child").attr("class",E)),this.controlSwitch=this.el.append("div").attr("title","Toggle global / local topbar").style("width",this.visData.global.column.padding+"px").classed("control-switch",!0).on("click",this["switch"].bind(this)),this.switchArrow=this.controlSwitch.append("svg").append("use").attr("xlink:href",this.vis.iconPath+"#arrow-down").attr("class","switch-arrow"),this.globalControls=this.el.append(T).classed(V,!0),this.globalPrecision=this.globalControls.append("li").attr("class","control-btn sort-precision").classed("active",function(){return"precision"===l.vis.currentSorting.global.type?(l.vis.currentSorting.global.el=e.select(this),!0):!1}).on("click",function(){l.sortAllColumns(this,"precision")}).on("mouseenter",function(){n.vis.interactionWrapper.call(n.vis,function(){n.highlightBars(void 0,"precision")},[])}).on("mouseleave",function(){n.vis.interactionWrapper.call(n.vis,function(){n.highlightBars(void 0,"precision",!0)},[])}),this.globalPrecisionWrapper=this.globalPrecision.append("div").attr("class","wrapper"),this.globalPrecisionWrapper.append("span").attr("class","label").text("Precision"),this.globalPrecisionWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","precision"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalRecall=this.globalControls.append("li").attr("class","control-btn sort-recall").classed("active",function(){return"recall"===l.vis.currentSorting.global.type?(l.vis.currentSorting.global.el=e.select(this),!0):!1}).on("click",function(){l.sortAllColumns(this,"recall")}).on("mouseenter",function(){n.vis.interactionWrapper.call(n.vis,function(){n.highlightBars(void 0,"recall")},[])}).on("mouseleave",function(){n.vis.interactionWrapper.call(n.vis,function(){n.highlightBars(void 0,"recall",!0)},[])}),this.globalRecallWrapper=this.globalRecall.append("div").attr("class","wrapper"),this.globalRecallWrapper.append("span").attr("class","label").text("Recall"),this.globalRecallWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","recall"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalName=this.globalControls.append("li").attr("class","control-btn sort-name").classed("active",function(){return"name"===l.vis.currentSorting.global.type?(l.vis.currentSorting.global.el=e.select(this),!0):!1}).on("click",function(){l.sortAllColumns(this,"name")}).on("mouseenter",function(){n.vis.interactionWrapper.call(n.vis,function(){n.highlightLabels()},[])}).on("mouseleave",function(){n.vis.interactionWrapper.call(n.vis,function(){n.highlightLabels(!0)},[])}),this.globalNameWrapper=this.globalName.append("div").attr("class","wrapper"),this.globalNameWrapper.append("span").attr("class","label").text("Name"),this.globalNameWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","name"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalNameWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-asc"),this.globalNameWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-desc"),this.globalOneBar=this.globalControls.append("li").attr("class","control-btn one-bar").classed("active","one"===this.vis.barMode).on("click",function(){l.switchBarMode(this,"one")}),this.globalOneBarWrapper=this.globalOneBar.append("div").attr("class","wrapper").text("One bar"),this.globalOneBarWrapper.append("svg").attr("class","icon-one-bar").append("use").attr("xlink:href",this.vis.iconPath+"#one-bar"),this.globalTwoBars=this.globalControls.append("li").attr("class","control-btn two-bars").classed("active","two"===this.vis.barMode).on("click",function(){l.switchBarMode(this,"two")}),this.globalTwoBarsWrapper=this.globalTwoBars.append("div").attr("class","wrapper").text("Two bars"),this.globalTwoBarsWrapper.append("svg").attr("class","icon-two-bars").append("use").attr("xlink:href",this.vis.iconPath+"#two-bars"),this.globalZoomOut=this.globalControls.append("li").attr("class","control-btn zoom-out").classed("active",this.vis.zoomedOut).on("mouseenter",function(){n.vis.interactionWrapper.call(n.vis,function(){n.vis.globalView.call(n.vis)},[])}).on("mouseleave",function(){n.vis.interactionWrapper.call(n.vis,function(){n.vis.zoomedView.call(n.vis)},[])}).on("click",function(){l.vis.toggleView.call(l.vis),e.select(this).classed("active",l.vis.zoomedOut)}),this.globalZoomOutWrapper=this.globalZoomOut.append("div").attr("class","wrapper").text("Zoom Out").style("margin-right",this.visData.global.column.padding+"px"),this.globalZoomOutWrapper.append("svg").attr("class","icon-zoom-out").append("use").attr("xlink:href",this.vis.iconPath+"#zoom-out"),this.localControlWrapper=this.el.append("div").classed("local-controls",!0),this.localControls=this.localControlWrapper.selectAll(I).data(o.nodes).enter().append(T).classed(I,!0).style("width",this.visData.global.column.width+"px"),this.localControls.each(function(t,i){var s=e.select(this);l.vis.currentSorting.local[i]={type:t.sortBy,order:t.sortOrder,el:void 0},s.append("li").attr("class","control-btn toggle").style("width",l.visData.global.column.padding+"px").on("click",l.toggleColumn),s.append("li").attr("class","control-btn sort-precision ease-all").classed("active",function(){return"precision"===l.vis.currentSorting.local[i].type?(l.vis.currentSorting.local[i].el=e.select(this),!0):!1}).style({width:l.visData.global.column.contentWidth/2+"px",left:l.visData.global.column.padding+"px"}).on("click",function(t){l.sortColumn(this,t.level,"precision")}).on("mouseenter",function(){l.highlightBars(this.parentNode,"precision"),e.select(this).style("width",l.visData.global.column.contentWidth-16+"px")}).on("mouseleave",function(){l.highlightBars(this.parentNode,"precision",!0),e.select(this).style("width",l.visData.global.column.contentWidth/2+"px")}).html('<div class="expandable-label">  <span class="letter abbr">P</span>  <span class="letter abbr">r</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">i</span>  <span class="letter">s</span>  <span class="letter">i</span>  <span class="letter">o</span>  <span class="letter">n</span></div><svg class="icon-unsort invisible-default '+("precision"!==l.vis.currentSorting.local[i].type?"visible":"")+'">  <use xlink:href="'+l.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("precision"===l.vis.currentSorting.local[i].type&&1===l.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+l.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("precision"===l.vis.currentSorting.local[i].type&&1!==l.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+l.vis.iconPath+'#sort-desc"></use></svg>'),s.append("li").attr("class","control-btn sort-recall ease-all").classed("active",function(){return"recall"===l.vis.currentSorting.local[i].type?(l.vis.currentSorting.local[i].el=e.select(this),!0):!1}).style({width:l.visData.global.column.contentWidth/2+"px",left:l.visData.global.column.contentWidth/2+l.visData.global.column.padding+"px"}).on("click",function(t){l.sortColumn(this,t.level,"recall")}).on("mouseenter",function(){l.highlightBars(this.parentNode,"recall"),e.select(this).style({width:l.visData.global.column.contentWidth-16+"px",left:l.visData.global.column.padding+16+"px"})}).on("mouseleave",function(){l.highlightBars(this.parentNode,"recall",!0),e.select(this).style({width:l.visData.global.column.contentWidth/2+"px",left:l.visData.global.column.contentWidth/2+l.visData.global.column.padding+"px"})}).html('<div class="expandable-label">  <span class="letter abbr">R</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">a</span>  <span class="letter abbr">l</span>  <span class="letter">l</span></div><svg class="icon-unsort invisible-default '+("recall"!==l.vis.currentSorting.local[i].type?"visible":"")+'">  <use xlink:href="'+l.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("recall"===l.vis.currentSorting.local[i].type&&1===l.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+l.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("recall"===l.vis.currentSorting.local[i].type&&1!==l.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+l.vis.iconPath+'#sort-desc"></use></svg>'),s.append("li").attr("class","control-btn options").style("width",l.visData.global.column.padding+"px").on("click",l.toggleOptions).html('<svg class="icon-gear">  <use xlink:href="'+l.vis.iconPath+'#gear"></use></svg>'),l.vis.currentSorting.local[i].type&&(l.vis.currentSorting.local[i].el=s.select(".sort-"+l.vis.currentSorting.local[i].type))})}return b.createClass(t,[{key:"selectNodesLevel",value:function(t){return this.vis.selectByLevel(e.select(t).datum().level,".node")}},{key:"highlightLabels",value:function(t){this.vis.baseElD3.selectAll(".node").classed("highlight-label",!t)}},{key:"highlightBars",value:function(t,e,i){var s=t?this.selectNodesLevel(t):this.vis.baseElD3.selectAll(".node");s.classed("highlight-bar",!i).selectAll(".bar."+e).classed("highlight",!i)}},{key:"sortAllColumns",value:function(t,i){this.semiActiveSortingEls&&this.resetSemiActiveSortingEls(),this.vis.currentSorting.global.type!==i&&this.vis.currentSorting.global.el&&this.resetSortEl(this.vis.currentSorting.global.el,i),this.vis.currentSorting.global.el=e.select(t),this.vis.currentSorting.global.el.classed("active",!0),this.vis.currentSorting.global.type=i;for(var s=Object.keys(this.vis.currentSorting.local),o=0,n=s.length;n>o;o++)this.sortColumn(t,s[o],i,!0);this.vis.sortAllColumns(i,!0)}},{key:"sortColumn",value:function(t,i,s,o){o||(this.semiActiveSortingEls&&this.resetSemiActiveSortingEls(),this.vis.currentSorting.global.type&&this.resetSortEl(this.vis.currentSorting.global.el,s),this.vis.currentSorting.global.type=void 0);var n=!1;this.vis.currentSorting.local[i].el&&this.vis.currentSorting.local[i].type!==s&&this.resetSortEl(this.vis.currentSorting.local[i].el,s),this.vis.currentSorting.local[i].type!==s&&(n=!0,this.vis.currentSorting.local[i].order=0),this.vis.currentSorting.local[i].el=e.select(t),this.vis.currentSorting.local[i].type=s,-1===this.vis.currentSorting.local[i].order?(this.vis.currentSorting.local[i].order=1,this.vis.currentSorting.local[i].el.select(".icon-sort-desc").classed("visible",!1),this.vis.currentSorting.local[i].el.select(".icon-sort-asc").classed("visible",!0)):(this.vis.currentSorting.local[i].order=-1,this.vis.currentSorting.local[i].el.select(".icon-sort-asc").classed("visible",!1),this.vis.currentSorting.local[i].el.select(".icon-sort-desc").classed("visible",!0)),this.vis.currentSorting.local[i].el.select(".icon-unsort").classed("visible",!1),this.vis.currentSorting.local[i].el.classed("active",!0),o||this.vis.sortColumn(i,s,this.vis.currentSorting.local[i].order,n)}},{key:"resetSortEl",value:function(t,e){t.classed("active",!1),t.select(".icon-sort-desc").classed("visible",!1),t.select(".icon-sort-asc").classed("visible",!1),t.select(".icon-unsort").classed("visible",!0),"name"===e&&(t.classed("semi-active",!0),this.semiActiveSortingEls=!0)}},{key:"resetSemiActiveSortingEls",value:function(){this.el.selectAll(".semi-active").classed("semi-active",!1)}},{key:"switch",value:function(){this.el.classed("details",!this.el.classed("details"))}},{key:"switchBarMode",value:function(t,e){this.vis.nodes.barMode!==e&&("one"===e?(this.globalOneBar.classed("active",!0),this.globalTwoBars.classed("active",!1)):(this.globalOneBar.classed("active",!1),this.globalTwoBars.classed("active",!0)),this.vis.switchBarMode(e))}}]),t}(),z="column",G="scroll-container",j=function(){function t(e,i,s){var o=this;b.classCallCheck(this,t),this.vis=i,this.visData=s,this.groups=e.selectAll("g").data(this.visData.nodes).enter().append("g").attr("class",z).classed("active",function(t,e){return o.vis.highlightActiveLevel?o.vis.nodes&&o.vis.nodes.rootedNode?e===o.vis.activeLevel:e===o.vis.activeLevel-o.vis.noRootActiveLevelDiff:!1}),this.groups.append("rect").attr("class",G).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",this.visData.global.column.width+1).attr("height",this.visData.global.column.height)}return b.createClass(t,[{key:"scrollPreparation",value:function(t,i){var s=this;this.groups.each(function(o,n){var l=o.nodes.getBoundingClientRect().height+2*s.visData.global.row.padding,a=l-s.visData.global.column.height,r=a>0?Math.max(s.visData.global.column.height*s.visData.global.column.height/l,10):0;o.height=l,o.linkSelections={incoming:n>0?t.selectByLevel(n-1,".link"):null,outgoing:t.selectByLevel(n,".link")},o.scrollHeight=a,o.scrollTop=0,o.scrollbar={el:void 0,x:o.x+s.visData.global.column.width-i,y:0,width:i,height:r,scrollHeight:s.visData.global.column.height-r,scrollTop:0,heightScale:e.scale.linear().domain([0,a]).range([0,s.visData.global.column.height-r])},o.invertedHeightScale=o.scrollbar.heightScale.invert})}},{key:"updateScrollProperties",value:function(){var t=this;this.groups.each(function(i){var s=i.nodes.getBoundingClientRect().height+2*t.visData.global.row.padding,o=s-t.visData.global.column.height,n=o>0?Math.max(t.visData.global.column.height*t.visData.global.column.height/s,10):0;i.height=s,i.scrollHeight=o,i.scrollTop=0,i.scrollbar.y=0,i.scrollbar.height=n,i.scrollbar.scrollHeight=t.visData.global.column.height-n,i.scrollbar.scrollTop=0,i.scrollbar.heightScale=e.scale.linear().domain([0,o]).range([0,t.visData.global.column.height-n])})}},{key:"updateVisibility",value:function(){this.groups.each(function(){var t=e.select(this);t.classed("hidden",t.selectAll(".node").filter(function(t){return!t.hidden}).empty())})}},{key:"focus",value:function(t){this.vis.highlightActiveLevel&&this.groups.filter(function(e){return e.level===t}).classed("active",!0)}},{key:"blur",value:function(t){this.vis.highlightActiveLevel&&(t?this.groups.filter(function(e){return e.level===t}).classed("active",!1):this.groups.classed("active",!1))}},{key:"className",get:function(){return z}},{key:"height",get:function(){return this.visData.global.column.height}}]),t}(),Y="links",U="link",X=function(){function t(i,s,o,n){var l=this;b.classCallCheck(this,t),this.vis=i,this.visData=o,this.layout=n,this.groups=s.append("g").attr("class",Y).call(function(t){t.each(function(){e.select(this.parentNode).datum().links=this})}),this.links=this.groups.selectAll(U).data(function(t,e){return l.layout.links(e)}).enter().append("g").attr("class",U).classed("visible",!this.vis.hideOutwardsLinks||this.linkVisibility.bind(this)),this.links.append("path").attr({"class":U+"-bg",d:this.diagonal}),this.links.append("path").attr({"class":U+"-direct",d:this.diagonal})}return b.createClass(t,[{key:"linkVisibility",value:function(t){return t.hidden=this.vis.pointsOutside.call(this.vis,t),0===t.hidden}},{key:"highlight",value:function(t,e,i){this.links.filter(function(e){return t[e.id]}).classed(i,e)}},{key:"scroll",value:function(t,e){t.data(e),this.vis.hideOutwardsLinks&&t.classed("visible",this.linkVisibility.bind(this)),t.selectAll("path").attr("d",this.diagonal)}},{key:"sort",value:function(t){var i=function(){e.select(this).classed("sorting",!0)},s=function(){e.select(this).classed("sorting",!1)};this.links.data(t,function(t){return t.id}),this.links.selectAll("path").transition().duration(q).attr("d",this.diagonal).each("start",i).each("end",s)}},{key:"updateVisibility",value:function(){this.links.selectAll("path").classed("hidden",function(t){return t.target.node.hidden||t.source.node.hidden}).transition().duration(q).attr("d",this.diagonal)}},{key:"diagonal",get:function(){function t(t){return t.node.x+t.offsetX+this.visData.global.column.contentWidth+this.visData.global.column.padding}function e(t){return t.node.x+t.offsetX+this.visData.global.column.padding}function i(t){return t.node.y+t.offsetY+this.visData.global.row.height/2}var s=this,o=this.vis.showLinkLocation?6:0;return function(n){var l=i.call(s,n.source),a=t.call(s,n.source),r=i.call(s,n.target),c=e.call(s,n.target),h=(a+c)/2;return"M"+a+","+l+"h"+o+"C"+(h+o)+","+l+" "+(h-o)+","+r+" "+(c-o)+","+r+"h"+o}}}]),t}(),J="[object Function]",Q="[object GeneratorFunction]",_=Object.prototype,Z=_.toString,$={"function":!0,object:!0},K=$[typeof exports]&&exports&&!exports.nodeType?exports:void 0,tt=$[typeof module]&&module&&!module.nodeType?module:void 0,et=o(K&&tt&&"object"==typeof global&&global),it=o($[typeof self]&&self),st=o($[typeof window]&&window),ot=o($[typeof this]&&this),nt=et||st!==(ot&&ot.window)&&st||it||ot||Function("return this")(),lt=nt.isFinite,at="bar",rt=function(){function t(e,i,s,o,n){function l(e){var i=this,s=this.visData.nodes[this.nodeData.depth].sortBy;e.attr("d",function(e){return t.generatePath(e,i.bars.mode,s,i.visData)}).classed("bar-magnitude",!0)}function a(t){t.attr("x",0).attr("y",this.visData.global.row.padding).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bar-border",!0)}function r(t){t.attr({"class":"bar-indicator",x:0,y:this.visData.global.row.padding,width:2,height:4})}var c=this;b.classCallCheck(this,t),this.data=i,this.nodeData=s,this.visData=o,this.bars=n,this.data.x=s.x,this.data.level=s.depth,this.height=this.visData.global.row.contentHeight/(2*this.data.length)-2*this.visData.global.cell.padding,this.activeHeight=this.visData.global.row.contentHeight-2,this.inactiveheight=2*this.visData.global.cell.padding-1,this.selection=e.selectAll(at).data(this.data).enter().append("g").attr("class",function(t){return at+" "+t.id}).classed("active",function(t){return t.id===c.visData.nodes[c.nodeData.depth].sortBy}),this.selection.append("rect").call(a.bind(this)),this.selection.append("path").call(l.bind(this)),this.selection.append("rect").call(r.bind(this))}return b.createClass(t,null,[{key:"updateIndicator",value:function(t,e,i,s,o,n){var l=Math.min(e*Math.min(s,1)-1,e-2);t.attr({height:i,x:n?l:0}).classed("positive",function(t){return t.value>=s}).transition().duration(0).attr("width",n?2:o?l:0),o||n||t.transition().duration(q).attr("width",l)}},{key:"generatePath",value:function(e,i,s,o,n,l,a){return"two"===i?t.generateTwoBarsPath(e,o,a):t.generateOneBarPath(e,s,o,n,l)}},{key:"generateOneBarPath",value:function(t,e,i,s,o){var n=i.global.row.contentHeight,l=Math.min(t.value,1),a=Math.min(s,1),r=0,c=2,h={topLeft:2,bottomLeft:2};return s&&(h={}),t.id!==e&&"undefined"==typeof s?(r=l*i.global.column.contentWidth-3,h={}):s?(r=a*i.global.column.contentWidth,o&&(a>l&&(r=l*i.global.column.contentWidth),c=Math.max(Math.abs(a-l)*i.global.column.contentWidth,2))):c=i.global.column.contentWidth*l,r=Math.min(r,i.global.column.contentWidth-2),d(r,i.global.row.padding,c,n,h)}},{key:"generateTwoBarsPath",value:function(t,e,i){var s=Math.min(t.value,1),o=e.global.row.contentHeight/2,n=e.global.column.contentWidth*s,l=e.global.row.padding,a={topLeft:2};return i&&(a={bottomLeft:2},l+=o),d(0,l,n,o,a)}}]),t}(),ct="bars",ht=function(){function t(i,s,o,n){b.classCallCheck(this,t);var l=this;this.vis=i,this.mode=o,this.visData=n,this.selection=s.append("g").attr("class",ct),this.selection.each(function(t){new rt(e.select(this),t.data.bars,t,l.visData,l)})}return b.createClass(t,[{key:"updateAll",value:function(t,e){var i=this;this.selection.selectAll(".bar-magnitude").data(t,function(t){return t.barId}).transition().duration(q).attr("d",function(t){return rt.generatePath(t,i.mode,e,i.visData)})}},{key:"update",value:function(t,i){var s=this;t.each(function(t){var s=e.select(this);t.id!==i||s.classed("active")||(s.classed("active",!0),this.parentNode.insertBefore(this,this.parentNode.children[0])),t.id!==i&&s.classed("active",!1)}),t.selectAll(".bar-magnitude").transition().duration(q).attr("d",function(t){return rt.generatePath(t,s.mode,i,s.visData)})}},{key:"updateIndicator",value:function(t,e,i){rt.updateIndicator(t,this.visData.global.column.contentWidth,i?this.visData.global.row.contentHeight:4,e,this.vis.lessTransitionsJs,i)}},{key:"switchMode",value:function(t,e){var i=this;this.mode!==t&&("one"===t&&e.global.type&&this.selection.selectAll(".bar").selectAll(".bar-magnitude").transition().duration(q).attr("d",function(t){return rt.generateOneBarPath(t,e.global.type,i.visData)}),"two"===t&&(this.selection.selectAll(".bar.precision").selectAll(".bar-magnitude").transition().duration(q).attr("d",function(t){return rt.generateTwoBarsPath(t,i.visData)}),this.selection.selectAll(".bar.recall").selectAll(".bar-magnitude").transition().duration(q).attr("d",function(t){return rt.generateTwoBarsPath(t,i.visData,!0)})),this.mode=t)}}]),t}(),dt="nodes",ut="node",vt="clone",gt="label-wrapper",pt="focus-controls",ft="root",bt="query",yt="lock",kt="active",mt="inactive",wt="link-indicator",Dt="link-location-indicator",Lt="incoming",St="outgoing",xt="above",Nt="below",Ct=function(){function t(i,o,n,l,a){function r(t,e){var i="incoming"===e;t.attr("class",wt+" "+(i?Lt:St)).attr("d",d(i?-7:this.visData.global.column.contentWidth,this.visData.global.row.height/2-1,7,2,{topLeft:i?1:0,topRight:i?0:1,bottomLeft:i?1:0,bottomRight:i?0:1})).attr("fill",function(t){return g(t.links[e].refs.length)}).classed("visible",function(t){return t.links[e].refs.length>0})}function c(t,e,i){var s="above"===i,o="incoming"===e,n=Dt+" "+(o?Lt:St)+" "+(s?xt:Nt);t.datum(function(t){return t.links[e]}).attr("class",n).attr("x",o?-5:this.visData.global.column.contentWidth+2).attr("y",s?this.visData.global.row.height/2-1:this.visData.global.row.height/2+1).attr("width",3).attr("height",3).attr("fill",function(t){return g(t.refs.length)})}function h(t,e,i,s){var o=i||0;t.attr("x",o).attr("y",v.visData.global.row.padding+o).attr("width",v.visData.global.column.contentWidth-2*o).attr("height",v.visData.global.row.contentHeight-2*o).attr("rx",s?0:2-o).attr("ry",s?0:2-o).classed(e,!0)}var u=this;b.classCallCheck(this,t);var v=this;this.vis=i,this.visData=n,this.links=l,this.events=a,this.currentLinks={},this.iconDimension=Math.min(this.visData.global.row.contentHeight/2-2*this.visData.global.cell.padding,this.visData.global.column.padding/2-4);var g=e.scale.linear().domain([1,this.vis.rows]).range(["#ccc","#000"]);this.groups=o.append("g").attr("class",dt).call(function(t){t.each(function(){e.select(this.parentNode).datum().nodes=this})}),this.nodes=this.groups.selectAll("."+ut).data(function(t){return t.rows}).enter().append("g").classed(ut,!0).classed(vt,function(t){return t.clone}).attr("transform",function(t){return"translate("+(t.x+u.visData.global.column.padding)+", "+t.y+")"}).on("mouseenter",function(t){v.vis.interactionWrapper.call(v.vis,function(t,i){var s=e.select(t);this.vis.activeScrollbar||this.enterHandler.call(this,t,i),s.classed("rooted")||s.selectAll(".bg-extension").style("transform","translateX("+(this.vis.querying?2*-this.iconDimension-10:-this.iconDimension-6)+"px)")}.bind(v),[this,t])}).on("mouseleave",function(t){v.vis.interactionWrapper.call(v.vis,function(t,i){var s=e.select(t);this.vis.activeScrollbar||this.leaveHandler.call(this,t,i),s.classed("rooted")||(i.data.queryMode?s.selectAll(".bg-extension").style("transform","translateX("+(-this.iconDimension-6)+"px)"):s.selectAll(".bg-extension").style("transform","translateX(0px)"))}.bind(v),[this,t])}),this.nodes.append("rect").call(h,"bg-extension").attr("width",Math.max(this.visData.global.column.padding+this.visData.global.column.contentWidth/2,this.visData.global.column.contentWidth)),this.nodes.append("rect").call(h,"bg-border"),this.nodes.append("rect").call(h,"bg",1,!0),this.vis.showLinkLocation&&(this.nodes.append("rect").call(c.bind(this),"incoming","above"),this.nodes.append("rect").call(c.bind(this),"incoming","bottom"),this.nodes.append("rect").call(c.bind(this),"outgoing","above"),this.nodes.append("rect").call(c.bind(this),"outgoing","bottom"),this.nodes.append("path").call(r.bind(this),"incoming"),this.nodes.append("path").call(r.bind(this),"outgoing"),this.groups.each(function(t,e){u.calcHeightLinkLocationIndicator(e,!0,!0)}));var p=this.nodes.append("g").attr("class",pt+" "+ft+" "+mt);if(p.append("rect").call(this.setUpFocusControls.bind(this),"left",this.vis.querying?2:1,"hover-helper","hover-helper"),p.append("svg").call(this.setUpFocusControls.bind(this),"left",this.vis.querying?2:1,"icon","ease-all state-inactive invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#unlocked"),p.append("svg").call(this.setUpFocusControls.bind(this),"left",this.vis.querying?2:1,"icon","ease-all state-active invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#locked"),this.vis.querying){var f=this.nodes.append("g").attr("class",pt+" "+bt+" "+mt);f.append("rect").call(this.setUpFocusControls.bind(this),"left",1,"hover-helper","hover-helper"),f.append("svg").call(this.setUpFocusControls.bind(this),"left",1,"icon","ease-all state-inactive invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#set-inactive"),f.append("svg").call(this.setUpFocusControls.bind(this),"left",1,"icon","ease-all state-and-or invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#union"),f.append("svg").call(this.setUpFocusControls.bind(this),"left",1,"icon","ease-all state-not invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#not")}var y=this.nodes.append("g").attr("class",pt+" "+yt+" "+mt);y.append("circle").call(this.setUpFocusControls.bind(this),"right",0,"bg","bg"),y.append("svg").call(this.setUpFocusControls.bind(this),"right",0,"icon","ease-all state-inactive invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#unlocked"),y.append("svg").call(this.setUpFocusControls.bind(this),"right",0,"icon","ease-all state-active invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#locked"),this.bars=new ht(this.vis,this.nodes,this.vis.barMode,this.visData),
this.nodes.append("rect").call(h,"border"),this.nodes.append("foreignObject").attr("x",this.visData.global.cell.padding).attr("y",this.visData.global.row.padding+this.visData.global.cell.padding).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight-2*this.visData.global.cell.padding).attr("class",gt).append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).style("line-height",this.visData.global.row.contentHeight-2*this.visData.global.cell.padding+"px").append("xhtml:span").text(function(t){return t.data.name}),s(this.events.on)&&(this.events.on("d3ListGraphFocusNodes",function(t){return u.focusNodes(t)}),this.events.on("d3ListGraphBlurNodes",function(t){return u.blurNodes(t)}),this.events.on("d3ListGraphNodeEnter",function(t){return u.eventHelper(t,u.highlightNodes)}),this.events.on("d3ListGraphNodeLeave",function(t){return u.eventHelper(t,u.unhighlightNodes)}),this.events.on("d3ListGraphNodeLock",function(t){return u.eventHelper(t,u.toggleLock,[],".lock")}),this.events.on("d3ListGraphNodeUnlock",function(t){return u.eventHelper(t,u.toggleLock,[!0],".lock")}),this.events.on("d3ListGraphNodeRoot",function(t){return u.eventHelper(t.nodeIds,u.toggleRoot,[],".root")}),this.events.on("d3ListGraphNodeUnroot",function(t){return u.eventHelper(t.nodeIds,u.toggleRoot,[!0],".root")}))}return b.createClass(t,[{key:"updateLinkLocationIndicators",value:function(t,e){this.calcHeightLinkLocationIndicator(t,!1,!0),this.calcHeightLinkLocationIndicator(e,!0,!1)}},{key:"calcHeightLinkLocationIndicator",value:function(t,e,i){var s=this.nodes.filter(function(e){return e.depth===t});s.each(function(t){if(e){t.links.incoming.above=0,t.links.incoming.below=0;for(var s=t.links.incoming.total;s--;)(1&t.links.incoming.refs[s].hidden)>0&&t.links.incoming.above++,(2&t.links.incoming.refs[s].hidden)>0&&t.links.incoming.below++}if(i){t.links.outgoing.above=0,t.links.outgoing.below=0;for(var s=t.links.outgoing.total;s--;)(4&t.links.outgoing.refs[s].hidden)>0&&t.links.outgoing.above++,(8&t.links.outgoing.refs[s].hidden)>0&&t.links.outgoing.below++}}),e&&this.updateHeightLinkLocationIndicatorBars(s),i&&this.updateHeightLinkLocationIndicatorBars(s,!0)}},{key:"updateHeightLinkLocationIndicatorBars",value:function(t,e){var i=this.visData.global.row.contentHeight/2-1,s=this.visData.global.row.height/2-1,o="."+Dt+"."+(e?St:Lt);t.selectAll(o+"."+xt).attr("y",function(t){return t.total?s-t.above/t.total*i:s}).attr("height",function(t){return t.total?t.above/t.total*i:0}),t.selectAll(o+"."+Nt).attr("height",function(t){return t.total?t.below/t.total*i:0})}},{key:"clickHandler",value:function(t,e){this.toggleQueryMode(t.parentNode,e)}},{key:"enterHandler",value:function(t,e){this.highlightNodes(t,e);var i={id:e.id,clone:!1,clonedFromId:void 0};e.clone&&(i.clone=!0,i.clonedFromId=e.originalNode.id),this.events.broadcast("d3ListGraphNodeEnter",i)}},{key:"leaveHandler",value:function(t,e){this.unhighlightNodes(t,e);var i={id:e.id,clone:!1,clonedFromId:void 0};e.clone&&(i.clone=!0,i.clonedFromId=e.originalNode.id),this.events.broadcast("d3ListGraphNodeLeave",i)}},{key:"lockHandler",value:function(t){var e=this.toggleLock(t);e.locked&&e.unlocked?e.locked&&this.events.broadcast("d3ListGraphNodeLockChange",{lock:{id:e.locked.id,clone:e.locked.clone,clonedFromId:e.locked.clone?e.locked.originalNode.id:void 0},unlock:{id:e.unlocked.id,clone:e.unlocked.clone,clonedFromId:e.unlocked.clone?e.unlocked.originalNode.id:void 0}}):(e.locked&&this.events.broadcast("d3ListGraphNodeLock",{id:e.locked.id,clone:e.locked.clone,clonedFromId:e.locked.clone?e.locked.originalNode.id:void 0}),e.unlocked&&this.events.broadcast("d3ListGraphNodeUnlock",{id:e.unlocked.id,clone:e.unlocked.clone,clonedFromId:e.unlocked.clone?e.unlocked.originalNode.id:void 0}))}},{key:"rootHandler",value:function(t){var e=this.toggleRoot(t);e.rooted&&e.unrooted?this.events.broadcast("d3ListGraphNodeReroot",{rooted:{id:e.rooted.id,clone:e.rooted.clone,clonedFromId:e.rooted.clone?e.rooted.originalNode.id:void 0},unrooted:{id:e.unrooted.id,clone:e.unrooted.clone,clonedFromId:e.unrooted.clone?e.unrooted.originalNode.id:void 0}}):(e.rooted&&this.events.broadcast("d3ListGraphNodeRoot",{id:e.rooted.id,clone:e.rooted.clone,clonedFromId:e.rooted.clone?e.rooted.originalNode.id:void 0}),e.unrooted&&this.events.broadcast("d3ListGraphNodeUnroot",{id:e.unrooted.id,clone:e.unrooted.clone,clonedFromId:e.unrooted.clone?e.unrooted.originalNode.id:void 0})),this.events.broadcast("d3ListGraphUpdateBarsRequest",{id:e.rooted.id,clone:e.rooted.clone,clonedFromId:e.rooted.clone?e.rooted.originalNode.id:void 0})}},{key:"focusNodes",value:function(t){this.eventHelper(t.nodeIds,this.highlightNodes,["focus","directParentsOnly",!!t.excludeClones]),t.zoomOut?this.vis.globalView(this.nodes.filter(function(t){return t.hovering>0})):this.vis.zoomedView()}},{key:"blurNodes",value:function(t){this.eventHelper(t.nodeIds,this.unhighlightNodes,["focus","directParentsOnly",!!t.excludeClones]),t.zoomIn&&this.vis.zoomedView()}},{key:"eventHelper",value:function(t,i,s,o){var n=this;this.nodes.filter(function(e){return!!~t.indexOf(e.id)}).each(function(t){var l=this;o&&(l=e.select(this).select(o).node()),i.apply(n,[l,t].concat(s||[]))})}},{key:"toggleLock",value:function(t,i,s){var o=e.select(t),n=o.datum(),l={locked:!1,unlocked:!1};return this.lockedNode?(this.lockedNode.classed(kt,!1).classed(mt,!0),this.lockedNode.datum().id===n.id?(this.unlockNode(this.lockedNode.datum().id),l.unlocked=this.lockedNode.datum(),this.lockedNode=void 0):(this.unlockNode(this.lockedNode.datum().id),l.unlocked=this.lockedNode.datum(),s||(o.classed(kt,!0).classed(mt,!1),this.lockNode(n.id),l.locked=n,this.lockedNode=o))):s||(o.classed(kt,!0).classed(mt,!1),this.lockNode(n.id),l.locked=n,this.lockedNode=o),l}},{key:"lockNode",value:function(t){var i=this,s=this.nodes.filter(function(e){return e.id===t});s.each(function(t){i.highlightNodes(this,t,"lock",void 0)}),s.selectAll(".bg-border").transition().duration(q).attr("width",function(){return parseInt(e.select(this).attr("width"),10)+i.visData.global.row.height/2})}},{key:"unlockNode",value:function(t){var i=this,s=this.nodes.filter(function(e){return e.id===t}),o=function(){e.select(this.parentNode).classed("animating",!0)},n=function(){e.select(this.parentNode).classed("animating",!1)};s.selectAll(".bg-border").transition().duration(q).attr("width",this.visData.global.column.contentWidth).each("start",o).each("end",n),s.each(function(t){i.unhighlightNodes(this,t,"lock",void 0)})}},{key:"queryNode",value:function(t,i,s){i.data.queryMode=s,e.select(t).classed({active:!0,inactive:!1,"query-and":"and"===s,"query-or":"or"===s,"query-not":"not"===s})}},{key:"unqueryNode",value:function(t,i){i.data.queryMode=void 0,i.data.queryBeforeRooting=void 0,e.select(t).classed({active:!1,inactive:!0,"query-and":!1,"query-or":!1,"query-not":!1}),this.rootedNode&&this.updateVisibility()}},{key:"toggleQueryMode",value:function(t,e){var i=e.data.queryMode;if(e.rooted)"or"!==i?this.queryNode(t,e,"or"):this.queryNode(t,e,"and");else switch(i){case"or":this.queryNode(t,e,"and");break;case"and":this.queryNode(t,e,"not");break;case"not":this.unqueryNode(t,e);break;default:this.queryNode(t,e,"or")}e.data.queryMode?e.data.queryMode!==i&&this.events.broadcast("d3ListGraphNodeQuery",{id:e.id,clone:e.clone,clonedFromId:e.clone?e.originalNode.id:void 0,mode:e.data.queryMode}):this.events.broadcast("d3ListGraphNodeUnquery",{id:e.id,clone:e.clone,clonedFromId:e.clone?e.originalNode.id:void 0})}},{key:"progToggleQueryMode",value:function(t,i){this.toggleQueryMode(e.select(t).selectAll(".focus-controls.query")[0].node(),i)}},{key:"toggleRoot",value:function(t,i){var s=e.select(t),o=s.datum(),n={rooted:!1,unrooted:!1};return this.vis.levels.blur(),this.rootedNode?(this.rootedNode.classed({active:!1,inactive:!0}),this.unrootNode(this.rootedNode.node(),this.rootedNode.datum()),n.unrooted=this.rootedNode.datum(),this.rootedNode.datum().id===o.id||i?(this.rootedNode=void 0,this.vis.levels.focus(this.vis.activeLevel-this.vis.noRootActiveLevelDiff)):(s.classed({active:!0,inactive:!1}),this.rootNode(t,o),this.rootedNode=s,n.rooted=o)):i||(s.classed({active:!0,inactive:!1}),this.rootNode(t,o),n.rooted=o,this.rootedNode=s),n}},{key:"rootNode",value:function(t,i){var s=e.select(t.parentNode);i.rooted=!0,s.classed("rooted",!0),this.hideNodes(s.node(),i,"downStream"),s.selectAll(".bg-extension").style("transform","translateX("+(this.vis.querying?2*-this.iconDimension-10:-this.iconDimension-6)+"px)"),this.vis.levels.focus(i.depth+this.vis.activeLevel),i.data.queryMode&&"not"!==i.data.queryMode?i.data.queryBeforeRooting=!0:(this.toggleQueryMode(s.node(),i),i.data.queryBeforeRooting=!1)}},{key:"unrootNode",value:function(t,i){var s=e.select(t.parentNode),o=0;i.data.queryMode&&(o=-this.iconDimension-6),s.selectAll(".bg-extension").style("transform","translateX("+o+"px)"),i.rooted=!1,s.classed("rooted",!1),this.showNodes(s.node(),i,"downStream"),i.data.queryBeforeRooting||this.unqueryNode(s.node(),i)}},{key:"setUpFocusControls",value:function(t,e,i,s,o){var n=this.iconDimension+4,l="left"===e?-n*(i||1):this.visData.global.column.contentWidth+2,a=this.visData.global.row.padding+(this.visData.global.row.contentHeight-2*this.visData.global.cell.padding)/4;"bg"===s?t.attr({"class":o,cx:l+this.iconDimension/2,cy:a+this.iconDimension/2,r:3*this.iconDimension/4}):"hover-helper"===s?t.attr({"class":o,x:l-2,y:a-2,width:this.iconDimension+4,height:this.iconDimension+4}):t.attr({"class":o,x:l,y:a,width:this.iconDimension,height:this.iconDimension})}},{key:"hideNodes",value:function(t,e,i){this.nodesVisibility(t,e,i)}},{key:"showNodes",value:function(t,e,i){this.nodesVisibility(t,e,i,!0)}},{key:"nodesVisibility",value:function(t,e,i,s){s?this.nodes.classed("hidden",!1).each(function(t){t.hidden=!1}):(this.nodes.each(function(t){t.hidden=!0}),c(e,function(t){t.hidden=!1}),h(e,function(t){t.hidden=!1}),this.nodes.classed("hidden",function(t){return t.hidden&&!t.data.queryMode})),this.updateVisibility()}},{key:"highlightNodes",value:function(t,i,s,o,n){function l(t,e){return!e.hidden&&!p.vis.isHidden.call(p.vis,t)}function h(t){return 1===t.hovering&&l(this,t)}function d(t){return 2===t.hovering&&l(this,t)}function u(t){p.bars.updateIndicator(t,D.value,!0)}function v(t){p.bars.updateIndicator(t,D.value)}var g=this,p=this,f=i.id,b=i.clone?i.originalNode:i,y=!0,k=s||"hovering",m=!n,w="directParentsOnly"!==o;this.currentLinks[k]||(this.currentLinks[k]={}),this.currentLinks[k][f]={};var D=e.select(t).selectAll(".bar.active .bar-magnitude");D=D.empty()?void 0:D.datum();var L=function(t,e){t.hovering=2;for(var i=t.links.outgoing.refs.length;i--;)t.links.outgoing.refs[i].target.node.id===e.id&&(g.currentLinks[k][f][t.links.outgoing.refs[i].id]=!0)},S=function(t){t.hovering=2;for(var e=t.links.outgoing.refs.length;e--;)g.currentLinks[k][f][t.links.outgoing.refs[e].id]=!0};if(y&&w&&c(i,L,S,void 0,m),y&&!w&&a(i,L,void 0,m),!y&&w&&r(i,L,void 0,m),b.hovering=1,m)for(var x=b.clones.length;x--;)b.clones[x].hovering=1;var N=D?".bar."+D.id+" .bar-indicator":"",C=this.nodes.filter(h).classed(k+"-directly",!0),B=this.nodes.filter(d).classed(k+"-indirectly",!0);D&&(C.select(N).call(u),B.select(N).call(v)),this.links.highlight(this.currentLinks[k][i.id],!0,k)}},{key:"unhighlightNodes",value:function(t,e,i,s,o){var n=function(t){t.hovering=0},l=!0,h=i||"hovering",d=!o,u="directParentsOnly"!==s;if(e.hovering=0,l&&u&&c(e,n,void 0,void 0,d),l&&!u&&a(e,n,void 0,d),!l&&u&&r(e,n,void 0,d),e.clone)e.originalNode.hovering=0;else if(d)for(var v=e.clones.length;v--;)e.clones[v].hovering=0;this.nodes.classed(h+"-directly",!1),this.nodes.classed(h+"-indirectly",!1),this.currentLinks[h][e.id]&&this.links.highlight(this.currentLinks[h][e.id],!1,h)}},{key:"sort",value:function(t,e){for(var i=this,s=t.length;s--;){var o=this.nodes.data(t[s].rows,function(t){return t.id});this.vis.svgD3.classed("sorting",!0),o.transition().duration(q).attr("transform",function(t){return"translate("+(t.x+i.visData.global.column.padding)+", "+t.y+")"}).call(v,function(){i.vis.svgD3.classed("sorting",!1),i.vis.updateLevelsVisibility(),i.vis.updateScrolling()}),e&&"name"!==this.vis.currentSorting.local[t[s].level].type&&this.bars.update(o.selectAll(".bar"),t[s].sortBy)}}},{key:"updateVisibility",value:function(){var t=this;this.vis.layout.updateNodesVisibility(),this.nodes.transition().duration(q).attr("transform",function(e){return"translate("+(e.x+t.visData.global.column.padding)+", "+e.y+")"}).call(v,function(){t.vis.updateLevelsVisibility(),t.vis.updateScrolling()}),this.vis.links.updateVisibility()}},{key:"classNnodes",get:function(){return dt}},{key:"classNode",get:function(){return ut}},{key:"classClone",get:function(){return vt}},{key:"classLabelWrapper",get:function(){return gt}},{key:"classFocusControls",get:function(){return pt}},{key:"classRoot",get:function(){return ft}},{key:"classQuery",get:function(){return bt}},{key:"classLock",get:function(){return yt}},{key:"barMode",get:function(){return this.bars.mode}}]),t}(),Bt="scrollbar",Mt=function(){function t(i,s,o){b.classCallCheck(this,t),this.visData=s,this.width=o,this.all=i.append("rect").attr("class",Bt).call(function(t){t.each(function(){e.select(this.parentNode).datum().scrollbar.el=this})}).attr("x",function(t){return t.scrollbar.x-2}).attr("y",function(t){return t.scrollbar.y}).attr("width",this.width).attr("height",function(t){return t.scrollbar.height}).attr("rx",this.width/2).attr("ry",this.width/2).classed("ready",!0)}return b.createClass(t,[{key:"updateVisibility",value:function(){this.all.transition().duration(H).attr({x:function(t){return t.scrollbar.x},height:function(t){return t.scrollbar.height}})}}]),t}(),Ot=Array.isArray,Pt=function(){function t(e,i){if(b.classCallCheck(this,t),i&&!s(i))throw new m;this.el=e,this._stack={},this.dispatch=i||this._dispatchEvent}return b.createClass(t,[{key:"_dispatchEvent",value:function(t,e){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!1,!1,e),this.el.dispatchEvent(i)}},{key:"broadcast",value:function(t,e){this.dispatch(t,e)}},{key:"on",value:function(t,e,i){if(!s(e))return!1;var o=n(i)?parseInt(i,10):1/0;return Ot(this.stack[t])?this.stack[t].push({callback:e,times:o})-1:(this.stack[t]=[{callback:e,times:o}],0)}},{key:"off",value:function(t,e){try{return this.stack[t].splice(e,1),!0}catch(i){return!1}}},{key:"trigger",value:function(t,e){if(Ot(this.stack[t])){for(var i=this.stack[t].length;i--;)this.stack[t][i].times--?this.stack[t][i].callback(e):this.off(t,i);return!0}return!1}},{key:"stack",get:function(){return this._stack}}]),t}(),At=function(t){function e(t){return b.classCallCheck(this,e),b.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"The limits are wrongly formatted. Please provide an object of the following format: `{ x: { min: 0, max: 1 }, y: { min: 0, max: 1 } }`"))}return b.inherits(e,t),e}(y),Wt=function(){function i(s){var o=this;if(b.classCallCheck(this,i),!e.layout.listGraph)throw new k;var n=this;this.baseEl=s.element,this.baseElD3=e.select(this.baseEl),this.baseElJq=t(this.baseEl),this.svgD3=this.baseElD3.select("svg.base"),this.svgEl=this.svgD3.node(),this.svgD3.empty()?(this.svgD3=this.baseElD3.append("svg").attr("class","base"),this.svgJq=t(this.svgD3.node())):this.svgJq=t(this.svgD3.node()),this.rootNodes=s.rootNodes,this.width=f(s.width,this.svgJq.width(),!0),this.height=f(s.height,this.svgJq.height(),!0),this.svgD3.on("mouseenter",function(){n.getBoundingRect.call(n,this)}),this.scrollbarWidth=f(s.scrollbarWidth,D,!0),this.columns=f(s.columns,L,!0),this.rows=f(s.rows,S,!0),this.iconPath=f(s.iconPath,x,!0),this.querying=f(s.querying,P),this.hideOutwardsLinks=f(s.hideOutwardsLinks,A),this.showLinkLocation=f(s.showLinkLocation,W),this.linkLocationBucketSize=s.linkLocationBucketSize,this.highlightActiveLevel=f(s.highlightActiveLevel,B),this.activeLevel=f(s.activeLevel,M),this.noRootActiveLevelDiff=f(s.noRootActiveLevelDiff,O),this.lessTransitionsJs=s.lessTransitions>0,this.lessTransitionsCss=s.lessTransitions>1,this.baseElD3.classed("less-animations",this.lessTransitionsCss),this.sortBy=s.sortBy,this.sortOrder="asc"===s.sortOrder?1:N,this.events=new Pt(this.baseEl,s.dispatcher),this.baseElJq.addClass(w),s.forceWidth&&this.baseElJq.width(this.width),this.layout=new e.layout.listGraph([this.width,this.height],[this.columns,this.rows]),this.data=s.data,this.visData=this.layout.process(this.data,this.rootNodes,{showLinkLocation:this.showLinkLocation,linkLocationBucketSize:this.linkLocationBucketSize,sortBy:this.sortBy,sortOrder:this.sortOrder}),this.currentSorting={global:{type:this.sortBy,order:this.sortOrder},local:{}},this.barMode=s.barMode||C,this.svgD3.classed(this.barMode+"-bar",!0),this.topbar=new F(this,this.baseElD3,this.visData),this.svgD3.attr("viewBox","0 0 "+this.width+" "+this.height),this.container=this.svgD3.append("g").attr("class","main-container"),this.levels=new j(this.container,this,this.visData),this.links=new X(this,this.levels.groups,this.visData,this.layout),this.nodes=new Ct(this,this.levels.groups,this.visData,this.links,this.events),this.levels.scrollPreparation(this,this.scrollbarWidth),this.scrollbars=new Mt(this.levels.groups,this.visData,this.scrollbarWidth),this.svgJq.on("mousewheel","."+this.levels.className,function(t){n.zoomedOut||n.mousewheelColumn(this,t)}),this.querying&&this.svgJq.on("click","."+this.nodes.classLabelWrapper,function(){n.nodes.toggleQueryMode.call(n.nodes,this.parentNode,e.select(this).datum())}),this.svgJq.on("click","."+this.nodes.classFocusControls+"."+this.nodes.classRoot,function(){n.nodes.rootHandler.call(n.nodes,this,e.select(this).datum())}),this.querying&&this.svgJq.on("click","."+this.nodes.classFocusControls+"."+this.nodes.classQuery,function(){n.nodes.toggleQueryMode.call(n.nodes,this.parentNode,e.select(this).datum())}),this.svgJq.on("click","."+this.nodes.classFocusControls+"."+this.nodes.classLock,function(){n.nodes.lockHandler.call(n.nodes,this,e.select(this).datum())}),this.scrollbars.all.on("mousedown",function(){n.scrollbarMouseDown(this,e.event)}),e.select(document).on("mouseup",function(){o.globalMouseUp(e.event)}).on("mousemove",function(){o.globalMouseMove(e.event)}),this.svgD3.call(g,this.dragStartHandler.bind(this),p,this.dragEndHandler.bind(this),[this.container,this.topbar.localControlWrapper],"horizontal",this.getDragLimits.bind(this),[this.scrollbarDragging.bind(this)]),this.events.on("d3ListGraphLevelFocus",function(t){return o.levels.focus(t)}),this.events.on("d3ListGraphNodeRoot",function(){o.nodes.bars.updateAll(o.layout.updateBars(o.data),o.currentSorting.global.type),o.updateSorting()}),this.events.on("d3ListGraphNodeUnroot",function(){o.nodes.bars.updateAll(o.layout.updateBars(o.data),o.currentSorting.global.type),o.updateSorting()}),this.events.on("d3ListGraphUpdateBars",function(){o.nodes.bars.updateAll(o.layout.updateBars(o.data),o.currentSorting.global.type),o.updateSorting()}),this.events.on("d3ListGraphActiveLevel",function(t){var e=o.activeLevel;if(o.activeLevel=Math.max(t,0),o.nodes.rootedNode){var i=o.nodes.rootedNode.datum().depth;o.levels.blur(i+e),o.levels.focus(i+o.activeLevel)}else o.levels.blur(e-o.noRootActiveLevelDiff),o.levels.focus(o.activeLevel-o.noRootActiveLevelDiff)})}return b.createClass(i,[{key:"getDragLimits",value:function(){return{x:{min:this.dragMinX,max:0}}}},{key:"getBoundingRect",value:function(t){this.top=t.getBoundingClientRect().top,this.left=t.getBoundingClientRect().left}},{key:"interactionWrapper",value:function(t,e){this.noInteractions||t.apply(this,e)}},{key:"dragStartHandler",value:function(){this.noInteractions=!0,this.baseElD3.classed("unselectable",!0)}},{key:"dragEndHandler",value:function(){this.noInteractions=!1,this.baseElD3.classed("unselectable",!1)}},{key:"scrollbarDragging",value:function(){return!!this.activeScrollbar}},{key:"globalMouseUp",value:function(t){if(this.noInteractions=!1,this.activeScrollbar){this.baseElD3.classed("unselectable",!1);var e=this.activeScrollbar.datum(),i=e.scrollbar.clientY-t.clientY;e.scrollbar.scrollTop=Math.min(Math.max(e.scrollbar.scrollTop-i,0),e.scrollbar.scrollHeight),e.scrollTop=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(i),0),-e.scrollHeight),this.activeScrollbar.classed("active",!1),this.activeScrollbar=void 0}}},{key:"globalMouseMove",value:function(t){if(this.activeScrollbar){var e=this.activeScrollbar.datum(),s=e.scrollbar.clientY-t.clientY;i.scrollElVertically(this.activeScrollbar.node(),Math.min(Math.max(e.scrollbar.scrollTop-s,0),e.scrollbar.scrollHeight));var o=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(s),0),-e.scrollHeight);i.scrollElVertically(e.nodes,o),e.level!==this.visData.nodes.length&&this.links.scroll(e.linkSelections.outgoing,this.layout.offsetLinks(e.level,o,"source")),e.level>0&&this.links.scroll(e.linkSelections.incoming,this.layout.offsetLinks(e.level-1,o,"target")),this.showLinkLocation&&this.nodes.updateLinkLocationIndicators(e.level-1,e.level+1)}}},{key:"scrollbarMouseDown",value:function(t,i){this.noInteractions=!0,this.baseElD3.classed("unselectable",!0),this.activeScrollbar=e.select(t).classed("active",!0),this.activeScrollbar.datum().scrollbar.clientY=i.clientY}},{key:"mousewheelColumn",value:function(t,i){i.preventDefault();var s=e.select(t).datum();s.scrollHeight>0&&(s.scrollTop=Math.max(Math.min(s.scrollTop+i.deltaY,0),-s.scrollHeight),this.scrollY(s))}},{key:"scrollY",value:function(t,e){i.scrollElVertically(t.nodes,t.scrollTop),t.scrollbar.scrollTop=t.scrollbar.heightScale(-t.scrollTop),i.scrollElVertically(t.scrollbar.el,t.scrollbar.scrollTop),t.level!==this.visData.nodes.length&&this.links.scroll(t.linkSelections.outgoing,this.layout.offsetLinks(t.level,t.scrollTop,"source")),t.level>0&&this.links.scroll(t.linkSelections.incoming,this.layout.offsetLinks(t.level-1,t.scrollTop,"target")),this.showLinkLocation&&this.nodes.updateLinkLocationIndicators(t.level-1,t.level+1)}},{key:"scrollYTo",value:function(t,i){var s=this;return t.transition().duration(q).tween("scrollY",function(t){var o=e.interpolateNumber(t.scrollTop,i);return function(e){t.scrollTop=o(e),s.scrollY(t)}})}},{key:"resetAllScrollPositions",value:function(){return this.scrollYTo(this.levels.groups,0)}},{key:"selectByLevel",value:function(t,i){return e.select(this.levels.groups[0][t]).selectAll(i)}},{key:"updateSorting",value:function(){for(var t=Object.keys(this.currentSorting.local),e=t.length;e--;)this.sortColumn(e,this.currentSorting.local[t[e]].type,this.currentSorting.local[t[e]].order,this.currentSorting.local[t[e]].type)}},{key:"sortColumn",value:function(t,e,i,s){this.nodes.sort(this.layout.sort(t,e,i).updateNodesVisibility().nodes(t),s),this.links.sort(this.layout.links(t-1,t+1))}},{key:"sortAllColumns",value:function(t,e){this.currentSorting.global.order=-1===this.currentSorting.global.order?1:-1,this.nodes.sort(this.layout.sort(void 0,t,this.currentSorting.global.order).updateNodesVisibility().nodes(),e),this.links.sort(this.layout.links())}},{key:"switchBarMode",value:function(t){this.svgD3.classed("one-bar","one"===t),this.svgD3.classed("two-bar","two"===t),this.nodes.bars.switchMode(t,this.currentSorting)}},{key:"trigger",value:function(t,e){this.events.trigger(t,e)}},{key:"updateScrolling",value:function(){var t=this;this.resetAllScrollPositions().call(v,function(){t.levels.updateScrollProperties(),t.scrollbars.updateVisibility()})}},{key:"updateLevelsVisibility",value:function(){this.levels.updateVisibility()}},{key:"globalView",value:function(t){var e=this;this.zoomedOut||!function(){var i=0,s=0,o=0,n=0,l=void 0,a=void 0,r=e.svgD3.node().getBoundingClientRect();t&&!t.empty()?(t.each(function(){l=this.getBBox(),a=this.getBoundingClientRect(),o=Math.max(o,a.left-r.left+a.width),n=Math.max(n,a.top-r.top+a.height)}),o=e.width>o?e.width:o,n=e.height>n?e.height:n):(l=e.container.node().getBBox(),o=e.width>l.width?e.width:l.width,n=e.height>l.height?e.height:l.height),i=l.x,s=l.y,e.svgD3.classed("zoomedOut",!0).transition().duration(q).attr("viewBox",i+" "+s+" "+o+" "+n)}()}},{key:"zoomedView",value:function(){this.zoomedOut||this.svgD3.classed("zoomedOut",!1).transition().duration(q).attr("viewBox","0 0 "+this.width+" "+this.height)}},{key:"toggleView",value:function(){this.zoomedOut?(this.zoomedOut=!1,this.zoomedView()):(this.globalView(),this.zoomedOut=!0)}},{key:"isHidden",value:function(t){var e=t.getBoundingClientRect();return e.top+e.height<=this.top||e.left+e.width<=this.left||e.top>=this.top+this.height||e.left>=this.left+this.width}},{key:"pointsOutside",value:function(t){var e=this.linkPointsOutside(t.source),i=this.linkPointsOutside(t.target)<<2;return e|i}},{key:"linkPointsOutside",value:function(t){var e=t.node.y+t.offsetY;return e+this.visData.global.row.height<=0?1:e>=this.height?2:0}},{key:"area",get:function(){return this.container.node().getBoundingClientRect()}},{key:"dragMinX",get:function(){return Math.min(0,this.width-this.area.width)}},{key:"barMode",get:function(){return this.bars?this.nodes.bars.mode:this._barMode},set:function(t){this.bars&&(this.nodes.bars.mode=t),this._barMode=t}}],[{key:"scrollElVertically",value:function(t,i){e.select(t).attr("transform","translate(0, "+i+")")}}]),i}();return Wt}($,d3);
//# sourceMappingURL=listGraph.min.js.map
