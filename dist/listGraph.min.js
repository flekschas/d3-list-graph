/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
var ListGraph=function(t,e){"use strict";function i(t){function i(t){t.each(function(){s[0].push(this)})}for(var s=e.selectAll(".d3-list-graph-not-existent"),a=t.length;a--;)i(t[a]);return s}function s(t,i,s,a,n,o,l){var r=e.behavior.drag(),c=o||{};i&&r.on("drag",function(t){"function"==typeof o&&(c=o()),i.call(this,t,a,n,c,l)}),s&&r.on("dragend",function(t){s.call(this,t,a,n,c,l)}),t.each(function(t){var i=e.select(this);t||(t={dragX:0,dragY:0},i.datum(t)),i.call(r)})}function a(t,s,a,n,o){function l(t,e){var i=void 0;if(e)try{i=Math.min(e.max,Math.max(e.min,t))}catch(s){throw new T}return i}for(var r=o.length;r--;)if(o[r]())return;var c=e.select(this);s&&s.length&&(c=i(s)),"horizontal"===a||"vertical"===a?("horizontal"===a&&(t.dragX+=e.event.dx,t.dragX=l(t.dragX+e.event.dx,n.x),c.style("transform","translateX("+t.dragX+"px)")),"vertical"===a&&(t.dragY+=e.event.dy,t.dragX=l(t.dragY+e.event.dy,n.y),c.style("transform","translateY("+t.dragY+"px)"))):(t.dragX+=e.event.dx,t.dragY+=e.event.dy,c.style("transform","translate("+t.dragX+"px,"+t.dragY+"px)"))}function n(t){for(var e=[],i=t.length;i--;)e.push({id:t[i]});return e}function o(t){var e=t;t.clone&&(e=t.originalNode);var i=[e];return e.clones.length&&(i=i.concat(e.clones)),i}function l(t){return"number"==typeof t&&z(t)}function r(t,e,i,s,a){for(var n=s?o(t):[t],c=n.length;c--;)if(a&&e(n[c],a),!l(i)||i>0)for(var h=Object.keys(n[c].parents),d=h.length;d--;)r(n[c].parents[h[d]],e,i-1,s,n[c])}function c(t,e,i,s){for(var a=s?o(t):[t],n=a.length;n--;)if(e(a[n]),!l(i)||i>0)for(var r=a[n].childRefs.length;r--;)c(a[n].childRefs[r],e,i-1,s)}function h(t,e,i,s,a){i?(r(t,e,s,a),c(t,i,s,a)):(r(t,e,s,a),c(t,e,s,a))}function d(t,e){for(var i=Object.keys(t.parents),s=i.length;s--;)for(var a=t.parents[i[s]].childRefs.length;a--;)e(t.parents[i[s]].childRefs[a]);if(t.siblings)for(var n=Object.keys(t.siblings),s=n.length;s--;)e(t.siblings[n[s]])}function u(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function v(t){return u(t)&&J.call(t)==_}function g(t,e,i,s,a){var n=a.topLeft||0,o=a.topRight||0,l=a.bottomLeft||0,r=a.bottomRight||0;return"M"+(t+n)+","+e+"h"+(i-n-o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(s-(o+r))+"a"+r+","+r+" 0 0 1 "+-r+","+r+"h"+(l-(i-r))+"a"+l+","+l+" 0 0 1 "+-l+","+-l+"v"+(n-(s-l))+"a"+n+","+n+" 0 0 1 "+n+","+-n+"z"}function p(t,i,s,a,n,o){var l=e.scale.pow().exponent(n||2),r=1/((o||0)+1),c=t.append("defs").append("linearGradient").attr("id",a).attr("x1",i.x).attr("y1",i.y).attr("x2",s.x).attr("y2",s.y).attr("spreadMethod","pad");c.append("stop").attr("offset",i.offset+"%").attr("stop-color",i.color).attr("stop-opacity",i.opacity);for(var h=0;o>h;h++)c.append("stop").attr("offset",i.offset+h*r*(s.offset-i.offset)+"%").attr("stop-color",s.color).attr("stop-opacity",i.opacity+l(h*r)*(s.opacity-i.opacity));c.append("stop").attr("offset",s.offset+"%").attr("stop-color",s.color).attr("stop-opacity",s.opacity)}function f(t){return!!t&&"object"==typeof t}function b(t){return null==t?!1:v(t)?kt.test(yt.call(t)):f(t)&&ft.test(t)}function y(t,e){var i=null==t?void 0:t[e];return b(i)?i:void 0}function m(t){return"number"==typeof t&&t>-1&&t%1==0&&wt>=t}var k={};k.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},k.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),k.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},k.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var w="list-graph",D=6,x=5,N=5,S="",C="desc",L="one",B=!0,P=0,A=0,M=150,O=250,W="#e0001c",H="#60bf00",R=function(t){function e(t){k.classCallCheck(this,e);var i=k.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.name=i.constructor.name,i.message=t,Error.captureStackTrace(i,i.constructor.name),i}return k.inherits(e,t),e}(Error),T=function(t){function e(t){return k.classCallCheck(this,e),k.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"The limits are wrongly formatted. Please provide an object of the following format: `{ x: { min: 0, max: 1 }, y: { min: 0, max: 1 } }`"))}return k.inherits(e,t),e}(R),j="scrollbar",E=function(){function t(i,s,a){k.classCallCheck(this,t),this.visData=s,this.width=a,this.all=i.append("rect").attr("class",j).call(function(t){t.each(function(){e.select(this.parentNode).datum().scrollbar.el=this})}).attr("x",function(t){return t.scrollbar.x-2}).attr("y",function(t){return t.scrollbar.y}).attr("width",this.width).attr("height",function(t){return t.scrollbar.height}).attr("rx",this.width/2).attr("ry",this.width/2).classed("ready",!0)}return k.createClass(t,[{key:"updateVisibility",value:function(){this.all.transition().duration(M).attr({x:function(t){return t.scrollbar.x},height:function(t){return t.scrollbar.height}})}}]),t}(),G={"function":!0,object:!0},V=G[typeof exports]&&exports&&!exports.nodeType&&exports,Y=G[typeof module]&&module&&!module.nodeType&&module,U=V&&Y&&"object"==typeof global&&global&&global.Object&&global,I=G[typeof self]&&self&&self.Object&&self,X=G[typeof window]&&window&&window.Object&&window,F=U||X!==(this&&this.window)&&X||I||this,z=F.isFinite,_="[object Function]",q=Object.prototype,J=q.toString,$="bar",K=function(){function t(e,i,s,a,n){function o(e){var i=this,s=this.visData.nodes[this.nodeData.depth].sortBy;e.attr("d",function(e){return t.generatePath(e,i.bars.mode,s,i.visData)}).classed("bar-magnitude",!0)}function l(t){t.attr("x",0).attr("y",this.visData.global.row.padding).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bar-border",!0)}function r(e){var i=this;e.attr("d",function(e){return t.generatePath(e,i.bars.mode,void 0,i.visData,e.value)}).classed("bar-indicator-bg",!0)}function c(t){t.attr({"class":"bar-indicator",x:0,y:this.visData.global.row.padding,width:2,height:this.visData.global.row.contentHeight})}var h=this;k.classCallCheck(this,t),this.data=i,this.nodeData=s,this.visData=a,this.bars=n,this.data.x=s.x,this.data.level=s.depth,this.height=this.visData.global.row.contentHeight/(2*this.data.length)-2*this.visData.global.cell.padding,this.activeHeight=this.visData.global.row.contentHeight-2,this.inactiveheight=2*this.visData.global.cell.padding-1,this.selection=e.selectAll($).data(this.data).enter().append("g").attr("class",function(t){return $+" "+t.id}).classed("active",function(t){return t.id===h.visData.nodes[h.nodeData.depth].sortBy}),this.selection.append("rect").call(l.bind(this)),this.selection.append("path").call(o.bind(this)),this.selection.append("path").call(r.bind(this)),this.selection.append("rect").call(c.bind(this))}return k.createClass(t,null,[{key:"updateIndicator",value:function(t,e,i){t.attr("x",Math.min(e*Math.min(i,1),e-2)).classed("positive",function(t){return t.value>=i})}},{key:"generatePath",value:function(e,i,s,a,n,o,l){return"two"===i?t.generateTwoBarsPath(e,a,l):t.generateOneBarPath(e,s,a,n,o)}},{key:"generateOneBarPath",value:function(t,e,i,s,a){var n=i.global.row.contentHeight,o=Math.min(t.value,1),l=Math.min(s,1),r=0,c=2,h={topLeft:2,bottomLeft:2};return s&&(h={}),t.id!==e&&"undefined"==typeof s?(r=o*i.global.column.contentWidth-3,h={}):s?(r=l*i.global.column.contentWidth,a&&(l>o&&(r=o*i.global.column.contentWidth),c=Math.max(Math.abs(l-o)*i.global.column.contentWidth,2))):c=i.global.column.contentWidth*o,r=Math.min(r,i.global.column.contentWidth-2),g(r,i.global.row.padding,c,n,h)}},{key:"generateTwoBarsPath",value:function(t,e,i){var s=Math.min(t.value,1),a=e.global.row.contentHeight/2,n=e.global.column.contentWidth*s,o=e.global.row.padding,l={topLeft:2};return i&&(l={bottomLeft:2},o+=a),g(0,o,n,a,l)}}]),t}(),Q="bars",Z=function(){function t(i,s,a,n){k.classCallCheck(this,t);var o=this;this.vis=i,this.mode=a,this.visData=n,this.selection=s.append("g").attr("class",Q),this.selection.each(function(t){new K(e.select(this),t.data.bars,t,o.visData,o)})}return k.createClass(t,[{key:"updateAll",value:function(t,e){var i=this;this.selection.selectAll(".bar-magnitude").data(t,function(t){return t.barId}).transition().duration(O).attr("d",function(t){return K.generatePath(t,i.mode,e,i.visData)})}},{key:"update",value:function(t,i){var s=this;t.each(function(){var t=e.select(this);t.classed("active")?t.classed("active",!1):(t.classed("active",!0),this.parentNode.insertBefore(this,e.select(this.parentNode).select(".bar").node()))}),t.selectAll(".bar-magnitude").transition().duration(O).attr("d",function(t){return K.generatePath(t,s.mode,i,s.visData)})}},{key:"updateIndicator",value:function(t,e,i,s){var a=this;K.updateIndicator(i,this.visData.global.column.contentWidth,s),K.updateIndicator(t,this.visData.global.column.contentWidth,s),e.attr("d",function(t){return K.generatePath(t,a.mode,void 0,a.visData,s)}).classed("positive",function(t){return t.value>=s});var n=e;this.vis.lessAnimations||(n=e.transition().duration(O)),n.attr("d",function(t){return K.generatePath(t,a.mode,void 0,a.visData,s,!0)})}},{key:"switchMode",value:function(t,e){var i=this;this.mode!==t&&("one"===t&&e.global.type&&this.selection.selectAll(".bar").selectAll(".bar-magnitude").transition().duration(O).attr("d",function(t){return K.generateOneBarPath(t,e.global.type,i.visData)}),"two"===t&&(this.selection.selectAll(".bar.precision").selectAll(".bar-magnitude").transition().duration(O).attr("d",function(t){return K.generateTwoBarsPath(t,i.visData)}),this.selection.selectAll(".bar.recall").selectAll(".bar-magnitude").transition().duration(O).attr("d",function(t){return K.generateTwoBarsPath(t,i.visData,!0)})),this.mode=t)}}]),t}(),tt="nodes",et="node",it="clone",st=function(){function t(i,s,a,n,o){function l(t,e,i){var s=i?i:0;t.attr("x",s).attr("y",c.visData.global.row.padding+s).attr("width",c.visData.global.column.contentWidth-2*s).attr("height",c.visData.global.row.contentHeight-2*s).attr("rx",2-s).attr("ry",2-s).classed(e,!0)}var r=this;k.classCallCheck(this,t);var c=this;this.vis=i,this.visData=a,this.links=n,this.events=o,this.currentLinks={},this.groups=s.append("g").attr("class",tt).call(function(t){t.each(function(){e.select(this.parentNode).datum().nodes=this})}),this.nodes=this.groups.selectAll("."+et).data(function(t){return t.rows}).enter().append("g").classed(et,!0).classed(it,function(t){return t.clone}).attr("transform",function(t){return"translate("+(t.x+r.visData.global.column.padding)+", "+t.y+")"}),this.nodes.append("rect").call(l,"bg-extension").attr("width",this.visData.global.column.padding+5),this.nodes.append("rect").call(l,"bg-border"),this.nodes.append("rect").call(l,"bg",1);var h=this.nodes.append("g").attr("class","focus-controls root inactive").on("click",function(t){c.rootHandler.call(c,this,t)});h.append("circle").call(this.setUpFocusControls.bind(this),"left","bg","bg"),h.append("svg").call(this.setUpFocusControls.bind(this),"left","icon","ease-all state-inactive invisible-default").append("use").attr("xlink:href",this.vis.iconPath+"#unlocked"),h.append("svg").call(this.setUpFocusControls.bind(this),"left","icon","ease-all state-active invisible-default").append("use").attr("xlink:href",this.vis.iconPath+"#locked");var d=this.nodes.append("g").attr("class","focus-controls lock inactive").on("click",function(t){c.lockHandler.call(c,this,t)});d.append("circle").call(this.setUpFocusControls.bind(this),"right","bg","bg"),d.append("svg").call(this.setUpFocusControls.bind(this),"right","icon","ease-all state-inactive invisible-default").append("use").attr("xlink:href",this.vis.iconPath+"#unlocked"),d.append("svg").call(this.setUpFocusControls.bind(this),"right","icon","ease-all state-active invisible-default").append("use").attr("xlink:href",this.vis.iconPath+"#locked"),this.nodes.on("click",function(t){c.clickHandler.call(c,this,t)}),this.nodes.on("mouseenter",function(t){c.vis.activeScrollbar||c.enterHandler.call(c,this,t)}),this.nodes.on("mouseleave",function(t){c.vis.activeScrollbar||c.leaveHandler.call(c,this,t)}),this.bars=new Z(this.vis,this.nodes,this.vis.barMode,this.visData),this.nodes.append("rect").call(l,"border"),this.nodes.call(function(t){t.append("foreignObject").attr("x",r.visData.global.cell.padding).attr("y",r.visData.global.row.padding+r.visData.global.cell.padding).attr("width",r.visData.global.column.contentWidth).attr("height",r.visData.global.row.contentHeight-2*r.visData.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).style("line-height",r.visData.global.row.contentHeight-2*r.visData.global.cell.padding+"px").append("xhtml:span").text(function(t){return t.data.name})}),v(this.events.on)&&(this.events.on("d3ListGraphFocusNodes",function(t){return r.focusNodes(t)}),this.events.on("d3ListGraphBlurNodes",function(t){return r.blurNodes(t)}),this.events.on("d3ListGraphNodeEnter",function(t){return r.eventHelper(t,r.highlightNodes)}),this.events.on("d3ListGraphNodeLeave",function(t){return r.eventHelper(t,r.unhighlightNodes)}),this.events.on("d3ListGraphNodeLock",function(t){return r.eventHelper(t,r.toggleLock,[],".lock")}),this.events.on("d3ListGraphNodeUnlock",function(t){return r.eventHelper(t,r.toggleLock,[!0],".lock")}),this.events.on("d3ListGraphNodeRoot",function(t){return r.eventHelper(t.nodeIds,r.toggleRoot,[],".root")}),this.events.on("d3ListGraphNodeUnroot",function(t){return r.eventHelper(t.nodeIds,r.toggleRoot,[!0],".root")}))}return k.createClass(t,[{key:"clickHandler",value:function(t,e){this.events.broadcast("d3ListGraphNodeClick",{id:e.id})}},{key:"enterHandler",value:function(t,e){this.highlightNodes(t,e),this.events.broadcast("d3ListGraphNodeEnter",{id:e.id})}},{key:"leaveHandler",value:function(t,e){this.unhighlightNodes(t,e),this.events.broadcast("d3ListGraphNodeLeave",{id:e.id})}},{key:"lockHandler",value:function(t){var e=this.toggleLock(t);e.locked&&this.events.broadcast("d3ListGraphNodeLock",{id:e.locked}),e.unlocked&&this.events.broadcast("d3ListGraphNodeUnlock",{id:e.unlocked})}},{key:"rootHandler",value:function(t){var e=this.toggleRoot(t);e.rooted&&this.events.broadcast("d3ListGraphNodeRoot",{id:e.rooted}),e.unrooted&&this.events.broadcast("d3ListGraphNodeUnroot",{id:e.unrooted}),this.events.broadcast("d3ListGraphUpdateBarsRequest",{id:e.rooted})}},{key:"focusNodes",value:function(t){this.eventHelper(t.nodeIds,this.highlightNodes,["focus","directParentsOnly",t.excludeClones?!0:!1]),t.zoomOut?this.vis.globalView(this.nodes.filter(function(t){return t.hovering>0})):this.vis.zoomedView()}},{key:"blurNodes",value:function(t){this.eventHelper(t.nodeIds,this.unhighlightNodes,["focus","directParentsOnly",t.excludeClones?!0:!1]),t.zoomIn&&this.vis.zoomedView()}},{key:"eventHelper",value:function(t,i,s,a){var n=this;this.nodes.filter(function(e){return!!~t.indexOf(e.id)}).each(function(t){var o=this;a&&(o=e.select(this).select(a).node()),i.apply(n,[o,t].concat(s?s:[]))})}},{key:"toggleLock",value:function(t,i,s){var a=e.select(t),n=a.datum(),o={locked:!1,unlocked:!1};return this.lockedNode?this.lockedNode.datum().id===n.id?(this.lockedNode.classed({active:!1,inactive:!0}),this.unlockNode(this.lockedNode.datum().id),o.unlocked=this.lockedNode.datum().id,this.lockedNode=void 0):(this.lockedNode.classed({active:!1,inactive:!0}),this.unlockNode(this.lockedNode.datum().id),o.unlocked=this.lockedNode.datum().id,s||(a.classed({active:!0,inactive:!1}),this.lockNode(n.id),o.locked=n.id,this.lockedNode=a)):s||(a.classed({active:!0,inactive:!1}),this.lockNode(n.id),o.locked=n.id,this.lockedNode=a),o}},{key:"lockNode",value:function(t){var i=this,s=this.nodes.filter(function(e){return e.id===t});s.each(function(t){i.highlightNodes(this,t,"lock",void 0)}),s.selectAll(".bg-border").transition().duration(O).attr("width",function(){return parseInt(e.select(this).attr("width"),10)+i.visData.global.row.height/2})}},{key:"unlockNode",value:function(t){var i=this,s=this.nodes.filter(function(e){return e.id===t}),a=function(){e.select(this.parentNode).classed("animating",!0)},n=function(){e.select(this.parentNode).classed("animating",!1)};s.selectAll(".bg-border").transition().duration(O).attr("width",this.visData.global.column.contentWidth).each("start",a).each("end",n),s.each(function(t){i.unhighlightNodes(this,t,"lock",void 0)})}},{key:"toggleRoot",value:function(t,i,s){var a=e.select(t),n=a.datum(),o={rooted:!1,unrooted:!1};return this.vis.levels.blur(),this.rootedNode?(this.rootedNode.classed({active:!1,inactive:!0}),this.unrootNode(this.rootedNode.datum().id),o.unrooted=this.rootedNode.datum().id,this.rootedNode.datum().id===n.id||s?(this.rootedNode=void 0,this.vis.levels.focus(this.vis.activeLevelNumber-this.vis.noRootedNodeDifference)):(a.classed({active:!0,inactive:!1}),this.rootNode(n.id),this.rootedNode=a,o.rooted=n.id)):s||(a.classed({active:!0,inactive:!1}),this.rootNode(n.id),o.rooted=n.id,this.rootedNode=a),o}},{key:"rootNode",value:function(t){var i=this,s=this.nodes.filter(function(e){return e.id===t}),a=void 0;s.each(function(t){t.rooted=!0,e.select(this).classed("rooted",!0),i.hideNodes.call(i,this,t,"downStream"),a=t}),s.selectAll(".bg-extension").transition().duration(O).attr("x",-i.visData.global.row.height/2),this.vis.levels.focus(a.depth+this.vis.activeLevelNumber)}},{key:"unrootNode",value:function(t){var i=this,s=this.nodes.filter(function(e){return e.id===t}),a=function(){e.select(this.parentNode).classed("animating",!0)},n=function(){e.select(this.parentNode).classed("animating",!1)};s.selectAll(".bg-extension").transition().duration(O).attr("x",0).each("start",a).each("end",n),s.each(function(t){t.rooted=!1,e.select(this).classed("rooted",!1),i.showNodes.call(i,this,t,"downStream")})}},{key:"setUpFocusControls",value:function(t,e,i,s){var a=this.visData.global.row.contentHeight/2-2*this.visData.global.cell.padding,n="left"===e?-a-2:this.visData.global.column.contentWidth+2,o=this.visData.global.row.padding+(this.visData.global.row.contentHeight-2*this.visData.global.cell.padding)/4;"bg"===i?t.attr({"class":s,cx:n+a/2,cy:o+a/2,r:3*a/4}):t.attr({"class":s,x:n,y:o,width:a,height:a})}},{key:"hideNodes",value:function(t,e,i){return this.nodesVisibility(t,e,i)}},{key:"showNodes",value:function(t,e,i){return this.nodesVisibility(t,e,i,!0)}},{key:"nodesVisibility",value:function(t,e,i,s){s?this.nodes.classed("hidden",!1).each(function(t){return t.hidden=!1}):(this.nodes.each(function(t){return t.hidden=!0}),h(e,function(t){return t.hidden=!1}),d(e,function(t){return t.hidden=!1}),this.nodes.classed("hidden",function(t){return t.hidden})),this.updateVisibility()}},{key:"highlightNodes",value:function(t,i,s,a,o){var l=this,d=this,u=i.id,v=i,g=!0,p=s?s:"hovering",f=o?!1:!0,b="directParentsOnly"===a?!1:!0;this.currentLinks[p]||(this.currentLinks[p]={}),this.currentLinks[p][u]=[];var y=e.select(t).selectAll(".bar.active .bar-magnitude").datum(),m=function(t,e){t.hovering=2;for(var i=t.links.length;i--;)t.links[i].target.node.id===e.id&&l.currentLinks[p][u].push(t.links[i].id)},k=function(t){t.hovering=2;for(var e=t.links.length;e--;)l.currentLinks[p][u].push(t.links[e].id)};if(g&&b&&h(i,m,k,void 0,f),g&&!b&&r(i,m,void 0,f),!g&&b&&c(i,m,void 0,f),i.clone)i.originalNode.hovering=1;else if(f)for(var w=i.clones.length;w--;)i.clones[w].hovering=1;i.hovering=1,this.nodes.each(function(i){var s=e.select(this);if(1===i.hovering)s.classed(p+"-directly",!0);else if(2===i.hovering){s.classed(p+"-indirectly",!0),s.selectAll(".bar."+y.id).classed("copy",function(t){var e=t.id;return t.clone&&(e=t.originalNode.id),e!==v.id?!0:void 0});var a=e.select(t).selectAll(".bar."+y.id).classed("reference",!0);d.bars.updateIndicator(s.selectAll(".bar.copy .bar-indicator"),s.selectAll(".bar.copy .bar-indicator-bg"),a.selectAll(".bar-indicator"),y.value)}}),this.links.highlight(n(this.currentLinks[p][i.id]),!0,p)}},{key:"unhighlightNodes",value:function(t,e,i,s,a){var o=function(t){return t.hovering=0},l=!0,d=i?i:"hovering",u=a?!1:!0,v="directParentsOnly"===s?!1:!0;if(e.hovering=0,l&&v&&h(e,o,void 0,void 0,u),l&&!v&&r(e,o,void 0,u),!l&&v&&c(e,o,void 0,u),e.clone)e.originalNode.hovering=0;else if(u)for(var g=e.clones.length;g--;)e.clones[g].hovering=0;this.nodes.classed(d+"-directly",!1),this.nodes.classed(d+"-indirectly",!1),this.currentLinks[d][e.id]&&this.links.highlight(n(this.currentLinks[d][e.id]),!1,d)}},{key:"sort",value:function(t,i){for(var s=this,a=function(){e.select(this).classed("sorting",!0)},n=function(){e.select(this).classed("sorting",!1)},o=t.length;o--;){var l=this.nodes.data(t[o].rows,function(t){return t.id});l.transition().duration(O).attr("transform",function(t){return"translate("+(t.x+s.visData.global.column.padding)+", "+t.y+")"}).each("start",a).each("end",n),i&&this.bars.update(l.selectAll(".bar"),t[o].sortBy)}}},{key:"updateVisibility",value:function(){var t=this;this.vis.layout.updateNodesVisibility();var e=function(t,e){0===t.size()&&e();var i=0;t.each(function(){return++i}).each("end",function(){--i||e.apply(this,arguments)})};this.nodes.transition().duration(O).attr("transform",function(e){return"translate("+(e.x+t.visData.global.column.padding)+", "+e.y+")"}).call(e,function(){t.vis.updateLevelsVisibility(),t.vis.updateScrollbarVisibility()}),this.vis.links.updateVisibility()}},{key:"barMode",get:function(){return this.bars.mode}}]),t}(),at="links",nt="link",ot=function(){function t(i,s,a){var n=this;k.classCallCheck(this,t),this.visData=s,this.layout=a,this.groups=i.append("g").attr("class",at).call(function(t){t.each(function(){e.select(this.parentNode).datum().links=this})}),this.links=this.groups.selectAll(nt+"-bg").data(function(t,e){return n.layout.links(e)}).enter().append("g").attr("class",nt),this.links.append("path").attr({"class":nt+"-bg",d:this.diagonal}),this.links.append("path").attr({"class":nt+"-direct",d:this.diagonal})}return k.createClass(t,[{key:"highlight",value:function(t,e,i){this.links.data(t,function(t){return t.id}).classed(i?i:"hovering",e===!1?!1:!0)}},{key:"scroll",value:function(t,e){t.data(e),t.selectAll("path").attr("d",this.diagonal)}},{key:"sort",value:function(t){var i=function(){e.select(this).classed("sorting",!0)},s=function(){e.select(this).classed("sorting",!1)};this.links.data(t,function(t){return t.id}),this.links.selectAll("path").transition().duration(O).attr("d",this.diagonal).each("start",i).each("end",s)}},{key:"updateVisibility",value:function(){this.links.selectAll("path").classed("hidden",function(t){return t.target.node.hidden||t.source.node.hidden}).transition().duration(O).attr("d",this.diagonal)}},{key:"diagonal",get:function(){var t=this;return e.svg.diagonal().source(function(e){return{x:e.source.node.y+e.source.offsetY+t.visData.global.row.height/2,y:e.source.node.x+e.source.offsetX+t.visData.global.column.contentWidth+t.visData.global.column.padding}}).target(function(e){return{x:e.target.node.y+e.target.offsetY+t.visData.global.row.height/2,y:e.target.node.x+e.target.offsetX+t.visData.global.column.padding}}).projection(function(t){return[t.y,t.x]})}}]),t}(),lt="column",rt="scroll-container",ct=function(){function t(e,i,s){var a=this;k.classCallCheck(this,t),this.vis=i,this.visData=s,this.groups=e.selectAll("g").data(this.visData.nodes).enter().append("g").attr("class",lt).classed("active",function(t,e){return a.vis.highlightActiveLevel?a.vis.nodes&&a.vis.nodes.rootedNode?e===a.vis.activeLevelNumber:e===a.vis.activeLevelNumber-a.vis.noRootedNodeDifference:void 0}),this.groups.append("rect").attr("class",rt).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",this.visData.global.column.width+1).attr("height",this.visData.global.column.height)}return k.createClass(t,[{key:"scrollPreparation",value:function(t,i){var s=this;this.groups.each(function(a,n){var o=a.nodes.getBoundingClientRect().height+2*s.visData.global.row.padding,l=o-s.visData.global.column.height,r=l>0?Math.max(s.visData.global.column.height*s.visData.global.column.height/o,10):0;a.height=o,a.linkSelections={incoming:n>0?t.selectByLevel(n-1,".link"):null,outgoing:t.selectByLevel(n,".link")},a.scrollHeight=l,a.scrollTop=0,a.scrollbar={el:void 0,x:a.x+s.visData.global.column.width-i,y:0,width:i,height:r,scrollHeight:s.visData.global.column.height-r,scrollTop:0,heightScale:e.scale.linear().domain([0,l]).range([0,s.visData.global.column.height-r])},a.invertedHeightScale=a.scrollbar.heightScale.invert})}},{key:"updateScrollProperties",value:function(){var t=this;this.groups.each(function(i){var s=i.nodes.getBoundingClientRect().height+2*t.visData.global.row.padding,a=s-t.visData.global.column.height,n=a>0?Math.max(t.visData.global.column.height*t.visData.global.column.height/s,10):0;i.height=s,i.scrollHeight=a,i.scrollTop=0,i.scrollbar.y=0,i.scrollbar.height=n,i.scrollbar.scrollHeight=t.visData.global.column.height-n,i.scrollbar.scrollTop=0,i.scrollbar.heightScale=e.scale.linear().domain([0,a]).range([0,t.visData.global.column.height-n])})}},{key:"updateVisibility",value:function(){this.groups.each(function(){var t=e.select(this);t.classed("hidden",t.selectAll(".node").filter(function(t){return!t.hidden}).empty())})}},{key:"focus",value:function(t){this.vis.highlightActiveLevel&&this.groups.filter(function(e){return e.level===t}).classed("active",!0)}},{key:"blur",value:function(t){this.vis.highlightActiveLevel&&(t?this.groups.filter(function(e){return e.level===t}).classed("active",!1):this.groups.classed("active",!1))}},{key:"height",get:function(){return this.visData.global.column.height}}]),t}(),ht="div",dt="top-bar",ut="ul",vt="controls",gt="global-controls",pt=function(){function t(i,s,a){var n=this;k.classCallCheck(this,t);var o=this;this.vis=i,this.visData=a,this.el=s.select("."+dt),this.el.empty()&&(this.el=s.insert(ht,":first-child").attr("class",dt)),this.controlSwitch=this.el.append("div").attr("title","Toggle global / local topbar").style("width",this.visData.global.column.padding+"px").classed("control-switch",!0).on("click",this["switch"].bind(this)),this.switchArrow=this.controlSwitch.append("svg").append("use").attr("xlink:href",this.vis.iconPath+"#arrow-down").attr("class","switch-arrow"),this.globalControls=this.el.append(ut).classed(gt,!0),this.globalPrecision=this.globalControls.append("li").attr("class","control-btn sort-precision").classed("active",function(){return"precision"===o.vis.currentSorting.global.type?(o.vis.currentSorting.global.el=e.select(this),!0):void 0}).on("click",function(){o.sortAllColumns(this,"precision")}).on("mouseenter",function(){return n.highlightBars(void 0,"precision")}).on("mouseleave",function(){return n.highlightBars(void 0,"precision",!0)}),this.globalPrecisionWrapper=this.globalPrecision.append("div").attr("class","wrapper").text("Precision").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalPrecisionWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","precision"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalRecall=this.globalControls.append("li").attr("class","control-btn sort-recall").classed("active",function(){return"recall"===o.vis.currentSorting.global.type?(o.vis.currentSorting.global.el=e.select(this),!0):void 0}).on("click",function(){o.sortAllColumns(this,"recall")}).on("mouseenter",function(){return n.highlightBars(void 0,"recall")}).on("mouseleave",function(){return n.highlightBars(void 0,"recall",!0)}),this.globalRecallWrapper=this.globalRecall.append("div").attr("class","wrapper").text("Recall").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalRecallWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","recall"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalName=this.globalControls.append("li").attr("class","control-btn sort-name").classed("active",function(){return"name"===o.vis.currentSorting.global.type?(o.vis.currentSorting.global.el=e.select(this),!0):void 0}).on("click",function(){o.sortAllColumns(this,"name")}).on("mouseenter",function(){return n.highlightLabels()}).on("mouseleave",function(){return n.highlightLabels(!0)}),this.globalNameWrapper=this.globalName.append("div").attr("class","wrapper").text("Name").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalNameWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","name"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalNameWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-asc"),this.globalNameWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-desc"),this.globalOneBar=this.globalControls.append("li").attr("class","control-btn one-bar").classed("active","one"===this.vis.barMode).on("click",function(){o.switchBarMode(this,"one")}),this.globalOneBarWrapper=this.globalOneBar.append("div").attr("class","wrapper").text("One bar").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalOneBarWrapper.append("svg").attr("class","icon-one-bar").append("use").attr("xlink:href",this.vis.iconPath+"#one-bar"),this.globalTwoBars=this.globalControls.append("li").attr("class","control-btn two-bars").classed("active","two"===this.vis.barMode).on("click",function(){o.switchBarMode(this,"two")}),this.globalTwoBarsWrapper=this.globalTwoBars.append("div").attr("class","wrapper").text("Two bars").style("margin","0 "+this.visData.global.column.padding+"px"),this.globalTwoBarsWrapper.append("svg").attr("class","icon-two-bars").append("use").attr("xlink:href",this.vis.iconPath+"#two-bars"),this.localControlWrapper=this.el.append("div").classed("local-controls",!0),this.localControls=this.localControlWrapper.selectAll(vt).data(a.nodes).enter().append(ut).classed(vt,!0).style("width",this.visData.global.column.width+"px"),this.localControls.each(function(t,i){var s=e.select(this);o.vis.currentSorting.local[i]={type:t.sortBy,order:t.sortOrder,el:void 0
},s.append("li").attr("class","control-btn toggle").style("width",o.visData.global.column.padding+"px").on("click",o.toggleColumn),s.append("li").attr("class","control-btn sort-precision ease-all").style({width:o.visData.global.column.contentWidth/2+"px",left:o.visData.global.column.padding+"px"}).on("click",function(t){o.sortColumn(this,t.level,"precision")}).on("mouseenter",function(){o.highlightBars(this.parentNode,"precision"),e.select(this).style("width",o.visData.global.column.contentWidth-16+"px")}).on("mouseleave",function(){o.highlightBars(this.parentNode,"precision",!0),e.select(this).style("width",o.visData.global.column.contentWidth/2+"px")}).html('<div class="expandable-label">  <span class="letter abbr">P</span>  <span class="letter abbr">r</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">i</span>  <span class="letter">s</span>  <span class="letter">i</span>  <span class="letter">o</span>  <span class="letter">n</span></div><svg class="icon-unsort invisible-default '+("precision"!==o.vis.currentSorting.local[i].type?"visible":"")+'">  <use xlink:href="'+o.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("precision"===o.vis.currentSorting.local[i].type&&1===o.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+o.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("precision"===o.vis.currentSorting.local[i].type&&1!==o.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+o.vis.iconPath+'#sort-desc"></use></svg>'),s.append("li").attr("class","control-btn sort-recall ease-all").style({width:o.visData.global.column.contentWidth/2+"px",left:o.visData.global.column.contentWidth/2+o.visData.global.column.padding+"px"}).on("click",function(t){o.sortColumn(this,t.level,"recall")}).on("mouseenter",function(){o.highlightBars(this.parentNode,"recall"),e.select(this).style({width:o.visData.global.column.contentWidth-16+"px",left:o.visData.global.column.padding+16+"px"})}).on("mouseleave",function(){o.highlightBars(this.parentNode,"recall",!0),e.select(this).style({width:o.visData.global.column.contentWidth/2+"px",left:o.visData.global.column.contentWidth/2+o.visData.global.column.padding+"px"})}).html('<div class="expandable-label">  <span class="letter abbr">R</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">a</span>  <span class="letter abbr">l</span>  <span class="letter">l</span></div><svg class="icon-unsort invisible-default '+("recall"!==o.vis.currentSorting.local[i].type?"visible":"")+'">  <use xlink:href="'+o.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("recall"===o.vis.currentSorting.local[i].type&&1===o.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+o.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("recall"===o.vis.currentSorting.local[i].type&&1!==o.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+o.vis.iconPath+'#sort-desc"></use></svg>'),s.append("li").attr("class","control-btn options").style("width",o.visData.global.column.padding+"px").on("click",o.toggleOptions).html('<svg class="icon-gear">  <use xlink:href="'+o.vis.iconPath+'#gear"></use></svg>'),o.vis.currentSorting.local[i].type&&(o.vis.currentSorting.local[i].el=s.select(".sort-"+o.vis.currentSorting.local[i].type))})}return k.createClass(t,[{key:"selectNodesLevel",value:function(t){return this.vis.selectByLevel(e.select(t).datum().level,".node")}},{key:"highlightLabels",value:function(t){this.vis.baseElD3.selectAll(".node").classed("highlight-label",!t)}},{key:"highlightBars",value:function(t,e,i){var s=t?this.selectNodesLevel(t):this.vis.baseElD3.selectAll(".node");s.classed("highlight-bar",!i).selectAll(".bar."+e).classed("highlight",!i)}},{key:"sortAllColumns",value:function(t,i){this.vis.currentSorting.global.type!==i&&this.vis.currentSorting.global.el&&this.resetSortEl(this.vis.currentSorting.global.el),this.vis.currentSorting.global.el=e.select(t),this.vis.currentSorting.global.el.classed("active",!0),this.vis.currentSorting.global.type=i;for(var s=Object.keys(this.vis.currentSorting.local),a=0,n=s.length;n>a;a++)this.sortColumn(t,s[a],i,!0)}},{key:"sortColumn",value:function(t,i,s,a){a||(this.vis.currentSorting.global.type=void 0,this.resetSortEl(this.vis.currentSorting.global.el));var n=!1;this.vis.currentSorting.local[i].el&&this.vis.currentSorting.local[i].type!==s&&this.resetSortEl(this.vis.currentSorting.local[i].el),this.vis.currentSorting.local[i].type!==s&&(n=!0,this.vis.currentSorting.local[i].order=0),this.vis.currentSorting.local[i].el=e.select(t),this.vis.currentSorting.local[i].type=s,-1===this.vis.currentSorting.local[i].order?(this.vis.currentSorting.local[i].order=1,this.vis.currentSorting.local[i].el.select(".icon-sort-desc").classed("visible",!1),this.vis.currentSorting.local[i].el.select(".icon-sort-asc").classed("visible",!0)):(this.vis.currentSorting.local[i].order=-1,this.vis.currentSorting.local[i].el.select(".icon-sort-asc").classed("visible",!1),this.vis.currentSorting.local[i].el.select(".icon-sort-desc").classed("visible",!0)),this.vis.currentSorting.local[i].el.select(".icon-unsort").classed("visible",!1),this.vis.sortColumn(i,s,this.vis.currentSorting.local[i].order,n)}},{key:"resetSortEl",value:function(t){t.classed("active",!1),t.select(".icon-sort-desc").classed("visible",!1),t.select(".icon-sort-asc").classed("visible",!1),t.select(".icon-unsort").classed("visible",!0)}},{key:"switch",value:function(){this.el.classed("details",!this.el.classed("details"))}},{key:"switchBarMode",value:function(t,e){this.vis.nodes.barMode!==e&&("one"===e?(this.globalOneBar.classed("active",!0),this.globalTwoBars.classed("active",!1)):(this.globalOneBar.classed("active",!1),this.globalTwoBars.classed("active",!0)),this.vis.switchBarMode(e))}}]),t}(),ft=/^\[object .+?Constructor\]$/,bt=Object.prototype,yt=Function.prototype.toString,mt=bt.hasOwnProperty,kt=RegExp("^"+yt.call(mt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wt=9007199254740991,Dt="[object Array]",xt=Object.prototype,Nt=xt.toString,St=y(Array,"isArray"),Ct=St||function(t){return f(t)&&m(t.length)&&Nt.call(t)==Dt},Lt=function(t){function e(t){return k.classCallCheck(this,e),k.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"D3.layout.listGraph.js has not been loaded yet."))}return k.inherits(e,t),e}(R),Bt=function(t){function e(t){return k.classCallCheck(this,e),k.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"Dispatcher needs to be a function."))}return k.inherits(e,t),e}(R),Pt=function(){function t(e,i){if(k.classCallCheck(this,t),i&&!v(i))throw new Bt;this.el=e,this._stack={},this.dispatch=i?i:this._dispatchEvent}return k.createClass(t,[{key:"_dispatchEvent",value:function(t,e){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!1,!1,e),this.el.dispatchEvent(i)}},{key:"broadcast",value:function(t,e){this.dispatch(t,e)}},{key:"on",value:function(t,e,i){if(!v(e))return!1;var s=l(i)?parseInt(i,10):1/0;return Ct(this.stack[t])?this.stack[t].push({callback:e,times:s})-1:(this.stack[t]=[{callback:e,times:s}],0)}},{key:"off",value:function(t,e){try{return this.stack[t].splice(e,1),!0}catch(i){return!1}}},{key:"trigger",value:function(t,e){if(Ct(this.stack[t])){for(var i=this.stack[t].length;i--;)this.stack[t][i].times--?this.stack[t][i].callback(e):this.off(t,i);return!0}return!1}},{key:"stack",get:function(){return this._stack}}]),t}(),At=function(){function i(n,o,l,r){var c=this;if(k.classCallCheck(this,i),!e.layout.listGraph)throw new Lt;u(r)||(r={});var h=this;this.baseEl=n,this.baseElD3=e.select(n),this.baseElJq=t(n),this.svgD3=this.baseElD3.select("svg.base"),this.svgD3.empty()?(this.svgD3=this.baseElD3.append("svg").attr("class","base"),this.svgJq=t(this.svgD3[0])):this.svgJq=t(this.svgD3[0]),this.rootNodes=l,this.width=r.width||this.svgJq.width(),this.height=r.height||this.svgJq.height(),this.scrollbarWidth=r.scrollbarWidth||D,this.columns=r.columns||x,this.rows=r.rows||N,this.iconPath=r.iconPath||S,this.highlightActiveLevel=B,"undefined"!=typeof r.highlightActiveLevel&&(this.highlightActiveLevel=r.highlightActiveLevel),this.activeLevelNumber=P,"undefined"!=typeof r.activeLevelNumber&&(this.activeLevelNumber=r.activeLevelNumber),this.noRootedNodeDifference=A,"undefined"!=typeof r.noRootedNodeDifference&&(this.noRootedNodeDifference=r.noRootedNodeDifference),this.lessAnimations=!!r.lessAnimations,this.baseElD3.classed("less-animations",this.lessAnimations),this.sortBy=r.sortBy,this.sortOrder=r.sortOrder||C,this.events=new Pt(this.baseEl,r.dispatcher),this.baseElJq.addClass(w),r.forceWidth&&this.baseElJq.width(this.width),this.layout=new e.layout.listGraph([this.width,this.height],[this.columns,this.rows]),this.data=o,this.visData=this.layout.process(this.data,this.rootNodes,{sortBy:this.sortBy,sortOrder:this.sortOrder}),this.currentSorting={global:{type:this.sortBy,order:this.sortOrder},local:{}},p(this.svgD3,{color:W,offset:0,opacity:.2,x:0,y:0},{afterOffsetOpacity:1,color:W,offset:99,opacity:1,x:1,y:0},"negativeRed",4,10),p(this.svgD3,{beforeOffsetOpacity:1,color:H,offset:1,opacity:1,x:0,y:0},{color:H,offset:100,opacity:.2,x:1,y:0},"positiveGreen",.25,10),this.barMode=r.barMode||L,this.svgD3.classed(this.barMode+"-bar",!0),this.topbar=new pt(this,this.baseElD3,this.visData),this.svgD3.attr("viewBox","0 0 "+this.width+" "+this.height),this.container=this.svgD3.append("g").attr("class","main-container"),this.levels=new ct(this.container,this,this.visData),this.links=new ot(this.levels.groups,this.visData,this.layout),this.nodes=new st(this,this.levels.groups,this.visData,this.links,this.events),this.levels.scrollPreparation(this,this.scrollbarWidth),this.scrollbars=new E(this.levels.groups,this.visData,this.scrollbarWidth),this.$levels=t(this.levels.groups[0]).on("mousewheel",function(t){h.mousewheelColumn(this,t)}),this.scrollbars.all.on("mousedown",function(){h.scrollbarMouseDown(this,e.event)}),e.select(document).on("mouseup",function(){c.globalMouseUp(e.event)}).on("mousemove",function(){c.globalMouseMove(e.event)}),this.svgD3.call(s,a,void 0,[this.container,this.topbar.localControlWrapper],"horizontal",this.getDragLimits.bind(this),[this.scrollbarDragging.bind(this)]),this.events.on("d3ListGraphLevelFocus",function(t){return c.levels.focus(t)}),this.events.on("d3ListGraphNodeRoot",function(){c.nodes.bars.updateAll(c.layout.updateBars(c.data),c.currentSorting.global.type)}),this.events.on("d3ListGraphNodeUnroot",function(){c.nodes.bars.updateAll(c.layout.updateBars(c.data),c.currentSorting.global.type)}),this.events.on("d3ListGraphUpdateBars",function(){c.nodes.bars.updateAll(c.layout.updateBars(c.data),c.currentSorting.global.type)}),this.events.on("d3ListGraphActiveLevel",function(t){var e=c.activeLevelNumber;if(c.activeLevelNumber=Math.max(t,0),c.nodes.rootedNode){var i=c.nodes.rootedNode.datum().depth;c.levels.blur(i+e),c.levels.focus(i+c.activeLevelNumber)}else c.levels.blur(e-c.noRootedNodeDifference),c.levels.focus(c.activeLevelNumber-c.noRootedNodeDifference)})}return k.createClass(i,[{key:"getDragLimits",value:function(){return{x:{min:this.dragMinX,max:0}}}},{key:"scrollbarDragging",value:function(){return!!this.activeScrollbar}},{key:"globalMouseUp",value:function(t){if(this.activeScrollbar){var e=this.activeScrollbar.datum(),i=e.scrollbar.clientY-t.clientY;e.scrollbar.scrollTop=Math.min(Math.max(e.scrollbar.scrollTop-i,0),e.scrollbar.scrollHeight),e.scrollTop=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(i),0),-e.scrollHeight),this.activeScrollbar.classed("active",!1),this.activeScrollbar=void 0}}},{key:"globalMouseMove",value:function(t){if(this.activeScrollbar){var e=this.activeScrollbar.datum(),s=e.scrollbar.clientY-t.clientY;i.scrollY(this.activeScrollbar.node(),Math.min(Math.max(e.scrollbar.scrollTop-s,0),e.scrollbar.scrollHeight));var a=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(s),0),-e.scrollHeight);i.scrollY(e.nodes,a),this.links.scroll(e.linkSelections.outgoing,this.layout.offsetLinks(e.level,a,"source")),this.links.scroll(e.linkSelections.incoming,this.layout.offsetLinks(e.level-1,a,"target"))}}},{key:"scrollbarMouseDown",value:function(t,i){this.activeScrollbar=e.select(t).classed("active",!0),this.activeScrollbar.datum().scrollbar.clientY=i.clientY}},{key:"mousewheelColumn",value:function(t,s){s.preventDefault();var a=e.select(t).datum();a.scrollHeight>0&&(a.scrollTop=Math.max(Math.min(a.scrollTop+s.deltaY,0),-a.scrollHeight),i.scrollY(a.nodes,a.scrollTop),a.scrollbar.scrollTop=a.scrollbar.heightScale(-a.scrollTop),i.scrollY(a.scrollbar.el,a.scrollbar.scrollTop),this.links.scroll(a.linkSelections.outgoing,this.layout.offsetLinks(a.level,a.scrollTop,"source")),this.links.scroll(a.linkSelections.incoming,this.layout.offsetLinks(a.level-1,a.scrollTop,"target")))}},{key:"selectByLevel",value:function(t,i){return e.select(this.levels.groups[0][t]).selectAll(i)}},{key:"sortColumn",value:function(t,e,i,s){this.nodes.sort(this.layout.sort(t,e,i).nodes(t),s),this.links.sort(this.layout.links(t-1,t+1))}},{key:"switchBarMode",value:function(t){this.svgD3.classed("one-bar","one"===t),this.svgD3.classed("two-bar","two"===t),this.nodes.bars.switchMode(t,this.currentSorting)}},{key:"trigger",value:function(t,e){this.events.trigger(t,e)}},{key:"updateScrollbarVisibility",value:function(){this.levels.updateScrollProperties(),this.scrollbars.updateVisibility()}},{key:"updateLevelsVisibility",value:function(){this.levels.updateVisibility()}},{key:"globalView",value:function(t){var e=0,i=0,s=void 0,a=void 0,n=this.svgD3.node().getBoundingClientRect();t&&!t.empty()?(t.each(function(){s=this.getBBox(),a=this.getBoundingClientRect(),e=Math.max(e,a.left-n.left+a.width),i=Math.max(i,a.top-n.top+a.height)}),e=this.width>e?this.width:e,i=this.height>i?this.height:i):(s=this.container.node().getBBox(),e=this.width>s.width?this.width:s.width,i=this.height>s.height?this.height:s.height),this.svgD3.transition().duration(O).attr("viewBox","0 0 "+e+" "+i)}},{key:"zoomedView",value:function(){this.svgD3.transition().duration(O).attr("viewBox","0 0 "+this.width+" "+this.height)}},{key:"area",get:function(){return this.container.node().getBoundingClientRect()}},{key:"dragMinX",get:function(){return Math.min(0,this.width-this.area.width)}},{key:"barMode",get:function(){return this.bars?this.nodes.bars.mode:this._barMode},set:function(t){this.bars&&(this.nodes.bars.mode=t),this._barMode=t}}],[{key:"scrollY",value:function(t,i){e.select(t).attr("transform","translate(0, "+i+")")}}]),i}();return At}($,d3);
//# sourceMappingURL=listGraph.min.js.map
