/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
!function(t){"use strict";function e(e,a){try{t.select(e).attr("transform","translate(0, "+a+")")}catch(n){console.err("ListGraph is not properly initialized!",n)}}function a(t,e,a,n,l){e.data(function(){return t.offsetLinks(a,n,l)}).attr("d",b).exit().remove()}function n(t,n){t.preventDefault(),this.__data__.scrollHeight>0&&(this.__data__.scrollTop=Math.max(Math.min(this.__data__.scrollTop+t.deltaY,0),-this.__data__.scrollHeight),e(this.__data__.scrollEl,this.__data__.scrollTop),this.__data__.scrollbar.el.__data__.scrollTop=this.__data__.scrollbar.heightScale(-this.__data__.scrollTop),e(this.__data__.scrollbar.el,this.__data__.scrollbar.el.__data__.scrollTop),a(n,this.__data__.linkSelections.outgoing,this.__data__.level,this.__data__.scrollTop,"source"),a(n,this.__data__.linkSelections.incoming,this.__data__.level-1,this.__data__.scrollTop,"target"))}function l(e,a){var n=this.querySelector(".nodes"),l=this.querySelector(".scrollbar"),s=n.getBoundingClientRect().height+2*a.row.padding,o=s-g,i=o>0?Math.max(g*g/o,10):0;e.height=s,e.linkSelections={incoming:this.previousSibling?t.select(this.previousSibling).selectAll(".link"):null,outgoing:t.select(this).selectAll(".link")},e.scrollEl=n,e.scrollHeight=o,e.scrollTop=0,e.scrollbar={el:l,x:e.x+a.column.width-p,y:0,width:p,height:i,scrollHeight:g-i,heightScale:t.scale.linear().domain([0,o]).range([0,g-i])}}function s(t,e){for(;t.parent;)t=t.parent,e(t)}function o(t,e){for(var a=t.childRefs.length;a--;)e(t.childRefs[a]),o(t.childRefs[a],e)}function i(t,e){s(t,e),o(t,e);for(var a=t.childRefs.length;a--;)e(t.childRefs[a]),o(t.childRefs[a],e)}function c(t){t.append("foreignObject").attr("x",function(t){return t.x+f.global.column.padding+f.global.cell.padding}).attr("y",function(t){return t.y+f.global.row.padding+f.global.cell.padding}).attr("width",f.global.column.contentWidth).attr("height",f.global.row.contentHeight/2-2*f.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).append("xhtml:span").text(function(t){return t.data.name})}function r(t,e,a,n,l){t.attr("x",e.x+f.global.column.padding+f.global.cell.padding).attr("y",function(t,n){return e.y+f.global.row.padding+f.global.row.contentHeight/2+a*n+f.global.cell.padding*(1+2*n)}).attr("width",function(t){return(l?t.value:1)*(f.global.column.contentWidth-2*f.global.cell.padding)}).attr("height",a).classed(n,!0)}function d(t){var e=t.datum(),a=e.data.bars,n=f.global.row.contentHeight/(2*e.data.bars.length)-2*f.global.cell.padding,l=t.selectAll(".bar").data(a).enter().append("g").attr("class",function(t){return"bar "+t.id});l.append("rect").call(r,e,n,"bar-border"),l.append("rect").call(r,e,n,"bar-magnitude",!0)}function u(t){t.append("g").classed("bars",!0).call(d)}t="default"in t?t["default"]:t;var h=250,_=800,g=200,p=6;$(".list-graph").width(_);var f,v=new D3LayoutListGraph([_,g],[5,5]),b=t.svg.diagonal().projection(function(t){return[t.y,t.x]}),m=t.select(".list-graph").append("div").attr("class","topbar"),x=t.select(".list-graph").append("svg").attr("width",_).attr("height",g),w=x.append("g");t.json("data.json",function(s,o){function r(){console.log("Toggle column")}function d(e){return t.select(k[0][t.select(e).data()[0].level]).selectAll(".node")}function _(t,e,a){var n=d(t);n.selectAll(".bar."+e).classed("highlight",!a)}function g(e,a){var n=$(this),l=t.select(this),s=n.data("sortStatus");switch(console.log(l.select(".icon-sort-unsort")),console.log(l.select(".icon-unsort").classed("visible",!1)),console.log(l.select(".icon-unsort").attr("class")),s){case 1:s=0,l.select(".icon-sort-asc").classed("visible",!1),l.select(".icon-unsort").classed("visible",!0);break;case-1:s=1,l.select(".icon-sort-desc").classed("visible",!1),l.select(".icon-sort-asc").classed("visible",!0);break;default:s=-1,l.select(".icon-unsort").classed("visible",!1),l.select(".icon-sort-desc").classed("visible",!0)}n.data("sortStatus",s);var o=d(this.parentNode),i=o.data();i.sort(function(t,a){var n=t.data.barRefs[e],l=a.data.barRefs[e];return n>l?s:l>n?-s:0});var c=function(){t.select(this).classed("sorting",!0)},r=function(){t.select(this).classed("sorting",!1)};s?o.data(i,function(t){return t.data.name}).transition().duration(h).attr("transform",function(t,e){return"translate(0, "+(e*a.row.height-t.y)+")"}).each("start",c).each("end",r):o.transition().duration(h).attr("transform","translate(0, 0)").each("start",c).each("end",r)}function x(){console.log("Toggle options")}function y(t,e){var a=$(t[0]).addClass("controls").width(e.column.width);$("<li/>").addClass("toggle").width(e.column.padding).on("click",r).appendTo(a),$("<li/>").addClass("sort-precision ease-all").css({width:e.column.contentWidth/2,left:e.column.padding}).on("click",function(){g.call(this,"precision",e)}).on("mouseenter",function(){_(this.parentNode,"precision"),$(this).css({width:e.column.contentWidth})}).on("mouseleave",function(){_(this.parentNode,"precision",!0),$(this).css({width:e.column.contentWidth/2})}).appendTo(a).append('<div class="expandable-label">  <span class="letter abbr">P</span>  <span class="letter abbr">r</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">i</span>  <span class="letter">s</span>  <span class="letter">i</span>  <span class="letter">o</span>  <span class="letter">n</span></div><svg class="icon-unsort invisible-default visible">  <use xlink:href="/dist/icons.svg#unsort"></use></svg><svg class="icon-sort-asc invisible-default">  <use xlink:href="/dist/icons.svg#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default">  <use xlink:href="/dist/icons.svg#sort-desc"></use></svg>'),$("<li/>").addClass("sort-recall ease-all").css({width:e.column.contentWidth/2,left:e.column.contentWidth/2+e.column.padding}).on("click",function(){g.call(this,"recall",e)}).on("mouseenter",function(){_(this.parentNode,"recall"),$(this).css({width:e.column.contentWidth,left:e.column.padding})}).on("mouseleave",function(){_(this.parentNode,"recall",!0),$(this).css({width:e.column.contentWidth/2,left:e.column.contentWidth/2+e.column.padding})}).appendTo(a).append('<div class="expandable-label">  <span class="letter abbr">R</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">a</span>  <span class="letter abbr">l</span>  <span class="letter">l</span></div><svg class="icon-unsort invisible-default visible">  <use xlink:href="/dist/icons.svg#unsort"></use></svg><svg class="icon-sort-asc invisible-default">  <use xlink:href="/dist/icons.svg#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default">  <use xlink:href="/dist/icons.svg#sort-desc"></use></svg>'),$("<li/>").addClass("options").width(e.column.padding).on("click",x).appendTo(a).append('<svg class="icon-gear">  <use xlink:href="/dist/icons.svg#gear"></use></svg>')}if(s)throw s;f=v.process(o,["1","2"]),b.source(function(t){return{x:t.source.y+t.source.offsetY+f.global.row.height/2,y:t.source.x+t.source.offsetX+f.global.column.contentWidth+f.global.column.padding}}).target(function(t){return{x:t.target.y+t.target.offsetY+f.global.row.height/2,y:t.target.x+t.target.offsetX+f.global.column.padding}}).projection(function(t){return[t.y,t.x]});var k=w.selectAll("g").data(f.nodes).enter().append("g").attr("class","level");k.append("rect").attr("class","scroll-container").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return f.global.column.width}).attr("height",function(t){return f.global.column.height});var T=k.append("g").attr("class","links"),S=(T.selectAll(".link").data(function(t,e){return v.links(e)}).enter().append("path").attr("class","link").attr("d",b),k.append("g").attr("class","nodes")),H=S.selectAll("g.node").data(function(t){return t.rows}).enter().append("g").classed("node",!0).classed("clone",function(t){return t.clone});H.append("rect").attr("x",function(t){return t.x+f.global.column.padding}).attr("y",function(t){return t.y+f.global.row.padding}).attr("width",f.global.column.contentWidth).attr("height",f.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bg",!0),H.on("mouseover",function(e){e.hovering=1,i(e,function(t){t.hovering=2}),t.select(this).classed("hovering-directly",!0),H.classed("hovering-indirectly",function(t){return 2===t.hovering})}),H.on("mouseout",function(e){e.hovering=0,i(e,function(t){t.hovering=0}),t.select(this).classed("hovering-directly",!1),H.classed("hovering-indirectly",!1)}),H.call(c),H.each(function(e){t.select(this).call(u)});var W=k.append("rect").classed("scrollbar",!0);k.each(function(t){l.call(this,t,f.global)}),W.attr("x",function(t){return t.scrollbar.x}).attr("y",function(t){return t.scrollbar.y}).attr("width",function(t){return p}).attr("height",function(t){return t.scrollbar.height}).attr("rx",p/2).attr("ry",p/2).classed("ready",!0);var M=($(k[0]).on("mousewheel",function(t){n.call(this,t,v)}),void 0);$(W[0]).each(function(){this.__data__={clientY:null,scrollTop:0};for(var t=Object.keys(this.parentNode.__data__.scrollbar),e=t.length;e--;)this.__data__[t[e]]=this.parentNode.__data__.scrollbar[t[e]];this.__data__.invertedHeightScale=this.__data__.heightScale.invert,this.__data__.contentEl=this.parentNode.querySelector(".nodes")}).on("mousedown",function(e){M=this,M.__data__.clientY=e.clientY,t.select(M).classed("active",!0)}),$(document).on("mouseup",function(e){if(M){var a=M.__data__.clientY-e.clientY;M.__data__.scrollTop=Math.min(Math.max(M.__data__.scrollTop-a,0),M.__data__.scrollHeight);var n=M.__data__.contentEl;n.__data__.scrollTop=Math.max(Math.min(n.__data__.scrollTop+M.__data__.invertedHeightScale(a),0),-n.__data__.scrollHeight),t.select(M).classed("active",!1),M=void 0}}).on("mousemove",function(t){if(M){var n=M.__data__.clientY-t.clientY;e(M,Math.min(Math.max(M.__data__.scrollTop-n,0),M.__data__.scrollHeight));var l=M.__data__.contentEl,s=Math.max(Math.min(l.__data__.scrollTop+M.__data__.invertedHeightScale(n),0),-l.__data__.scrollHeight);e(l,s),a(v,l.__data__.linkSelections.outgoing,l.__data__.level,s,"source"),a(v,l.__data__.linkSelections.incoming,l.__data__.level-1,s,"target")}}),m.selectAll(".controls").data(f.nodes).enter().append("ul").call(y,f.global)})}(d3);
//# sourceMappingURL=listGraph.min.js.map
