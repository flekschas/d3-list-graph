/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
var ListGraph=function(t,e){"use strict";function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function n(t){var e=i(t)?Gt.call(t):"";return e==Qt||e==zt}function s(t){return t&&t.Object===Object?t:null}function o(t){return"number"==typeof t&&ee(t)}function a(t,e){var i=t;if(t.clone&&(i=t.originalNode,e))return[];var n=[i];return i.clones.length&&(n=n.concat(i.clones)),n}function r(t,e,i,n,s,l){if(!l[t.id])for(var c=n?a(t):[t],h=c.length;h--;)if(s&&e(c[h],s),l[c[h].id]=!0,!o(i)||i>0)for(var u=Object.keys(c[h].parents),d=u.length;d--;)r(c[h].parents[u[d]],e,i-1,n,c[h],l)}function l(t,e,i,n,s){var o={};r(t,e,i,n,s,o)}function c(t,e,i,n,s){if(!s[t.id])for(var r=n?a(t,!0):[t],l=r.length;l--;)if(e(r[l]),s[r[l].id]=!0,0===l&&(!o(i)||i>0))for(var h=r[l].childRefs.length;h--;)c(r[l].childRefs[h],e,i-1,n,s)}function h(t,e,i,n){var s={};c(t,e,i,n,s)}function u(t,e,i,n,s){if(i)l(t,e,n,s),h(t,i,n,s);else{var o={};l(t,e,n,s,o),h(t,e,n,s,o)}}function d(t,e){for(var i=Object.keys(t.parents),n=i.length;n--;)for(var s=t.parents[i[n]].childRefs.length;s--;)e(t.parents[i[n]].childRefs[s]);if(t.siblings)for(var o=Object.keys(t.siblings),n=o.length;n--;)e(t.siblings[o[n]])}function v(t,e,i,n,s){var o=s.topLeft||0,a=s.topRight||0,r=s.bottomLeft||0,l=s.bottomRight||0;return"M"+(t+o)+","+e+"h"+(i-o-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(n-(a+l))+"a"+l+","+l+" 0 0 1 "+-l+","+l+"h"+(r-(i-l))+"a"+r+","+r+" 0 0 1 "+-r+","+-r+"v"+(o-(n-r))+"a"+o+","+o+" 0 0 1 "+o+","+-o+"z"}function g(t){return"M"+(t.x+t.radius)+","+t.y+"h"+(t.width-2*t.radius)+"a"+t.radius+","+t.radius+" 0 0 1 "+t.radius+","+t.radius+"v"+(t.height-2*t.radius)+"a"+t.radius+","+t.radius+" 0 0 1 "+-t.radius+","+t.radius+"h"+-(t.width-2*t.radius-2*t.arrowSize)/2+"l"+-t.arrowSize+","+t.arrowSize+"l"+-t.arrowSize+","+-t.arrowSize+"h"+-(t.width-2*t.radius-2*t.arrowSize)/2+"a"+t.radius+","+t.radius+" 0 0 1 "+-t.radius+","+-t.radius+"v"+(t.radius-(t.height-t.radius))+"a"+t.radius+","+t.radius+" 0 0 1 "+t.radius+","+-t.radius+"z"}function p(t){function i(t){t.each(function(){n[0].push(this)})}for(var n=e.selectAll(".d3-list-graph-not-existent"),s=t.length;s--;)i(t[s]);return n}function f(t,e){0===t.size()&&e();var i=0;t.each(function(){return++i}).each("end",function(){for(var t=arguments.length,n=Array(t),s=0;t>s;s++)n[s]=arguments[s];--i||e.apply(this,n)})}function b(t){return"function"==typeof t||"object"==typeof t&&null!==t}function y(t){return"function"==typeof t}function m(t){Be=t}function k(t){Me=t}function w(){return function(){process.nextTick(C)}}function x(){return function(){Le(C)}}function D(){var t=0,e=new qe(C),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function N(){var t=new MessageChannel;return t.port1.onmessage=C,function(){t.port2.postMessage(0)}}function S(){return function(){setTimeout(C,1)}}function C(){for(var t=0;He>t;t+=2){var e=Te[t],i=Te[t+1];e(i),Te[t]=void 0,Te[t+1]=void 0}He=0}function L(){try{var t=require,e=t("vertx");return Le=e.runOnLoop||e.runOnContext,x()}catch(i){return S()}}function B(t,e){var i=this,n=i._state;if(n===We&&!t||n===Ie&&!e)return this;var s=new this.constructor(A),o=i._result;if(n){var a=arguments[n-1];Me(function(){G(n,s,a,o)})}else V(i,s,t,e);return s}function _(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(A);return T(i,t),i}function A(){}function H(){return new TypeError("You cannot resolve a promise with itself")}function M(){return new TypeError("A promises callback cannot return that same promise.")}function R(t){try{return t.then}catch(e){return Ve.error=e,Ve}}function O(t,e,i,n){try{t.call(e,i,n)}catch(s){return s}}function q(t,e,i){Me(function(t){var n=!1,s=O(i,e,function(i){n||(n=!0,e!==i?T(t,i):W(t,i))},function(e){n||(n=!0,I(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&s&&(n=!0,I(t,s))},t)}function F(t,e){e._state===We?W(t,e._result):e._state===Ie?I(t,e._result):V(e,void 0,function(e){T(t,e)},function(e){I(t,e)})}function E(t,e,i){e.constructor===t.constructor&&i===B&&constructor.resolve===_?F(t,e):i===Ve?I(t,Ve.error):void 0===i?W(t,e):y(i)?q(t,e,i):W(t,e)}function T(t,e){t===e?I(t,H()):b(e)?E(t,e,R(e)):W(t,e)}function P(t){t._onerror&&t._onerror(t._result),Q(t)}function W(t,e){t._state===Pe&&(t._result=e,t._state=We,0!==t._subscribers.length&&Me(Q,t))}function I(t,e){t._state===Pe&&(t._state=Ie,t._result=e,Me(P,t))}function V(t,e,i,n){var s=t._subscribers,o=s.length;t._onerror=null,s[o]=e,s[o+We]=i,s[o+Ie]=n,0===o&&t._state&&Me(Q,t)}function Q(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n,s,o=t._result,a=0;a<e.length;a+=3)n=e[a],s=e[a+i],n?G(i,n,s,o):s(o);t._subscribers.length=0}}function z(){this.error=null}function j(t,e){try{return t(e)}catch(i){return Qe.error=i,Qe}}function G(t,e,i,n){var s,o,a,r,l=y(i);if(l){if(s=j(i,n),s===Qe?(r=!0,o=s.error,s=null):a=!0,e===s)return void I(e,M())}else s=n,a=!0;e._state!==Pe||(l&&a?T(e,s):r?I(e,o):t===We?W(e,s):t===Ie&&I(e,s))}function U(t,e){try{e(function(e){T(t,e)},function(e){I(t,e)})}catch(i){I(t,i)}}function Y(t){function e(t){T(s,t)}function i(t){I(s,t)}var n=this,s=new n(A);if(!Ae(t))return I(s,new TypeError("You must pass an array to race.")),s;for(var o=t.length,a=0;s._state===Pe&&o>a;a++)V(n.resolve(t[a]),void 0,e,i);return s}function J(t){var e=this,i=new e(A);return I(i,t),i}function X(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function $(t){this._id=ze++,this._state=void 0,this._result=void 0,this._subscribers=[],A!==t&&("function"!=typeof t&&X(),this instanceof $?U(this,t):Z())}function K(t,e){this._instanceConstructor=t,this.promise=new t(A),Array.isArray(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?W(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&W(this.promise,this._result))):I(this.promise,this._validationError())}function tt(t){return new K(this,t).promise}function et(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function it(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function nt(t){this._id=je++,this._state=void 0,this._result=void 0,this._subscribers=[],A!==t&&("function"!=typeof t&&et(),this instanceof nt?U(this,t):it())}function st(t){if(i(t)){var e=n(t.valueOf)?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Ye,"");var s=Xe.test(t);return s||Ze.test(t)?$e(t.slice(2),s?2:8):Je.test(t)?Ue:+t}function ot(t,e,n){function s(){p&&clearTimeout(p),u&&clearTimeout(u),b=0,h=u=g=p=f=void 0}function o(e,i){i&&clearTimeout(i),u=p=f=void 0,e&&(b=Ge(),d=t.apply(g,h),p||u||(h=g=void 0))}function a(){var t=e-(Ge()-v);0>=t||t>e?o(f,u):p=setTimeout(a,t)}function r(){return(p&&f||u&&k)&&(d=t.apply(g,h)),s(),d}function l(){o(k,p)}function c(){if(h=arguments,v=Ge(),g=this,f=k&&(p||!y),m===!1)var i=y&&!p;else{b||u||y||(b=v);var n=m-(v-b),s=(0>=n||n>m)&&(y||u);s?(u&&(u=clearTimeout(u)),b=v,d=t.apply(g,h)):u||(u=setTimeout(l,n))}return s&&p?p=clearTimeout(p):p||e===m||(p=setTimeout(a,e)),i&&(s=!0,d=t.apply(g,h)),!s||p||u||(h=g=void 0),d}var h,u,d,v,g,p,f,b=0,y=!1,m=!1,k=!0;if("function"!=typeof t)throw new TypeError(Ke);return e=st(e)||0,i(n)&&(y=!!n.leading,m="maxWait"in n&&ti(st(n.maxWait)||0,e),k="trailing"in n?!!n.trailing:k),c.cancel=s,c.flush=r,c}function at(t,i,n,s,o,a,r,l,c){var h=e.behavior.drag(),u=r||{};i&&h.on("dragstart",function(){"function"==typeof r&&(u=r())}),n&&h.on("drag",function(t){for(var s=l.length;s--;)if(l[s]())return;e.event.sourceEvent.preventDefault(),i(),n.call(this,t,o,a,u)}),s&&h.on("dragend",s),t.each(function(t){var i=e.select(this);t||(t={drag:c},i.datum(t)),i.call(h)})}function rt(t,i,n,s){function o(t,e){var i=void 0;if(e)try{i=Math.min(e.max,Math.max(e.min,t))}catch(n){throw new gi}return i}var a=e.select(this);i&&i.length&&(a=p(i)),"horizontal"===n||"vertical"===n?("horizontal"===n&&(t.drag.x+=e.event.dx,t.drag.x=o(t.drag.x+e.event.dx,s.x),a.style("transform","translateX("+t.drag.x+"px)")),"vertical"===n&&(t.drag.y+=e.event.dy,t.drag.x=o(t.drag.y+e.event.dy,s.y),a.style("transform","translateY("+t.drag.y+"px)"))):(t.drag.x+=e.event.dx,t.drag.y+=e.event.dy,a.style("transform","translate("+t.drag.x+"px,"+t.drag.y+"px)"))}function lt(t,e,i,n,s,o){var a=t.select("defs");a.empty()&&(a=t.append("defs"));var r=a.append("filter").attr("id","drop-shadow"+(e?"-"+e:"")).attr("height","130%");r.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",s),r.append("feOffset").attr("dx",i).attr("dy",n).attr("result","offsetBlur"),r.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",o||1);var l=r.append("feMerge");l.append("feMergeNode"),l.append("feMergeNode").attr("in","SourceGraphic")}function ct(t,e,i){return i?t||e:"undefined"!=typeof t?t:e}var ht={};ht.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ht.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),ht.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},ht.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var ut,dt=function(t){function e(t){ht.classCallCheck(this,e);var i=ht.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.name=i.constructor.name,i.message=t,Error.captureStackTrace(i,i.constructor.name),i}return ht.inherits(e,t),e}(Error),vt=function(t){function e(t){return ht.classCallCheck(this,e),ht.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"D3.layout.listGraph.js has not been loaded yet."))}return ht.inherits(e,t),e}(dt),gt=function(t){function e(t){return ht.classCallCheck(this,e),ht.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"Dispatcher needs to be a function."))}return ht.inherits(e,t),e}(dt),pt="list-graph",ft=6,bt=5,yt=5,mt="",kt=-1,wt="one",xt=!0,Dt=0,Nt=0,St=!1,Ct=!1,Lt=!1,Bt=!1,_t=150,At=250,Ht="div",Mt="top-bar",Rt="ul",Ot="controls",qt="global-controls",Ft=function(){function t(i,n,s){var o=this;ht.classCallCheck(this,t);var a=this;this.vis=i,this.visData=s,this.el=n.select("."+Mt),this.el.empty()&&(this.el=n.insert(Ht,":first-child").attr("class",Mt)),this.controlSwitch=this.el.append("div").attr("title","Toggle global / local topbar").style("width",this.visData.global.column.padding+"px").classed("control-switch",!0).on("click",this["switch"].bind(this)),this.switchArrow=this.controlSwitch.append("svg").append("use").attr("xlink:href",this.vis.iconPath+"#arrow-down").attr("class","switch-arrow"),this.globalControls=this.el.append(Rt).classed(qt,!0),this.globalPrecision=this.globalControls.append("li").attr("class","control-btn sort-precision").classed("active",function(){return"precision"===a.vis.currentSorting.global.type?(a.vis.currentSorting.global.el=e.select(this),!0):!1}).on("click",function(){a.sortAllColumns(this,"precision")}).on("mouseenter",function(){o.vis.interactionWrapper.call(o.vis,function(){o.highlightBars(void 0,"precision")},[])}).on("mouseleave",function(){o.vis.interactionWrapper.call(o.vis,function(){o.highlightBars(void 0,"precision",!0)},[])}),this.globalPrecisionWrapper=this.globalPrecision.append("div").attr("class","wrapper"),this.globalPrecisionWrapper.append("span").attr("class","label").text("Precision"),this.globalPrecisionWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","precision"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalPrecisionWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","precision"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalRecall=this.globalControls.append("li").attr("class","control-btn sort-recall").classed("active",function(){return"recall"===a.vis.currentSorting.global.type?(a.vis.currentSorting.global.el=e.select(this),!0):!1}).on("click",function(){a.sortAllColumns(this,"recall")}).on("mouseenter",function(){o.vis.interactionWrapper.call(o.vis,function(){o.highlightBars(void 0,"recall")},[])}).on("mouseleave",function(){o.vis.interactionWrapper.call(o.vis,function(){o.highlightBars(void 0,"recall",!0)},[])}),this.globalRecallWrapper=this.globalRecall.append("div").attr("class","wrapper"),this.globalRecallWrapper.append("span").attr("class","label").text("Recall"),this.globalRecallWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","recall"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-asc"),this.globalRecallWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","recall"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-desc"),this.globalName=this.globalControls.append("li").attr("class","control-btn sort-name").classed("active",function(){return"name"===a.vis.currentSorting.global.type?(a.vis.currentSorting.global.el=e.select(this),!0):!1}).on("click",function(){a.sortAllColumns(this,"name")}).on("mouseenter",function(){o.vis.interactionWrapper.call(o.vis,function(){o.highlightLabels()},[])}).on("mouseleave",function(){o.vis.interactionWrapper.call(o.vis,function(){o.highlightLabels(!0)},[])}),this.globalNameWrapper=this.globalName.append("div").attr("class","wrapper"),this.globalNameWrapper.append("span").attr("class","label").text("Name"),this.globalNameWrapper.append("svg").attr("class","icon-unsort invisible-default").classed("visible","name"!==this.vis.currentSorting.global.type).append("use").attr("xlink:href",this.vis.iconPath+"#unsort"),this.globalNameWrapper.append("svg").attr("class","icon-sort-asc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1===this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-asc"),this.globalNameWrapper.append("svg").attr("class","icon-sort-desc invisible-default").classed("visible","name"===this.vis.currentSorting.global.type&&1!==this.vis.currentSorting.global.order).append("use").attr("xlink:href",this.vis.iconPath+"#sort-alpha-desc"),this.globalOneBar=this.globalControls.append("li").attr("class","control-btn one-bar").classed("active","one"===this.vis.barMode).on("click",function(){a.switchBarMode(this,"one")}),this.globalOneBarWrapper=this.globalOneBar.append("div").attr("class","wrapper").text("One bar"),this.globalOneBarWrapper.append("svg").attr("class","icon-one-bar").append("use").attr("xlink:href",this.vis.iconPath+"#one-bar"),this.globalTwoBars=this.globalControls.append("li").attr("class","control-btn two-bars").classed("active","two"===this.vis.barMode).on("click",function(){a.switchBarMode(this,"two")}),this.globalTwoBarsWrapper=this.globalTwoBars.append("div").attr("class","wrapper").text("Two bars"),this.globalTwoBarsWrapper.append("svg").attr("class","icon-two-bars").append("use").attr("xlink:href",this.vis.iconPath+"#two-bars"),this.globalZoomOut=this.globalControls.append("li").attr("class","control-btn zoom-out").classed("active",this.vis.zoomedOut).on("mouseenter",function(){o.vis.interactionWrapper.call(o.vis,function(){o.vis.globalView.call(o.vis)},[])}).on("mouseleave",function(){o.vis.interactionWrapper.call(o.vis,function(){o.vis.zoomedView.call(o.vis)},[])}).on("click",function(){a.vis.toggleView.call(a.vis),e.select(this).classed("active",a.vis.zoomedOut)}),this.globalZoomOutWrapper=this.globalZoomOut.append("div").attr("class","wrapper").text("Zoom Out"),this.globalZoomOutWrapper.append("svg").attr("class","icon-zoom-out").append("use").attr("xlink:href",this.vis.iconPath+"#zoom-out"),this.localControlWrapper=this.el.append("div").classed("local-controls",!0),this.localControls=this.localControlWrapper.selectAll(Ot).data(s.nodes).enter().append(Rt).classed(Ot,!0).style("width",this.visData.global.column.width+"px"),this.localControls.each(function(t,i){var n=e.select(this);a.vis.currentSorting.local[i]={type:t.sortBy,order:t.sortOrder,el:void 0},n.append("li").attr("class","control-btn toggle").style("width",a.visData.global.column.padding+"px").on("click",a.toggleColumn),n.append("li").attr("class","control-btn sort-precision ease-all").classed("active",function(){return"precision"===a.vis.currentSorting.local[i].type?(a.vis.currentSorting.local[i].el=e.select(this),!0):!1}).style({width:a.visData.global.column.contentWidth/2+"px",left:a.visData.global.column.padding+"px"}).on("click",function(t){a.sortColumn(this,t.level,"precision")}).on("mouseenter",function(){a.highlightBars(this.parentNode,"precision"),e.select(this).style("width",a.visData.global.column.contentWidth-16+"px")}).on("mouseleave",function(){a.highlightBars(this.parentNode,"precision",!0),e.select(this).style("width",a.visData.global.column.contentWidth/2+"px")}).html('<div class="expandable-label">  <span class="letter abbr">P</span>  <span class="letter abbr">r</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">i</span>  <span class="letter">s</span>  <span class="letter">i</span>  <span class="letter">o</span>  <span class="letter">n</span></div><svg class="icon-unsort invisible-default '+("precision"!==a.vis.currentSorting.local[i].type?"visible":"")+'">  <use xlink:href="'+a.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("precision"===a.vis.currentSorting.local[i].type&&1===a.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+a.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("precision"===a.vis.currentSorting.local[i].type&&1!==a.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+a.vis.iconPath+'#sort-desc"></use></svg>'),n.append("li").attr("class","control-btn sort-recall ease-all").classed("active",function(){return"recall"===a.vis.currentSorting.local[i].type?(a.vis.currentSorting.local[i].el=e.select(this),!0):!1}).style({width:a.visData.global.column.contentWidth/2+"px",left:a.visData.global.column.contentWidth/2+a.visData.global.column.padding+"px"}).on("click",function(t){a.sortColumn(this,t.level,"recall")}).on("mouseenter",function(){a.highlightBars(this.parentNode,"recall"),e.select(this).style({width:a.visData.global.column.contentWidth-16+"px",left:a.visData.global.column.padding+16+"px"})}).on("mouseleave",function(){a.highlightBars(this.parentNode,"recall",!0),e.select(this).style({width:a.visData.global.column.contentWidth/2+"px",left:a.visData.global.column.contentWidth/2+a.visData.global.column.padding+"px"})}).html('<div class="expandable-label">  <span class="letter abbr">R</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">a</span>  <span class="letter abbr">l</span>  <span class="letter">l</span></div><svg class="icon-unsort invisible-default '+("recall"!==a.vis.currentSorting.local[i].type?"visible":"")+'">  <use xlink:href="'+a.vis.iconPath+'#unsort"></use></svg><svg class="icon-sort-asc invisible-default '+("recall"===a.vis.currentSorting.local[i].type&&1===a.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+a.vis.iconPath+'#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default '+("recall"===a.vis.currentSorting.local[i].type&&1!==a.vis.currentSorting.local[i].order?"visible":"")+'">  <use xlink:href="'+a.vis.iconPath+'#sort-desc"></use></svg>'),n.append("li").attr("class","control-btn options").style("width",a.visData.global.column.padding+"px").on("click",a.toggleOptions).html('<svg class="icon-gear">  <use xlink:href="'+a.vis.iconPath+'#gear"></use></svg>'),a.vis.currentSorting.local[i].type&&(a.vis.currentSorting.local[i].el=n.select(".sort-"+a.vis.currentSorting.local[i].type))})}return ht.createClass(t,[{key:"selectNodesLevel",value:function(t){return this.vis.selectByLevel(e.select(t).datum().level,".node")}},{key:"highlightLabels",value:function(t){this.vis.baseElD3.selectAll(".node").classed("highlight-label",!t)}},{key:"highlightBars",value:function(t,e,i){var n=t?this.selectNodesLevel(t):this.vis.baseElD3.selectAll(".node");n.classed("highlight-bar",!i).selectAll(".bar."+e).classed("highlight",!i)}},{key:"sortAllColumns",value:function(t,i){var n=this.vis.currentSorting.global.type!==i;n&&(this.semiActiveSortingEls&&this.resetSemiActiveSortingEls(),this.vis.currentSorting.global.el&&this.resetSortEl(this.vis.currentSorting.global.el,i)),this.vis.currentSorting.global.el=e.select(t),this.vis.currentSorting.global.el.classed("active",!0),this.vis.currentSorting.global.type=i;for(var s=Object.keys(this.vis.currentSorting.local),o=0,a=s.length;a>o;o++)this.sortColumn(t,s[o],i,!0);this.vis.sortAllColumns(i,n)}},{key:"sortColumn",value:function(t,i,n,s){s||(this.semiActiveSortingEls&&this.resetSemiActiveSortingEls(),this.vis.currentSorting.global.type&&this.resetSortEl(this.vis.currentSorting.global.el,n),this.vis.currentSorting.global.type=void 0);var o=!1;this.vis.currentSorting.local[i].el&&this.vis.currentSorting.local[i].type!==n&&this.resetSortEl(this.vis.currentSorting.local[i].el,n),this.vis.currentSorting.local[i].type!==n&&(o=!0,this.vis.currentSorting.local[i].order=0),this.vis.currentSorting.local[i].el=e.select(t),this.vis.currentSorting.local[i].type=n,-1===this.vis.currentSorting.local[i].order?(this.vis.currentSorting.local[i].order=1,this.vis.currentSorting.local[i].el.select(".icon-sort-desc").classed("visible",!1),this.vis.currentSorting.local[i].el.select(".icon-sort-asc").classed("visible",!0)):(this.vis.currentSorting.local[i].order=-1,this.vis.currentSorting.local[i].el.select(".icon-sort-asc").classed("visible",!1),this.vis.currentSorting.local[i].el.select(".icon-sort-desc").classed("visible",!0)),this.vis.currentSorting.local[i].el.select(".icon-unsort").classed("visible",!1),this.vis.currentSorting.local[i].el.classed("active",!0),s||this.vis.sortColumn(i,n,this.vis.currentSorting.local[i].order,o)}},{key:"resetSortEl",value:function(t,e){t.classed("active",!1),t.select(".icon-sort-desc").classed("visible",!1),t.select(".icon-sort-asc").classed("visible",!1),t.select(".icon-unsort").classed("visible",!0),"name"===e&&(t.classed("semi-active",!0),this.semiActiveSortingEls=!0)}},{key:"resetSemiActiveSortingEls",value:function(){this.el.selectAll(".semi-active").classed("semi-active",!1)}},{key:"switch",value:function(){this.el.classed("details",!this.el.classed("details"))}},{key:"switchBarMode",value:function(t,e){this.vis.nodes.barMode!==e&&("one"===e?(this.globalOneBar.classed("active",!0),this.globalTwoBars.classed("active",!1)):(this.globalOneBar.classed("active",!1),this.globalTwoBars.classed("active",!0)),this.vis.switchBarMode(e))}}]),t}(),Et="column",Tt="scroll-container",Pt=function(){function t(e,i,n){var s=this;ht.classCallCheck(this,t),this.vis=i,this.visData=n,this.groups=e.selectAll("g").data(this.visData.nodes).enter().append("g").attr("class",Et).classed("active",function(t,e){return s.vis.highlightActiveLevel?s.vis.nodes&&s.vis.nodes.rootedNode?e===s.vis.activeLevel:e===s.vis.activeLevel-s.vis.noRootActiveLevelDiff:!1}).each(function(t){t.scrollTop=0}),this.groups.append("rect").attr("class",Tt).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",this.visData.global.column.width+1).attr("height",this.visData.global.column.height)}return ht.createClass(t,[{key:"scrollPreparation",value:function(t,i){var n=this;this.groups.each(function(s,o){var a=s.nodes.getBoundingClientRect().height+2*n.visData.global.row.padding,r=a-n.visData.global.column.height,l=r>0?Math.max(n.visData.global.column.height*n.visData.global.column.height/a,10):0;s.height=a,s.linkSelections={incoming:o>0?t.selectByLevel(o-1,".link"):null,outgoing:t.selectByLevel(o,".link")},s.scrollHeight=r,s.scrollTop=0,s.scrollbar={el:void 0,x:s.x+n.visData.global.column.width-i,y:0,width:i,height:l,scrollHeight:n.visData.global.column.height-l,scrollTop:0,heightScale:e.scale.linear().domain([0,r]).range([0,n.visData.global.column.height-l])},s.invertedHeightScale=s.scrollbar.heightScale.invert})}},{key:"updateScrollProperties",value:function(){var t=this;this.groups.each(function(i){var n=i.nodes.getBoundingClientRect().height+2*t.visData.global.row.padding,s=n-t.visData.global.column.height,o=s>0?Math.max(t.visData.global.column.height*t.visData.global.column.height/n,10):0;i.height=n,i.scrollHeight=s,i.scrollTop=0,i.scrollbar.y=0,i.scrollbar.height=o,i.scrollbar.scrollHeight=t.visData.global.column.height-o,i.scrollbar.scrollTop=0,i.scrollbar.heightScale=e.scale.linear().domain([0,s]).range([0,t.visData.global.column.height-o])})}},{key:"updateVisibility",value:function(){this.groups.each(function(){var t=e.select(this);t.classed("hidden",t.selectAll(".node").filter(function(t){return!t.hidden}).empty())})}},{key:"focus",value:function(t){this.vis.highlightActiveLevel&&this.groups.filter(function(e){return e.level===t}).classed("active",!0)}},{key:"blur",value:function(t){this.vis.highlightActiveLevel&&(t?this.groups.filter(function(e){return e.level===t}).classed("active",!1):this.groups.classed("active",!1))}},{key:"className",get:function(){return Et}},{key:"height",get:function(){return this.visData.global.column.height}}]),t}(),Wt="links",It="link",Vt=function(){function t(i,n,s,o){var a=this;ht.classCallCheck(this,t),this.vis=i,this.visData=s,this.layout=o,this.groups=n.append("g").attr("class",Wt).call(function(t){t.each(function(){e.select(this.parentNode).datum().links=this})}),this.links=this.groups.selectAll(It).data(function(t,e){return a.layout.links(e)}).enter().append("g").attr("class",It).classed("visible",!this.vis.hideOutwardsLinks||this.linkVisibility.bind(this)),this.links.append("path").attr({"class":It+"-bg",d:this.diagonal}),this.links.append("path").attr({"class":It+"-direct",d:this.diagonal})}return ht.createClass(t,[{key:"linkVisibility",value:function(t){return t.hidden=this.vis.pointsOutside.call(this.vis,t),0===t.hidden}},{key:"highlight",value:function(t,e,i){this.links.filter(function(e){return t[e.id]}).classed(i,e)}},{key:"scroll",value:function(t,e){t.data(e),this.vis.hideOutwardsLinks&&t.classed("visible",this.linkVisibility.bind(this)),t.selectAll("path").attr("d",this.diagonal)}},{key:"sort",value:function(t){var i=function(){e.select(this).classed("sorting",!0)},n=function(){e.select(this).classed("sorting",!1)};this.links.data(t,function(t){return t.id}),this.links.selectAll("path").transition().duration(At).attr("d",this.diagonal).each("start",i).each("end",n)}},{key:"updateVisibility",value:function(){this.links.selectAll("path").classed("hidden",function(t){return t.target.node.hidden||t.source.node.hidden}).transition().duration(At).attr("d",this.diagonal)}},{key:"diagonal",get:function(){function t(t){return t.node.x+t.offsetX+this.visData.global.column.contentWidth+this.visData.global.column.padding}function e(t){return t.node.x+t.offsetX+this.visData.global.column.padding}function i(t){return t.node.y+t.offsetY+this.visData.global.row.height/2}var n=this,s=this.vis.showLinkLocation?6:0;return function(o){var a=i.call(n,o.source),r=t.call(n,o.source),l=i.call(n,o.target),c=e.call(n,o.target),h=(r+c)/2;return"M"+r+","+a+"h"+s+"C"+(h+s)+","+a+" "+(h-s)+","+l+" "+(c-s)+","+l+"h"+s}}}]),t}(),Qt="[object Function]",zt="[object GeneratorFunction]",jt=Object.prototype,Gt=jt.toString,Ut={"function":!0,object:!0},Yt=Ut[typeof exports]&&exports&&!exports.nodeType?exports:void 0,Jt=Ut[typeof module]&&module&&!module.nodeType?module:void 0,Xt=s(Yt&&Jt&&"object"==typeof global&&global),Zt=s(Ut[typeof self]&&self),$t=s(Ut[typeof window]&&window),Kt=s(Ut[typeof this]&&this),te=Xt||$t!==(Kt&&Kt.window)&&$t||Zt||Kt||Function("return this")(),ee=te.isFinite,ie="bar",ne=function fi(t,e,i,n,s){function o(t){var e=this,i=this.visData.nodes[this.nodeData.depth].sortBy;t.attr("d",function(t){return e.bars.generatePath(t,i)}).classed("bar-magnitude",!0)}function a(t){t.attr("x",0).attr("y",this.visData.global.row.padding).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bar-border",!0)}function r(t){t.attr({"class":"bar-indicator",x:0,y:this.visData.global.row.padding,width:2,height:this.visData.global.row.contentHeight})}var l=this;ht.classCallCheck(this,fi),this.data=e,this.nodeData=i,this.visData=n,this.bars=s,this.data.x=i.x,this.data.level=i.depth,this.height=this.visData.global.row.contentHeight/(2*this.data.length)-2*this.visData.global.cell.padding,this.activeHeight=this.visData.global.row.contentHeight-2,this.inactiveheight=2*this.visData.global.cell.padding-1,this.selection=t.selectAll(ie).data(this.data).enter().append("g").attr("class",function(t){return ie+" "+t.id}).classed("active",function(t){return t.id===l.visData.nodes[l.nodeData.depth].sortBy}),this.selection.append("rect").call(a.bind(this)),this.selection.append("path").call(o.bind(this)),this.selection.append("rect").call(r.bind(this))},se="bars",oe=function(){function t(i,n,s,o){ht.classCallCheck(this,t);var a=this;this.vis=i,this.mode=s,this.visData=o,this.indicatorX=e.scale.linear().domain([0,1]).range([1,this.visData.global.column.contentWidth-3]),this.selection=n.append("g").attr("class",se),this.selection.each(function(t){new ne(e.select(this),t.data.bars,t,a.visData,a)})}return ht.createClass(t,[{key:"updateAll",value:function(t,e){var i=this;this.selection.selectAll(".bar-magnitude").data(t,function(t){return t.barId}).transition().duration(At).attr("d",function(t){return i.generatePath(t,i.mode,e,i.visData)})}},{key:"update",value:function(t,i){var n=this;t.each(function(t){var n=e.select(this);t.id!==i||n.classed("active")||(n.classed("active",!0),this.parentNode.insertBefore(this,this.parentNode.children[0])),t.id!==i&&n.classed("active",!1)}),t.selectAll(".bar-magnitude").transition().duration(At).attr("d",function(t){return n.generatePath(t,i)})}},{key:"updateIndicator",value:function(t,e){t.attr("x",this.indicatorX(e)).attr("width",2)}},{key:"switchMode",value:function(t,e){var i=this;this.mode!==t&&("one"===t&&e.global.type&&this.selection.selectAll(".bar").selectAll(".bar-magnitude").transition().duration(At).attr("d",function(t){return i.generateOneBarPath(t,e.global.type)}),"two"===t&&(this.selection.selectAll(".bar.precision").selectAll(".bar-magnitude").transition().duration(At).attr("d",function(t){
return i.generateTwoBarsPath(t)}),this.selection.selectAll(".bar.recall").selectAll(".bar-magnitude").transition().duration(At).attr("d",function(t){return i.generateTwoBarsPath(t,!0)})),this.mode=t)}},{key:"generatePath",value:function(t,e,i,n,s){return"two"===this.mode?this.generateTwoBarsPath(t,s):this.generateOneBarPath(t,e,i,n)}},{key:"generateOneBarPath",value:function(t,e,i,n){var s=this.visData.global.row.contentHeight,o=Math.min(t.value,1),a=Math.min(i,1),r=0,l=2,c={topLeft:2,bottomLeft:2};return i&&(c={}),t.id!==e&&"undefined"==typeof i?(r=this.indicatorX(o),c={}):i?(r=a*this.visData.global.column.contentWidth,n&&(a>o&&(r=o*this.visData.global.column.contentWidth),l=Math.max(Math.abs(a-o)*this.visData.global.column.contentWidth,2))):l=this.visData.global.column.contentWidth*o,r=Math.min(r,this.visData.global.column.contentWidth-2),v(r,this.visData.global.row.padding,l,s,c)}},{key:"generateTwoBarsPath",value:function(t,e){var i=Math.min(t.value,1),n=this.visData.global.row.contentHeight/2,s=this.visData.global.column.contentWidth*i,o=this.visData.global.row.padding,a={topLeft:2};return e&&(a={bottomLeft:2},o+=n),v(0,o,s,n,a)}}]),t}(),ae="nodes",re="node",le="visible-node",ce="clone",he="label-wrapper",ue="focus-controls",de="root",ve="query",ge="lock",pe="inactive",fe="link-indicator",be="link-location-indicator",ye="incoming",me="outgoing",ke="above",we="below",xe=function(){function t(i,s,o,a,r){function l(t,e){var i="incoming"===e;t.attr("class",fe+" "+(i?ye:me)).attr("d",v(i?-7:this.visData.global.column.contentWidth,this.visData.global.row.height/2-1,7,2,{topLeft:i?1:0,topRight:i?0:1,bottomLeft:i?1:0,bottomRight:i?0:1})).attr("fill",function(t){return p(t.links[e].refs.length)}).classed("visible",function(t){return t.links[e].refs.length>0})}function c(t,e,i){var n="above"===i,s="incoming"===e,o=be+" "+(s?ye:me)+" "+(n?ke:we);t.datum(function(t){return t.links[e]}).attr("class",o).attr("x",s?-5:this.visData.global.column.contentWidth+2).attr("y",n?this.visData.global.row.height/2-1:this.visData.global.row.height/2+1).attr("width",3).attr("height",3).attr("fill",function(t){return p(t.refs.length)})}function h(t,e,i,n){var s=i||0;t.attr("x",s).attr("y",g.visData.global.row.padding+s).attr("width",g.visData.global.column.contentWidth-2*s).attr("height",g.visData.global.row.contentHeight-2*s).attr("rx",n?0:2-s).attr("ry",n?0:2-s).classed(e,!0)}function u(t){t.attr("x",0).attr("y",0).attr("width",g.visData.global.column.contentWidth).attr("height",g.visData.global.row.height).attr("class","invisible-container")}var d=this;ht.classCallCheck(this,t);var g=this;this.vis=i,this.visData=o,this.links=a,this.events=r,this.currentLinks={},this.iconDimension=Math.min(this.visData.global.row.contentHeight/2-2*this.visData.global.cell.padding,this.visData.global.column.padding/2-4);var p=e.scale.linear().domain([1,this.vis.rows]).range(["#ccc","#000"]);this.groups=s.append("g").attr("class",ae).call(function(t){t.each(function(){e.select(this.parentNode).datum().nodes=this})}),this.nodes=this.groups.selectAll("."+re).data(function(t){return t.rows}).enter().append("g").classed(re,!0).classed(ce,function(t){return t.clone}).attr("transform",function(t){return"translate("+(t.x+d.visData.global.column.padding)+", "+t.y+")"}),this.nodes.append("rect").call(u),this.visNodes=this.nodes.append("g").attr("class",le),this.visNodes.append("rect").call(h,"bg-border"),this.visNodes.append("rect").call(h,"bg",1,!0),this.vis.showLinkLocation&&(this.nodes.append("rect").call(c.bind(this),"incoming","above"),this.nodes.append("rect").call(c.bind(this),"incoming","bottom"),this.nodes.append("rect").call(c.bind(this),"outgoing","above"),this.nodes.append("rect").call(c.bind(this),"outgoing","bottom"),this.nodes.append("path").call(l.bind(this),"incoming"),this.nodes.append("path").call(l.bind(this),"outgoing"),this.groups.each(function(t,e){d.calcHeightLinkLocationIndicator(e,!0,!0)}));var f=this.nodes.append("g").attr("class",ue+" "+de+" "+pe);if(f.append("rect").call(this.setUpFocusControls.bind(this),"left",.6,"hover-helper","hover-helper"),f.append("svg").call(this.setUpFocusControls.bind(this),"left",.6,"icon","ease-all state-inactive invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#unlocked"),f.append("svg").call(this.setUpFocusControls.bind(this),"left",.6,"icon","ease-all state-active invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#locked"),this.vis.querying){var b=this.nodes.append("g").attr("class",ue+" "+ve+" "+pe);b.append("rect").call(this.setUpFocusControls.bind(this),"right",.6,"hover-helper","hover-helper"),b.append("svg").call(this.setUpFocusControls.bind(this),"right",.6,"icon","ease-all state-and-or invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#union"),b.append("svg").call(this.setUpFocusControls.bind(this),"right",.6,"icon","ease-all state-not invisible-default icon").append("use").attr("xlink:href",this.vis.iconPath+"#not")}this.bars=new oe(this.vis,this.visNodes,this.vis.barMode,this.visData),this.visNodes.append("rect").call(h,"border"),this.visNodes.append("foreignObject").attr("x",this.visData.global.cell.padding).attr("y",this.visData.global.row.padding+this.visData.global.cell.padding).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight-2*this.visData.global.cell.padding).attr("class",he).append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).style("line-height",this.visData.global.row.contentHeight-2*this.visData.global.cell.padding+"px").append("xhtml:span").text(function(t){return t.data.name}),n(this.events.on)&&(this.events.on("d3ListGraphFocusNodes",function(t){return d.focusNodes(t)}),this.events.on("d3ListGraphBlurNodes",function(t){return d.blurNodes(t)}),this.events.on("d3ListGraphNodeEnter",function(t){return d.eventHelper(t,d.highlightNodes)}),this.events.on("d3ListGraphNodeLeave",function(t){return d.eventHelper(t,d.unhighlightNodes)}),this.events.on("d3ListGraphNodeLock",function(t){return d.eventHelper(t,d.toggleLock,[])}),this.events.on("d3ListGraphNodeUnlock",function(t){return d.eventHelper(t,d.toggleLock,[!0])}),this.events.on("d3ListGraphNodeRoot",function(t){return d.eventHelper(t.nodeIds,d.toggleRoot,[!1,!0])}),this.events.on("d3ListGraphNodeUnroot",function(t){return d.eventHelper(t.nodeIds,d.toggleRoot,[!0,!0])})),this.nodes.call(this.isInvisible.bind(this))}return ht.createClass(t,[{key:"updateLinkLocationIndicators",value:function(t,e){this.calcHeightLinkLocationIndicator(t,!1,!0),this.calcHeightLinkLocationIndicator(e,!0,!1)}},{key:"calcHeightLinkLocationIndicator",value:function(t,e,i){var n=this.nodes.filter(function(e){return e.depth===t});n.each(function(t){if(e){t.links.incoming.above=0,t.links.incoming.below=0;for(var n=t.links.incoming.total;n--;)(1&t.links.incoming.refs[n].hidden)>0&&t.links.incoming.above++,(2&t.links.incoming.refs[n].hidden)>0&&t.links.incoming.below++}if(i){t.links.outgoing.above=0,t.links.outgoing.below=0;for(var n=t.links.outgoing.total;n--;)(4&t.links.outgoing.refs[n].hidden)>0&&t.links.outgoing.above++,(8&t.links.outgoing.refs[n].hidden)>0&&t.links.outgoing.below++}}),e&&this.updateHeightLinkLocationIndicatorBars(n),i&&this.updateHeightLinkLocationIndicatorBars(n,!0)}},{key:"updateHeightLinkLocationIndicatorBars",value:function(t,e){var i=this.visData.global.row.contentHeight/2-1,n=this.visData.global.row.height/2-1,s="."+be+"."+(e?me:ye);t.selectAll(s+"."+ke).attr("y",function(t){return t.total?n-t.above/t.total*i:n}).attr("height",function(t){return t.total?t.above/t.total*i:0}),t.selectAll(s+"."+we).attr("height",function(t){return t.total?t.below/t.total*i:0})}},{key:"enterHandler",value:function(t,i){this.highlightNodes(e.select(t));var n={id:i.id,clone:!1,clonedFromId:void 0};i.clone&&(n.clone=!0,n.clonedFromId=i.originalNode.id),this.events.broadcast("d3ListGraphNodeEnter",n)}},{key:"leaveHandler",value:function(t,i){this.unhighlightNodes(e.select(t));var n={id:i.id,clone:!1,clonedFromId:void 0};i.clone&&(n.clone=!0,n.clonedFromId=i.originalNode.id),this.events.broadcast("d3ListGraphNodeLeave",n)}},{key:"lockHandler",value:function(t){var e=this.toggleLock(t);e.locked&&e.unlocked?this.events.broadcast("d3ListGraphNodeLockChange",{lock:{id:e.locked.id,clone:e.locked.clone,clonedFromId:e.locked.clone?e.locked.originalNode.id:void 0},unlock:{id:e.unlocked.id,clone:e.unlocked.clone,clonedFromId:e.unlocked.clone?e.unlocked.originalNode.id:void 0}}):(e.locked&&this.events.broadcast("d3ListGraphNodeLock",{id:e.locked.id,clone:e.locked.clone,clonedFromId:e.locked.clone?e.locked.originalNode.id:void 0}),e.unlocked&&this.events.broadcast("d3ListGraphNodeUnlock",{id:e.unlocked.id,clone:e.unlocked.clone,clonedFromId:e.unlocked.clone?e.unlocked.originalNode.id:void 0}))}},{key:"rootHandler",value:function(t,e){if(t.datum().data.state.root||!e){var i=this.toggleRoot(t,e);i.rooted&&i.unrooted?this.events.broadcast("d3ListGraphNodeReroot",{rooted:{id:i.rooted.id,clone:i.rooted.clone,clonedFromId:i.rooted.clone?i.rooted.originalNode.id:void 0},unrooted:{id:i.unrooted.id,clone:i.unrooted.clone,clonedFromId:i.unrooted.clone?i.unrooted.originalNode.id:void 0}}):(i.rooted&&this.events.broadcast("d3ListGraphNodeRoot",{id:i.rooted.id,clone:i.rooted.clone,clonedFromId:i.rooted.clone?i.rooted.originalNode.id:void 0}),i.unrooted&&this.events.broadcast("d3ListGraphNodeUnroot",{id:i.unrooted.id,clone:i.unrooted.clone,clonedFromId:i.unrooted.clone?i.unrooted.originalNode.id:void 0}))}}},{key:"focusNodes",value:function(t){var e=this.checkNodeFocusEventSame(t.nodeIds);this.nodeFocusId&&!e&&this.blurNodes({nodeIds:this.nodeFocusId}),this.nodeFocusId=t.nodeIds,this.eventHelper(t.nodeIds,this.highlightNodes,["focus","directParentsOnly",!!t.excludeClones,t.zoomOut||t.hideUnrelatedNodes]),t.zoomOut?this.vis.globalView(this.nodes.filter(function(t){return t.hovering>0})):this.vis.zoomedView(),t.hideUnrelatedNodes?e&&this.tempHidingUnrelatedNodes||this.hideUnrelatedNodes(t.nodeIds):this.tempHidingUnrelatedNodes&&this.showUnrelatedNodes()}},{key:"blurNodes",value:function(t){this.eventHelper(t.nodeIds,this.unhighlightNodes,["focus","directParentsOnly",!!t.excludeClones]),t.zoomIn&&this.vis.zoomedView(),this.tempHidingUnrelatedNodes&&this.showUnrelatedNodes()}},{key:"checkNodeFocusEventSame",value:function(t){if(!this.nodeFocusId)return!1;if(t.length!==this.nodeFocusId.length)return!1;for(var e=t.length;e--;)if(t[e]!==this.nodeFocusId[e])return!1;return!0}},{key:"hideUnrelatedNodes",value:function(t){this.tempHidingUnrelatedNodes=t,this.nodes.filter(function(t){return!t.hovering}).classed("hidden",!0).each(function(t){t._hidden=t.hidden,t.hidden=!0}),this.updateVisibility()}},{key:"showUnrelatedNodes",value:function(){this.tempHidingUnrelatedNodes=void 0,this.nodes.filter(function(t){return!t.hovering}).classed("hidden",function(t){return t._hidden}).each(function(t){t.hidden=t._hidden,t._hidden=void 0}),this.updateVisibility()}},{key:"eventHelper",value:function(t,i,n,s){var o=this;this.nodes.filter(function(e){return!!~t.indexOf(e.id)}).each(function(){var t=e.select(this);s&&(t=t.select(s)),i.apply(o,[t].concat(n||[]))})}},{key:"toggleLock",value:function(t,e){var i=t.datum(),n={locked:!1,unlocked:!1};return this.lockedNode?this.lockedNode.datum().id===i.id?(this.unlockNode(this.lockedNode.datum().id),n.unlocked=this.lockedNode.datum(),this.lockedNode=void 0):(this.unlockNode(this.lockedNode.datum().id),n.unlocked=this.lockedNode.datum(),e||(this.lockNode(i.id),n.locked=i,this.lockedNode=t)):e||(this.lockNode(i.id),n.locked=i,this.lockedNode=t),n}},{key:"lockNode",value:function(t){var i=this,n=this.nodes.filter(function(e){return e.id===t});n.each(function(t){i.highlightNodes(e.select(this),"lock",void 0),t.data.state.lock=!0})}},{key:"unlockNode",value:function(t){var i=this,n=this.nodes.filter(function(e){return e.id===t});n.each(function(t){i.unhighlightNodes(e.select(this),"lock",void 0),t.data.state.lock=void 0})}},{key:"queryByNode",value:function(t,e){t.datum().data.state.query=e,t.classed({active:!0,inactive:!1,"query-and":"and"===e,"query-or":"or"===e,"query-not":"not"===e})}},{key:"unqueryByNode",value:function(t){var e=t.datum();e.data.state.query=void 0,e.data.queryBeforeRooting=void 0,t.classed({active:!1,inactive:!0,"query-and":!1,"query-or":!1,"query-not":!1}),this.rootedNode&&this.updateVisibility()}},{key:"toggleQueryByNode",value:function(t){var e=t.datum(),i=e.data.state.query;if(e.data.state.root)"or"!==i?this.queryByNode(t,"or"):this.queryByNode(t,"and");else switch(i){case"or":this.queryByNode(t,"and");break;case"and":this.queryByNode(t,"not");break;case"not":this.unqueryByNode(t);break;default:this.queryByNode(t,"or")}}},{key:"batchQueryHandler",value:function(t,e){for(var i=[],n=t.length;n--;)i.push(this.queryHandler(t[n].d3El,t[n].action,t[n].mode,!0));e||this.events.broadcast("d3ListGraphBatchQuery",i)}},{key:"queryHandler",value:function(t,e,i,n){var s=t.datum(),o=s.data.state.query,a={};if(o||"unquery"!==e){switch(e){case"query":this.queryByNode(t,i);break;case"unquery":this.unqueryByNode(t);break;default:this.toggleQueryByNode(t)}return s.data.state.query?s.data.state.query!==o&&(a.name="d3ListGraphNodeQuery",a.data={id:s.id,clone:s.clone,clonedFromId:s.clone?s.originalNode.id:void 0,mode:s.data.state.query}):(a.name="d3ListGraphNodeUnquery",a.data={id:s.id,clone:s.clone,clonedFromId:s.clone?s.originalNode.id:void 0}),a.name&&!n&&this.events.broadcast(a.name,a.data),a.name?a:void 0}}},{key:"toggleRoot",value:function(t,e,i){var n=t.datum(),s={rooted:!1,unrooted:!1},o=[];return this.vis.levels.blur(),this.rootedNode?(this.rootedNode.classed({active:!1,inactive:!0}),s.unrooted=this.rootedNode.datum(),this.unrootNode(this.rootedNode).unquery&&o.push({d3El:this.rootedNode,action:"unquery"}),this.rootedNode.datum().id===n.id||e?(this.rootedNode=void 0,this.vis.levels.focus(this.vis.activeLevel-this.vis.noRootActiveLevelDiff)):(t.classed({active:!0,inactive:!1}),this.rootedNode=t,s.rooted=t.datum(),this.rootNode(t).query&&o.push({d3El:t,action:"query",mode:"or"}))):e||(t.classed({active:!0,inactive:!1}),this.rootedNode=t,s.rooted=t.datum(),this.rootNode(t).query&&o.push({d3El:t,action:"query",mode:"or"})),o.length&&this.batchQueryHandler(o,i),s}},{key:"rootNode",value:function(t){var e=t.datum();return e.data.state.root=!0,t.classed("rooted",!0),this.hideNodes(e),this.vis.levels.focus(e.depth+this.vis.activeLevel),e.data.state.query&&"not"!==e.data.state.query?(e.data.queryBeforeRooting=!0,{query:!1}):(e.data.queryBeforeRooting=!1,{query:!0})}},{key:"unrootNode",value:function(t){var e=t.datum();return e.data.state.root=!1,t.classed("rooted",!1),this.showNodes(),e.data.queryBeforeRooting?{unquery:!1}:{unquery:!0}}},{key:"setUpFocusControls",value:function(t,e,i,n,s){var o=this.iconDimension+4,a=0-o*(i+1);"right"===e&&(a=this.visData.global.column.contentWidth+2+o*i);var r=this.visData.global.row.padding+(this.visData.global.row.contentHeight-2*this.visData.global.cell.padding)/4;"bg"===n?t.attr({"class":s,cx:a+this.iconDimension/2,cy:r+this.iconDimension/2,r:3*this.iconDimension/4}):"hover-helper"===n?t.attr({"class":s,x:a-4,y:r-4,width:this.iconDimension+8,height:this.iconDimension+8,rx:this.iconDimension,ry:this.iconDimension}):t.attr({"class":s,x:a,y:r,width:this.iconDimension,height:this.iconDimension})}},{key:"hideNodes",value:function(t){this.nodesVisibility(t)}},{key:"showNodes",value:function(){this.nodesVisibility(void 0,!0)}},{key:"nodesVisibility",value:function(t,e){e?this.nodes.classed("hidden",!1).each(function(t){t.hidden=!1}):(this.nodes.each(function(t){t.hidden=!0}),u(t,function(t){t.hidden=!1}),d(t,function(t){t.hidden=!1}),this.nodes.classed("hidden",function(t){return t.hidden&&!t.data.state.query})),this.updateVisibility()}},{key:"isInvisible",value:function(t,e){var i=this;t.classed("invisible",function(t){var n=e||i.visData.nodes[t.depth].scrollTop;return t.x+i.vis.dragged.x>=i.vis.width?t.invisible=!0:t.y+n>=i.vis.height?t.invisible=!0:t.y+i.visData.global.row.height+n<=0?t.invisible=!0:t.x+i.vis.dragged.x+i.visData.global.column.width<=0?t.invisible=!0:t.invisible=!1})}},{key:"makeAllTempVisible",value:function(t){t?this.nodes.classed("invisible",function(t){var e=t._invisible;return t._invisible=void 0,e}):this.nodes.classed("invisible",function(t){return t._invisible=t.invisible,!1})}},{key:"highlightNodes",value:function(t,e,i,n,s){function o(t,e){return s||!e.hidden&&!g.vis.isHidden.call(g.vis,t)}function a(t){return 1===t.hovering&&o(this,t)}function r(t){return 2===t.hovering&&o(this,t)}function c(t){g.bars.updateIndicator(t,x.value,!0)}function d(t){g.bars.updateIndicator(t,x.value)}var v=this,g=this,p=t.datum(),f=p.id,b=p.clone?p.originalNode:p,y=!0,m=e||"hovering",k=!n,w="directParentsOnly"!==i;this.currentLinks[m]||(this.currentLinks[m]={}),this.currentLinks[m][f]={};var x=t.selectAll(".bar.active .bar-magnitude");x=x.empty()?void 0:x.datum();var D=function(t,e){t.hovering=2;for(var i=t.links.outgoing.refs.length;i--;)t.links.outgoing.refs[i].target.node.id===e.id&&(v.currentLinks[m][f][t.links.outgoing.refs[i].id]=!0)},N=function(t){t.hovering=2;for(var e=t.links.outgoing.refs.length;e--;)v.currentLinks[m][f][t.links.outgoing.refs[e].id]=!0};if(y&&w&&u(p,D,N,void 0,k),y&&!w&&l(p,D,void 0,k),!y&&w&&h(p,D,void 0,k),b.hovering=1,k)for(var S=b.clones.length;S--;)b.clones[S].hovering=1;var C=x?".bar."+x.id+" .bar-indicator":"",L=this.nodes.filter(a).classed(m+"-directly",!0),B=this.nodes.filter(r).classed(m+"-indirectly",!0);x&&(L.select(C).call(c),B.select(C).call(d)),this.links.highlight(this.currentLinks[m][p.id],!0,m)}},{key:"unhighlightNodes",value:function(t,e,i,n){var s=t.datum(),o=function(t){t.hovering=0},a=!0,r=e||"hovering",c=!n,d="directParentsOnly"!==i;if(s.hovering=0,a&&d&&u(s,o,void 0,void 0,c),a&&!d&&l(s,o,void 0,c),!a&&d&&h(s,o,void 0,c),s.clone)s.originalNode.hovering=0;else if(c)for(var v=s.clones.length;v--;)s.clones[v].hovering=0;this.nodes.classed(r+"-directly",!1),this.nodes.classed(r+"-indirectly",!1),this.currentLinks[r]&&this.currentLinks[r][s.id]&&this.links.highlight(this.currentLinks[r][s.id],!1,r)}},{key:"sort",value:function(t,e){for(var i=this,n=t.length;n--;){var s=this.nodes.data(t[n].rows,function(t){return t.id});this.vis.svgD3.classed("sorting",!0),s.transition().duration(At).attr("transform",function(t){return"translate("+(t.x+i.visData.global.column.padding)+", "+t.y+")"}).call(f,function(){i.vis.svgD3.classed("sorting",!1),i.vis.updateLevelsVisibility(),i.vis.updateScrolling()}),e&&"name"!==this.vis.currentSorting.local[t[n].level].type&&this.bars.update(s.selectAll(".bar"),t[n].sortBy)}}},{key:"updateVisibility",value:function(){var t=this;this.vis.layout.updateNodesVisibility(),this.nodes.transition().duration(At).attr("transform",function(e){return"translate("+(e.x+t.visData.global.column.padding)+", "+e.y+")"}).call(f,function(){t.vis.updateLevelsVisibility(),t.vis.updateScrolling(),t.nodes.call(t.isInvisible.bind(t))}),this.vis.links.updateVisibility()}},{key:"classNnodes",get:function(){return ae}},{key:"classNode",get:function(){return re}},{key:"classNodeVisible",get:function(){return le}},{key:"classClone",get:function(){return ce}},{key:"classLabelWrapper",get:function(){return he}},{key:"classFocusControls",get:function(){return ue}},{key:"classRoot",get:function(){return de}},{key:"classQuery",get:function(){return ve}},{key:"classLock",get:function(){return ge}},{key:"barMode",get:function(){return this.bars.mode}}]),t}(),De="scrollbar",Ne=function(){function t(i,n,s){ht.classCallCheck(this,t),this.visData=n,this.width=s,this.all=i.append("rect").attr("class",De).call(function(t){t.each(function(){e.select(this.parentNode).datum().scrollbar.el=this})}).attr("x",function(t){return t.scrollbar.x-2}).attr("y",function(t){return t.scrollbar.y}).attr("width",this.width).attr("height",function(t){return t.scrollbar.height}).attr("rx",this.width/2).attr("ry",this.width/2).classed("ready",!0)}return ht.createClass(t,[{key:"updateVisibility",value:function(){this.all.transition().duration(_t).attr({x:function(t){return t.scrollbar.x},height:function(t){return t.scrollbar.height}})}}]),t}(),Se=Array.isArray,Ce=function(){function t(e,i){if(ht.classCallCheck(this,t),i&&!n(i))throw new gt;this.el=e,this._stack={},this.dispatch=i||this._dispatchEvent}return ht.createClass(t,[{key:"_dispatchEvent",value:function(t,e){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!1,!1,e),this.el.dispatchEvent(i)}},{key:"broadcast",value:function(t,e){this.dispatch(t,e)}},{key:"on",value:function(t,e,i){if(!n(e))return!1;var s=o(i)?parseInt(i,10):1/0;return Se(this.stack[t])?this.stack[t].push({callback:e,times:s})-1:(this.stack[t]=[{callback:e,times:s}],0)}},{key:"off",value:function(t,e){try{return this.stack[t].splice(e,1),!0}catch(i){return!1}}},{key:"trigger",value:function(t,e){if(Se(this.stack[t])){for(var i=this.stack[t].length;i--;)this.stack[t][i].times--?this.stack[t][i].callback(e):this.off(t,i);return!0}return!1}},{key:"stack",get:function(){return this._stack}}]),t}();ut=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var Le,Be,_e,Ae=ut,He=0,Me=function(t,e){Te[He]=t,Te[He+1]=e,He+=2,2===He&&(Be?Be(C):_e())},Re="undefined"!=typeof window?window:void 0,Oe=Re||{},qe=Oe.MutationObserver||Oe.WebKitMutationObserver,Fe="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Ee="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Te=new Array(1e3);_e=Fe?w():qe?D():Ee?N():void 0===Re&&"function"==typeof require?L():S();var Pe=void 0,We=1,Ie=2,Ve=new z,Qe=new z,ze=0;$.all=tt,$.race=Y,$.resolve=_,$.reject=J,$._setScheduler=m,$._setAsap=k,$._asap=Me,$.prototype={constructor:$,then:B,"catch":function(t){return this.then(null,t)}},K.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},K.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===Pe&&t>i;i++)this._eachEntry(e[i],i)},K.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===_){var s=R(t);if(s===B&&t._state!==Pe)this._settledAt(t._state,e,t._result);else if("function"!=typeof s)this._remaining--,this._result[e]=t;else if(i===$){var o=new i(A);E(o,t,s),this._willSettleAt(o,e)}else this._willSettleAt(new i(function(e){e(t)}),e)}else this._willSettleAt(n(t),e)},K.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===Pe&&(this._remaining--,t===Ie?I(n,i):this._result[e]=i),0===this._remaining&&W(n,this._result)},K.prototype._willSettleAt=function(t,e){var i=this;V(t,void 0,function(t){i._settledAt(We,e,t)},function(t){i._settledAt(Ie,e,t)})};var je=0;nt.all=tt,nt.race=Y,nt.resolve=_,nt.reject=J,nt._setScheduler=m,nt._setAsap=k,nt._asap=Me,nt.prototype={constructor:nt,then:B,"catch":function(t){return this.then(null,t)}};var Ge=Date.now,Ue=NaN,Ye=/^\s+|\s+$/g,Je=/^[-+]0x[0-9a-f]+$/i,Xe=/^0b[01]+$/i,Ze=/^0o[0-7]+$/i,$e=parseInt,Ke="Expected a function",ti=Math.max,ei=function(){var t=0;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}}(),ii=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){window.clearTimeout(t)}}(),ni=function(){function t(){var t=void 0;do t=Math.floor(1e9*Math.random());while(t in e);return t}var e={};return{request:window.requestNextAnimationFrame||function(i,n){var s=t();return e[s]=ei(function(){e[s]=ei(function(t){delete e[s],i(t)},n)},n),s},cancel:window.cancelNextAnimationFrame||function(t){e[t]&&(ii(e[t]),delete e[t])}}}(),si=ni.request,oi="context-menu",ai="checkbox",ri=6,li=125,ci=666,hi=500,ui=150,di=700,vi=function(){function t(e,i,n,s,o){ht.classCallCheck(this,t);var a=this;this._x=0,this._y=0,this._yOffset=0,this._scale=0,this.vis=e,this.visData=i,this.baseEl=n,this.events=s,this.numButtonRows=o?2:3,this.height=this.visData.global.row.height*this.numButtonRows,this.toBottom=!1,this.wrapper=this.baseEl.append("g").attr("class",oi),this.updateAppearance(),this.bg=this.wrapper.append("path").attr("class","bgBorder").attr("d",g({x:-1,y:-1,width:this.visData.global.column.width+2,height:this.height+2,radius:ri-2,arrowSize:ri})).style("filter","url(#drop-shadow-context-menu)"),this.dropShadow=this.wrapper.append("path").attr("class","bg").attr("d",g({x:0,y:0,width:this.visData.global.column.width,height:this.height,radius:ri-1,arrowSize:ri})).style("filter","url(#drop-shadow-context-menu)"),this.buttonQuery=this.wrapper.append("g").call(this.createButton.bind(this),{alignRight:!1,classNames:[],distanceFromCenter:1,fullWidth:!0,label:"Query:",labelTwo:"query-mode",bamEffect:!0}).on("click",function(){a.clickQueryHandler.call(a,this)}),this.buttonQueryFill=this.buttonQuery.select(".bg-fill-effect"),this.buttonQueryBamEffect=this.buttonQuery.select(".bg-bam-effect"),this.buttonRoot=this.wrapper.append("g").call(this.createButton.bind(this),{alignRight:!1,classNames:[],distanceFromCenter:0,fullWidth:!1,label:"Root"}).on("click",function(){a.clickRootHandler.call(a,this)}),this.buttonRootFill=this.buttonRoot.select(".bg-fill-effect"),this.checkboxRoot=this.createCheckbox(this.buttonRoot),this.buttonLock=this.wrapper.append("g").call(this.createButton.bind(this),{alignRight:!0,classNames:[],distanceFromCenter:0,fullWidth:!1,label:"Lock",bamEffect:!0}).on("click",function(){a.clickLockHandler.call(a,this)}),this.buttonLockFill=this.buttonLock.select(".bg-fill-effect"),this.buttonLockBamEffect=this.buttonLock.select(".bg-bam-effect"),this.checkboxLock=this.createCheckbox(this.buttonLock),this.buttons=this.wrapper.selectAll(".button"),this.debouncedQueryHandler=ot(this.queryHandler,ci),this.debouncedRootHandler=ot(this.rootHandler,hi)}return ht.createClass(t,[{key:"addLabel",value:function(t,e,i){var n=t.append("foreignObject").attr("x",2*this.visData.global.row.padding).attr("y",this.visData.global.row.padding+this.visData.global.cell.padding).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight-2*this.visData.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").style("line-height",this.visData.global.row.contentHeight-2*this.visData.global.cell.padding+"px");n.append("xhtml:span").attr("class","label").attr("title",e).text(e),i&&n.append("xhtml:span").attr("class","label-two "+i)}},{key:"checkLock",value:function(){var t=this.node.datum().data.state.lock;return this.buttonLock.classed("semi-active",t),this.checkboxLock.style("transform","translateX("+(t?this.checkBoxMovement:0)+"px)"),t?this.fillButton(this.buttonLockFill):this.emptyButton(this.buttonLockFill),t}},{key:"checkOrientation",value:function(){this._y+this._yOffset>=0?this.toBottom=!1:this.toBottom=!0,this.buttons.call(this.positionButton.bind(this)),this.bg.classed("is-mirrored-horizontally",this.toBottom),this.dropShadow.classed("is-mirrored-horizontally",this.toBottom)}},{key:"checkRoot",value:function(t,e){var i=this.node.datum().data.state.root,n=i;t&&("undefined"==typeof this.currentRootState&&(this.currentRootState=!!i),"undefined"==typeof this.tempRoot&&(this.tempRoot=this.currentRootState),this.tempRoot=!this.tempRoot,n=this.tempRoot),i?t?n?this.showFillButton(this.buttonRootFill):this.emptyButton(this.buttonRootFill,e):this.fillButton(this.buttonRootFill,e):t?n?this.fillButton(this.buttonRootFill,e):this.hideFillButton(this.buttonRootFill):this.emptyButton(this.buttonRootFill,e),this.buttonRoot.classed("semi-active",n),this.checkboxRoot.style("transform","translateX("+(n?this.checkBoxMovement:0)+"px)")}},{key:"clickLockHandler",value:function(){var t=this;this.buttonLock.classed("fill-effect",!0),this.vis.nodes.lockHandler(this.node);var e=this.checkLock();e?this.buttonLock.classed("active",!0):this.buttonLock.classed("active",!1),setTimeout(function(){e&&t.triggerButtonBamEffect(t.buttonLockBamEffect),t.buttonLock.classed("fill-effect",!1)},ui)}},{key:"clickQueryHandler",value:function(){this.buttonQuery.classed("fill-effect",!0),this.updateQuery(!0,ci),this.vis.disableDebouncedContextMenu?this.queryHandler():this.debouncedQueryHandler(!0)}},{key:"clickRootHandler",value:function(){this.buttonRoot.classed("fill-effect",!0),this.checkRoot(!0,hi),this.vis.disableDebouncedContextMenu?this.rootHandler():this.debouncedRootHandler(!0)}},{key:"close",value:function(){var t=this;return this.closing||(this.closing=new nt(function(e){t.opened=!1,t.updateAppearance(),setTimeout(function(){t.visible=!1,t.updateAppearance(),e(t.node.datum().id),t.node=void 0},li)})),this.closing}},{key:"createButton",value:function(t,e){var i="button";e.classNames&&e.classNames.length&&(i+=" "+e.classNames.join(" ")),t.attr("class",i),t.datum(e).call(this.createButtonBg.bind(this),{bamEffect:e.bamEffect,fullWidth:e.fullWidth}).call(this.addLabel.bind(this),e.label,e.labelTwo).call(this.positionButton.bind(this),e.distanceFromCenter,e.alignRight)}},{key:"createButtonBg",value:function(t,e){var i=this;t.datum(function(t){return t.x=i.visData.global.row.padding,t.y=i.visData.global.row.padding,t.width=i.visData.global.column.width*(e.fullWidth?1:.5)-2*i.visData.global.row.padding,t.height=i.visData.global.row.contentHeight,t.rx=2,t.ry=2,t}).append("rect").attr("class","bg").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("rx",function(t){return t.rx}).attr("ry",function(t){return t.ry}),t.append("rect").attr("class","bg-fill-effect").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",0).attr("rx",function(t){return t.rx}).attr("ry",function(t){return t.ry}),e.bamEffect&&t.append("rect").attr("class","bg-bam-effect").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("rx",function(t){return t.rx}).attr("ry",function(t){return t.ry})}},{key:"createCheckbox",value:function(t){var e=Math.round(t.datum().height/2),i=-1.75*e+this.visData.global.row.padding,n=t.append("g").attr("class",ai);return n.append("rect").attr("class","checkbox-bg").attr("x",function(t){return t.width+i}).attr("y",e/2+this.visData.global.row.padding).attr("width",1.5*e).attr("height",e).attr("rx",e/2).attr("ry",e/2),this.checkBoxMovement=(e-2)/2,n.append("rect").attr("class","checkbox-knob").attr("x",function(t){return t.width+i+1}).attr("y",e/2+this.visData.global.row.padding+1).attr("width",e-2).attr("height",e-2).attr("rx",e-2)}},{key:"emptyButton",value:function(t,e){t.transition().duration(0).attr("y",function(t){return t.y}).attr("height",function(t){return t.height}).call(f,function(){t.transition().duration(e||ui).ease("linear").attr("y",function(t){return t.height}).attr("height",0)})}},{key:"fillButton",value:function(t,e){t.transition().duration(0).attr("y",function(t){return t.y}).attr("height",0).call(f,function(){t.transition().duration(e||ui).ease("linear").attr("height",function(t){return t.height})})}},{key:"hideFillButton",value:function(t){t.transition().duration(0).attr("height",0)}},{key:"open",value:function(t){var e=this;return new nt(function(i){e.node=t,e.closing=void 0,e.updateStates(),e._yOffset=e.visData.nodes[e.node.datum().depth].scrollTop,e.translate={
x:e.node.datum().x,y:e.node.datum().y-e.height},e.checkOrientation(),e.updateAppearance(),e.opened=!0,e.visible=!0,si(function(){e.updateAppearance(),setTimeout(function(){i(!0)},li)})})}},{key:"positionButton",value:function(t,e,i){var n=this;t.datum(function(t){return e&&(t.distanceFromCenter=e),i&&(t.alignRight=i),t}).attr("transform",function(t){var e=t.alignRight?n.visData.global.column.width/2:0,i=n.visData.global.row.height*(n.toBottom?t.distanceFromCenter:n.numButtonRows-t.distanceFromCenter-1)+(n.toBottom?ri:0);return"translate("+e+", "+i+")"})}},{key:"queryHandler",value:function(t){t?this.tempQueryMode!==this.currentQueryMode&&(this.tempQueryMode?(this.vis.nodes.queryHandler(this.node,"query",this.tempQueryMode),this.triggerButtonBamEffect(this.buttonQueryBamEffect),this.buttonQuery.classed("active",!0)):(this.vis.nodes.queryHandler(this.node,"unquery"),this.buttonQuery.classed("active",!1))):this.vis.nodes.queryHandler(this.node),this.tempQueryMode=void 0,this.currentQueryMode=void 0,this.buttonQuery.classed("fill-effect",!1)}},{key:"rootHandler",value:function(t){t&&this.tempRoot===this.currentRootState||(this.close(),this.vis.nodes.rootHandler(this.node)),this.tempRoot=void 0,this.currentRootState=void 0,this.buttonRoot.classed("fill-effect",!1),this.buttonRoot.classed("active",this.node.datum().data.state.root)}},{key:"scrollY",value:function(t){this._yOffset=t,this.updateAppearance()}},{key:"showFillButton",value:function(t){t.transition().duration(0).attr("y",function(t){return t.y}).attr("height",function(t){return t.height})}},{key:"toggle",value:function(t){var e=this;return new nt(function(i){var n=t.datum().id,s=nt.resolve();e.visible&&(s=e.close()),s.then(function(s){n!==s?e.open(t).then(function(){i(n)}):i(n)})})}},{key:"triggerButtonBamEffect",value:function(t){t.classed("active",!0),setTimeout(function(){t.classed("active",!1)},di)}},{key:"updateAppearance",value:function(){var t=this.toBottom?0:this.height+this.visData.global.row.height;this.wrapper.classed("transitionable",this.visible).classed("open",this.opened).style("transform",this.translate+" "+this.scale).style("transform-origin",this.visData.global.column.width/2+"px "+t+"px")}},{key:"updatePosition",value:function(){this.node&&this.opened&&this.open(this.node)}},{key:"updateQuery",value:function(t,e){function i(t){switch(t){case"or":return"and";case"and":return"not";case"not":return null;default:return"or"}}var n=this.node.datum().data.state.query,s=n;t&&("undefined"==typeof this.currentQueryMode&&(this.currentQueryMode=n),"undefined"==typeof this.tempQueryMode&&(this.tempQueryMode=this.currentQueryMode),this.tempQueryMode=i(this.tempQueryMode),s=this.tempQueryMode),t?s?s===n?this.showFillButton(this.buttonQueryFill):this.fillButton(this.buttonQueryFill,e):n?this.emptyButton(this.buttonQueryFill,e):this.hideFillButton(this.buttonQueryFill):this.emptyButton(this.buttonQueryFill,e),this.buttonQuery.classed("semi-active",!!s).classed("active",!!n).select(".query-mode").text(s||"not queried").classed("inactive",!s)}},{key:"updateStates",value:function(){this.node&&(this.checkLock(),this.checkRoot(),this.updateQuery())}},{key:"scale",get:function(){return"scale("+(this.opened?1:.5)+")"}},{key:"translate",get:function(){var t=this.toBottom?this._y+this.height+this.visData.global.row.height-ri:this._y;return"translate("+this._x+"px,"+(t+this._yOffset)+"px)"},set:function(t){this._x=t.x,this._y=t.y}}]),t}(),gi=function(t){function e(t){return ht.classCallCheck(this,e),ht.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"The limits are wrongly formatted. Please provide an object of the following format: `{ x: { min: 0, max: 1 }, y: { min: 0, max: 1 } }`"))}return ht.inherits(e,t),e}(dt),pi=function(){function i(n){var s=this;if(ht.classCallCheck(this,i),!e.layout.listGraph)throw new vt;var o=this;this.baseEl=n.element,this.baseEl.__d3ListGraphBase__=!0,this.baseElD3=e.select(this.baseEl),this.baseElJq=t(this.baseEl),this.svgD3=this.baseElD3.select("svg.base"),this.svgEl=this.svgD3.node(),this.outsideClickHandler={},this.outsideClickClassHandler={},this.svgD3.empty()?(this.svgD3=this.baseElD3.append("svg").attr("class","base"),this.svgJq=t(this.svgD3.node())):this.svgJq=t(this.svgD3.node()),this.rootNodes=n.rootNodes,this.width=ct(n.width,this.svgJq.width(),!0),this.height=ct(n.height,this.svgJq.height(),!0),this.svgD3.on("mouseenter",this.getBoundingRect.bind(this)),this.scrollbarWidth=ct(n.scrollbarWidth,ft,!0),this.columns=ct(n.columns,bt,!0),this.rows=ct(n.rows,yt,!0),this.iconPath=ct(n.iconPath,mt,!0),this.querying=ct(n.querying,St),this.hideOutwardsLinks=ct(n.hideOutwardsLinks,Ct),this.showLinkLocation=ct(n.showLinkLocation,Lt),this.linkLocationBucketSize=n.linkLocationBucketSize,this.highlightActiveLevel=ct(n.highlightActiveLevel,xt),this.activeLevel=ct(n.activeLevel,Dt),this.noRootActiveLevelDiff=ct(n.noRootActiveLevelDiff,Nt),this.lessTransitionsJs=n.lessTransitions>0,this.lessTransitionsCss=n.lessTransitions>1,this.disableDebouncedContextMenu=ct(n.disableDebouncedContextMenu,Bt),this.baseElD3.classed("less-animations",this.lessTransitionsCss),this.sortBy=n.sortBy,this.sortOrder="asc"===n.sortOrder?1:kt,this.events=new Ce(this.baseEl,n.dispatcher),this.baseElJq.addClass(pt),this.dragged={x:0,y:0},n.forceWidth&&this.baseElJq.width(this.width),this.layout=new e.layout.listGraph([this.width,this.height],[this.columns,this.rows]),this.data=n.data,this.visData=this.layout.process(this.data,this.rootNodes,{showLinkLocation:this.showLinkLocation,linkLocationBucketSize:this.linkLocationBucketSize,sortBy:this.sortBy,sortOrder:this.sortOrder}),this.currentSorting={global:{type:this.sortBy,order:this.sortOrder},local:{}},this.barMode=n.barMode||wt,this.svgD3.classed(this.barMode+"-bar",!0),this.topbar=new Ft(this,this.baseElD3,this.visData),this.svgD3.attr("viewBox","0 0 "+this.width+" "+this.height),this.container=this.svgD3.append("g").attr("class","main-container"),this.levels=new Pt(this.container,this,this.visData),this.links=new Vt(this,this.levels.groups,this.visData,this.layout),this.nodes=new xe(this,this.levels.groups,this.visData,this.links,this.events),this.levels.scrollPreparation(this,this.scrollbarWidth),this.scrollbars=new Ne(this.levels.groups,this.visData,this.scrollbarWidth),this.nodeContextMenu=new vi(this,this.visData,this.container,this.events,this.querying),lt(this.svgD3,"context-menu",1,1,2,.2),this.svgJq.on("mousewheel","."+this.levels.className,function(t){o.zoomedOut||o.mousewheelColumn(this,t)}),this.svgJq.on("click",function(t){o.checkGlobalClick.call(o,t.target)}),this.querying&&this.svgJq.on("click","."+this.nodes.classNodeVisible,function(){si(function(){o.registerOutSideClickHandler("nodeContextMenu",[o.nodeContextMenu.wrapper.node()],["visible-node"],function(){o.nodeContextMenu.close(),o.unregisterOutSideClickHandler.call(o,"nodeContextMenu")})}),o.nodeContextMenu.toggle.call(o.nodeContextMenu,e.select(this.parentNode))}),this.svgJq.on("click","."+this.nodes.classFocusControls+"."+this.nodes.classRoot,function(){o.nodes.rootHandler.call(o.nodes,e.select(this),!0)}),this.querying&&this.svgJq.on("click","."+this.nodes.classFocusControls+"."+this.nodes.classQuery,function(){o.nodes.queryHandler.call(o.nodes,e.select(this.parentNode),"unquery"),o.nodeContextMenu.updateStates()}),this.svgJq.on("click","."+this.nodes.classFocusControls+"."+this.nodes.classLock,function(){o.nodes.lockHandler.call(o.nodes,this,e.select(this).datum())}),this.svgJq.on("mouseenter","."+this.nodes.classNodeVisible,function(){o.interactionWrapper.call(o,function(t,e){this.vis.activeScrollbar||this.enterHandler.call(this,t,e)}.bind(o.nodes),[this,e.select(this).datum()])}),this.svgJq.on("mouseleave","."+this.nodes.classNodeVisible,function(){o.interactionWrapper.call(o,function(t,e){this.vis.activeScrollbar||this.leaveHandler.call(this,t,e)}.bind(o.nodes),[this,e.select(this).datum()])}),this.scrollbars.all.on("mousedown",function(){o.scrollbarMouseDown(this,e.event)}),e.select(document).on("mouseup",function(){s.globalMouseUp(e.event)}).on("mousemove",function(){s.globalMouseMove(e.event)}),this.svgD3.call(at,this.dragStartHandler.bind(this),this.dragMoveHandler.bind(this),this.dragEndHandler.bind(this),[this.container,this.topbar.localControlWrapper],"horizontal",this.getDragLimits.bind(this),[this.scrollbarDragging.bind(this)],this.dragged),this.events.on("d3ListGraphLevelFocus",function(t){return s.levels.focus(t)}),this.events.on("d3ListGraphNodeRoot",function(){s.nodes.bars.updateAll(s.layout.updateBars(s.data),s.currentSorting.global.type),s.updateSorting()}),this.events.on("d3ListGraphNodeUnroot",function(){s.nodes.bars.updateAll(s.layout.updateBars(s.data),s.currentSorting.global.type),s.updateSorting()}),this.events.on("d3ListGraphUpdateBars",function(){s.nodes.bars.updateAll(s.layout.updateBars(s.data),s.currentSorting.global.type),s.updateSorting()}),this.events.on("d3ListGraphActiveLevel",function(t){var e=s.activeLevel;if(s.activeLevel=Math.max(t,0),s.nodes.rootedNode){var i=s.nodes.rootedNode.datum().depth;s.levels.blur(i+e),s.levels.focus(i+s.activeLevel)}else s.levels.blur(e-s.noRootActiveLevelDiff),s.levels.focus(s.activeLevel-s.noRootActiveLevelDiff)}),this.getBoundingRect()}return ht.createClass(i,[{key:"dragMoveHandler",value:function(t,e,i,n,s){rt(t,e,i,n,s),this.checkNodeVisibility()}},{key:"checkNodeVisibility",value:function(t,e){var i=t?this.nodes.nodes.filter(function(e){return e.depth===t}):this.nodes.nodes;i.call(this.nodes.isInvisible.bind(this.nodes),e)}},{key:"registerOutSideClickHandler",value:function(t,e,i,n){for(var s=e.length;s--;)e[s].__id__?e[s].__id__.push(t):e[s].__id__=[t];for(var o=this.outsideClickHandler[t]={id:t,els:e,elClassNames:i,callback:n},s=i.length;s--;)this.outsideClickClassHandler[i[s]]=this.outsideClickHandler[t];return o}},{key:"unregisterOutSideClickHandler",value:function(t){for(var e=this.outsideClickHandler[t],i=e.els.length;i--;)e.els[i].__id__=void 0,delete e.els[i].__id__;this.outsideClickHandler[t]=void 0,delete this.outsideClickHandler[t]}},{key:"checkGlobalClick",value:function(t){var e={},i=Object.keys(this.outsideClickClassHandler).length,n=t;try{for(;!n.__d3ListGraphBase__;){if(n.__id__)for(var s=n.__id__.length;s--;)e[n.__id__[s]]=!0;if(i)for(var o=Object.keys(this.outsideClickClassHandler),s=o.length;s--;){var a=n.getAttribute("class");a&&a.indexOf(o[s])>=0&&(e[this.outsideClickClassHandler[o[s]].id]=!0)}n=n.parentNode}}catch(r){return}for(var l=Object.keys(this.outsideClickHandler),s=l.length;s--;)e[l[s]]||this.outsideClickHandler[l[s]].callback.call(this)}},{key:"getDragLimits",value:function(){return{x:{min:this.dragMinX,max:0}}}},{key:"getBoundingRect",value:function(){this.left=this.svgEl.getBoundingClientRect().left,this.top=this.svgEl.getBoundingClientRect().top}},{key:"interactionWrapper",value:function(t,e){this.noInteractions||t.apply(this,e)}},{key:"dragStartHandler",value:function(){this.dragging||(this.noInteractions=this.dragging=!0)}},{key:"dragEndHandler",value:function(){this.dragging&&(this.noInteractions=this.dragging=!1)}},{key:"scrollbarDragging",value:function(){return!!this.activeScrollbar}},{key:"globalMouseUp",value:function(t){if(this.noInteractions=!1,this.activeScrollbar){var e=this.activeScrollbar.datum(),i=e.scrollbar.clientY-t.clientY;e.scrollbar.scrollTop=Math.min(Math.max(e.scrollbar.scrollTop-i,0),e.scrollbar.scrollHeight),e.scrollTop=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(i),0),-e.scrollHeight),this.activeScrollbar.classed("active",!1),this.activeScrollbar=void 0}}},{key:"globalMouseMove",value:function(t){if(this.activeScrollbar){t.preventDefault();var e=this.activeScrollbar.datum(),n=e.scrollbar.clientY-t.clientY;i.scrollElVertically(this.activeScrollbar.node(),Math.min(Math.max(e.scrollbar.scrollTop-n,0),e.scrollbar.scrollHeight));var s=Math.max(Math.min(e.scrollTop+e.invertedHeightScale(n),0),-e.scrollHeight);this.checkNodeVisibility(e.level,s),i.scrollElVertically(e.nodes,s),e.level!==this.visData.nodes.length&&this.links.scroll(e.linkSelections.outgoing,this.layout.offsetLinks(e.level,s,"source")),e.level>0&&this.links.scroll(e.linkSelections.incoming,this.layout.offsetLinks(e.level-1,s,"target")),this.showLinkLocation&&this.nodes.updateLinkLocationIndicators(e.level-1,e.level+1),this.nodeContextMenu.opened&&this.nodeContextMenu.scrollY(s)}}},{key:"scrollbarMouseDown",value:function(t,i){this.noInteractions=!0,this.activeScrollbar=e.select(t).classed("active",!0),this.activeScrollbar.datum().scrollbar.clientY=i.clientY}},{key:"mousewheelColumn",value:function(t,i){i.preventDefault();var n=e.select(t).datum();this.checkNodeVisibility(n.level),n.scrollHeight>0&&(n.scrollTop=Math.max(Math.min(n.scrollTop+i.deltaY,0),-n.scrollHeight),this.scrollY(n))}},{key:"scrollY",value:function(t,e){i.scrollElVertically(t.nodes,t.scrollTop),t.scrollbar.scrollTop=t.scrollbar.heightScale(-t.scrollTop),i.scrollElVertically(t.scrollbar.el,t.scrollbar.scrollTop),t.level!==this.visData.nodes.length&&this.links.scroll(t.linkSelections.outgoing,this.layout.offsetLinks(t.level,t.scrollTop,"source")),t.level>0&&this.links.scroll(t.linkSelections.incoming,this.layout.offsetLinks(t.level-1,t.scrollTop,"target")),this.showLinkLocation&&this.nodes.updateLinkLocationIndicators(t.level-1,t.level+1),this.nodeContextMenu.opened&&this.nodeContextMenu.scrollY(t.scrollTop)}},{key:"scrollYTo",value:function(t,i){var n=this;return t.transition().duration(At).tween("scrollY",function(t){var s=e.interpolateNumber(t.scrollTop,i);return function(e){t.scrollTop=s(e),n.scrollY(t)}})}},{key:"resetAllScrollPositions",value:function(){return this.scrollYTo(this.levels.groups,0)}},{key:"selectByLevel",value:function(t,i){return e.select(this.levels.groups[0][t]).selectAll(i)}},{key:"updateSorting",value:function(){for(var t=Object.keys(this.currentSorting.local),e=t.length;e--;)this.sortColumn(e,this.currentSorting.local[t[e]].type,this.currentSorting.local[t[e]].order,this.currentSorting.local[t[e]].type)}},{key:"sortColumn",value:function(t,e,i,n){this.nodes.sort(this.layout.sort(t,e,i).updateNodesVisibility().nodes(t),n),this.links.sort(this.layout.links(t-1,t+1)),this.nodeContextMenu.updatePosition(),this.checkNodeVisibility()}},{key:"sortAllColumns",value:function(t,e){this.currentSorting.global.order=-1!==this.currentSorting.global.order||e?-1:1,this.nodes.sort(this.layout.sort(void 0,t,this.currentSorting.global.order).updateNodesVisibility().nodes(),e),this.links.sort(this.layout.links()),this.nodeContextMenu.updatePosition(),this.checkNodeVisibility()}},{key:"switchBarMode",value:function(t){this.svgD3.classed("one-bar","one"===t),this.svgD3.classed("two-bar","two"===t),this.nodes.bars.switchMode(t,this.currentSorting)}},{key:"trigger",value:function(t,e){this.events.trigger(t,e)}},{key:"updateScrolling",value:function(){var t=this;this.resetAllScrollPositions().call(f,function(){t.levels.updateScrollProperties(),t.scrollbars.updateVisibility()})}},{key:"updateLevelsVisibility",value:function(){this.levels.updateVisibility()}},{key:"globalView",value:function(t){var e=this;this.zoomedOut||!function(){var i=0,n=0,s=0,o=0,a=void 0,r=e.container.node().getBBox(),l=e.svgD3.node().getBoundingClientRect();t&&!t.empty()?(t.each(function(){a=this.getBoundingClientRect(),s=Math.max(s,a.left-l.left+a.width),o=Math.max(o,a.top-l.top+a.height)}),s=e.width>s?e.width:s,o=e.height>o?e.height:o):(s=e.width>r.width?e.width:r.width,o=e.height>r.height?e.height:r.height),i=r.x+e.dragged.x,n=r.y,e.nodes.makeAllTempVisible(),e.svgD3.classed("zoomedOut",!0).transition().duration(At).attr("viewBox",i+" "+n+" "+s+" "+o)}()}},{key:"zoomedView",value:function(){this.zoomedOut||(this.nodes.makeAllTempVisible(!0),this.svgD3.classed("zoomedOut",!1).transition().duration(At).attr("viewBox","0 0 "+this.width+" "+this.height))}},{key:"toggleView",value:function(){this.zoomedOut?(this.zoomedOut=!1,this.zoomedView()):(this.globalView(),this.zoomedOut=!0)}},{key:"isHidden",value:function(t){var e=t.getBoundingClientRect();return e.top+e.height<=this.top||e.left+e.width<=this.left||e.top>=this.top+this.height||e.left>=this.left+this.width}},{key:"pointsOutside",value:function(t){var e=this.linkPointsOutside(t.source),i=this.linkPointsOutside(t.target)<<2;return e|i}},{key:"linkPointsOutside",value:function(t){var e=t.node.y+t.offsetY;return e+this.visData.global.row.height<=0?1:e>=this.height?2:0}},{key:"area",get:function(){return this.container.node().getBoundingClientRect()}},{key:"dragMinX",get:function(){return Math.min(0,this.width-this.area.width)}},{key:"barMode",get:function(){return this.bars?this.nodes.bars.mode:this._barMode},set:function(t){this.bars&&(this.nodes.bars.mode=t),this._barMode=t}}],[{key:"scrollElVertically",value:function(t,i){e.select(t).attr("transform","translate(0, "+i+")")}}]),i}();return pi}($,d3);
//# sourceMappingURL=listGraph.min.js.map
