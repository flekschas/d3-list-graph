/* Copyright Fritz Lekschas: D3 example visualization app using list-based graphs */
var ListGraph=function(t,s){"use strict";function e(t){var s=typeof t;return!!t&&("object"==s||"function"==s)}function a(t,s){for(;t.parent;)t=t.parent,s(t)}function l(t,s){for(var e=t.childRefs.length;e--;)s(t.childRefs[e]),l(t.childRefs[e],s)}function i(t,s){a(t,s),l(t,s)}var n={};n.classCallCheck=function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")},n.createClass=function(){function t(t,s){for(var e=0;e<s.length;e++){var a=s[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(s,e,a){return e&&t(s.prototype,e),a&&t(s,a),s}}(),n.inherits=function(t,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function, not "+typeof s);t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(t,s):t.__proto__=s)},n.possibleConstructorReturn=function(t,s){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||"object"!=typeof s&&"function"!=typeof s?t:s};var o="scrollbar",r=function A(t,e,a){var l=this;n.classCallCheck(this,A),this.visData=e,this.width=a,this.selection=t.append("rect").attr("class",o).call(function(t){t.each(function(t,e){s.select(this.parentNode).datum().scrollbar.el=this})}).attr("x",function(t){return t.scrollbar.x}).attr("y",function(t){return t.scrollbar.y}).attr("width",function(t){return l.width}).attr("height",function(t){return t.scrollbar.height}).attr("rx",this.width/2).attr("ry",this.width/2).classed("ready",!0)},c="bar",h=function L(t,s,e,a){function l(t,s,e){t.attr("x",i.nodeData.x+i.visData.global.column.padding+i.visData.global.cell.padding).attr("y",function(t,s){return i.nodeData.y+i.visData.global.row.padding+i.visData.global.row.contentHeight/2+i.height*s+i.visData.global.cell.padding*(1+2*s)}).attr("width",function(t){return(e?t.value:1)*(i.visData.global.column.contentWidth-2*i.visData.global.cell.padding)}).attr("height",i.height).classed(s,!0)}n.classCallCheck(this,L);var i=this;this.data=s,this.nodeData=e,this.visData=a,this.height=this.visData.global.row.contentHeight/(2*this.nodeData.data.bars.length)-2*this.visData.global.cell.padding,this.selection=t.selectAll(c).data(this.data).enter().append("g").attr("class",function(t){return c+" "+t.id}),this.selection.append("rect").call(l,"bar-border"),this.selection.append("rect").call(l,"bar-magnitude",!0)},u="bars",d=function G(t,e){n.classCallCheck(this,G);var a=this;this.visData=e,t.append("g").attr("class",u).call(function(t){t.each(function(t){new h(s.select(this),t.data.bars,t,a.visData)})})},g="nodes",v="node",p="clone",f=function(){function t(e,a){var l=this;n.classCallCheck(this,t);var i=this;this.visData=a,this.groups=e.append("g").attr("class",g).call(function(t){t.each(function(t,e){s.select(this.parentNode).datum().nodes=this})}),this.nodes=this.groups.selectAll("."+v).data(function(t){return t.rows}).enter().append("g").classed(v,!0).classed(p,function(t){return t.clone}),this.nodes.append("rect").attr("x",function(t){return t.x+l.visData.global.column.padding}).attr("y",function(t){return t.y+l.visData.global.row.padding}).attr("width",this.visData.global.column.contentWidth).attr("height",this.visData.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bg",!0),this.nodes.on("mouseenter",function(t){i.mouseEnter(this,t)}),this.nodes.on("mouseleave",function(t){i.mouseLeave(this,t)}),this.nodes.call(function(t){t.append("foreignObject").attr("x",function(t){return t.x+l.visData.global.column.padding+l.visData.global.cell.padding}).attr("y",function(t){return t.y+l.visData.global.row.padding+l.visData.global.cell.padding}).attr("width",l.visData.global.column.contentWidth).attr("height",l.visData.global.row.contentHeight/2-2*l.visData.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).append("xhtml:span").text(function(t){return t.data.name})}),this.bars=new d(this.nodes,this.visData)}return n.createClass(t,[{key:"mouseEnter",value:function(t,e){e.hovering=1,i(e,function(t){return t.hovering=2}),s.select(t).classed("hovering-directly",!0),this.nodes.classed("hovering-indirectly",function(t){return 2===t.hovering})}},{key:"mouseLeave",value:function(t,e){e.hovering=0,i(e,function(t){return t.hovering=0}),s.select(t).classed("hovering-directly",!1),this.nodes.classed("hovering-indirectly",!1)}}]),t}(),b="links",m="link",y=function(){function t(e,a,l){var i=this;n.classCallCheck(this,t),this.visData=a,this.layout=l,this.groups=e.append("g").attr("class",b).call(function(t){t.each(function(t,e){s.select(this.parentNode).datum().links=this})}),this.links=this.groups.selectAll(m).data(function(t,s){return i.layout.links(s)}).enter().append("path").attr("class","link").attr("d",this.diagonal)}return n.createClass(t,[{key:"scroll",value:function(t,s){t.data(s).attr("d",this.diagonal).exit().remove()}},{key:"diagonal",get:function(){var t=this;return s.svg.diagonal().source(function(s){return{x:s.source.y+s.source.offsetY+t.visData.global.row.height/2,y:s.source.x+s.source.offsetX+t.visData.global.column.contentWidth+t.visData.global.column.padding}}).target(function(s){return{x:s.target.y+s.target.offsetY+t.visData.global.row.height/2,y:s.target.x+s.target.offsetX+t.visData.global.column.padding}}).projection(function(t){return[t.y,t.x]})}}]),t}(),D="column",w="scroll-container",k=function(){function t(s,e){var a=this;n.classCallCheck(this,t),this.visData=e,this.groups=s.selectAll("g").data(this.visData.nodes).enter().append("g").attr("class",D),this.groups.append("rect").attr("class",w).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return a.visData.global.column.width}).attr("height",function(t){return a.visData.global.column.height})}return n.createClass(t,[{key:"scrollPreparation",value:function(t,e){var a=this;this.groups.each(function(l,i){var n=l.nodes.getBoundingClientRect().height+2*a.visData.global.row.padding,o=n-a.visData.global.column.height,r=o>0?Math.max(a.visData.global.column.height*a.visData.global.column.height/n,10):0;l.height=n,l.linkSelections={incoming:i>0?t.selectByColumn(i-1,".link"):null,outgoing:t.selectByColumn(i,".link")},l.scrollHeight=o,l.scrollTop=0,l.scrollbar={el:void 0,x:l.x+a.visData.global.column.width-e,y:0,width:e,height:r,scrollHeight:a.visData.global.column.height-r,scrollTop:0,heightScale:s.scale.linear().domain([0,o]).range([0,a.visData.global.column.height-r])},l.invertedHeightScale=l.scrollbar.heightScale.invert})}},{key:"height",get:function(){return this.visData.global.column.height}}]),t}(),x="list-graph",C=800,S=200,T=6,M=5,W=5,H=250,Y="div",N="topbar",O="ul",j="controls",E=function(){function t(e,a,l){n.classCallCheck(this,t);var i=this;this.vis=e,this.visData=l,this.el=a.append(Y).attr("class",N),this.controls=this.el.selectAll(j).data(l.nodes).enter().append(O).classed(j,!0).style("width",this.visData.global.column.width+"px"),this.controls.append("li").attr("class","toggle").style("width",this.visData.global.column.padding+"px").on("click",this.toggleColumn),this.controls.append("li").attr("class","sort-precision ease-all").style({width:this.visData.global.column.contentWidth/2+"px",left:this.visData.global.column.padding+"px"}).on("click",function(){i.sortColumn(this,"precision")}).on("mouseenter",function(){i.highlightBars(this.parentNode,"precision"),s.select(this).style("width",i.visData.global.column.contentWidth-16+"px")}).on("mouseleave",function(){i.highlightBars(this.parentNode,"precision",!0),s.select(this).style("width",i.visData.global.column.contentWidth/2+"px")}).html('<div class="expandable-label">  <span class="letter abbr">P</span>  <span class="letter abbr">r</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">i</span>  <span class="letter">s</span>  <span class="letter">i</span>  <span class="letter">o</span>  <span class="letter">n</span></div><svg class="icon-unsort invisible-default visible">  <use xlink:href="/dist/icons.svg#unsort"></use></svg><svg class="icon-sort-asc invisible-default">  <use xlink:href="/dist/icons.svg#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default">  <use xlink:href="/dist/icons.svg#sort-desc"></use></svg>'),this.controls.append("li").attr("class","sort-recall ease-all").style({width:this.visData.global.column.contentWidth/2+"px",left:this.visData.global.column.contentWidth/2+this.visData.global.column.padding+"px"}).on("click",function(){i.sortColumn(this,"recall")}).on("mouseenter",function(){i.highlightBars(this.parentNode,"recall"),s.select(this).style({width:i.visData.global.column.contentWidth-16+"px",left:i.visData.global.column.padding+16+"px"})}).on("mouseleave",function(){i.highlightBars(this.parentNode,"recall",!0),s.select(this).style({width:i.visData.global.column.contentWidth/2+"px",left:i.visData.global.column.contentWidth/2+i.visData.global.column.padding+"px"})}).html('<div class="expandable-label">  <span class="letter abbr">R</span>  <span class="letter">e</span>  <span class="letter abbr">c</span>  <span class="letter">a</span>  <span class="letter abbr">l</span>  <span class="letter">l</span></div><svg class="icon-unsort invisible-default visible">  <use xlink:href="/dist/icons.svg#unsort"></use></svg><svg class="icon-sort-asc invisible-default">  <use xlink:href="/dist/icons.svg#sort-asc"></use></svg><svg class="icon-sort-desc invisible-default">  <use xlink:href="/dist/icons.svg#sort-desc"></use></svg>'),this.controls.append("li").attr("class","options").style("width",this.visData.global.column.padding+"px").on("click",this.toggleOptions).html('<svg class="icon-gear">  <use xlink:href="/dist/icons.svg#gear"></use></svg>')}return n.createClass(t,[{key:"toggleColumn",value:function(){console.log("Toggle column")}},{key:"selectNodesColumn",value:function(t){return this.vis.selectByColumn(s.select(t).datum().level,".node")}},{key:"highlightBars",value:function(t,s,e){var a=this.selectNodesColumn(t);a.selectAll(".bar."+s).classed("highlight",!e)}},{key:"sortColumn",value:function(t,e){var a=this,l=s.select(t),i=l.datum().sortStatus;switch(i){case 1:i=0,l.select(".icon-sort-asc").classed("visible",!1),l.select(".icon-unsort").classed("visible",!0);break;case-1:i=1,l.select(".icon-sort-desc").classed("visible",!1),l.select(".icon-sort-asc").classed("visible",!0);break;default:i=-1,l.select(".icon-unsort").classed("visible",!1),l.select(".icon-sort-desc").classed("visible",!0)}l.datum().sortStatus=i;var n=this.selectNodesColumn(t.parentNode),o=n.data();o.sort(function(t,s){var a=t.data.barRefs[e],l=s.data.barRefs[e];return a>l?i:l>a?-i:0});var r=function(){s.select(this).classed("sorting",!0)},c=function(){s.select(this).classed("sorting",!1)};i?n.data(o,function(t){return t.data.name}).transition().duration(H).attr("transform",function(t,s){return"translate(0, "+(s*a.visData.global.row.height-t.y)+")"}).each("start",r).each("end",c):n.transition().duration(H).attr("transform","translate(0, 0)").each("start",r).each("end",c)}},{key:"toggleOptions",value:function(){console.log("Toggle options")}}]),t}(),R=function(t){function s(t){n.classCallCheck(this,s);var e=n.possibleConstructorReturn(this,Object.getPrototypeOf(s).call(this,t));return e.name=e.constructor.name,e.message=t,Error.captureStackTrace(e,e.constructor.name),e}return n.inherits(s,t),s}(Error),B=function(t){function s(t){return n.classCallCheck(this,s),n.possibleConstructorReturn(this,Object.getPrototypeOf(s).call(this,t||"D3.layout.listGraph.js has not been loaded yet."))}return n.inherits(s,t),s}(R),P=function(){function a(l,i,o,c){var h=this;if(n.classCallCheck(this,a),!s.layout.listGraph)throw new B("D3 list graph layout (d3.layout.listGraph.js) needs to be loaded before creating the visualization.");e(c)||(c={});var u=this;this.baseEl=l,this.baseElD3=s.select(l),this.baseElJq=t(l),this.rootNodes=o,this.width=c.width||C,this.height=c.height||S,this.scrollbarWidth=c.scrollbarWidth||T,this.columns=c.columns||M,this.rows=c.rows||W,this.baseElJq.width(this.width).addClass(x),this.layout=new s.layout.listGraph([this.width,this.height],[this.columns,this.rows]),this.data=i,this.visData=this.layout.process(this.data,this.rootNodes),this.topbar=new E(this,this.baseElD3,this.visData),this.svg=s.select(".list-graph").append("svg").attr("width",this.width).attr("height",this.height),this.container=this.svg.append("g"),this.columns=new k(this.container,this.visData),this.links=new y(this.columns.groups,this.visData,this.layout),this.nodes=new f(this.columns.groups,this.visData),this.columns.scrollPreparation(this,this.scrollbarWidth),this.scrollbars=new r(this.columns.groups,this.visData,this.scrollbarWidth),this.$levels=t(this.columns.groups[0]).on("mousewheel",function(t){u.mousewheelColumn(this,t)}),this.scrollbars.selection.on("mousedown",function(){u.scrollbarMouseDown(this,s.event)}),s.select(document).on("mouseup",function(){h.globalMouseUp(s.event)}).on("mousemove",function(){h.globalMouseMove(s.event)})}return n.createClass(a,[{key:"globalMouseUp",value:function(t){if(this.activeScrollbar){var s=this.activeScrollbar.datum(),e=s.scrollbar.clientY-t.clientY;s.scrollbar.scrollTop=Math.min(Math.max(s.scrollbar.scrollTop-e,0),s.scrollbar.scrollHeight),s.scrollTop=Math.max(Math.min(s.scrollTop+s.invertedHeightScale(e),0),-s.scrollHeight),this.activeScrollbar.classed("active",!1),this.activeScrollbar=void 0}}},{key:"globalMouseMove",value:function(t){if(this.activeScrollbar){var s=this.activeScrollbar.datum(),e=s.scrollbar.clientY-t.clientY;a.scrollY(this.activeScrollbar.node(),Math.min(Math.max(s.scrollbar.scrollTop-e,0),s.scrollbar.scrollHeight));var l=Math.max(Math.min(s.scrollTop+s.invertedHeightScale(e),0),-s.scrollHeight);a.scrollY(s.nodes,l),this.links.scroll(s.linkSelections.outgoing,this.layout.offsetLinks(s.level,l,"source")),this.links.scroll(s.linkSelections.incoming,this.layout.offsetLinks(s.level-1,l,"target"))}}},{key:"scrollbarMouseDown",value:function(t,e){this.activeScrollbar=s.select(t).classed("active",!0),this.activeScrollbar.datum().scrollbar.clientY=e.clientY}},{key:"mousewheelColumn",value:function(t,e){e.preventDefault();var l=s.select(t).datum();l.scrollHeight>0&&(l.scrollTop=Math.max(Math.min(l.scrollTop+e.deltaY,0),-l.scrollHeight),a.scrollY(l.nodes,l.scrollTop),l.scrollbar.scrollTop=l.scrollbar.heightScale(-l.scrollTop),a.scrollY(l.scrollbar.el,l.scrollbar.scrollTop),this.links.scroll(l.linkSelections.outgoing,this.layout.offsetLinks(l.level,l.scrollTop,"source")),this.links.scroll(l.linkSelections.incoming,this.layout.offsetLinks(l.level-1,l.scrollTop,"target")))}},{key:"selectByColumn",value:function(t,e){return s.select(this.columns.groups[0][t]).selectAll(e)}}],[{key:"scrollY",value:function(t,e){s.select(t).attr("transform","translate(0, "+e+")")}}]),a}();return P}($,d3);
//# sourceMappingURL=listGraph.min.js.map
