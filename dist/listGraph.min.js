function scrollColumn(t,a){try{d3.select(t).attr("transform","translate(0, "+a+")")}catch(l){console.err("ListGraph is not properly initialized!",l)}}function scrollLinks(t,a,l,e,n){a.data(function(){return t.offsetLinks(l,e,n)}).attr("d",diagonal).exit().remove()}function mousewheelColumn(t,a){t.preventDefault(),this.__data__.scrollHeight>0&&(this.__data__.scrollTop=Math.max(Math.min(this.__data__.scrollTop+t.deltaY,0),-this.__data__.scrollHeight),scrollColumn(this.__data__.scrollEl,this.__data__.scrollTop),this.__data__.scrollbar.el.__data__.scrollTop=this.__data__.scrollbar.heightScale(-this.__data__.scrollTop),scrollColumn(this.__data__.scrollbar.el,this.__data__.scrollbar.el.__data__.scrollTop),scrollLinks(a,this.__data__.linkSelections.outgoing,this.__data__.level,this.__data__.scrollTop,"source"),scrollLinks(a,this.__data__.linkSelections.incoming,this.__data__.level-1,this.__data__.scrollTop,"target"))}function prepareColumnForScrolling(t,a){var l=this.querySelector(".nodes"),e=this.querySelector(".scrollbar"),n=l.getBoundingClientRect().height+2*a.row.padding,r=n-height,i=r>0?Math.max(height*height/r,10):0;t.height=n,t.linkSelections={incoming:this.previousSibling?d3.select(this.previousSibling).selectAll(".link"):null,outgoing:d3.select(this).selectAll(".link")},t.scrollEl=l,t.scrollHeight=r,t.scrollTop=0,t.scrollbar={el:e,x:t.x+a.column.width-scrollbarWidth,y:0,width:scrollbarWidth,height:i,scrollHeight:height-i,heightScale:d3.scale.linear().domain([0,r]).range([0,height-i])}}function traverseUp(t,a){for(;t.parent;)t=t.parent,a(t)}function traverseDown(t,a){for(var l=t.childRefs.length;l--;)a(t.childRefs[l]),traverseDown(t.childRefs[l],a)}function traverse(t,a){traverseUp(t,a),traverseDown(t,a);for(var l=t.childRefs.length;l--;)a(t.childRefs[l]),traverseDown(t.childRefs[l],a)}function addLabel(t){t.append("foreignObject").attr("x",function(t){return t.x+visData.global.column.padding+visData.global.cell.padding}).attr("y",function(t){return t.y+visData.global.row.padding+visData.global.cell.padding}).attr("width",visData.global.column.contentWidth).attr("height",visData.global.row.contentHeight/2-2*visData.global.cell.padding).attr("class","label-wrapper").append("xhtml:div").attr("class","label").attr("title",function(t){return t.data.name}).append("xhtml:span").text(function(t){return t.data.name})}function setUpBar(t,a,l,e,n){t.attr("class",e).attr("x",a.x+visData.global.column.padding+visData.global.cell.padding).attr("y",function(t,e){return a.y+visData.global.row.padding+visData.global.row.contentHeight/2+l*e+visData.global.cell.padding*(1+2*e)}).attr("width",function(t){return(n?t.value:1)*(visData.global.column.contentWidth-2*visData.global.cell.padding)}).attr("height",l)}function addBar(t){var a=t.datum(),l=a.data.bars,e=visData.global.row.contentHeight/(2*a.data.bars.length)-2*visData.global.cell.padding,n=t.selectAll(".bar").data(l).enter().append("g").attr("class","bar");n.append("rect").call(setUpBar,a,e,"bar-border"),n.append("rect").call(setUpBar,a,e,"bar-magnitude",!0)}function addBars(t){t.append("g").classed("bars",!0).call(addBar)}var width=800,height=200,scrollbarWidth=6,D3ListGraph=d3.layout.listGraph(),listGraph=new D3ListGraph([width,height],[5,5]),visData,diagonal=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),svg=d3.select("body").append("svg").attr("width",width).attr("height",height),container=svg.append("g");d3.json("data.json",function(t,a){if(t)throw t;visData=listGraph.process(a,["1","2"]),diagonal.source(function(t){return{x:t.source.y+t.source.offsetY+visData.global.row.height/2,y:t.source.x+t.source.offsetX+visData.global.column.contentWidth+visData.global.column.padding}}).target(function(t){return{x:t.target.y+t.target.offsetY+visData.global.row.height/2,y:t.target.x+t.target.offsetX+visData.global.column.padding}}).projection(function(t){return[t.y,t.x]});var l=container.selectAll("g").data(visData.nodes).enter().append("g").attr("class","level");l.append("rect").attr("class","scroll-container").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return visData.global.column.width}).attr("height",function(t){return visData.global.column.height});var e=l.append("g").attr("class","links"),n=(e.selectAll(".link").data(function(t,a){return listGraph.links(a)}).enter().append("path").attr("class","link").attr("d",diagonal),l.append("g").attr("class","nodes")),r=n.selectAll("g.node").data(function(t){return t.rows}).enter().append("g").classed("node",!0).classed("clone",function(t){return t.clone});r.append("rect").attr("x",function(t){return t.x+visData.global.column.padding}).attr("y",function(t){return t.y+visData.global.row.padding}).attr("width",visData.global.column.contentWidth).attr("height",visData.global.row.contentHeight).attr("rx",2).attr("ry",2).classed("bg",!0),r.on("mouseover",function(t){t.hovering=1,traverse(t,function(t){t.hovering=2}),d3.select(this).classed("hovering-directly",!0),r.classed("hovering-indirectly",function(t){return 2===t.hovering})}),r.on("mouseout",function(t){t.hovering=0,traverse(t,function(t){t.hovering=0}),d3.select(this).classed("hovering-directly",!1),r.classed("hovering-indirectly",!1)}),r.call(addLabel),r.each(function(t){d3.select(this).call(addBars)});var i=l.append("rect").classed("scrollbar",!0);l.each(function(t){prepareColumnForScrolling.call(this,t,visData.global)}),i.attr("x",function(t){return t.scrollbar.x}).attr("y",function(t){return t.scrollbar.y}).attr("width",function(t){return scrollbarWidth}).attr("height",function(t){return t.scrollbar.height}).attr("rx",scrollbarWidth/2).attr("ry",scrollbarWidth/2).classed("ready",!0);var o;$(l[0]).on("mousewheel",function(t){mousewheelColumn.call(this,t,listGraph)}),$(i[0]).each(function(){this.__data__={clientY:null,scrollTop:0};for(var t=Object.keys(this.parentNode.__data__.scrollbar),a=t.length;a--;)this.__data__[t[a]]=this.parentNode.__data__.scrollbar[t[a]];this.__data__.invertedHeightScale=this.__data__.heightScale.invert,this.__data__.contentEl=this.parentNode.querySelector(".nodes")}).on("mousedown",function(t){o=this,o.__data__.clientY=t.clientY,d3.select(o).classed("active",!0)}),$(document).on("mouseup",function(t){if(o){var a=o.__data__.clientY-t.clientY;o.__data__.scrollTop=Math.min(Math.max(o.__data__.scrollTop-a,0),o.__data__.scrollHeight);var l=o.__data__.contentEl;l.__data__.scrollTop=Math.max(Math.min(l.__data__.scrollTop+o.__data__.invertedHeightScale(a),0),-l.__data__.scrollHeight),d3.select(o).classed("active",!1),o=void 0}}).on("mousemove",function(t){if(o){var a=o.__data__.clientY-t.clientY;scrollColumn(o,Math.min(Math.max(o.__data__.scrollTop-a,0),o.__data__.scrollHeight));var l=o.__data__.contentEl,e=Math.max(Math.min(l.__data__.scrollTop+o.__data__.invertedHeightScale(a),0),-l.__data__.scrollHeight);scrollColumn(l,e),scrollLinks(listGraph,l.__data__.linkSelections.outgoing,l.__data__.level,e,"source"),scrollLinks(listGraph,l.__data__.linkSelections.incoming,l.__data__.level-1,e,"target")}})});
//# sourceMappingURL=listGraph.min.js.map
