{"version":3,"sources":["listGraph.min.js"],"names":["scrollColumn","element","offset","d3","select","attr","e","console","err","scrollLinks","graph","selection","level","scrollTop","nodeType","data","offsetLinks","diagonal","exit","remove","mousewheelColumn","listGraph","preventDefault","this","__data__","scrollHeight","Math","max","min","deltaY","scrollEl","scrollbar","el","heightScale","linkSelections","outgoing","incoming","prepareColumnForScrolling","global","querySelector","scrollbarEl","columnHeight","getBoundingClientRect","height","row","padding","scrollbarHeight","previousSibling","selectAll","x","column","width","scrollbarWidth","y","scale","linear","domain","range","traverseUp","node","callback","parent","traverseDown","i","childRefs","length","traverse","addLabel","append","visData","cell","contentWidth","contentHeight","name","text","setUpBar","datum","barHeight","className","magnitude","value","addBar","bars","newSelection","enter","call","addBars","classed","D3ListGraph","layout","svg","projection","d","container","json","error","process","source","offsetY","offsetX","target","levels","nodes","linksGroups","nodesGroups","links","rows","clone","on","hovering","each","scrollbars","activeScrollbar","$","clientY","keys","Object","parentNode","invertedHeightScale","invert","contentEl","document","undefined","contentScrollTop"],"mappings":"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","file":"listGraph.min.js","sourcesContent":["function scrollColumn (element, offset) {\n  try {\n    d3.select(element).attr(\n      'transform',\n      'translate(0, ' + offset + ')'\n    );\n  } catch (e) {\n    console.err('ListGraph is not properly initialized!', e);\n  }\n}\n\nfunction scrollLinks (graph, selection, level, scrollTop, nodeType) {\n  selection\n    .data(function () {\n      return graph.offsetLinks(\n        level,\n        scrollTop,\n        nodeType\n      );\n    })\n    .attr('d', diagonal)\n    .exit().remove();\n}\n\nfunction mousewheelColumn (e, listGraph) {\n  e.preventDefault();\n\n  if (this.__data__.scrollHeight > 0) {\n    // Scroll nodes\n    this.__data__.scrollTop = Math.max(\n      Math.min(this.__data__.scrollTop + e.deltaY, 0),\n      -this.__data__.scrollHeight\n    );\n\n    scrollColumn(\n      this.__data__.scrollEl,\n      this.__data__.scrollTop\n    );\n\n    // Scroll scrollbar\n    this.__data__.scrollbar.el.__data__.scrollTop = this.__data__.scrollbar\n      .heightScale(\n        -this.__data__.scrollTop\n      );\n\n    scrollColumn(\n      this.__data__.scrollbar.el,\n      this.__data__.scrollbar.el.__data__.scrollTop\n    );\n\n    // Update links\n    scrollLinks(\n      listGraph,\n      this.__data__.linkSelections.outgoing,\n      this.__data__.level,\n      this.__data__.scrollTop,\n      'source'\n    );\n    scrollLinks(\n      listGraph,\n      this.__data__.linkSelections.incoming,\n      this.__data__.level - 1,\n      this.__data__.scrollTop,\n      'target'\n    );\n  }\n}\n\nfunction prepareColumnForScrolling (data, global) {\n  var scrollEl = this.querySelector('.nodes');\n  var scrollbarEl = this.querySelector('.scrollbar');\n\n  var columnHeight = scrollEl.getBoundingClientRect().height +\n    2 * global.row.padding;\n  var scrollHeight = columnHeight - height;\n  var scrollbarHeight = scrollHeight > 0 ?\n    Math.max((height * height / scrollHeight), 10) : 0;\n\n  data.height = columnHeight;\n  data.linkSelections = {\n    incoming: this.previousSibling ?\n      d3.select(this.previousSibling).selectAll('.link') : null,\n    outgoing: d3.select(this).selectAll('.link')\n  };\n  data.scrollEl = scrollEl;\n  data.scrollHeight = scrollHeight;\n  data.scrollTop = 0;\n  data.scrollbar = {\n    el: scrollbarEl,\n    x: data.x + global.column.width - scrollbarWidth,\n    y: 0,\n    width: scrollbarWidth,\n    height: scrollbarHeight,\n    scrollHeight: height - scrollbarHeight,\n    heightScale: d3.scale.linear()\n      .domain([0, scrollHeight])\n      .range([0, height - scrollbarHeight])\n  };\n}\n\nfunction traverseUp (node, callback) {\n  while (node.parent) {\n    node = node.parent;\n    callback(node);\n  }\n}\n\nfunction traverseDown (node, callback) {\n  for (var i = node.childRefs.length; i--;) {\n    callback(node.childRefs[i]);\n    traverseDown(node.childRefs[i], callback);\n  }\n}\n\nfunction traverse (node, callback) {\n  traverseUp(node, callback);\n  traverseDown(node, callback);\n  for (var i = node.childRefs.length; i--;) {\n    callback(node.childRefs[i]);\n    traverseDown(node.childRefs[i], callback);\n  }\n}\n\nfunction addLabel (selection) {\n  selection.append('foreignObject')\n    .attr('x', function(data) {\n      return data.x + visData.global.column.padding + visData.global.cell.padding;\n    })\n    .attr('y', function(data) {\n      return data.y + visData.global.row.padding + visData.global.cell.padding;\n    })\n    .attr('width', visData.global.column.contentWidth)\n    .attr('height', visData.global.row.contentHeight / 2 - visData.global.cell.padding * 2)\n    .attr('class', 'label-wrapper')\n    .append('xhtml:div')\n      .attr('class', 'label')\n      .attr('title', function(data) {\n        return data.data.name;\n      })\n      .append('xhtml:span')\n        .text(function(data) {\n          return data.data.name;\n        });\n}\n\nfunction setUpBar (selection, datum, barHeight, className, magnitude) {\n  selection\n    .attr('class', className)\n    .attr('x', datum.x + visData.global.column.padding + visData.global.cell.padding)\n    .attr('y', function (data, i) {\n      return datum.y +\n        visData.global.row.padding +\n        visData.global.row.contentHeight / 2 +\n        barHeight * i +\n        visData.global.cell.padding * (1 + 2 * i);\n    })\n    .attr('width', function (data) {\n      return (magnitude ? data.value : 1) *\n        (visData.global.column.contentWidth - visData.global.cell.padding * 2);\n    })\n    .attr('height', barHeight);\n}\n\nfunction addBar (selection) {\n  var datum = selection.datum();\n  var bars = datum.data.bars;\n  var barHeight = visData.global.row.contentHeight /\n  (datum.data.bars.length * 2) -\n  visData.global.cell.padding * 2;\n\n  var newSelection = selection.selectAll('.bar')\n    .data(bars)\n    .enter()\n    .append('g')\n      .attr('class', 'bar');\n\n  newSelection\n    .append('rect')\n      .call(setUpBar, datum, barHeight, 'bar-border');\n\n  newSelection\n    .append('rect')\n      .call(setUpBar, datum, barHeight, 'bar-magnitude', true);\n}\n\nfunction addBars (selection) {\n  selection\n    .append('g')\n      .classed('bars', true)\n      .call(addBar);\n}\n\nvar width = 800,\n    height = 200,\n    scrollbarWidth = 6;\n\nvar D3ListGraph = d3.layout.listGraph();\n\nvar listGraph = new D3ListGraph([width, height], [5,5]);\nvar visData;\n\nvar diagonal = d3.svg.diagonal()\n  .projection(function(d) { return [d.y, d.x]; });\n\nvar svg = d3.select('body')\n  .append('svg')\n    .attr('width', width)\n    .attr('height', height);\n\nvar container = svg.append('g');\n\nd3.json('data.json', function(error, data) {\n  if (error) throw error;\n\n  visData = listGraph.process(data, ['1', '2']);\n\n  diagonal\n    .source(function (data) {\n      return {\n        x: data.source.y + data.source.offsetY + visData.global.row.height / 2,\n        y: data.source.x + data.source.offsetX + visData.global.column.contentWidth + visData.global.column.padding\n      };\n    })\n    .target(function (data) {\n      return {\n        x: data.target.y + data.target.offsetY+ visData.global.row.height / 2,\n        y: data.target.x + data.target.offsetX+ visData.global.column.padding\n      };\n    })\n    .projection(function (data) {\n      return [data.y, data.x];\n    });\n\n  var levels = container\n    .selectAll('g')\n    .data(visData.nodes)\n    .enter()\n    .append('g')\n      .attr('class', 'level');\n\n  // We need to add an empty rectangle that fills up the whole column to ensure\n  // that the `g`'s size is at a maximum, otherwise scrolling will be halted\n  // when the cursor leaves an actually drawn element.\n  levels\n    .append('rect')\n      .attr('class', 'scroll-container')\n      .attr('x', function (data) {\n        return data.x;\n      })\n      .attr('y', function (data) {\n        return data.y;\n      })\n      .attr('width', function (data) {\n        return visData.global.column.width;\n      })\n      .attr('height', function (data) {\n        return visData.global.column.height;\n      });\n\n  // We need an extra container which is transformed during scrolling. Otherwise\n  // we \"scroll away\" the container that is listening to the mousehweel event.\n  var linksGroups = levels.append('g').attr('class', 'links');\n\n  var links = linksGroups.selectAll('.link')\n    .data(function (data, i) {\n      return listGraph.links(i);\n    })\n    .enter()\n    .append('path')\n      .attr('class', 'link')\n      .attr('d', diagonal);\n\n  var nodesGroups = levels.append('g').attr('class', 'nodes');\n\n  var nodes = nodesGroups\n    .selectAll('g.node')\n    .data(function(data) { return data.rows; })\n    .enter()\n    .append('g')\n      .classed('node', true)\n      .classed('clone', function (data) {\n        return data.clone;\n      });\n\n  nodes\n    .append('rect')\n      .attr('x', function(data) {\n        return data.x + visData.global.column.padding;\n      })\n      .attr('y', function(data) {\n        return data.y + visData.global.row.padding;\n      })\n      .attr('width', visData.global.column.contentWidth)\n      .attr('height', visData.global.row.contentHeight)\n      .attr('rx', 2)\n      .attr('ry', 2)\n      .classed('bg', true);\n\n  nodes.on('mouseover', function (data) {\n    data.hovering = 1;\n    traverse(data, function (data) {\n      data.hovering = 2;\n    });\n\n    d3.select(this).classed('hovering-directly', true);\n    nodes.classed('hovering-indirectly', function (data) {\n      return data.hovering === 2;\n    });\n  });\n\n  nodes.on('mouseout', function (data) {\n    data.hovering = 0;\n    traverse(data, function (data) {\n      data.hovering = 0;\n    });\n\n    d3.select(this).classed('hovering-directly', false);\n    nodes.classed('hovering-indirectly', false);\n  });\n\n  // Add label\n  nodes.call(addLabel);\n\n  nodes.each(function (data) {\n    d3.select(this).call(addBars);\n  });\n\n  // Add bars\n  // nodes.call(addBars);\n\n  // Add empty scrollbar element\n  var scrollbars = levels\n    .append('rect')\n      .classed('scrollbar', true);\n\n  // Store the height for each column to save computations when scrolling.\n  levels.each(function (data) {\n    prepareColumnForScrolling.call(\n      this,\n      data,\n      visData.global\n    );\n  });\n\n  // Adjust scrollbars\n  scrollbars\n    .attr('x', function (data) {\n      return data.scrollbar.x;\n    })\n    .attr('y', function (data) {\n      return data.scrollbar.y;\n    })\n    .attr('width', function (data) {\n      return scrollbarWidth;\n    })\n    .attr('height', function (data) {\n      return data.scrollbar.height;\n    })\n    .attr('rx', scrollbarWidth / 2)\n    .attr('ry', scrollbarWidth / 2)\n    .classed('ready', true);\n\n  var $levels = $(levels[0]).on('mousewheel', function (e) {\n    mousewheelColumn.call(this, e, listGraph);\n  });\n\n  // Reference to the currently active scrollbar. A scrollbar is active when\n  // one clicked on the scrollbar and hold the mouse down.\n  var activeScrollbar;\n\n  var $scrollbars = $(scrollbars[0])\n    .each(function () {\n      this.__data__ = {\n        clientY: null,\n        scrollTop: 0\n      };\n      // Copy data over from the parent\n      var keys = Object.keys(this.parentNode.__data__.scrollbar);\n      for (var i = keys.length; i--;) {\n        this.__data__[keys[i]] = this.parentNode.__data__.scrollbar[keys[i]];\n      }\n      // Invert scale\n      this.__data__.invertedHeightScale = this.__data__.heightScale.invert;\n      // Store a reference to the actual node list to be scrolled\n      this.__data__.contentEl = this.parentNode.querySelector('.nodes');\n    })\n    .on('mousedown', function (e) {\n      activeScrollbar = this;\n      activeScrollbar.__data__.clientY = e.clientY;\n\n      d3.select(activeScrollbar).classed('active', true);\n    });\n\n  // We need to listen to `mouseup` and `mousemove` globally otherwise scrolling\n  // will only work as long as the cursor hovers the actual scrollbar, which is\n  // super annoying.\n  var $document = $(document)\n    .on('mouseup', function (e) {\n      if (activeScrollbar) {\n        var deltaY = activeScrollbar.__data__.clientY - e.clientY;\n        // Save final vertical position\n        // Scrollbar\n        activeScrollbar.__data__.scrollTop = Math.min(\n          Math.max(\n            activeScrollbar.__data__.scrollTop - deltaY,\n            0\n          ),\n          activeScrollbar.__data__.scrollHeight\n        );\n        // Content\n        var contentEl = activeScrollbar.__data__.contentEl;\n        contentEl.__data__.scrollTop = Math.max(\n          Math.min(\n            contentEl.__data__.scrollTop +\n            activeScrollbar.__data__.invertedHeightScale(deltaY),\n            0\n          ),\n          -contentEl.__data__.scrollHeight\n        );\n\n        d3.select(activeScrollbar).classed('active', false);\n\n        activeScrollbar = undefined;\n      }\n    })\n    .on('mousemove', function (e) {\n      if (activeScrollbar) {\n        var deltaY = activeScrollbar.__data__.clientY - e.clientY;\n        // Scroll scrollbar\n        scrollColumn(\n          activeScrollbar,\n          Math.min(\n            Math.max(\n              activeScrollbar.__data__.scrollTop - deltaY,\n              0\n            ),\n            activeScrollbar.__data__.scrollHeight\n          )\n        );\n        // Scroll content\n        var contentEl = activeScrollbar.__data__.contentEl,\n            contentScrollTop = Math.max(\n                Math.min(\n                  contentEl.__data__.scrollTop +\n                  activeScrollbar.__data__.invertedHeightScale(deltaY),\n                  0\n                ),\n                -contentEl.__data__.scrollHeight\n              );\n        scrollColumn(\n          contentEl,\n          contentScrollTop\n        );\n        // Scroll links\n        scrollLinks(\n          listGraph,\n          contentEl.__data__.linkSelections.outgoing,\n          contentEl.__data__.level,\n          contentScrollTop,\n          'source'\n        );\n        scrollLinks(\n          listGraph,\n          contentEl.__data__.linkSelections.incoming,\n          contentEl.__data__.level - 1,\n          contentScrollTop,\n          'target'\n        );\n      }\n    });\n});\n"],"sourceRoot":"/source/"}