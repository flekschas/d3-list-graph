{"version":3,"sources":["listGraph.min.js"],"names":["global","factory","exports","module","require","define","amd","ListGraph","$","d3","this","$$1","isObject","value","type","isFunction","tag","objectToString","call","funcTag","genTag","isFinite","nativeIsFinite","collectInclClones","node","onlyForOriginalNode","originalNode","clone","clones","length","concat","_up","callback","depth","includeClones","child","visitedNodes","id","nodes","i","parentsId","Object","keys","parents","j","up","undefined","_down","childRefs","down","upAndDown","callbackUp","callbackDown","siblings","siblingsId","_i","roundRect","x","y","width","height","radius","topLeft","topRight","bottomLeft","bottomRight","dropMenu","c","arrowSize","mergeSelections","selections","mergedSelection","selectAll","_groups","allTransitionsEnded","transition","size","n","each","on","_len","arguments","args","Array","_key","apply","objectOrFunction","isFunction$2","setScheduler","scheduleFn","customSchedulerFn","setAsap","asapFn","asap","useNextTick","process","nextTick","flush","useVertxTimer","vertxNext","useMutationObserver","iterations","observer","BrowserMutationObserver","document","createTextNode","observe","characterData","data","useMessageChannel","channel","MessageChannel","port1","onmessage","port2","postMessage","useSetTimeout","setTimeout","len","queue","arg","attemptVertx","r","vertx","runOnLoop","runOnContext","e","then","onFulfillment","onRejection","parent","constructor","noop","PROMISE_ID","makePromise","state","_state","invokeCallback","_result","subscribe","resolve$1","object","Constructor","promise","resolve","selfFulfillment","TypeError","cannotReturnOwn","getThen","error","GET_THEN_ERROR","tryThen","then$$1","fulfillmentHandler","rejectionHandler","handleForeignThenable","thenable","sealed","fulfill","reason","reject","_label","handleOwnThenable","FULFILLED","REJECTED","handleMaybeThenable","maybeThenable","publishRejection","_onerror","publish","PENDING","_subscribers","subscribers","settled","detail","ErrorObject","tryCatch","TRY_CATCH_ERROR","succeeded","failed","hasCallback","initializePromise","resolver","nextId","Enumerator$1","input","_instanceConstructor","isArray$2","_input","_remaining","_enumerate","validationError","Error","all","entries","race","reject$1","needsResolver","needsNew","Promise$2","isObjectLike","isSymbol","objectToString$1","symbolTag","toNumber","NAN","other","valueOf","replace","reTrim","isBinary","reIsBinary","test","reIsOctal","freeParseInt","slice","reIsBadHex","debounce","func","wait","options","invokeFunc","time","lastArgs","thisArg","lastThis","lastInvokeTime","result","leadingEdge","timerId","timerExpired","leading","remainingWait","timeSinceLastCall","lastCallTime","timeSinceLastInvoke","maxing","nativeMin","maxWait","shouldInvoke","now","trailingEdge","trailing","cancel","clearTimeout","debounced","isInvoking","FUNC_ERROR_TEXT","nativeMax","onDragDrop","selection","dragStartHandler","dragMoveHandler","dropHandler","elsToBeDragged","orientation","limits","noDraggingWhenTrue","dragData","clickTolerance","drag$$1","drag","checkWhenDragging","appliedLimits","filter","d2","event","sourceEvent","preventDefault","dx","dy","select","window","el","datum","dragMoveHandler$1","withinLimits","applyingLimits","restrictedValue","Math","min","max","LimitsUnsupportedFormat","els","style","dropShadow","name","blur","opacity","defs","empty","append","attr","feMerge","setOption","defaultValue","noFalsyValue","_isArray","isArray","classCallCheck","AwaitValue","AsyncGenerator","gen","send","key","Promise","request","next","back","front","resume","settle","done","err","_invoke","return","Symbol","asyncIterator","prototype","throw","wrap","fn","await","instance","createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","protoProps","staticProps","inherits","subClass","superClass","create","setPrototypeOf","__proto__","possibleConstructorReturn","self","ReferenceError","ExtendableError","_Error","message","_this","getPrototypeOf","captureStackTrace","D3VersionFourRequired","_ExtendableError","versionFound","LayoutNotAvailable","_ExtendableError2","NoObject","variableName","EventDispatcherNoFunction","CLASSNAME","SCROLLBAR_WIDTH","COLUMNS","ROWS","ICON_PATH","DEFAULT_SORT_ORDER","DEFAULT_BAR_MODE","HIGHLIGHT_ACTIVE_LEVEL","ACTIVE_LEVEL","NO_ROOT_ACTIVE_LEVEL_DIFF","QUERYING","HIDE_OUTWARDS_LINKS","SHOW_LINK_LOCATION","DISABLE_DEBOUNCED_CONTEXT_MENU","TRANSITION_LIGHTNING_FAST","TRANSITION_SEMI_FAST","LINK_BUNDLING_STRENGTH","TOPBAR_EL","TOPBAR_CLASS","TOPBAR_CONTROL_EL","TOPBAR_CONTROL_CLASS","TOPBAR_GLOBAL_CONTROL_CLASS","Topbar","vis","baseEl","visData","customTopbarButtons","insert","controlSwitch","column","padding","classed","switch","bind","switchArrow","iconPath","globalControls","globalPrecision","currentSorting","sortAllColumns","interactionWrapper","highlightBars","globalPrecisionWrapper","text","order","globalRecall","globalRecallWrapper","globalName","highlightLabels","globalNameWrapper","globalOneBar","barMode","switchBarMode","globalOneBarWrapper","globalTwoBars","globalTwoBarsWrapper","globalZoomOut","zoomedOut","toggleView","globalZoomOutWrapper","btn","wrapper","label","iconSvg","iconSpan","localControlWrapper","localControls","enter","index","control","local","sortBy","sortOrder","toggleColumn","contentWidth","controlData","sortColumn","level","parentNode","html","toggleOptions","deHighlight","selectNodesLevel","baseElD3","newType","semiActiveSortingEls","selectByLevel","newSortType","resetSemiActiveSortingEls","resetSortEl","columnKeys","mode","COLUMN_CLASS","SCROLL_CONTAINER_CLASS","Levels","groups","highlightActiveLevel","rootedNode","activeLevel","noRootActiveLevelDiff","scrollTop","scrollbarWidth","_this2","contentHeight","getBoundingClientRect","row","scrollHeight","scrollbarHeight","linkSelections","incoming","outgoing","scrollbar","heightScale","scaleLinear","domain","range","invertedHeightScale","invert","_this3","group","hidden","get","LINKS_CLASS","LINK_CLASS","Links","levels","layout","links","hideOutwardsLinks","linkVisibility","diagonal","pointsOutside","nodeIds","_highlight","className","unset","update","start","end","duration","source","getSourceX","offsetX","getTargetX","getY","offsetY","addStraightOffset","path","lineStart","indexOf","lineEnd","lastIndexOf","startPoint","substr","split","endPoint","parseInt","extraOffsetX","substring","showLinkLocation","getLine","line","curve","curveBundle","beta","points","sourceX","sourceY","targetX","targetY","middleX","relMiddleX","push","objectProto","toString","freeGlobal","freeSelf","root","Function","BAR_CLASS","Bar","barData","nodeData","bars","setupMagnitude","generatePath","cell","activeHeight","inactiveheight","BARS_CLASS","Bars","xScale","barId","insertBefore","children","generateOneBarPath","generateTwoBarsPath","normValue","isBottom","CLASS_NODES","CLASS_NODE","CLASS_NODE_VISIBLE","CLASS_CLONE","CLASS_LABEL_WRAPPER","CLASS_FOCUS_CONTROLS","CLASS_ROOT","CLASS_QUERY","CLASS_INDICATOR_BAR","CLASS_INDICATOR_LOCATION","CLASS_INDICATOR_INCOMING","CLASS_INDICATOR_OUTGOING","CLASS_INDICATOR_ABOVE","CLASS_INDICATOR_BELOW","Nodes","events","drawLinkIndicator","direction","linkDensityBg","refs","drawLinkLocationIndicator","position","above","drawFullSizeRect","shrinking","noRoundBorder","shrinkingAmount","drawMaxSizedRect","currentLinks","iconDimension","rows","visNodes","calcHeightLinkLocationIndicator","nodeRooted","setUpFocusControls","querying","nodeQuery","event$$1","focusNodes","blurNodes","eventHelper","highlightNodes","unhighlightNodes","toggleLock","toggleRoot","isInvisible","noNotification","actions","queryHandler","d3El","action","broadcast","excludeClones","zoomIn","zoomedView","tempHidingUnrelatedNodes","hideUnrelatedNodes","below","total","updateHeightLinkLocationIndicatorBars","nodeFocusIds","eventData","clonedFromId","optionalParams","subSelectionClass","same","checkNodeFocusSameEvent","zoomOut","globalView","hovering","nodesVisibility","showAgain","_hidden","updateVisibility","restriction","noVisibilityCheck","checkNodeVisibility","_el","_data","isHidden","checkNodeDirect","checkNodeIndirect","nodeId","currentNodeData","includeParents","appliedClassName","includeChildren","currentlyActiveBar","traverseCallbackUp","childData","traverseCallbackDown","highlight","customScrollTop","dragged","invisible","locked","unlocked","lock","unlock","prevInvisible","_invisible","show","query","previousMode","setNodeQueryState","unsetNodeQueryState","toggleNodeQueryStates","unroot","rooted","unrooted","hideNodes","focus","queryBeforeRooting","location","paddedDim","_this4","svgD3","updateLevelsVisibility","updateScrolling","forceUnlock","lockedNode","unlockNode","lockNode","forceUnroot","queries","unrootNode","unquery","rootNode","batchQueryHandler","traverseCallback","showNodes","barRefHeight","barAboveRefTop","baseClassName","left","right","_this5","updateNodesVisibility","SCROLLBAR_CLASS","Scrollbars","Events","_stack","dispatch","_dispatchEvent","eventName","createEvent","initCustomEvent","dispatchEvent","times","normTimes","Infinity","stack","splice","off","scheduleFlush","browserWindow","browserGlobal","MutationObserver","WebKitMutationObserver","isNode","isWorker","Uint8ClampedArray","importScripts","random","_eachEntry","entry","resolve$$1","_settledAt","_willSettleAt","enumerator","_setScheduler","_setAsap","_asap","catch","Date","objectProto$1","requestAnimationFrame","lastTime","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","currTime","getTime","timeToCall","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","nextAnimationFrame","requestId","floor","ids","requestNextAnimationFrame","element","ts","cancelNextAnimationFrame","CLASS_NAME","CLASS_CHECKBOX","ARROW_SIZE","TRANSITION_SPEED","BUTTON_QUERY_DEBOUNCE","BUTTON_ROOT_DEBOUNCE","BUTTON_DEFAULT_DEBOUNCE","BUTTON_BAM_EFFECT_ANIMATION_TIME","NodeContextMenu","init","_x","_y","_yOffset","_scale","isQueryable","infoFields","isDebounced","numButtonRows","toBottom","nodeInfoId","updateAppearance","bgWrapper","bgBorder","bg","textNodeInfo","createTextField","alignRight","classNames","distanceFromCenter","fullWidth","labels","toggler","clickNodeInfo","togglerX","togglerY","buttonQuery","createButton","labelTwo","bamEffect","unselectable","clickQueryHandler","buttonQueryFill","buttonQueryBamEffect","buttonRoot","clickRootHandler","buttonRootFill","checkboxRoot","createCheckbox","buttonLock","clickLockHandler","buttonLockFill","buttonLockBamEffect","checkboxLock","components","debouncedQueryHandler","debouncedRootHandler","rootHandler","isToggable","isUnselectable","div","checked","checkBoxMovement","fillButton","emptyButton","positionComponent","translate","currentRootState","tempRoot","showElement","hideElement","lockHandler","checkLock","triggerButtonBamEffect","getNodeProperty","property","updateQuery","checkRoot","closing","opened","visible","properties","join","createButtonBg","addLabel","rx","ry","round","container","columnNum","updateStates","checkOrientation","_this6","tempQueryMode","currentQueryMode","close","offset","_this7","closed","previousNodeId","open","centerY","scale","nextQueryMode","queryMode","updateInfoText","set","ease","easeLinear","button","_d3","version","listGraph","__d3ListGraphBase__","baseElJq","svgEl","outsideClickHandler","outsideClickClassHandler","svgJq","rootNodes","getBoundingRect","columns","linkLocationBucketSize","lessTransitionsJs","lessTransitions","lessTransitionsCss","disableDebouncedContextMenu","nodeInfoContextMenu","dispatcher","addClass","forceWidth","grid","topbar","scrollPreparation","scrollbars","nodeContextMenu","mouseDownOnContextMenu","mousewheelColumn","checkGlobalClick","classNodeVisible","registerOutSideClickHandler","unregisterOutSideClickHandler","toggle","classFocusControls","classRoot","classQuery","domEl","activeScrollbar","enterHandler","leaveHandler","scrollbarMouseDown","globalMouseUp","dragEndHandler","getDragLimits","noDragging","levelId","updateAll","updateBars","updateSorting","nextLevel","oldLevel","rootNodeDepth","found","checkClass","__id__","getAttribute","handlerIds","_i2","dragging","noInteractions","deltaY","clientY","scrollElVertically","contentScrollTop","scroll","offsetLinks","updateLinkLocationIndicators","scrollY","top","dragMinX","stopScrollBarMouseMove","selectionInterst","cRect","contBBox","getBBox","globalCRect","makeAllTempVisible","params","boundingRect","linkPointsOutside","elClassNames","newLength","_i3","scrollYTo","startScrollBarMouseMove","columnData","scrollbarDragging","isOpenSameColumn","positionY","tween","scrollPositionY","interpolateNumber","selector","sort","updatePosition","dragScrollbar","switchMode","trigger","handler","resetAllScrollPositions","updateScrollProperties","_barMode","area"],"mappings":"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","file":"listGraph.min.js","sourcesContent":["/* Copyright Fritz Lekschas: D3 example visualization app using the list-like graph layout */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('$'), require('d3')) :\n  typeof define === 'function' && define.amd ? define(['$', 'd3'], factory) :\n  (global.ListGraph = factory(global.$,global.d3));\n}(this, (function ($$1,d3) { 'use strict';\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nvar asyncGenerator = function () {\n  function AwaitValue(value) {\n    this.value = value;\n  }\n\n  function AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n\n        if (value instanceof AwaitValue) {\n          Promise.resolve(value.value).then(function (arg) {\n            resume(\"next\", arg);\n          }, function (arg) {\n            resume(\"throw\", arg);\n          });\n        } else {\n          settle(result.done ? \"return\" : \"normal\", result.value);\n        }\n      } catch (err) {\n        settle(\"throw\", err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case \"return\":\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case \"throw\":\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== \"function\") {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === \"function\" && Symbol.asyncIterator) {\n    AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke(\"next\", arg);\n  };\n\n  AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke(\"throw\", arg);\n  };\n\n  AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke(\"return\", arg);\n  };\n\n  return {\n    wrap: function (fn) {\n      return function () {\n        return new AsyncGenerator(fn.apply(this, arguments));\n      };\n    },\n    await: function (value) {\n      return new AwaitValue(value);\n    }\n  };\n}();\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get$1 = function get$1(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get$1(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar possibleConstructorReturn = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\n\n\nvar set$1 = function set$1(object, property, value, receiver) {\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent !== null) {\n      set$1(parent, property, value, receiver);\n    }\n  } else if (\"value\" in desc && desc.writable) {\n    desc.value = value;\n  } else {\n    var setter = desc.set;\n\n    if (setter !== undefined) {\n      setter.call(receiver, value);\n    }\n  }\n\n  return value;\n};\n\n/**\n * Base error class.\n */\nvar ExtendableError = function (_Error) {\n  inherits(ExtendableError, _Error);\n\n  /**\n   * Constructor.\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-12\n   * @param   {String}  message  Custom error message.\n   */\n  function ExtendableError(message) {\n    classCallCheck(this, ExtendableError);\n\n    var _this = possibleConstructorReturn(this, (ExtendableError.__proto__ || Object.getPrototypeOf(ExtendableError)).call(this, message));\n\n    _this.name = _this.constructor.name;\n    _this.message = message;\n    Error.captureStackTrace(_this, _this.constructor.name);\n    return _this;\n  }\n\n  return ExtendableError;\n}(Error);\n\n/**\n * D3 version 4 not found error.\n */\nvar D3VersionFourRequired = function (_ExtendableError) {\n  inherits(D3VersionFourRequired, _ExtendableError);\n\n  /**\n   * Constructor\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-12\n   * @param   {String}  versionFound  D3 version string.\n   */\n  function D3VersionFourRequired(versionFound) {\n    classCallCheck(this, D3VersionFourRequired);\n    return possibleConstructorReturn(this, (D3VersionFourRequired.__proto__ || Object.getPrototypeOf(D3VersionFourRequired)).call(this, 'D3 version 4 is required to run the code. Found version ' + versionFound));\n  }\n\n  return D3VersionFourRequired;\n}(ExtendableError);\n\n/**\n * When varible is no object\n */\nvar NoObject = function (_ExtendableError2) {\n  inherits(NoObject, _ExtendableError2);\n\n  /**\n   * Constructor\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-12\n   * @param   {String}  variableName  Name of the variable that ought to be an\n   *   object.\n   */\n  function NoObject(variableName) {\n    classCallCheck(this, NoObject);\n    return possibleConstructorReturn(this, (NoObject.__proto__ || Object.getPrototypeOf(NoObject)).call(this, 'The \"' + variableName + '\" must be an object.'));\n  }\n\n  return NoObject;\n}(ExtendableError);\n\n// Internal\nvar LayoutNotAvailable = function (_ExtendableError) {\n  inherits(LayoutNotAvailable, _ExtendableError);\n\n  function LayoutNotAvailable(message) {\n    classCallCheck(this, LayoutNotAvailable);\n    return possibleConstructorReturn(this, (LayoutNotAvailable.__proto__ || Object.getPrototypeOf(LayoutNotAvailable)).call(this, message || 'D3.layout.listGraph.js has not been loaded yet.'));\n  }\n\n  return LayoutNotAvailable;\n}(ExtendableError);\n\nvar EventDispatcherNoFunction = function (_ExtendableError2) {\n  inherits(EventDispatcherNoFunction, _ExtendableError2);\n\n  function EventDispatcherNoFunction(message) {\n    classCallCheck(this, EventDispatcherNoFunction);\n    return possibleConstructorReturn(this, (EventDispatcherNoFunction.__proto__ || Object.getPrototypeOf(EventDispatcherNoFunction)).call(this, message || 'Dispatcher needs to be a function.'));\n  }\n\n  return EventDispatcherNoFunction;\n}(ExtendableError);\n\nvar CLASSNAME = 'list-graph';\n\n/**\n * Width of the scrollbar in pixel.\n *\n * @type  {Number}\n */\nvar SCROLLBAR_WIDTH = 6;\n\n/**\n * Default number of columns\n *\n * @type  {Number}\n */\nvar COLUMNS = 5;\n\n/**\n * Default number of rows.\n *\n * @type  {Number}\n */\nvar ROWS = 5;\n\n/**\n * Path to the icon file. An empty path is equal to inline SVG.\n *\n * @type  {String}\n */\nvar ICON_PATH = '';\n\n/**\n * Default sort order.\n *\n * @description\n * -1 = desc, 1 = asc\n *\n * @type  {Number}\n */\nvar DEFAULT_SORT_ORDER = -1;\n\n/**\n * Default bar display mode.\n *\n * @type  {String}\n */\nvar DEFAULT_BAR_MODE = 'one';\n\n/**\n * Default highlighting of the active level.\n *\n * @type  {Boolean}\n */\nvar HIGHLIGHT_ACTIVE_LEVEL = true;\n\n/**\n * Default active level.\n *\n * @type  {Number}\n */\nvar ACTIVE_LEVEL = 0;\n\n/**\n * Default difference when no custom root is queried for.\n *\n * @type  {Number}\n */\nvar NO_ROOT_ACTIVE_LEVEL_DIFF = 0;\n\n/**\n * Default querying.\n *\n * @type  {Boolean}\n */\nvar QUERYING = false;\n\n/**\n * Default value for hiding links pointing to nodes outside the visible area.\n *\n * @type  {Boolean}\n */\nvar HIDE_OUTWARDS_LINKS = false;\n\n/**\n * Default value for showing the link indicator bar when links to hidden nodes\n * are hidden.\n *\n * @type  {Boolean}\n */\nvar SHOW_LINK_LOCATION = false;\n\n/**\n * Default for disabling debouncing of the node context menu.\n *\n * @type  {Boolean}\n */\nvar DISABLE_DEBOUNCED_CONTEXT_MENU = false;\n\n/**\n * Default transition speed in milliseconds for super fast transition.\n *\n * @type  {Number}\n */\nvar TRANSITION_LIGHTNING_FAST = 150;\n\n/**\n * Default transition speed in milliseconds for fast transition.\n *\n * @type  {Number}\n */\n\n/**\n * Default transition speed in milliseconds for semi-fast transition.\n *\n * @type  {Number}\n */\nvar TRANSITION_SEMI_FAST = 250;\n/**\n * Default transition speed in milliseconds for normal transition.\n *\n * @type  {Number}\n */\n\n/**\n * Default transition speed in milliseconds for slow transition.\n *\n * @type  {Number}\n */\n\n/**\n * Default transition speed in milliseconds for slow transition.\n *\n * @type  {Number}\n */\n\n\n/**\n * Strength of how much links should be bundled.\n *\n * @description\n * The value ranges from 0 (no bundling at all) to 1 (move line through every\n * controll point).\n *\n * @type  {Number}\n */\nvar LINK_BUNDLING_STRENGTH = 0.95;\n\n/**\n * Stretch out factor for link bundling.\n *\n * @description\n * The value ranges from 0 (no stretch out at all) to 1 (which means the two\n * middle control points defining the B-Spline are identical).\n *\n * @type  {Number}\n */\n\n// External\nvar TOPBAR_EL = 'div';\nvar TOPBAR_CLASS = 'top-bar';\n\nvar TOPBAR_CONTROL_EL = 'ul';\nvar TOPBAR_CONTROL_CLASS = 'controls';\nvar TOPBAR_GLOBAL_CONTROL_CLASS = 'global-controls';\n\nvar Topbar = function () {\n  /**\n   * Topbar constructor\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-10-02\n   * @param   {Object}  vis                  List Graph App.\n   * @param   {Object}  baseEl               D3 base selection.\n   * @param   {Object}  visData              List Graph App data.\n   * @param   {Array}   customTopbarButtons  Array of custom topbar buttons.\n   */\n  function Topbar(vis, baseEl, visData, customTopbarButtons) {\n    var _this = this;\n\n    classCallCheck(this, Topbar);\n\n    var self = this;\n\n    this.vis = vis;\n    this.visData = visData;\n    this.customTopbarButtons = customTopbarButtons;\n    // Add base topbar element\n    this.el = baseEl.select('.' + TOPBAR_CLASS);\n\n    if (this.el.empty()) {\n      this.el = baseEl.insert(TOPBAR_EL, ':first-child').attr('class', TOPBAR_CLASS);\n    }\n\n    this.controlSwitch = this.el.append('div').attr('title', 'Toggle global / local topbar').style('width', this.visData.global.column.padding + 'px').classed('control-switch', true).on('click', this.switch.bind(this));\n\n    this.switchArrow = this.controlSwitch.append('svg').append('use').attr('xlink:href', this.vis.iconPath + '#arrow-down').attr('class', 'switch-arrow');\n\n    this.globalControls = this.el.append(TOPBAR_CONTROL_EL).classed(TOPBAR_GLOBAL_CONTROL_CLASS, true);\n\n    // Add button for sorting by precision\n    this.globalPrecision = this.globalControls.append('li').attr('class', 'control-btn sort-precision').classed('active', function () {\n      if (self.vis.currentSorting.global.type === 'precision') {\n        // Save currently active element. Needed when when re-sorting for the\n        // first time, to be able to de-highlight this element.\n        self.vis.currentSorting.global.el = d3.select(this);\n        return true;\n      }\n      return false;\n    }).on('click', function () {\n      self.sortAllColumns(this, 'precision');\n    }).on('mouseenter', function () {\n      _this.vis.interactionWrapper.call(_this.vis, function () {\n        _this.highlightBars(undefined, 'precision');\n      }, []);\n    }).on('mouseleave', function () {\n      _this.vis.interactionWrapper.call(_this.vis, function () {\n        _this.highlightBars(undefined, 'precision', true);\n      }, []);\n    });\n\n    this.globalPrecisionWrapper = this.globalPrecision.append('div').attr('class', 'wrapper');\n\n    this.globalPrecisionWrapper.append('span').attr('class', 'label').text('Precision');\n\n    this.globalPrecisionWrapper.append('svg').attr('class', 'icon-unsort invisible-default').classed('visible', this.vis.currentSorting.global.type !== 'precision').append('use').attr('xlink:href', this.vis.iconPath + '#unsort');\n\n    this.globalPrecisionWrapper.append('svg').attr('class', 'icon-sort-asc invisible-default').classed('visible', this.vis.currentSorting.global.type === 'precision' && this.vis.currentSorting.global.order === 1).append('use').attr('xlink:href', this.vis.iconPath + '#sort-asc');\n\n    this.globalPrecisionWrapper.append('svg').attr('class', 'icon-sort-desc invisible-default').classed('visible', this.vis.currentSorting.global.type === 'precision' && this.vis.currentSorting.global.order !== 1).append('use').attr('xlink:href', this.vis.iconPath + '#sort-desc');\n\n    // Add button for sorting by recall\n    this.globalRecall = this.globalControls.append('li').attr('class', 'control-btn sort-recall').classed('active', function () {\n      if (self.vis.currentSorting.global.type === 'recall') {\n        // See precision\n        self.vis.currentSorting.global.el = d3.select(this);\n        return true;\n      }\n      return false;\n    }).on('click', function () {\n      self.sortAllColumns(this, 'recall');\n    }).on('mouseenter', function () {\n      _this.vis.interactionWrapper.call(_this.vis, function () {\n        _this.highlightBars(undefined, 'recall');\n      }, []);\n    }).on('mouseleave', function () {\n      _this.vis.interactionWrapper.call(_this.vis, function () {\n        _this.highlightBars(undefined, 'recall', true);\n      }, []);\n    });\n\n    this.globalRecallWrapper = this.globalRecall.append('div').attr('class', 'wrapper');\n\n    this.globalRecallWrapper.append('span').attr('class', 'label').text('Recall');\n\n    this.globalRecallWrapper.append('svg').attr('class', 'icon-unsort invisible-default').classed('visible', this.vis.currentSorting.global.type !== 'recall').append('use').attr('xlink:href', this.vis.iconPath + '#unsort');\n\n    this.globalRecallWrapper.append('svg').attr('class', 'icon-sort-asc invisible-default').classed('visible', this.vis.currentSorting.global.type === 'recall' && this.vis.currentSorting.global.order === 1).append('use').attr('xlink:href', this.vis.iconPath + '#sort-asc');\n\n    this.globalRecallWrapper.append('svg').attr('class', 'icon-sort-desc invisible-default').classed('visible', this.vis.currentSorting.global.type === 'recall' && this.vis.currentSorting.global.order !== 1).append('use').attr('xlink:href', this.vis.iconPath + '#sort-desc');\n\n    // Add button for sorting by name\n    this.globalName = this.globalControls.append('li').attr('class', 'control-btn sort-name').classed('active', function () {\n      if (self.vis.currentSorting.global.type === 'name') {\n        // See precision\n        self.vis.currentSorting.global.el = d3.select(this);\n        return true;\n      }\n      return false;\n    }).on('click', function () {\n      self.sortAllColumns(this, 'name');\n    }).on('mouseenter', function () {\n      _this.vis.interactionWrapper.call(_this.vis, function () {\n        _this.highlightLabels();\n      }, []);\n    }).on('mouseleave', function () {\n      _this.vis.interactionWrapper.call(_this.vis, function () {\n        _this.highlightLabels(true);\n      }, []);\n    });\n\n    this.globalNameWrapper = this.globalName.append('div').attr('class', 'wrapper');\n\n    this.globalNameWrapper.append('span').attr('class', 'label').text('Name');\n\n    this.globalNameWrapper.append('svg').attr('class', 'icon-unsort invisible-default').classed('visible', this.vis.currentSorting.global.type !== 'name').append('use').attr('xlink:href', this.vis.iconPath + '#unsort');\n\n    this.globalNameWrapper.append('svg').attr('class', 'icon-sort-asc invisible-default').classed('visible', this.vis.currentSorting.global.type === 'name' && this.vis.currentSorting.global.order === 1).append('use').attr('xlink:href', this.vis.iconPath + '#sort-alpha-asc');\n\n    this.globalNameWrapper.append('svg').attr('class', 'icon-sort-desc invisible-default').classed('visible', this.vis.currentSorting.global.type === 'name' && this.vis.currentSorting.global.order !== 1).append('use').attr('xlink:href', this.vis.iconPath + '#sort-alpha-desc');\n\n    // Add button for switching to 'one bar'\n    this.globalOneBar = this.globalControls.append('li').attr('class', 'control-btn one-bar').classed('active', this.vis.barMode === 'one').on('click', function () {\n      self.switchBarMode(this, 'one');\n    });\n\n    this.globalOneBarWrapper = this.globalOneBar.append('div').attr('class', 'wrapper').text('One bar');\n\n    this.globalOneBarWrapper.append('svg').attr('class', 'icon-one-bar').append('use').attr('xlink:href', this.vis.iconPath + '#one-bar');\n\n    // Add button for switching to 'two bars'\n    this.globalTwoBars = this.globalControls.append('li').attr('class', 'control-btn two-bars').classed('active', this.vis.barMode === 'two').on('click', function () {\n      self.switchBarMode(this, 'two');\n    });\n\n    this.globalTwoBarsWrapper = this.globalTwoBars.append('div').attr('class', 'wrapper').text('Two bars');\n\n    this.globalTwoBarsWrapper.append('svg').attr('class', 'icon-two-bars').append('use').attr('xlink:href', this.vis.iconPath + '#two-bars');\n\n    // Add button for zoom-out\n    this.globalZoomOut = this.globalControls.append('li').attr('class', 'control-btn zoom-out').classed('active', this.vis.zoomedOut).on('click', function () {\n      self.vis.toggleView.call(self.vis);\n      d3.select(this).classed('active', self.vis.zoomedOut);\n    });\n\n    this.globalZoomOutWrapper = this.globalZoomOut.append('div').attr('class', 'wrapper').text('Zoom Out');\n\n    this.globalZoomOutWrapper.append('svg').attr('class', 'icon-zoom-out').append('use').attr('xlink:href', this.vis.iconPath + '#zoom-out');\n\n    // Add custom button\n    for (var i = 0; i < this.customTopbarButtons.length; i++) {\n      var btn = this.globalControls.append('li').attr('class', 'control-btn').on('click', this.customTopbarButtons[i].callback);\n\n      var wrapper = btn.append('div').attr('class', 'wrapper').text(this.customTopbarButtons[i].label);\n\n      if (this.customTopbarButtons[i].iconSvg) {\n        wrapper.append('svg').attr('class', 'icon').append('use').attr('xlink:href', this.customTopbarButtons[i].iconSvg);\n      }\n\n      if (this.customTopbarButtons[i].iconSpan) {\n        wrapper.append('span').attr('class', 'icon ' + this.customTopbarButtons[i].iconSpan);\n      }\n    }\n\n    this.localControlWrapper = this.el.append('div').classed('local-controls', true);\n\n    this.localControls = this.localControlWrapper.selectAll(TOPBAR_CONTROL_CLASS).data(visData.nodes).enter().append(TOPBAR_CONTROL_EL).classed(TOPBAR_CONTROL_CLASS, true).style('width', this.visData.global.column.width + 'px');\n\n    this.localControls.each(function (data, index) {\n      var control = d3.select(this);\n\n      /*\n       * Order:\n       * 0 = unsorted\n       * 1 = asc\n       * -1 = desc\n       */\n      self.vis.currentSorting.local[index] = {\n        type: data.sortBy,\n        order: data.sortOrder,\n        el: undefined\n      };\n\n      control.append('li').attr('class', 'control-btn toggle').style('width', self.visData.global.column.padding + 'px').on('click', self.toggleColumn);\n\n      control.append('li').attr('class', 'control-btn sort-precision ease-all').classed('active', function () {\n        if (self.vis.currentSorting.local[index].type === 'precision') {\n          // See precision\n          self.vis.currentSorting.local[index].el = d3.select(this);\n          return true;\n        }\n        return false;\n      }).style('width', self.visData.global.column.contentWidth / 2 + 'px').style('left', self.visData.global.column.padding + 'px').on('click', function (controlData) {\n        self.sortColumn(this, controlData.level, 'precision');\n      }).on('mouseenter', function () {\n        self.highlightBars(this.parentNode, 'precision');\n        d3.select(this).style('width', self.visData.global.column.contentWidth - 16 + 'px');\n      }).on('mouseleave', function () {\n        self.highlightBars(this.parentNode, 'precision', true);\n        d3.select(this).style('width', self.visData.global.column.contentWidth / 2 + 'px');\n      }).html('<div class=\"expandable-label\">' + '  <span class=\"letter abbr\">P</span>' + '  <span class=\"letter abbr\">r</span>' + '  <span class=\"letter\">e</span>' + '  <span class=\"letter abbr\">c</span>' + '  <span class=\"letter\">i</span>' + '  <span class=\"letter\">s</span>' + '  <span class=\"letter\">i</span>' + '  <span class=\"letter\">o</span>' + '  <span class=\"letter\">n</span>' + '</div>' + '<svg class=\"icon-unsort invisible-default ' + (self.vis.currentSorting.local[index].type !== 'precision' ? 'visible' : '') + '\">' + // eslint-disable-line\n      '  <use xlink:href=\"' + self.vis.iconPath + '#unsort\"></use>' + '</svg>' + '<svg class=\"icon-sort-asc invisible-default ' + (self.vis.currentSorting.local[index].type === 'precision' && self.vis.currentSorting.local[index].order === 1 ? 'visible' : '') + '\">' + // eslint-disable-line\n      '  <use xlink:href=\"' + self.vis.iconPath + '#sort-asc\"></use>' + '</svg>' + '<svg class=\"icon-sort-desc invisible-default ' + (self.vis.currentSorting.local[index].type === 'precision' && self.vis.currentSorting.local[index].order !== 1 ? 'visible' : '') + '\">' + // eslint-disable-line\n      '  <use xlink:href=\"' + self.vis.iconPath + '#sort-desc\"></use>' + '</svg>');\n\n      control.append('li').attr('class', 'control-btn sort-recall ease-all').classed('active', function () {\n        if (self.vis.currentSorting.local[index].type === 'recall') {\n          // See recall\n          self.vis.currentSorting.local[index].el = d3.select(this);\n          return true;\n        }\n        return false;\n      }).style('width', self.visData.global.column.contentWidth / 2 + 'px').style('left', self.visData.global.column.contentWidth / 2 + self.visData.global.column.padding + 'px').on('click', function (controlData) {\n        self.sortColumn(this, controlData.level, 'recall');\n      }).on('mouseenter', function () {\n        self.highlightBars(this.parentNode, 'recall');\n        d3.select(this).style('width', self.visData.global.column.contentWidth - 16 + 'px').style('left', self.visData.global.column.padding + 16 + 'px');\n      }).on('mouseleave', function () {\n        self.highlightBars(this.parentNode, 'recall', true);\n        d3.select(this).style('width', self.visData.global.column.contentWidth / 2 + 'px').style('left', self.visData.global.column.contentWidth / 2 + self.visData.global.column.padding + 'px');\n      }).html('<div class=\"expandable-label\">' + '  <span class=\"letter abbr\">R</span>' + '  <span class=\"letter\">e</span>' + '  <span class=\"letter abbr\">c</span>' + '  <span class=\"letter\">a</span>' + '  <span class=\"letter abbr\">l</span>' + '  <span class=\"letter\">l</span>' + '</div>' + '<svg class=\"icon-unsort invisible-default ' + (self.vis.currentSorting.local[index].type !== 'recall' ? 'visible' : '') + '\">' + // eslint-disable-line\n      '  <use xlink:href=\"' + self.vis.iconPath + '#unsort\"></use>' + '</svg>' + '<svg class=\"icon-sort-asc invisible-default ' + (self.vis.currentSorting.local[index].type === 'recall' && self.vis.currentSorting.local[index].order === 1 ? 'visible' : '') + '\">' + // eslint-disable-line\n      '  <use xlink:href=\"' + self.vis.iconPath + '#sort-asc\"></use>' + '</svg>' + '<svg class=\"icon-sort-desc invisible-default ' + (self.vis.currentSorting.local[index].type === 'recall' && self.vis.currentSorting.local[index].order !== 1 ? 'visible' : '') + '\">' + // eslint-disable-line\n      '  <use xlink:href=\"' + self.vis.iconPath + '#sort-desc\"></use>' + '</svg>');\n\n      control.append('li').attr('class', 'control-btn options').style('width', self.visData.global.column.padding + 'px').on('click', self.toggleOptions).html('<svg class=\"icon-gear\">' + '  <use xlink:href=\"' + self.vis.iconPath + '#gear\"></use>' + '</svg>');\n\n      if (self.vis.currentSorting.local[index].type) {\n        self.vis.currentSorting.local[index].el = control.select('.sort-' + self.vis.currentSorting.local[index].type);\n      }\n    });\n  }\n\n  /**\n   * Highlight bars.\n   *\n   * @method  highlightBars\n   * @author  Fritz Lekschas\n   * @date    2016-10-02\n   * @param   {Object}   el           DOM element.\n   * @param   {String}   type         Name of the nodes to be highlighted.\n   * @param   {Boolean}  deHighlight  If `true` the highlighting will be reset.\n   */\n\n\n  createClass(Topbar, [{\n    key: 'highlightBars',\n    value: function highlightBars(el, type, deHighlight) {\n      var nodes = el ? this.selectNodesLevel(el) : this.vis.baseElD3.selectAll('.node');\n\n      nodes.classed('highlight-bar', !deHighlight).selectAll('.bar.' + type).classed('highlight', !deHighlight);\n    }\n\n    /**\n     * Highlight node labels\n     *\n     * @method  highlightLabels\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Boolean}  deHighlight  If `true` the highlighting will be reset.\n     */\n\n  }, {\n    key: 'highlightLabels',\n    value: function highlightLabels(deHighlight) {\n      this.vis.baseElD3.selectAll('.node').classed('highlight-label', !deHighlight);\n    }\n\n    /**\n     * Reset semi-active sort button\n     *\n     * @method  resetSemiActiveSortingEls\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'resetSemiActiveSortingEls',\n    value: function resetSemiActiveSortingEls() {\n      this.el.selectAll('.semi-active').classed('semi-active', false);\n    }\n\n    /**\n     * Reset the visual status of the sort button\n     *\n     * @method  resetSortEl\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}   el       DOM element.\n     * @param   {String}   newType  New sort type.\n     */\n\n  }, {\n    key: 'resetSortEl',\n    value: function resetSortEl(el, newType) {\n      el.classed('active', false);\n      el.select('.icon-sort-desc').classed('visible', false);\n      el.select('.icon-sort-asc').classed('visible', false);\n      el.select('.icon-unsort').classed('visible', true);\n      if (newType === 'name') {\n        el.classed('semi-active', true);\n        this.semiActiveSortingEls = true;\n      }\n    }\n\n    /**\n     * Select nodes by level by button.\n     *\n     * @method  selectNodesLevel\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  el  DOM element.\n     * @return  {Object}      D3 selection of nodes.\n     */\n\n  }, {\n    key: 'selectNodesLevel',\n    value: function selectNodesLevel(el) {\n      return this.vis.selectByLevel(d3.select(el).datum().level, '.node');\n    }\n\n    /**\n     * Sort all columns\n     *\n     * @method  sortAllColumns\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  el    DOM element.\n     * @param   {String}  type  Property to be sorted by.\n     */\n\n  }, {\n    key: 'sortAllColumns',\n    value: function sortAllColumns(el, type) {\n      var newSortType = this.vis.currentSorting.global.type !== type;\n\n      if (newSortType) {\n        if (this.semiActiveSortingEls) {\n          this.resetSemiActiveSortingEls();\n        }\n        // Unset class of previous global sorting element\n        if (this.vis.currentSorting.global.el) {\n          this.resetSortEl(this.vis.currentSorting.global.el, type);\n        }\n      }\n\n      this.vis.currentSorting.global.el = d3.select(el);\n      this.vis.currentSorting.global.el.classed('active', true);\n      this.vis.currentSorting.global.type = type;\n\n      var columnKeys = Object.keys(this.vis.currentSorting.local);\n      for (var i = 0, len = columnKeys.length; i < len; i++) {\n        // Update local sorting properties and buttons but do **not** sort\n        // locally!\n        this.sortColumn(el, columnKeys[i], type, true);\n      }\n\n      this.vis.sortAllColumns(type, newSortType);\n    }\n\n    /**\n     * Sort a column of nodes.\n     *\n     * @method  sortColumn\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}   el      DOM element.\n     * @param   {Number}   index   Index of the column.\n     * @param   {String}   type    Property to be sorted by.\n     * @param   {Boolean}  global  If `true` its global sorting.\n     */\n\n  }, {\n    key: 'sortColumn',\n    value: function sortColumn(el, index, type, global) {\n      // Reset global sorting\n      if (!global) {\n        if (this.semiActiveSortingEls) {\n          this.resetSemiActiveSortingEls();\n        }\n        if (this.vis.currentSorting.global.type) {\n          this.resetSortEl(this.vis.currentSorting.global.el, type);\n        }\n        this.vis.currentSorting.global.type = undefined;\n      }\n\n      var newSortType = false;\n\n      if (this.vis.currentSorting.local[index].el) {\n        if (this.vis.currentSorting.local[index].type !== type) {\n          this.resetSortEl(this.vis.currentSorting.local[index].el, type);\n        }\n      }\n\n      if (this.vis.currentSorting.local[index].type !== type) {\n        newSortType = true;\n        // Reset sort order\n        this.vis.currentSorting.local[index].order = 0;\n      }\n\n      this.vis.currentSorting.local[index].el = d3.select(el);\n      this.vis.currentSorting.local[index].type = type;\n\n      // -1 = desc, 1 = asc\n      if (this.vis.currentSorting.local[index].order === -1) {\n        this.vis.currentSorting.local[index].order = 1;\n        this.vis.currentSorting.local[index].el.select('.icon-sort-desc').classed('visible', false);\n        this.vis.currentSorting.local[index].el.select('.icon-sort-asc').classed('visible', true);\n      } else {\n        this.vis.currentSorting.local[index].order = -1;\n        this.vis.currentSorting.local[index].el.select('.icon-sort-asc').classed('visible', false);\n        this.vis.currentSorting.local[index].el.select('.icon-sort-desc').classed('visible', true);\n      }\n\n      this.vis.currentSorting.local[index].el.select('.icon-unsort').classed('visible', false);\n\n      this.vis.currentSorting.local[index].el.classed('active', true);\n\n      if (!global) {\n        this.vis.sortColumn(index, type, this.vis.currentSorting.local[index].order, newSortType);\n      }\n    }\n\n    /**\n     * Toggle between the global topbar buttons and the local sort buttons.\n     *\n     * @method  switch\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'switch',\n    value: function _switch() {\n      this.el.classed('details', !this.el.classed('details'));\n    }\n\n    /**\n     * Switch bar mode.\n     *\n     * @method  switchBarMode\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  el    DOM element.\n     * @param   {String}  mode  Bar mode to be switched to. Can be ['one', 'two'].\n     */\n\n  }, {\n    key: 'switchBarMode',\n    value: function switchBarMode(el, mode) {\n      if (this.vis.nodes.barMode !== mode) {\n        if (mode === 'one') {\n          this.globalOneBar.classed('active', true);\n          this.globalTwoBars.classed('active', false);\n        } else {\n          this.globalOneBar.classed('active', false);\n          this.globalTwoBars.classed('active', true);\n        }\n        this.vis.switchBarMode(mode);\n      }\n    }\n  }]);\n  return Topbar;\n}();\n\n// External\n/**\n * Class name of columns.\n *\n * @type  {String}\n */\nvar COLUMN_CLASS = 'column';\n\n/**\n * Class name of scroll containers.\n *\n * @type  {String}\n */\nvar SCROLL_CONTAINER_CLASS = 'scroll-container';\n\nvar Levels = function () {\n  /**\n   * Level / column constructor.\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   * @param   {Object}  selection  D3 selection of element the levels should be\n   *   appended to.\n   * @param   {Object}  vis        List Graph App.\n   * @param   {Object}  visData    List Graph App data.\n   */\n  function Levels(selection, vis, visData) {\n    var _this = this;\n\n    classCallCheck(this, Levels);\n\n    this.vis = vis;\n    this.visData = visData;\n    this.groups = selection.selectAll('g').data(this.visData.nodes).enter().append('g').attr('class', COLUMN_CLASS).classed('active', function (data, index) {\n      if (_this.vis.highlightActiveLevel) {\n        if (!_this.vis.nodes || !_this.vis.nodes.rootedNode) {\n          return index === _this.vis.activeLevel - _this.vis.noRootActiveLevelDiff;\n        }\n        return index === _this.vis.activeLevel;\n      }\n      return false;\n    }).each(function (data) {\n      data.scrollTop = 0;\n    });\n\n    // We need to add an empty rectangle that fills up the whole column to ensure\n    // that the `g`'s size is at a maximum, otherwise scrolling will be halted\n    // when the cursor leaves an actually drawn element.\n    this.groups.append('rect').attr('class', SCROLL_CONTAINER_CLASS).attr('x', function (data) {\n      return data.x;\n    }).attr('y', function (data) {\n      return data.y;\n    }).attr('width', this.visData.global.column.width + 1).attr('height', this.visData.global.column.height);\n  }\n\n  /**\n   * Prepare column for scrolling.\n   *\n   * @method  scrollPreparation\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   * @param   {Number}  scrollbarWidth  Width of the scrollbar in pixel.\n   */\n\n\n  createClass(Levels, [{\n    key: 'scrollPreparation',\n    value: function scrollPreparation(scrollbarWidth) {\n      var _this2 = this;\n\n      this.groups.each(function (data, index) {\n        var contentHeight = data.nodes.getBoundingClientRect().height + 2 * _this2.visData.global.row.padding;\n        var scrollHeight = contentHeight - _this2.visData.global.column.height;\n        var scrollbarHeight = scrollHeight > 0 ? Math.max(_this2.visData.global.column.height * _this2.visData.global.column.height / contentHeight, 10) : 0;\n\n        data.height = contentHeight;\n        data.linkSelections = {\n          incoming: index > 0 ? _this2.vis.selectByLevel(index - 1, '.link') : null,\n          outgoing: _this2.vis.selectByLevel(index, '.link')\n        };\n        data.scrollHeight = scrollHeight;\n        data.scrollTop = 0;\n        data.scrollbar = {\n          el: undefined,\n          x: data.x + (_this2.visData.global.column.width - scrollbarWidth),\n          y: 0,\n          width: scrollbarWidth,\n          height: scrollbarHeight,\n          scrollHeight: _this2.visData.global.column.height - scrollbarHeight,\n          scrollTop: 0,\n          heightScale: d3.scaleLinear().domain([0, scrollHeight]).range([0, _this2.visData.global.column.height - scrollbarHeight])\n        };\n        data.invertedHeightScale = data.scrollbar.heightScale.invert;\n      });\n    }\n\n    /**\n     * Update the properties for column scrolling.\n     *\n     * @method  updateScrollProperties\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     */\n\n  }, {\n    key: 'updateScrollProperties',\n    value: function updateScrollProperties() {\n      var _this3 = this;\n\n      this.groups.each(function (data) {\n        var contentHeight = data.nodes.getBoundingClientRect().height + 2 * _this3.visData.global.row.padding;\n        var scrollHeight = contentHeight - _this3.visData.global.column.height;\n        var scrollbarHeight = scrollHeight > 0 ? Math.max(_this3.visData.global.column.height * _this3.visData.global.column.height / contentHeight, 10) : 0;\n\n        data.height = contentHeight;\n        data.scrollHeight = scrollHeight;\n        data.scrollTop = 0;\n        data.scrollbar.y = 0;\n        data.scrollbar.height = scrollbarHeight;\n        data.scrollbar.scrollHeight = _this3.visData.global.column.height - scrollbarHeight;\n        data.scrollbar.scrollTop = 0;\n        data.scrollbar.heightScale = d3.scaleLinear().domain([0, scrollHeight]).range([0, _this3.visData.global.column.height - scrollbarHeight]);\n      });\n    }\n\n    /**\n     * Check if column should be hidden when it's not in the visible area.\n     *\n     * @method  updateVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     */\n\n  }, {\n    key: 'updateVisibility',\n    value: function updateVisibility() {\n      this.groups.each(function () {\n        var group = d3.select(this);\n\n        group.classed('hidden', group.selectAll('.node').filter(function (data) {\n          return !data.hidden;\n        }).empty());\n      });\n    }\n\n    /**\n     * Get the column's class name.\n     *\n     * @method  className\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @return  {String}  Class name of the column.\n     */\n\n  }, {\n    key: 'focus',\n\n\n    /**\n     * Focus a level.\n     *\n     * @method  focus\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Number}  level  ID of the column.\n     */\n    value: function focus(level) {\n      if (this.vis.highlightActiveLevel) {\n        this.groups.filter(function (data) {\n          return data.level === level;\n        }).classed('active', true);\n      }\n    }\n\n    /**\n     * Blur a level.\n     *\n     * @method  blur\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Number}  level  ID of the column.\n     */\n\n  }, {\n    key: 'blur',\n    value: function blur(level) {\n      if (this.vis.highlightActiveLevel) {\n        if (level) {\n          this.groups.filter(function (data) {\n            return data.level === level;\n          }).classed('active', false);\n        } else {\n          this.groups.classed('active', false);\n        }\n      }\n    }\n  }, {\n    key: 'height',\n\n\n    /**\n     * Get the column's height.\n     *\n     * @method  height\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @return  {Number}  Column height in pixel.\n     */\n    get: function get() {\n      return this.visData.global.column.height;\n    }\n  }], [{\n    key: 'className',\n    get: function get() {\n      return COLUMN_CLASS;\n    }\n  }]);\n  return Levels;\n}();\n\n// External\n// Internal\n/**\n * Class name of the group of link container.\n *\n * @type  {String}\n */\nvar LINKS_CLASS = 'links';\n\n/**\n * Class name of a link element.\n *\n * @type  {String}\n */\nvar LINK_CLASS = 'link';\n\nvar Links = function () {\n  /**\n   * [constructor description]\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   * @param   {Object}   vis      List Graph App.\n   * @param   {Object}   levels   List Graph App's levels.\n   * @param   {Object}   visData  List Graph App's data.\n   * @param   {Object}   layout   List Graph Layout.\n   */\n  function Links(vis, levels, visData, layout) {\n    var _this = this;\n\n    classCallCheck(this, Links);\n\n    this.vis = vis;\n    this.visData = visData;\n    this.layout = layout;\n\n    this.groups = levels.append('g').attr('class', LINKS_CLASS).call(function (selection) {\n      selection.each(function () {\n        d3.select(this.parentNode).datum().links = this;\n      });\n    });\n\n    this.links = this.groups.selectAll(LINK_CLASS).data(function (data, index) {\n      return _this.layout.links(index);\n    }).enter().append('g').attr('class', LINK_CLASS).classed('visible', !this.vis.hideOutwardsLinks || this.linkVisibility.bind(this));\n\n    this.links.append('path').attr('class', LINK_CLASS + '-bg').attr('d', this.diagonal.bind(this));\n\n    this.links.append('path').attr('class', LINK_CLASS + '-direct').attr('d', this.diagonal.bind(this));\n  }\n\n  /**\n   * Creates a SVG path string for links based on B-splines.\n   *\n   * @method  diagonal\n   * @author  Fritz Lekschas\n   * @date    2016-09-22\n   * @return  {String}  SVG path string.\n   */\n\n\n  createClass(Links, [{\n    key: 'linkVisibility',\n\n\n    /**\n     * Assess link visibility\n     *\n     * @method  linkVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}  data  D3 selection data object of links.\n     */\n    value: function linkVisibility(data) {\n      // Cache visibility.\n      data.hidden = this.vis.pointsOutside.call(this.vis, data);\n      return data.hidden === 0;\n    }\n\n    /**\n     * [highlight description]\n     *\n     * @method  highlight\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Array}    nodeIds    Array of Node IDs.\n     * @param   {Boolean}  highlight  If `true` highlights links.\n     * @param   {String}   className  Class name added for CSS-based highlighting.\n     */\n\n  }, {\n    key: 'highlight',\n    value: function highlight(nodeIds, _highlight, className) {\n      this.links.filter(function (data) {\n        return nodeIds[data.id];\n      }).classed(className, _highlight);\n    }\n\n    /**\n     * Make links temporarily visible.\n     *\n     * @method  makeAllTempVisible\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Boolean}  unset  If `true` reverts the temporal visibility.\n     */\n\n  }, {\n    key: 'makeAllTempVisible',\n    value: function makeAllTempVisible(unset) {\n      if (unset) {\n        this.links.classed('visible', this.linkVisibility.bind(this));\n      } else {\n        this.links.classed('visible', true);\n      }\n    }\n\n    /**\n     * Scroll links when the container is scrolled.\n     *\n     * @method  scroll\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}  selection  D3 selection of links.\n     * @param   {Object}  data       Updated link data depending on scroll\n     *   position.\n     */\n\n  }, {\n    key: 'scroll',\n    value: function scroll(selection, data) {\n      // Update data of `g`.\n      selection.data(data);\n\n      if (this.vis.hideOutwardsLinks) {\n        // Check if links point outwards.\n        selection.classed('visible', this.linkVisibility.bind(this));\n      }\n\n      // Next, update all paths according to the new data.\n      selection.selectAll('path').attr('d', this.diagonal);\n    }\n\n    /**\n     * Sort links by applying updated data and transitioning to the new position.\n     *\n     * @method  sort\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {[type]}    update  [description]\n     * @return  {[type]}            [description]\n     */\n\n  }, {\n    key: 'sort',\n    value: function sort(update) {\n      var start = function start() {\n        d3.select(this).classed('sorting', true);\n      };\n      var end = function end() {\n        d3.select(this).classed('sorting', false);\n      };\n\n      // Update data of `g`.\n      this.links.data(update, function (data) {\n        return data.id;\n      });\n\n      // Next update all paths according to the new data.\n      this.links.selectAll('path').transition().duration(TRANSITION_SEMI_FAST).attr('d', this.diagonal).on('start', start).on('end', end);\n    }\n\n    /**\n     * Update the visual state of the link according to the current state of data.\n     *\n     * @description\n     * This method differs from checking whether a source or target node is\n     * visible as it purely depends on the `hidden` property of the node data. It\n     * is primarily used to hide links of hidden nodes, e.g., when nodes are\n     * hidden manually.\n     *\n     * @method  updateVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     */\n\n  }, {\n    key: 'updateVisibility',\n    value: function updateVisibility() {\n      this.links.classed('hidden', function (data) {\n        return data.target.node.hidden || data.source.node.hidden;\n      });\n\n      this.links.selectAll('path').transition().duration(TRANSITION_SEMI_FAST).attr('d', this.diagonal);\n    }\n  }, {\n    key: 'diagonal',\n    get: function get() {\n      var _this2 = this;\n\n      var extraOffsetX = this.vis.showLinkLocation ? 6 : 0;\n\n      function getSourceX(source) {\n        return source.node.x + source.offsetX + this.visData.global.column.contentWidth + this.visData.global.column.padding;\n      }\n\n      function getTargetX(source) {\n        return source.node.x + source.offsetX + this.visData.global.column.padding;\n      }\n\n      function getY(source) {\n        return source.node.y + source.offsetY + this.visData.global.row.height / 2;\n      }\n\n      function addStraightOffset(path) {\n        var lineStart = path.indexOf('L');\n        var lineEnd = path.lastIndexOf('L');\n\n        var startPoint = path.substr(1, lineStart - 1).split(',');\n        var endPoint = path.substr(lineEnd + 1).split(',');\n\n        return 'M' + (parseInt(startPoint[0], 10) - extraOffsetX) + ',' + startPoint[1] + 'L' + startPoint[0] + ',' + startPoint[1] + path.substring(lineStart, lineEnd) + 'L' + endPoint[0] + ',' + endPoint[1] + 'L' + (parseInt(endPoint[0], 10) + extraOffsetX) + ',' + endPoint[1];\n      }\n\n      var getLine = d3.line().x(function (data) {\n        return data.x;\n      }).y(function (data) {\n        return data.y;\n      }).curve(d3.curveBundle.beta(LINK_BUNDLING_STRENGTH));\n\n      return function (data) {\n        var points = [];\n\n        var sourceX = getSourceX.call(_this2, data.source);\n        var sourceY = getY.call(_this2, data.source);\n\n        var targetX = getTargetX.call(_this2, data.target);\n        var targetY = getY.call(_this2, data.target);\n\n        var middleX = (sourceX + targetX) / 2;\n        var relMiddleX = (targetX - (sourceX + targetX) / 2) * 2 / 3;\n\n        // Push the start point\n        points.push({\n          x: sourceX + extraOffsetX,\n          y: sourceY\n        });\n\n        points.push({\n          x: middleX,\n          y: sourceY\n        });\n\n        // Push a control point\n        points.push({\n          x: targetX - relMiddleX,\n          y: targetY\n        });\n\n        // Push a control point\n        points.push({\n          x: targetX - extraOffsetX,\n          y: targetY\n        });\n\n        return addStraightOffset(getLine(points));\n      };\n    }\n  }]);\n  return Links;\n}();\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]';\nvar genTag = '[object GeneratorFunction]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsFinite = root.isFinite;\n\n/**\n * Checks if `value` is a finite primitive number.\n *\n * **Note:** This method is based on\n * [`Number.isFinite`](https://mdn.io/Number/isFinite).\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a finite number, else `false`.\n * @example\n *\n * _.isFinite(3);\n * // => true\n *\n * _.isFinite(Number.MIN_VALUE);\n * // => true\n *\n * _.isFinite(Infinity);\n * // => false\n *\n * _.isFinite('3');\n * // => false\n */\nfunction isFinite(value) {\n  return typeof value == 'number' && nativeIsFinite(value);\n}\n\n/**\n * Collect all cloned nodes, including the original node.\n *\n * @method  collectInclClones\n * @author  Fritz Lekschas\n * @date    2016-03-20\n * @param   {Object}   node                 Start node\n * @param   {Boolean}  onlyForOriginalNode  If `true` only collect clones when\n *   `node` is not a clone itself.\n * @return  {Array}                         Array of original and cloned nodes.\n */\nfunction collectInclClones(node, onlyForOriginalNode) {\n  var originalNode = node;\n\n  if (node.clone) {\n    originalNode = node.originalNode;\n    if (onlyForOriginalNode) {\n      return [];\n    }\n  }\n\n  var clones = [originalNode];\n\n  if (originalNode.clones.length) {\n    clones = clones.concat(originalNode.clones);\n  }\n\n  return clones;\n}\n\n// External\n// Internal\nfunction _up(node, callback, depth, includeClones, child, visitedNodes) {\n  if (visitedNodes[node.id]) {\n    if (!visitedNodes[node.id][child.id]) {\n      callback(node, child);\n    }\n    return;\n  }\n\n  var nodes = includeClones ? collectInclClones(node) : [node];\n\n  for (var i = nodes.length; i--;) {\n    visitedNodes[nodes[i].id] = {};\n\n    if (child) {\n      callback(nodes[i], child);\n      visitedNodes[nodes[i].id][child.id] = true;\n    }\n\n    if (!isFinite(depth) || depth > 0) {\n      var parentsId = Object.keys(nodes[i].parents);\n      for (var j = parentsId.length; j--;) {\n        _up(nodes[i].parents[parentsId[j]], callback, depth - 1, includeClones, nodes[i], visitedNodes);\n      }\n    }\n  }\n}\n\n/**\n * Traverse the graph upwards from a given node until a certain depth.\n *\n * @method  up\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}    node           D3 data object of a selected DOM element.\n * @param   {Function}  callback       Method to be called on every traversed\n *   node.\n * @param   {Number}    depth          Max steps to traverse upwards. If\n *   `undefined` will traverse till the root node.\n * @param   {Boolean}   includeClones  If `true` cloned nodes will be traversed\n *   as well.\n */\nfunction up(node, callback, depth, includeClones) {\n  var visitedNodes = {};\n  _up(node, callback, depth, includeClones, undefined, visitedNodes);\n}\n\nfunction _down(node, callback, depth, includeClones, visitedNodes) {\n  if (visitedNodes[node.id]) {\n    return;\n  }\n\n  var nodes = includeClones ? collectInclClones(node) : [node];\n\n  for (var i = nodes.length; i--;) {\n    callback(nodes[i]);\n\n    visitedNodes[nodes[i].id] = true;\n\n    // We only need to recursivly traverse the graph for the original node as\n    // the clones do not have any children (i.e. the have the same children as\n    // the original node)\n    if (i === 0 && (!isFinite(depth) || depth > 0)) {\n      for (var j = nodes[i].childRefs.length; j--;) {\n        _down(nodes[i].childRefs[j], callback, depth - 1, includeClones, visitedNodes);\n      }\n    }\n  }\n}\n\n/**\n * Traverse the graph downwards from a given node until a certain depth.\n *\n * @method  down\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}    node           D3 data object of a selected DOM element.\n * @param   {Function}  callback       Method to be called on every traversed\n *   node.\n * @param   {Number}    depth          Max steps to traverse downwards. If\n *   `undefined` will traverse till leaf nodes.\n * @param   {Boolean}   includeClones  If `true` cloned nodes will be traversed\n *   as well.\n */\nfunction down(node, callback, depth, includeClones) {\n  var visitedNodes = {};\n  _down(node, callback, depth, includeClones, visitedNodes);\n}\n\n/**\n * Traverse the graph up- and downwards from a given node until a certain depth.\n *\n * @method  upAndDown\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}    node           D3 data object of a selected DOM element.\n * @param   {Function}  callback       Method to be called on every upwards\n *   traversed node.\n * @param   {Function}  callback       Method to be called on every downwards\n *   traversed node.\n * @param   {Number}    depth          Max steps to traverse downwards. If\n *   `undefined` will traverse till leaf nodes.\n * @param   {Boolean}   includeClones  If `true` cloned nodes will be traversed\n *   as well.\n */\nfunction upAndDown(node, callbackUp, callbackDown, depth, includeClones) {\n  if (callbackDown) {\n    up(node, callbackUp, depth, includeClones);\n    down(node, callbackDown, depth, includeClones);\n  } else {\n    var visitedNodes = {};\n    up(node, callbackUp, depth, includeClones, visitedNodes);\n    down(node, callbackUp, depth, includeClones, visitedNodes);\n  }\n}\n\n/**\n * Traverse siblings from a given nodes.\n *\n * @method  siblings\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}    node      D3 data object of a selected DOM element.\n * @param   {Function}  callback   Method to be called on every visited node.\n */\nfunction siblings(node, callback) {\n  var parentsId = Object.keys(node.parents);\n  for (var i = parentsId.length; i--;) {\n    for (var j = node.parents[parentsId[i]].childRefs.length; j--;) {\n      callback(node.parents[parentsId[i]].childRefs[j]);\n    }\n  }\n  // The root node doesn't have a `parents` property but might have `siblings`.\n  if (node.siblings) {\n    var siblingsId = Object.keys(node.siblings);\n    for (var _i = siblingsId.length; _i--;) {\n      callback(node.siblings[siblingsId[_i]]);\n    }\n  }\n}\n\nvar BAR_CLASS = 'bar';\n\nvar Bar =\n/**\n * Bar constructor\n *\n * @method  constructor\n * @author  Fritz Lekschas\n * @date    2016-09-14\n * @param   {Object}  baseEl    D3 selection of the base element where bars\n *   should be appended to.\n * @param   {Object}  barData   Object with the bar properties.\n * @param   {Object}  nodeData  Object with the node properties.\n * @param   {Object}  visData   Object with the list graph app properties.\n * @param   {Object}  bars      Bars class.\n */\nfunction Bar(baseEl, barData, nodeData, visData, bars) {\n  var _this = this;\n\n  classCallCheck(this, Bar);\n\n  this.data = barData;\n  this.nodeData = nodeData;\n  this.visData = visData;\n  this.bars = bars;\n\n  this.data.x = nodeData.x;\n  this.data.level = nodeData.depth;\n\n  this.height = this.visData.global.row.contentHeight / (this.data.length * 2) - this.visData.global.cell.padding * 2;\n\n  this.activeHeight = this.visData.global.row.contentHeight - 2;\n\n  this.inactiveheight = this.visData.global.cell.padding * 2 - 1;\n\n  this.selection = baseEl.selectAll(BAR_CLASS).data(this.data).enter().append('g').attr('class', function (data) {\n    return BAR_CLASS + ' ' + data.id;\n  }).classed('active', function (data) {\n    return data.id === _this.visData.nodes[_this.nodeData.depth].sortBy;\n  });\n\n  // Local helper method to avoid code duplication.\n  function setupMagnitude(selection) {\n    var _this2 = this;\n\n    var currentSorting = this.visData.nodes[this.nodeData.depth].sortBy;\n\n    selection.attr('d', function (data) {\n      return _this2.bars.generatePath(data, currentSorting);\n    }).classed('bar-magnitude', true);\n  }\n\n  this.selection.append('path').call(setupMagnitude.bind(this));\n};\n\n/**\n * Returns the path for a rounded rectangle\n *\n * Credits go to Mike Bostock: http://bl.ocks.org/mbostock/3468167\n *\n * @method  roundRect\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Number}    x       X coordinate.\n * @param   {Number}    y       Y coordinate.\n * @param   {Number}    width   Width of the rectangle.\n * @param   {Number}    height  Height of the rectangle.\n * @param   {Number}    radius  Radius.\n * @return  {String}            Path string of the rounded rectangle.\n */\nfunction roundRect(x, y, width, height, radius) {\n  var topLeft = radius.topLeft || 0;\n  var topRight = radius.topRight || 0;\n  var bottomLeft = radius.bottomLeft || 0;\n  var bottomRight = radius.bottomRight || 0;\n\n  return 'M' + (x + topLeft) + ',' + y + 'h' + (width - topLeft - topRight) + 'a' + topRight + ',' + topRight + ' 0 0 1 ' + topRight + ',' + topRight + 'v' + (height - (topRight + bottomRight)) + 'a' + bottomRight + ',' + bottomRight + ' 0 0 1 ' + -bottomRight + ',' + bottomRight + 'h' + (bottomLeft - (width - bottomRight)) + 'a' + bottomLeft + ',' + bottomLeft + ' 0 0 1 ' + -bottomLeft + ',' + -bottomLeft + 'v' + (topLeft - (height - bottomLeft)) + 'a' + topLeft + ',' + topLeft + ' 0 0 1 ' + topLeft + ',' + -topLeft + 'z';\n}\n\n/**\n * Creates a path that looks like a drop menu\n *\n * @example\n * The following is an example how to create a drop menu path:\n * ```javascript\n * import { dropMenu } from './charts';\n * const dropMenuPath = dropMenu({\n *   x: 0,\n *   y: 0,\n *   width: 50,\n *   height: 100,\n *   radius: 5,\n *   arrowSize: 5\n * });\n * ```\n *\n * @method  dropMenu\n * @author  Fritz Lekschas\n * @date    2016-03-03\n * @param   {Object}  c  Config object that needs to contain the following\n *   properties: x, y, width, height, radius and arrowSize.\n */\nfunction dropMenu(c) {\n  return 'M' + (c.x + c.radius) + ',' + c.y + 'h' + (c.width - c.radius * 2) + 'a' + c.radius + ',' + c.radius + ' 0 0 1 ' + c.radius + ',' + c.radius + 'v' + (c.height - c.radius * 2) + 'a' + c.radius + ',' + c.radius + ' 0 0 1 ' + -c.radius + ',' + c.radius + 'h' + -(c.width - c.radius * 2 - c.arrowSize * 2) / 2 + 'l' + -c.arrowSize + ',' + c.arrowSize + 'l' + -c.arrowSize + ',' + -c.arrowSize + 'h' + -(c.width - c.radius * 2 - c.arrowSize * 2) / 2 + 'a' + c.radius + ',' + c.radius + ' 0 0 1 ' + -c.radius + ',' + -c.radius + 'v' + (c.radius - (c.height - c.radius)) + 'a' + c.radius + ',' + c.radius + ' 0 0 1 ' + c.radius + ',' + -c.radius + 'z';\n}\n\n// External\n// Internal\nvar BARS_CLASS = 'bars';\n\nvar Bars = function () {\n  /**\n   * [constructor description]\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   * @param   {Object}  baseEl   D3 selection where the group of bars should be\n   *   appended to.\n   * @param   {String}  mode     Display more. Can be either `one` or `two`.\n   * @param   {Object}  visData  Object with the list graph app data.\n   */\n  function Bars(baseEl, mode, visData) {\n    classCallCheck(this, Bars);\n\n    var self = this;\n\n    this.mode = mode;\n    this.visData = visData;\n\n    this.xScale = d3.scaleLinear().domain([0, 1]).range([1, this.visData.global.column.contentWidth - 3]);\n\n    this.baseEl = baseEl.append('g').attr('class', BARS_CLASS);\n\n    this.baseEl.each(function (datum) {\n      new Bar(d3.select(this), datum.data.bars, datum, self.visData, self);\n    });\n  }\n\n  /**\n   * Updates all bar magnitude elements.\n   *\n   * @method  updateAll\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   * @param   {Object}  update  Object with the current data.\n   * @param   {String}  sortBy  Name of the poperty to be sorted by.\n   */\n\n\n  createClass(Bars, [{\n    key: 'updateAll',\n    value: function updateAll(update, sortBy) {\n      var _this = this;\n\n      this.baseEl.selectAll('.bar-magnitude').data(update, function (data) {\n        return data.barId;\n      }).transition().duration(TRANSITION_SEMI_FAST).attr('d', function (data) {\n        return _this.generatePath(data, sortBy);\n      });\n    }\n\n    /**\n     * Update bars when switching the bar mode.\n     *\n     * @method  update\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}  selection  D3 selection\n     * @param   {String}  sortBy     Name of the poperty to be sorted by.\n     */\n\n  }, {\n    key: 'update',\n    value: function update(selection, sortBy) {\n      var _this2 = this;\n\n      selection.each(function (data) {\n        var el = d3.select(this);\n\n        if (data.id === sortBy && !el.classed('active')) {\n          el.classed('active', true);\n          // Ensure that the active bars we are places before any other bar,\n          // thus placing them in the background\n          this.parentNode.insertBefore(this, this.parentNode.children[0]);\n        }\n\n        if (data.id !== sortBy) {\n          el.classed('active', false);\n        }\n      });\n\n      selection.selectAll('.bar-magnitude').transition().duration(TRANSITION_SEMI_FAST).attr('d', function (data) {\n        return _this2.generatePath(data, sortBy);\n      });\n    }\n\n    /**\n     * Switch one and two-bar display mode.\n     *\n     * @method  switchMode\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {String}  mode            Name of the display mode. Can either be\n     *   `one` or `two`.\n     * @param   {String}  currentSorting  Name if the property currently sorted\n     *   by.\n     */\n\n  }, {\n    key: 'switchMode',\n    value: function switchMode(mode, currentSorting) {\n      var _this3 = this;\n\n      if (this.mode !== mode) {\n        if (mode === 'one') {\n          if (currentSorting.global.type) {\n            this.baseEl.selectAll('.bar').selectAll('.bar-magnitude').transition().duration(TRANSITION_SEMI_FAST).attr('d', function (data) {\n              return _this3.generateOneBarPath(data, currentSorting.global.type);\n            });\n          } else {\n            // console.error(\n            //   'Switching magnitude visualization after individual sorting is ' +\n            //   'not supported yet.'\n            // );\n          }\n        }\n\n        if (mode === 'two') {\n          this.baseEl.selectAll('.bar.precision').selectAll('.bar-magnitude').transition().duration(TRANSITION_SEMI_FAST).attr('d', function (data) {\n            return _this3.generateTwoBarsPath(data);\n          });\n\n          this.baseEl.selectAll('.bar.recall').selectAll('.bar-magnitude').transition().duration(TRANSITION_SEMI_FAST).attr('d', function (data) {\n            return _this3.generateTwoBarsPath(data, true);\n          });\n        }\n\n        this.mode = mode;\n      }\n    }\n\n    /**\n     * Helper method to generate path used as a bar.\n     *\n     * @method  generatePath\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}   data             Data object.\n     * @param   {String}   sortBy           Name of the property currently sorted\n     *   by.\n     */\n\n  }, {\n    key: 'generatePath',\n    value: function generatePath(data, sortBy) {\n      if (this.mode === 'two') {\n        return this.generateTwoBarsPath(data);\n      }\n      return this.generateOneBarPath(data, sortBy);\n    }\n\n    /**\n     * Generates a bar when one-bar display mode is active.\n     *\n     * @method  generateOneBarPath\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}   data    Data object.\n     * @param   {String}   sortBy  Name of the property currently sorted by.\n     */\n\n  }, {\n    key: 'generateOneBarPath',\n    value: function generateOneBarPath(data, sortBy) {\n      var height = this.visData.global.row.contentHeight;\n      var normValue = Math.min(data.value, 1) || 0;\n\n      var x = 0;\n      var width = 2;\n\n      var radius = {\n        topLeft: 2,\n        bottomLeft: 2\n      };\n\n      if (data.id !== sortBy) {\n        x = this.xScale(normValue);\n        radius = {};\n      } else {\n        width = this.visData.global.column.contentWidth * normValue;\n      }\n\n      x = Math.min(x, this.visData.global.column.contentWidth - 2);\n\n      return roundRect(x, this.visData.global.row.padding, width, height, radius);\n    }\n\n    /**\n     * Generates a bar when two-bar display mode is active.\n     *\n     * @method  generateTwoBarsPath\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}   data      Data object.\n     * @param   {Boolean}  isBottom  If `true` then the bottom bar should be\n     *   generated.\n     */\n\n  }, {\n    key: 'generateTwoBarsPath',\n    value: function generateTwoBarsPath(data, isBottom) {\n      var normValue = Math.min(data.value, 1);\n      var height = this.visData.global.row.contentHeight / 2;\n      var width = this.visData.global.column.contentWidth * normValue;\n\n      var y = this.visData.global.row.padding;\n      var radius = { topLeft: 2 };\n\n      if (isBottom) {\n        radius = { bottomLeft: 2 };\n        y += height;\n      }\n\n      return roundRect(0, y, width, height, radius);\n    }\n  }]);\n  return Bars;\n}();\n\n// External\n/**\n * Merges multiple distinct D3 selection objects.\n *\n * @description\n * First an empty selection is created by querying for a non-existing element.\n *\n * @method  mergeSelections\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Array}   selections  Array of multiple D3 selection objects.\n * @return  {Object}              Single D3 selection object containing all the\n *   selected elements from `selections`.\n */\nfunction mergeSelections(selections) {\n  // Create a new empty selection\n  var mergedSelection = d3.selectAll('.d3-list-graph-not-existent');\n\n  for (var i = selections.length; i--;) {\n    mergedSelection._groups = mergedSelection._groups.concat(selections[i]._groups);\n  }\n\n  return mergedSelection;\n}\n\n/**\n * Detects when an array of transitions has ended.\n *\n * @method  allTransitionsEnded\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}    transition  D3 transition object.\n * @param   {Function}  callback    Callback function to be triggered when all\n *   transitions have ended.\n */\nfunction allTransitionsEnded(transition, callback) {\n  if (transition.size() === 0) {\n    callback();\n  }\n  var n = 0;\n  transition.each(function () {\n    return ++n;\n  }).on('end', function () {\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (! --n) callback.apply(this, args);\n  });\n}\n\n// External\n// Internal\n/**\n * CSS class name of grou of nodes.\n *\n * @type  {String}\n */\nvar CLASS_NODES = 'nodes';\n\n/**\n * CSS class name of node group.\n *\n * @type  {String}\n */\nvar CLASS_NODE = 'node';\n\n/**\n * CSS class name of visible nodes.\n *\n * @type  {String}\n */\nvar CLASS_NODE_VISIBLE = 'visible-node';\n\n/**\n * CSS class name of cloned nodes.\n *\n * @type  {String}\n */\nvar CLASS_CLONE = 'clone';\n\n/**\n * CSS class name of label wrappers of nodes.\n *\n * @type  {String}\n */\nvar CLASS_LABEL_WRAPPER = 'label-wrapper';\n\n/**\n * CSS class name of focus controls that appear to the left and right of a node\n * when being active.\n *\n * @type  {String}\n */\nvar CLASS_FOCUS_CONTROLS = 'focus-controls';\n\n/**\n * CSS class name of the root focus button.\n *\n * @type  {String}\n */\nvar CLASS_ROOT = 'root';\n\n/**\n * CSS class name of the query focus button.\n *\n * @type  {String}\n */\nvar CLASS_QUERY = 'query';\n\n/**\n * CSS class name of the link indicator.\n *\n * @type  {String}\n */\nvar CLASS_INDICATOR_BAR = 'link-indicator';\n\n/**\n * CSS class name of the link location indicator.\n *\n * @type  {String}\n */\nvar CLASS_INDICATOR_LOCATION = 'link-location-indicator';\n\n/**\n * CSS class name for identifying incoming link location indicators.\n *\n * @type  {String}\n */\nvar CLASS_INDICATOR_INCOMING = 'incoming';\n\n/**\n * CSS class name for identifying outgoing link location indicators.\n *\n * @type  {String}\n */\nvar CLASS_INDICATOR_OUTGOING = 'outgoing';\n\n/**\n * CSS class name for identifying link location indicators above the visible\n * container.\n *\n * @type  {String}\n */\nvar CLASS_INDICATOR_ABOVE = 'above';\n\n/**\n * CSS class name for identifying link location indicators below the visible\n * container.\n *\n * @type  {String}\n */\nvar CLASS_INDICATOR_BELOW = 'below';\n\nvar Nodes = function () {\n  /**\n   * Nodes constructor\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-22\n   * @param   {Object}  vis      List Graph App.\n   * @param   {Object}  baseEl   D3 base selection.\n   * @param   {Object}  visData  List Graph App data.\n   * @param   {Object}  links    Links class.\n   * @param   {Object}  events   Event class.\n   */\n  function Nodes(vis, baseEl, visData, links, events) {\n    var _this = this;\n\n    classCallCheck(this, Nodes);\n\n    var self = this;\n\n    this.vis = vis;\n    this.visData = visData;\n    this.links = links;\n    this.events = events;\n    this.currentLinks = {};\n    this.iconDimension = Math.min(this.visData.global.row.contentHeight / 2 - this.visData.global.cell.padding * 2, this.visData.global.column.padding / 2 - 4);\n\n    var linkDensityBg = d3.scaleLinear().domain([1, this.vis.rows]).range(['#ccc', '#000']);\n\n    function drawLinkIndicator(selection, direction) {\n      var incoming = direction === 'incoming';\n\n      selection.attr('class', CLASS_INDICATOR_BAR + ' ' + (incoming ? CLASS_INDICATOR_INCOMING : CLASS_INDICATOR_OUTGOING)).attr('d', roundRect(incoming ? -7 : this.visData.global.column.contentWidth, this.visData.global.row.height / 2 - 1, 7, 2, {\n        topLeft: incoming ? 1 : 0,\n        topRight: incoming ? 0 : 1,\n        bottomLeft: incoming ? 1 : 0,\n        bottomRight: incoming ? 0 : 1\n      })).attr('fill', function (data) {\n        return linkDensityBg(data.links[direction].refs.length);\n      }).classed('visible', function (data) {\n        return data.links[direction].refs.length > 0;\n      }).style('transform-origin', (incoming ? 0 : this.visData.global.column.contentWidth) + 'px ' + this.visData.global.row.height / 2 + 'px');\n    }\n\n    function drawLinkLocationIndicator(selection, direction, position) {\n      var above = position === 'above';\n      var incoming = direction === 'incoming';\n\n      var className = CLASS_INDICATOR_LOCATION + ' ' + (incoming ? CLASS_INDICATOR_INCOMING : CLASS_INDICATOR_OUTGOING) + ' ' + (above ? CLASS_INDICATOR_ABOVE : CLASS_INDICATOR_BELOW);\n\n      selection.datum(function (data) {\n        return data.links[direction];\n      }).attr('class', className).attr('x', incoming ? -5 : this.visData.global.column.contentWidth + 2).attr('y', above ? this.visData.global.row.height / 2 - 1 : this.visData.global.row.height / 2 + 1).attr('width', 3).attr('height', 0).attr('fill', function (data) {\n        return linkDensityBg(data.refs.length);\n      });\n    }\n\n    // Helper\n    function drawFullSizeRect(selection, className, shrinking, noRoundBorder) {\n      var shrinkingAmount = shrinking || 0;\n\n      selection.attr('x', shrinkingAmount).attr('y', self.visData.global.row.padding + shrinkingAmount).attr('width', self.visData.global.column.contentWidth - 2 * shrinkingAmount).attr('height', self.visData.global.row.contentHeight - 2 * shrinkingAmount).attr('rx', noRoundBorder ? 0 : 2 - shrinkingAmount).attr('ry', noRoundBorder ? 0 : 2 - shrinkingAmount).classed(className, true);\n    }\n\n    function drawMaxSizedRect(selection) {\n      selection.attr('x', 0).attr('y', 0).attr('width', self.visData.global.column.contentWidth).attr('height', self.visData.global.row.height).attr('class', 'invisible-container');\n    }\n\n    this.groups = baseEl.append('g').attr('class', CLASS_NODES).call(function (selection) {\n      selection.each(function storeLinkToGroupNode() {\n        d3.select(this.parentNode).datum().nodes = this;\n      });\n    });\n\n    this.nodes = this.groups.selectAll('.' + CLASS_NODE).data(function (data) {\n      return data.rows;\n    }).enter().append('g').classed(CLASS_NODE, true).classed(CLASS_CLONE, function (data) {\n      return data.clone;\n    }).attr('transform', function (data) {\n      return 'translate(' + (data.x + _this.visData.global.column.padding) + ', ' + data.y + ')';\n    });\n\n    this.nodes.append('rect').call(drawMaxSizedRect);\n\n    this.visNodes = this.nodes.append('g').attr('class', CLASS_NODE_VISIBLE);\n\n    this.visNodes.append('rect').call(drawFullSizeRect, 'bg-border');\n\n    this.visNodes.append('rect').call(drawFullSizeRect, 'bg', 1, true);\n\n    if (this.vis.showLinkLocation) {\n      this.nodes.append('rect').call(drawLinkLocationIndicator.bind(this), 'incoming', 'above');\n      this.nodes.append('rect').call(drawLinkLocationIndicator.bind(this), 'incoming', 'bottom');\n      this.nodes.append('rect').call(drawLinkLocationIndicator.bind(this), 'outgoing', 'above');\n      this.nodes.append('rect').call(drawLinkLocationIndicator.bind(this), 'outgoing', 'bottom');\n\n      this.nodes.append('path').call(drawLinkIndicator.bind(this), 'incoming');\n      this.nodes.append('path').call(drawLinkIndicator.bind(this), 'outgoing');\n\n      // Set all the link location indicator bars.\n      this.groups.each(function (data, index) {\n        _this.calcHeightLinkLocationIndicator(index, true, true);\n      });\n    }\n\n    // Rooting icons\n    var nodeRooted = this.nodes.append('g').attr('class', CLASS_FOCUS_CONTROLS + ' ' + CLASS_ROOT);\n\n    nodeRooted.append('rect').call(this.setUpFocusControls.bind(this), 'left', 0.6, 'hover-helper', 'hover-helper');\n\n    nodeRooted.append('svg').call(this.setUpFocusControls.bind(this), 'left', 0.6, 'icon', 'ease-all state-active invisible-default icon').append('use').attr('xlink:href', this.vis.iconPath + '#locked');\n\n    // Querying icons\n    if (this.vis.querying) {\n      var nodeQuery = this.nodes.append('g').attr('class', CLASS_FOCUS_CONTROLS + ' ' + CLASS_QUERY);\n\n      nodeQuery.append('rect').call(this.setUpFocusControls.bind(this), 'right', 0.6, 'hover-helper', 'hover-helper');\n\n      nodeQuery.append('svg').call(this.setUpFocusControls.bind(this), 'right', 0.6, 'icon', 'ease-all state-and-or invisible-default icon').append('use').attr('xlink:href', this.vis.iconPath + '#union');\n\n      nodeQuery.append('svg').call(this.setUpFocusControls.bind(this), 'right', 0.6, 'icon', 'ease-all state-not invisible-default icon').append('use').attr('xlink:href', this.vis.iconPath + '#not');\n    }\n\n    this.bars = new Bars(this.visNodes, this.vis.barMode, this.visData);\n\n    this.visNodes.append('rect').call(drawFullSizeRect, 'border');\n\n    // Add node label\n    this.visNodes.append('foreignObject').attr('x', this.visData.global.cell.padding).attr('y', this.visData.global.row.padding + this.visData.global.cell.padding).attr('width', this.visData.global.column.contentWidth).attr('height', this.visData.global.row.contentHeight - this.visData.global.cell.padding * 2).attr('class', CLASS_LABEL_WRAPPER).append('xhtml:div').attr('class', 'label').attr('title', function (data) {\n      return data.data.name;\n    }).style('line-height', this.visData.global.row.contentHeight - this.visData.global.cell.padding * 2 + 'px').append('xhtml:span').text(function (data) {\n      return data.data.name;\n    });\n\n    if (isFunction(this.events.on)) {\n      this.events.on('d3ListGraphFocusNodes', function (event$$1) {\n        return _this.focusNodes(event$$1);\n      });\n\n      this.events.on('d3ListGraphBlurNodes', function (event$$1) {\n        return _this.blurNodes(event$$1);\n      });\n\n      this.events.on('d3ListGraphNodeEnter', function (nodeIds) {\n        return _this.eventHelper(nodeIds, _this.highlightNodes);\n      });\n\n      this.events.on('d3ListGraphNodeLeave', function (nodeIds) {\n        return _this.eventHelper(nodeIds, _this.unhighlightNodes);\n      });\n\n      this.events.on('d3ListGraphNodeLock', function (nodeIds) {\n        return _this.eventHelper(nodeIds, _this.toggleLock, []);\n      });\n\n      this.events.on('d3ListGraphNodeUnlock', function (nodeIds) {\n        return _this.eventHelper(nodeIds, _this.toggleLock, [true]);\n      });\n\n      this.events.on('d3ListGraphNodeRoot', function (data) {\n        return _this.eventHelper(data.nodeIds, _this.toggleRoot, [false, true]);\n      });\n\n      this.events.on('d3ListGraphNodeUnroot', function (data) {\n        return _this.eventHelper(data.nodeIds, _this.toggleRoot, [true, true]);\n      });\n    }\n\n    this.nodes.call(this.isInvisible.bind(this));\n  }\n\n  /**\n   * Get the current bar mode.\n   *\n   * @method  barMode\n   * @author  Fritz Lekschas\n   * @date    2016-09-22\n   * @return  {String}  Bar mode string.\n   */\n\n\n  createClass(Nodes, [{\n    key: 'batchQueryHandler',\n\n\n    /**\n     * Handle multiple queries as once.\n     *\n     * @description\n     * Useful when the custom root node is changed as this involves \"un-querying\"\n     * and querying.\n     *\n     * @method  batchQueryHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Array}    els             Array of D3 selections of nodes to be\n     *   queried.\n     * @param   {Boolean}  noNotification  If `true` notifications are suppressed.\n     */\n    value: function batchQueryHandler(els, noNotification) {\n      var actions = [];\n      for (var i = els.length; i--;) {\n        actions.push(this.queryHandler(els[i].d3El, els[i].action, els[i].mode, true));\n      }\n\n      if (!noNotification) {\n        this.events.broadcast('d3ListGraphBatchQuery', actions);\n      }\n    }\n\n    /**\n     * Visually blur a node.\n     *\n     * @method  blurNodes\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}  event  Event object.\n     */\n\n  }, {\n    key: 'blurNodes',\n    value: function blurNodes(event$$1) {\n      this.eventHelper(event$$1.nodeIds, this.unhighlightNodes, ['focus', 'directParentsOnly', !!event$$1.excludeClones]);\n\n      if (event$$1.zoomIn) {\n        this.vis.zoomedView();\n      }\n\n      if (this.tempHidingUnrelatedNodes) {\n        this.hideUnrelatedNodes(undefined, true);\n      }\n    }\n\n    /**\n     * Calculates the height of all incoming or outgoing link location indicators\n     * for a given level.\n     *\n     * @method  calcHeightLinkLocationIndicator\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Number}   level     Index of the level / column.\n     * @param   {Boolean}  outgoing  If `true` outgoing link location indicator\n     *   heights are calculated. Otherwise incoming link location indicator\n     *   heights are calculated.\n     */\n\n  }, {\n    key: 'calcHeightLinkLocationIndicator',\n    value: function calcHeightLinkLocationIndicator(level, outgoing) {\n      var nodes = this.nodes.filter(function (data) {\n        return data.depth === level;\n      });\n      nodes.each(function (data) {\n        if (outgoing) {\n          data.links.outgoing.above = 0;\n          data.links.outgoing.below = 0;\n          for (var i = data.links.outgoing.total; i--;) {\n            // We are checking the target location of the outgoing link. The\n            // source location is the location of the node of the column being\n            // scrolled.\n            if ((data.links.outgoing.refs[i].hidden & 4) > 0) {\n              data.links.outgoing.above++;\n            }\n            if ((data.links.outgoing.refs[i].hidden & 8) > 0) {\n              data.links.outgoing.below++;\n            }\n          }\n        } else {\n          data.links.incoming.above = 0;\n          data.links.incoming.below = 0;\n          for (var _i = data.links.incoming.total; _i--;) {\n            // We are checking the source location of the incoming link. The\n            // source location is the location of the node of the column being\n            // scrolled.\n            if ((data.links.incoming.refs[_i].hidden & 1) > 0) {\n              data.links.incoming.above++;\n            }\n            if ((data.links.incoming.refs[_i].hidden & 2) > 0) {\n              data.links.incoming.below++;\n            }\n          }\n        }\n      });\n\n      if (outgoing) {\n        this.updateHeightLinkLocationIndicatorBars(nodes, true);\n      } else {\n        this.updateHeightLinkLocationIndicatorBars(nodes);\n      }\n    }\n\n    /**\n     * Tests if the event-related node list is identical.\n     *\n     * @method  checkNodeFocusSameEvent\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Array}  nodeIds  Array of node IDs.\n     * @return  {Boolean}         If `true` the event node ID list is identical to\n     *   the current focus node ID list.\n     */\n\n  }, {\n    key: 'checkNodeFocusSameEvent',\n    value: function checkNodeFocusSameEvent(nodeIds) {\n      if (!this.nodeFocusIds) {\n        return false;\n      }\n      if (nodeIds.length !== this.nodeFocusIds.length) {\n        return false;\n      }\n      for (var i = nodeIds.length; i--;) {\n        if (nodeIds[i] !== this.nodeFocusIds[i]) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    /**\n     * Get the CSS class of the node group.\n     *\n     * @method  classNodeVisible\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @return  {String}  CSS name.\n     */\n\n  }, {\n    key: 'enterHandler',\n\n\n    /**\n     * Node _mouse enter_ handler.\n     *\n     * @method  enterHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}  el    DOM element.\n     * @param   {Object}  data  D3 data object of the DOM element.\n     */\n    value: function enterHandler(el, data) {\n      this.highlightNodes(d3.select(el));\n\n      var eventData = {\n        id: data.id,\n        clone: false,\n        clonedFromId: undefined\n      };\n\n      if (data.clone) {\n        eventData.clone = true;\n        eventData.clonedFromId = data.originalNode.id;\n      }\n\n      this.events.broadcast('d3ListGraphNodeEnter', eventData);\n    }\n\n    /**\n     * Event helper.\n     *\n     * @method  eventHelper\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Array}     nodeIds            Array of node IDs.\n     * @param   {Function}  callback           Call back function of the actual\n     *   event.\n     * @param   {Array}     optionalParams     Array of optional parameters to be\n     *   passed to the callback.\n     * @param   {String}    subSelectionClass  Sub-selection of certain elements\n     *   based on a CSS class. The selection will be passed to the callback.\n     */\n\n  }, {\n    key: 'eventHelper',\n    value: function eventHelper(nodeIds, callback, optionalParams, subSelectionClass) {\n      var self = this;\n\n      this.nodes\n      // Filter by node ID\n      .filter(function (data) {\n        return !!~nodeIds.indexOf(data.id);\n      }).each(function triggerCallback() {\n        var d3El = d3.select(this);\n\n        if (subSelectionClass) {\n          d3El = d3El.select(subSelectionClass);\n        }\n\n        callback.apply(self, [d3El].concat(optionalParams || []));\n      });\n    }\n\n    /**\n     * Visually focus a node.\n     *\n     * @method  focusNodes\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}  event  Event object.\n     */\n\n  }, {\n    key: 'focusNodes',\n    value: function focusNodes(event$$1) {\n      var same = this.checkNodeFocusSameEvent(event$$1.nodeIds);\n      if (this.nodeFocusIds && !same) {\n        // Show unrelated nodes first before we hide them again.\n        this.blurNodes({\n          nodeIds: this.nodeFocusIds\n        });\n      }\n\n      this.nodeFocusIds = event$$1.nodeIds;\n\n      this.eventHelper(event$$1.nodeIds, this.highlightNodes, ['focus', 'directParentsOnly', !!event$$1.excludeClones, event$$1.zoomOut || event$$1.hideUnrelatedNodes]);\n\n      if (event$$1.zoomOut) {\n        this.vis.globalView(this.nodes.filter(function (data) {\n          return data.hovering > 0;\n        }));\n      } else {\n        this.vis.zoomedView();\n      }\n\n      if (event$$1.hideUnrelatedNodes) {\n        if (!same || !this.tempHidingUnrelatedNodes) {\n          this.hideUnrelatedNodes(event$$1.nodeIds);\n        }\n      } else if (this.tempHidingUnrelatedNodes) {\n        this.hideUnrelatedNodes(undefined, true);\n      }\n    }\n\n    /**\n     * Helper method to hide nodes.\n     *\n     * @method  hideNodes\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}   data  Node data object.\n     */\n\n  }, {\n    key: 'hideNodes',\n    value: function hideNodes(data) {\n      this.nodesVisibility(data);\n    }\n\n    /**\n     * Hide unrelated nodes temporarily.\n     *\n     * @method  hideUnrelatedNodes\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Array}    nodeIds    Array of node IDs.\n     * @param   {Boolean}  showAgain  If `true` displays hidden nows again.\n     */\n\n  }, {\n    key: 'hideUnrelatedNodes',\n    value: function hideUnrelatedNodes(nodeIds, showAgain) {\n      this.tempHidingUnrelatedNodes = showAgain ? undefined : nodeIds;\n\n      this.nodes.filter(function (data) {\n        return !data.hovering;\n      }).classed('hidden', function (data) {\n        return showAgain ? data._hidden : true;\n      }).each(function (data) {\n        if (showAgain) {\n          // Reset old hiding state\n          data.hidden = data._hidden;\n          data._hidden = undefined;\n        } else {\n          // Store old value for `hidden` temporarily\n          data._hidden = data.hidden;\n          data.hidden = true;\n        }\n      });\n\n      this.updateVisibility();\n    }\n\n    /**\n     * Visually highlight nodes.\n     *\n     * @method  highlightNodes\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}   d3El               D3 selection of the node where to\n     *   start highlighting from.\n     * @param   {String}   className          CSS class name to be assigned to the\n     *   highlighted nodes.\n     * @param   {String}   restriction        Specify a restriction. Currently\n     *   only \"directParentsOnly\" is supported.\n     * @param   {Boolean}  excludeClones      If `true` exclude cloned nodes.\n     * @param   {Boolean}  noVisibilityCheck  If `true` don't check the nodes'\n     *   visibility states.\n     */\n\n  }, {\n    key: 'highlightNodes',\n    value: function highlightNodes(d3El, className, restriction, excludeClones, noVisibilityCheck) {\n      var _this2 = this;\n\n      var self = this;\n      var data = d3El.datum();\n      var nodeId = data.id;\n      var currentNodeData = data.clone ? data.originalNode : data;\n      var includeParents = true;\n      var appliedClassName = className || 'hovering';\n      var includeClones = !excludeClones;\n      var includeChildren = restriction !== 'directParentsOnly';\n\n      // Store link IDs\n      if (!this.currentLinks[appliedClassName]) {\n        this.currentLinks[appliedClassName] = {};\n      }\n      this.currentLinks[appliedClassName][nodeId] = {};\n\n      var currentlyActiveBar = d3El.selectAll('.bar.active .bar-magnitude');\n      if (!currentlyActiveBar.empty()) {\n        currentlyActiveBar = currentlyActiveBar.datum();\n      } else {\n        currentlyActiveBar = undefined;\n      }\n\n      var traverseCallbackUp = function traverseCallbackUp(nodeData, childData) {\n        nodeData.hovering = 2;\n        for (var i = nodeData.links.outgoing.refs.length; i--;) {\n          // Only push direct parent child connections. E.g.\n          // Store: (parent)->(child)\n          // Ignore: (parent)->(siblings of child)\n          if (nodeData.links.outgoing.refs[i].target.node.id === childData.id) {\n            _this2.currentLinks[appliedClassName][nodeId][nodeData.links.outgoing.refs[i].id] = true;\n          }\n        }\n      };\n\n      var traverseCallbackDown = function traverseCallbackDown(nodeData) {\n        nodeData.hovering = 2;\n        for (var i = nodeData.links.outgoing.refs.length; i--;) {\n          _this2.currentLinks[appliedClassName][nodeId][nodeData.links.outgoing.refs[i].id] = true;\n        }\n      };\n\n      if (includeParents && includeChildren) {\n        upAndDown(data.clone ? data.originalNode : data, traverseCallbackUp, traverseCallbackDown, undefined, includeClones);\n      }\n      if (includeParents && !includeChildren) {\n        up(data, traverseCallbackUp, undefined, includeClones);\n      }\n      if (!includeParents && includeChildren) {\n        down(data.clone ? data.originalNode : data, traverseCallbackUp, undefined, includeClones);\n      }\n\n      currentNodeData.hovering = 1;\n\n      if (includeClones) {\n        for (var i = currentNodeData.clones.length; i--;) {\n          currentNodeData.clones[i].hovering = 1;\n        }\n      }\n\n      /**\n       * Helper method to assess the node visibility.\n       *\n       * @method  checkNodeVisibility\n       * @author  Fritz Lekschas\n       * @date    2016-02-25\n       * @param   {Object}  _el    [description]\n       * @param   {Object}  _data  [description]\n       * @return  {Boolean}        If `true` element is hidden.\n       */\n      function checkNodeVisibility(_el, _data) {\n        return noVisibilityCheck || !_data.hidden && !self.vis.isHidden.call(self.vis, _el);\n      }\n\n      /**\n       * Helper method to filter out directly hovered nodes.\n       *\n       * @method  checkNodeDirect\n       * @author  Fritz Lekschas\n       * @date    2016-02-25\n       * @param   {Object}  nodeData  The node's data object.\n       * @return  {Boolean}           If `true` element will not be filtered out.\n       */\n      function checkNodeDirect(nodeData) {\n        return nodeData.hovering === 1 && checkNodeVisibility(this, nodeData);\n      }\n\n      /**\n       * Helper method to filter out indirectly hovered nodes.\n       *\n       * @method  checkNodeIndirect\n       * @author  Fritz Lekschas\n       * @date    2016-02-25\n       * @param   {Object}  nodeData  The node's data object.\n       * @return  {Boolean}           If `true` element will not be filtered out.\n       */\n      function checkNodeIndirect(nodeData) {\n        return nodeData.hovering === 2 && checkNodeVisibility(this, nodeData);\n      }\n\n      this.nodes.filter(checkNodeDirect).classed(appliedClassName + '-directly', true);\n      this.nodes.filter(checkNodeIndirect).classed(appliedClassName + '-indirectly', true);\n\n      this.links.highlight(this.currentLinks[appliedClassName][data.id], true, appliedClassName);\n    }\n\n    /**\n     * Marks nodes as being invisible via assigning a class depending on the\n     * custom scroll top position or the columns scroll top position.\n     *\n     * @method  isInvisible\n     * @author  Fritz Lekschas\n     * @date    2016-09-12\n     * @param   {Object}  selection        D3 selection of nodes to be checked.\n     * @param   {Number}  customScrollTop  Custom scroll top position. Used when\n     *   column is actively scrolled.\n     */\n\n  }, {\n    key: 'isInvisible',\n    value: function isInvisible(selection, customScrollTop) {\n      var _this3 = this;\n\n      selection.classed('invisible', function (data) {\n        var scrollTop = customScrollTop || _this3.visData.nodes[data.depth].scrollTop;\n\n        // Node is right to the visible container\n        if (data.x + _this3.vis.dragged.x >= _this3.vis.width) {\n          return data.invisible = true;\n        }\n        // Node is below the visible container\n        if (data.y + scrollTop >= _this3.vis.height) {\n          return data.invisible = true;\n        }\n        // Node is above the visible container\n        if (data.y + _this3.visData.global.row.height + scrollTop <= 0) {\n          return data.invisible = true;\n        }\n        // Node is left to the visible container\n        if (data.x + _this3.vis.dragged.x + _this3.visData.global.column.width <= 0) {\n          return data.invisible = true;\n        }\n        return data.invisible = false;\n      });\n    }\n\n    /**\n     * Node _mouse leave handler.\n     *\n     * @method  leaveHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}  el    DOM element.\n     * @param   {Object}  data  D3 data object of the DOM element.\n     */\n\n  }, {\n    key: 'leaveHandler',\n    value: function leaveHandler(el, data) {\n      this.unhighlightNodes(d3.select(el));\n\n      var eventData = {\n        id: data.id,\n        clone: false,\n        clonedFromId: undefined\n      };\n\n      if (data.clone) {\n        eventData.clone = true;\n        eventData.clonedFromId = data.originalNode.id;\n      }\n\n      this.events.broadcast('d3ListGraphNodeLeave', eventData);\n    }\n\n    /**\n     * Handler managing visual _lock_ events.\n     *\n     * @method  lockHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}  d3El  D3 selection of the element to be visually locked.\n     */\n\n  }, {\n    key: 'lockHandler',\n    value: function lockHandler(d3El) {\n      var events = this.toggleLock(d3El);\n\n      if (events.locked && events.unlocked) {\n        this.events.broadcast('d3ListGraphNodeLockChange', {\n          lock: {\n            id: events.locked.id,\n            clone: events.locked.clone,\n            clonedFromId: events.locked.clone ? events.locked.originalNode.id : undefined\n          },\n          unlock: {\n            id: events.unlocked.id,\n            clone: events.unlocked.clone,\n            clonedFromId: events.unlocked.clone ? events.unlocked.originalNode.id : undefined\n          }\n        });\n      } else {\n        if (events.locked) {\n          this.events.broadcast('d3ListGraphNodeLock', {\n            id: events.locked.id,\n            clone: events.locked.clone,\n            clonedFromId: events.locked.clone ? events.locked.originalNode.id : undefined\n          });\n        }\n\n        if (events.unlocked) {\n          this.events.broadcast('d3ListGraphNodeUnlock', {\n            id: events.unlocked.id,\n            clone: events.unlocked.clone,\n            clonedFromId: events.unlocked.clone ? events.unlocked.originalNode.id : undefined\n          });\n        }\n      }\n    }\n\n    /**\n     * Lock a node(s) by ID.\n     *\n     * @description\n     * The reason for not just passing the selected node element in the DOM is\n     * because the node might have been cloned. Hence, multiple copies of the same\n     * node exist.\n     *\n     * @method  lockNode\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Number}  id  ID of node(s) to be locked.\n     */\n\n  }, {\n    key: 'lockNode',\n    value: function lockNode(id) {\n      var self = this;\n      var els = this.nodes.filter(function (data) {\n        return data.id === id;\n      });\n\n      els.each(function (data) {\n        self.highlightNodes(d3.select(this), 'lock', undefined);\n        data.data.state.lock = true;\n      });\n    }\n\n    /**\n     * Temporarily make all nodes visible.\n     *\n     * @method  makeAllTempVisible\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Boolean}  unset  If `true` reverts back to the old state of\n     *   visibility.\n     */\n\n  }, {\n    key: 'makeAllTempVisible',\n    value: function makeAllTempVisible(unset) {\n      if (unset) {\n        this.nodes.classed('invisible', function (data) {\n          var prevInvisible = data._invisible;\n          data._invisible = undefined;\n\n          return prevInvisible;\n        });\n      } else {\n        this.nodes.classed('invisible', function (data) {\n          data._invisible = data.invisible;\n          return false;\n        });\n      }\n    }\n\n    /**\n     * Only show the subtree and siblings of the node `data`.\n     *\n     * @method  nodesVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}   data  Node data object.\n     * @param   {Boolean}  show  If `true` nodes will be shown again.\n     */\n\n  }, {\n    key: 'nodesVisibility',\n    value: function nodesVisibility(data, show) {\n      if (show) {\n        this.nodes.classed('hidden', false).each(function (nodeData) {\n          nodeData.hidden = false;\n        });\n      } else {\n        // First we set all nodes to `hidden` except those that are currently\n        // queried for.\n        this.nodes.each(function (nodeData) {\n          nodeData.hidden = !nodeData.data.state.query;\n        });\n\n        // Then we set direct child and parent nodes of the current node visible.\n        upAndDown(data, function (nodeData) {\n          nodeData.hidden = false;\n        });\n\n        // We also show sibling nodes.\n        siblings(data, function (nodeData) {\n          nodeData.hidden = false;\n        });\n\n        // Assign CSS class to actually hide the nodes.\n        this.nodes.classed('hidden', function (nodeData) {\n          return nodeData.hidden;\n        });\n      }\n      this.updateVisibility();\n    }\n\n    /**\n     * Query handler.\n     *\n     * @method  queryHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}   d3El            D3 selection of the node to be inspected.\n     * @param   {String}   action          Specific query action. Can be ['query',\n     *   'unquery', undefined].\n     * @param   {String}   mode            If `action == 'query'`, string name of\n     *   the query mode. Can be [or, and, not].\n     * @param   {Boolean}  noNotification  If `true` notifications are suppressed.\n     */\n\n  }, {\n    key: 'queryHandler',\n    value: function queryHandler(d3El, action, mode, noNotification) {\n      var data = d3El.datum();\n      var previousMode = data.data.state.query;\n      var event$$1 = {};\n\n      if (!previousMode && action === 'unquery') {\n        // We haven't queried anything so there's nothing to \"un-query\".\n        return undefined;\n      }\n\n      switch (action) {\n        case 'query':\n          Nodes.setNodeQueryState(d3El, mode);\n          break;\n        case 'unquery':\n          this.unsetNodeQueryState(d3El);\n          break;\n        default:\n          this.toggleNodeQueryStates(d3El);\n          break;\n      }\n\n      if (data.data.state.query) {\n        if (data.data.state.query !== previousMode) {\n          event$$1.name = 'd3ListGraphNodeQuery';\n          event$$1.data = {\n            id: data.id,\n            clone: data.clone,\n            clonedFromId: data.clone ? data.originalNode.id : undefined,\n            mode: data.data.state.query\n          };\n        }\n      } else {\n        event$$1.name = 'd3ListGraphNodeUnquery';\n        event$$1.data = {\n          id: data.id,\n          clone: data.clone,\n          clonedFromId: data.clone ? data.originalNode.id : undefined\n        };\n      }\n\n      if (event$$1.name && !noNotification) {\n        this.events.broadcast(event$$1.name, event$$1.data);\n      }\n\n      return event$$1.name ? event$$1 : undefined;\n    }\n\n    /**\n     * Handler managing _root_ events.\n     *\n     * @method  rootHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}   d3El    D3 selection of the node to be rooted.\n     * @param   {Boolean}  unroot  If `true` the rooting is resolved.\n     */\n\n  }, {\n    key: 'rootHandler',\n    value: function rootHandler(d3El, unroot) {\n      if (!d3El.datum().data.state.root && unroot) {\n        // The node is not rooted so there's no point in unrooting.\n        return;\n      }\n      var events = this.toggleRoot(d3El, unroot);\n\n      if (events.rooted && events.unrooted) {\n        this.events.broadcast('d3ListGraphNodeReroot', {\n          rooted: {\n            id: events.rooted.id,\n            clone: events.rooted.clone,\n            clonedFromId: events.rooted.clone ? events.rooted.originalNode.id : undefined\n          },\n          unrooted: {\n            id: events.unrooted.id,\n            clone: events.unrooted.clone,\n            clonedFromId: events.unrooted.clone ? events.unrooted.originalNode.id : undefined\n          }\n        });\n      } else {\n        if (events.rooted) {\n          this.events.broadcast('d3ListGraphNodeRoot', {\n            id: events.rooted.id,\n            clone: events.rooted.clone,\n            clonedFromId: events.rooted.clone ? events.rooted.originalNode.id : undefined\n          });\n        }\n\n        if (events.unrooted) {\n          this.events.broadcast('d3ListGraphNodeUnroot', {\n            id: events.unrooted.id,\n            clone: events.unrooted.clone,\n            clonedFromId: events.unrooted.clone ? events.unrooted.originalNode.id : undefined\n          });\n        }\n      }\n    }\n\n    /**\n     * Set the given node as the root.\n     *\n     * @method  rootNode\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}  d3El  D3 selection of the node to be rooted.\n     */\n\n  }, {\n    key: 'rootNode',\n    value: function rootNode(d3El) {\n      var data = d3El.datum();\n\n      data.data.state.root = true;\n      d3El.classed('rooted', true);\n      this.hideNodes(data);\n\n      // Highlight level\n      this.vis.levels.focus(data.depth + this.vis.activeLevel);\n\n      if (!data.data.state.query || data.data.state.query === 'not') {\n        data.data.queryBeforeRooting = false;\n        return {\n          query: true\n        };\n      }\n\n      data.data.queryBeforeRooting = true;\n\n      return {\n        query: false\n      };\n    }\n\n    /**\n     * Set the query state of the node by assign the corresponding CSS class.\n     *\n     * @method  setNodeQueryState\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}  d3El  D3 selection of the node to be inspected.\n     * @param   {String}  mode  Name of the query mode.\n     */\n\n  }, {\n    key: 'setUpFocusControls',\n\n\n    /**\n     * Helper method to create focus controls.\n     *\n     * @method  setUpFocusControls\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}  selection  D3 selection of the node to which the focus\n     *   controls should be added.\n     * @param   {String}  location   Can either be \"left\" or \"right\"\n     * @param   {Number}  position   Amount the focus control is pushed away from\n     *   the node.\n     * @param   {String}  mode       Specifies a helper element like \"bg\" or\n     *   \"hover-helper\".\n     * @param   {String}  className  Class name to be assigned to to the focus\n     *   control.\n     */\n    value: function setUpFocusControls(selection, location, position, mode, className) {\n      var paddedDim = this.iconDimension + 4;\n\n      var x = 0 - paddedDim * (position + 1);\n\n      if (location === 'right') {\n        x = this.visData.global.column.contentWidth + 2 + paddedDim * position;\n      }\n\n      var y = this.visData.global.row.padding + (this.visData.global.row.contentHeight - 2 * this.visData.global.cell.padding) / 4;\n\n      if (mode === 'bg') {\n        selection.attr('class', className).attr('cx', x + this.iconDimension / 2).attr('cy', y + this.iconDimension / 2).attr('r', this.iconDimension * 3 / 4);\n      } else if (mode === 'hover-helper') {\n        selection.attr('class', className).attr('x', x - 4).attr('y', y - 4).attr('width', this.iconDimension + 8).attr('height', this.iconDimension + 8).attr('rx', this.iconDimension).attr('ry', this.iconDimension);\n      } else {\n        selection.attr('class', className).attr('x', x).attr('y', y).attr('width', this.iconDimension).attr('height', this.iconDimension);\n      }\n    }\n\n    /**\n     * Helper method to show nodes.\n     *\n     * @method  showNodes\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     */\n\n  }, {\n    key: 'showNodes',\n    value: function showNodes() {\n      this.nodesVisibility(undefined, true);\n    }\n\n    /**\n     * Visually update the nodes' positions after sorting.\n     *\n     * @method  sort\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}   update       Updated node data object.\n     * @param   {Boolean}  newSortType  If `true` the sort type has changed.\n     */\n\n  }, {\n    key: 'sort',\n    value: function sort(update, newSortType) {\n      var _this4 = this;\n\n      for (var i = update.length; i--;) {\n        var selection = this.nodes.data(update[i].rows, function (data) {\n          return data.id;\n        });\n\n        this.vis.svgD3.classed('sorting', true);\n        selection.transition().duration(TRANSITION_SEMI_FAST).attr('transform', function (data) {\n          return 'translate(' + (data.x + _this4.visData.global.column.padding) + ', ' + data.y + ')';\n        }).call(allTransitionsEnded, function () {\n          _this4.vis.svgD3.classed('sorting', false);\n          _this4.vis.updateLevelsVisibility();\n          _this4.vis.updateScrolling();\n        });\n\n        if (newSortType && this.vis.currentSorting.local[update[i].level].type !== 'name') {\n          this.bars.update(selection.selectAll('.bar'), update[i].sortBy);\n        }\n      }\n    }\n\n    /**\n     * Toggle through the lock state of a node\n     *\n     * @method  toggleLock\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}   d3El         D3 selection of the node to be locked.\n     * @param   {Boolean}  forceUnlock  If `true` forces an unlock.\n     */\n\n  }, {\n    key: 'toggleLock',\n    value: function toggleLock(d3El, forceUnlock) {\n      var data = d3El.datum();\n      var events = { locked: false, unlocked: false };\n\n      if (this.lockedNode) {\n        if (this.lockedNode.datum().id === data.id) {\n          this.unlockNode(this.lockedNode.datum().id);\n          events.unlocked = this.lockedNode.datum();\n          this.lockedNode = undefined;\n        } else {\n          // Reset previously locked node;\n          this.unlockNode(this.lockedNode.datum().id);\n          events.unlocked = this.lockedNode.datum();\n\n          if (!forceUnlock) {\n            this.lockNode(data.id);\n            events.locked = data;\n            this.lockedNode = d3El;\n          }\n        }\n      } else {\n        if (!forceUnlock) {\n          this.lockNode(data.id);\n          events.locked = data;\n          this.lockedNode = d3El;\n        }\n      }\n\n      return events;\n    }\n\n    /**\n     * Toggle through node query states.\n     *\n     * @method  toggleNodeQueryStates\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}  d3El  D3 selection of the node to be inspected.\n     */\n\n  }, {\n    key: 'toggleNodeQueryStates',\n    value: function toggleNodeQueryStates(d3El) {\n      var data = d3El.datum();\n      var previousMode = data.data.state.query;\n\n      if (data.data.state.root) {\n        if (previousMode !== 'or') {\n          Nodes.setNodeQueryState(d3El, 'or');\n        } else {\n          Nodes.setNodeQueryState(d3El, 'and');\n        }\n      } else {\n        switch (previousMode) {\n          case 'or':\n            Nodes.setNodeQueryState(d3El, 'and');\n            break;\n          case 'and':\n            Nodes.setNodeQueryState(d3El, 'not');\n            break;\n          case 'not':\n            this.unsetNodeQueryState(d3El);\n            break;\n          default:\n            Nodes.setNodeQueryState(d3El, 'or');\n            break;\n        }\n      }\n    }\n\n    /**\n     * Toggle root node.\n     *\n     * @method  toggleRoot\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}   d3El            D3 selection of the node to be\n     *   inspected.\n     * @param   {Boolean}  forceUnroot     If `true` the node will be \"un-rooted\".\n     * @param   {Boolean}  noNotification  If `true` notifications are suppressed.\n     */\n\n  }, {\n    key: 'toggleRoot',\n    value: function toggleRoot(d3El, forceUnroot, noNotification) {\n      var data = d3El.datum();\n      var events = { rooted: false, unrooted: false };\n      var queries = [];\n\n      // Blur current levels\n      this.vis.levels.blur();\n\n      if (this.rootedNode) {\n        // Reset current root node\n        this.rootedNode.classed('active', false).classed('inactive', true);\n\n        events.unrooted = this.rootedNode.datum();\n        if (this.unrootNode(this.rootedNode).unquery) {\n          queries.push({\n            d3El: this.rootedNode,\n            action: 'unquery'\n          });\n        }\n\n        // Activate new root\n        if (this.rootedNode.datum().id !== data.id && !forceUnroot) {\n          d3El.classed('active', true).classed('inactive', false);\n\n          this.rootedNode = d3El;\n          events.rooted = d3El.datum();\n          if (this.rootNode(d3El).query) {\n            queries.push({\n              d3El: d3El,\n              action: 'query',\n              mode: 'or'\n            });\n          }\n        } else {\n          this.rootedNode = undefined;\n          // Highlight first level\n          this.vis.levels.focus(this.vis.activeLevel - this.vis.noRootActiveLevelDiff);\n        }\n      } else {\n        if (!forceUnroot) {\n          d3El.classed('active', true).classed('inactive', false);\n\n          this.rootedNode = d3El;\n          events.rooted = d3El.datum();\n          if (this.rootNode(d3El).query) {\n            queries.push({\n              d3El: d3El,\n              action: 'query',\n              mode: 'or'\n            });\n          }\n        }\n      }\n\n      if (queries.length) {\n        this.batchQueryHandler(queries, noNotification);\n      }\n\n      return events;\n    }\n\n    /**\n     * Visually remove the highlighting of nodes.\n     *\n     * @method  unhighlightNodes\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}   d3El           D3 selection of the starting node which\n     *   highlighting should be undone.\n     * @param   {String}   className      CSS class name to be assigned to the\n     *   highlighted nodes.\n     * @param   {String}   restriction    Specify a restriction. Currently\n     *   only \"directParentsOnly\" is supported.\n     * @param   {Boolean}  excludeClones  If `true` exclude cloned nodes.\n     */\n\n  }, {\n    key: 'unhighlightNodes',\n    value: function unhighlightNodes(d3El, className, restriction, excludeClones) {\n      var data = d3El.datum();\n      var traverseCallback = function traverseCallback(nodeData) {\n        nodeData.hovering = 0;\n      };\n      var includeParents = true;\n      var appliedClassName = className || 'hovering';\n      var includeClones = !excludeClones;\n      var includeChildren = restriction !== 'directParentsOnly';\n\n      data.hovering = 0;\n      if (includeParents && includeChildren) {\n        upAndDown(data, traverseCallback, undefined, undefined, includeClones);\n      }\n      if (includeParents && !includeChildren) {\n        up(data, traverseCallback, undefined, includeClones);\n      }\n      if (!includeParents && includeChildren) {\n        down(data, traverseCallback, undefined, includeClones);\n      }\n\n      if (data.clone) {\n        data.originalNode.hovering = 0;\n      } else {\n        if (includeClones) {\n          for (var i = data.clones.length; i--;) {\n            data.clones[i].hovering = 0;\n          }\n        }\n      }\n\n      this.nodes.classed(appliedClassName + '-directly', false);\n      this.nodes.classed(appliedClassName + '-indirectly', false);\n\n      if (this.currentLinks[appliedClassName] && this.currentLinks[appliedClassName][data.id]) {\n        this.links.highlight(this.currentLinks[appliedClassName][data.id], false, appliedClassName);\n      }\n    }\n\n    /**\n     * Unlock node.\n     *\n     * @method  unlockNode\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Number}  id  ID of node(s) to be locked.\n     */\n\n  }, {\n    key: 'unlockNode',\n    value: function unlockNode(id) {\n      var self = this;\n      var els = this.nodes.filter(function (data) {\n        return data.id === id;\n      });\n\n      els.each(function (data) {\n        self.unhighlightNodes(d3.select(this), 'lock', undefined);\n        data.data.state.lock = undefined;\n      });\n    }\n\n    /**\n     * Stop rooting by the given node.\n     *\n     * @method  unrootNode\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}  d3El  D3 selection of the node to be \"un-rooted\".\n     */\n\n  }, {\n    key: 'unrootNode',\n    value: function unrootNode(d3El) {\n      var data = d3El.datum();\n\n      data.data.state.root = false;\n      d3El.classed('rooted', false);\n      this.showNodes();\n\n      if (!data.data.queryBeforeRooting) {\n        return {\n          unquery: true\n        };\n      }\n\n      return {\n        unquery: false\n      };\n    }\n\n    /**\n     * Unset the query state of a node.\n     *\n     * @method  unsetNodeQueryState\n     * @author  Fritz Lekschas\n     * @date    2016-09-23\n     * @param   {Object}  d3El  D3 selection of the node to be inspected.\n     */\n\n  }, {\n    key: 'unsetNodeQueryState',\n    value: function unsetNodeQueryState(d3El) {\n      var data = d3El.datum();\n\n      data.data.state.query = undefined;\n      data.data.queryBeforeRooting = undefined;\n\n      d3El.classed('active', true).classed('inactive', false).classed('query-and', false).classed('query-or', false).classed('query-not', false);\n\n      if (this.rootedNode) {\n        this.hideNodes(this.rootedNode.datum());\n      }\n    }\n\n    /**\n     * Updates the visual appearance of the link location indicators.\n     *\n     * @method  updateHeightLinkLocationIndicatorBars\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Object}   selection  D3 selection of the corresponding nodes.\n     * @param   {Boolean}  outgoing   If `true` outgoing link location indicator\n     *   heights are updated. Otherwise incoming link location indicator\n     *   heights are updated.\n     */\n\n  }, {\n    key: 'updateHeightLinkLocationIndicatorBars',\n    value: function updateHeightLinkLocationIndicatorBars(selection, outgoing) {\n      var barRefHeight = this.visData.global.row.contentHeight / 2 - 1;\n      var barAboveRefTop = this.visData.global.row.height / 2 - 1;\n\n      var baseClassName = '.' + CLASS_INDICATOR_LOCATION + '.' + (outgoing ? CLASS_INDICATOR_OUTGOING : CLASS_INDICATOR_INCOMING);\n\n      selection.selectAll(baseClassName + '.' + CLASS_INDICATOR_ABOVE).attr('y', function (data) {\n        return data.total ? barAboveRefTop - data.above / data.total * barRefHeight : barAboveRefTop;\n      }).attr('height', function (data) {\n        return data.total ? data.above / data.total * barRefHeight : 0;\n      });\n\n      selection.selectAll(baseClassName + '.' + CLASS_INDICATOR_BELOW).attr('height', function (data) {\n        return data.total ? data.below / data.total * barRefHeight : 0;\n      });\n    }\n\n    /**\n     * Update the link location indicators.\n     *\n     * @description\n     * Updates the link location indicators of level / column `right` - `left`.\n     *\n     * @method  updateLinkLocationIndicators\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @param   {Number}  left   Index of the column to the left.\n     * @param   {Number}  right  Index of the right column.\n     */\n\n  }, {\n    key: 'updateLinkLocationIndicators',\n    value: function updateLinkLocationIndicators(left, right) {\n      this.calcHeightLinkLocationIndicator(left, true);\n      this.calcHeightLinkLocationIndicator(right);\n    }\n\n    /**\n     * Updates the nodes' visibility visually.\n     *\n     * @method  updateVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-02-21\n     */\n\n  }, {\n    key: 'updateVisibility',\n    value: function updateVisibility() {\n      var _this5 = this;\n\n      // Calls the D3 list graph layout method to update the nodes position.\n      this.vis.layout.updateNodesVisibility();\n\n      // Transition to the updated position\n      this.nodes.transition().duration(TRANSITION_SEMI_FAST).attr('transform', function (data) {\n        return 'translate(' + (data.x + _this5.visData.global.column.padding) + ', ' + data.y + ')';\n      }).call(allTransitionsEnded, function () {\n        _this5.vis.updateLevelsVisibility();\n        _this5.vis.updateScrolling();\n        _this5.nodes.call(_this5.isInvisible.bind(_this5));\n      });\n\n      this.vis.links.updateVisibility();\n    }\n  }, {\n    key: 'barMode',\n    get: function get() {\n      return this.bars.mode;\n    }\n  }], [{\n    key: 'setNodeQueryState',\n    value: function setNodeQueryState(d3El, mode) {\n      d3El.datum().data.state.query = mode;\n      d3El.classed('active', true).classed('inactive', false).classed('query-and', mode === 'and').classed('query-or', mode === 'or').classed('query-not', mode === 'not');\n    }\n  }, {\n    key: 'classNodeVisible',\n    get: function get() {\n      return CLASS_NODE_VISIBLE;\n    }\n\n    /**\n     * Get the CSS class of focus controls.\n     *\n     * @method  classFocusControls\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @return  {String}  CSS name.\n     */\n\n  }, {\n    key: 'classFocusControls',\n    get: function get() {\n      return CLASS_FOCUS_CONTROLS;\n    }\n\n    /**\n     * Get the CSS class of root elements.\n     *\n     * @method  classRoot\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @return  {String}  CSS name.\n     */\n\n  }, {\n    key: 'classRoot',\n    get: function get() {\n      return CLASS_ROOT;\n    }\n\n    /**\n     * Get the CSS class of query button..\n     *\n     * @method  classQuery\n     * @author  Fritz Lekschas\n     * @date    2016-09-22\n     * @return  {String}  CSS name.\n     */\n\n  }, {\n    key: 'classQuery',\n    get: function get() {\n      return CLASS_QUERY;\n    }\n  }]);\n  return Nodes;\n}();\n\n// External\n// Internal\n/**\n * Class name of scrollbar elements.\n *\n * @type  {String}\n */\nvar SCROLLBAR_CLASS = 'scrollbar';\n\nvar Scrollbars = function () {\n  /**\n   * [constructor description]\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   * @param   {Object}  baseEl   D3 selection of the element where the\n   *   scrollbars should be appended to.\n   * @param   {Object}  visData  List Graph App's data.\n   * @param   {Number}  width    Width of the scrollbar in pixels.\n   */\n  function Scrollbars(baseEl, visData, width) {\n    classCallCheck(this, Scrollbars);\n\n    this.visData = visData;\n    this.width = width;\n\n    // Add empty scrollbar element\n    this.all = baseEl.append('rect').attr('class', SCROLLBAR_CLASS).call(function (selection) {\n      selection.each(function setScrollBarDomElement() {\n        d3.select(this.parentNode).datum().scrollbar.el = this;\n      });\n    }).attr('x', function (data) {\n      return data.scrollbar.x - 2;\n    }).attr('y', function (data) {\n      return data.scrollbar.y;\n    }).attr('width', this.width).attr('height', function (data) {\n      return data.scrollbar.height;\n    }).attr('rx', this.width / 2).attr('ry', this.width / 2).classed('ready', true);\n  }\n\n  /**\n   * Update the viisual state of the scrollbar given the current data.\n   *\n   * @method  updateVisibility\n   * @author  Fritz Lekschas\n   * @date    2016-09-14\n   */\n\n\n  createClass(Scrollbars, [{\n    key: 'updateVisibility',\n    value: function updateVisibility() {\n      this.all.transition().duration(TRANSITION_LIGHTNING_FAST).attr('x', function (data) {\n        return data.scrollbar.x;\n      }).attr('height', function (data) {\n        return data.scrollbar.height;\n      });\n    }\n  }]);\n  return Scrollbars;\n}();\n\n// External\n// Internal\nvar Events = function () {\n  function Events(el, broadcast) {\n    classCallCheck(this, Events);\n\n    if (broadcast && !isFunction(broadcast)) {\n      throw new EventDispatcherNoFunction();\n    }\n\n    this.el = el;\n    this._stack = {};\n    this.dispatch = broadcast || this._dispatchEvent;\n  }\n\n  createClass(Events, [{\n    key: '_dispatchEvent',\n    value: function _dispatchEvent(eventName, data) {\n      var event$$1 = document.createEvent('CustomEvent');\n      event$$1.initCustomEvent(eventName, false, false, data);\n      this.el.dispatchEvent(event$$1);\n    }\n  }, {\n    key: 'broadcast',\n    value: function broadcast(event$$1, data) {\n      this.dispatch(event$$1, data);\n    }\n\n    /**\n     * Add a callback function to an event stack.\n     *\n     * @method  on\n     * @author  Fritz Lekschas\n     * @date    2016-01-07\n     *\n     * @param   {String}    event     Event identifier.\n     * @param   {Function}  callback  Function which is called when the event\n     *   stack is triggered.\n     * @param   {Number}    times     Number of times the callback function should\n     *   be triggered before it is removed from the event stack. This is useful\n     *   when an event happens only a certain number of times.\n     * @return  {Number}              Index of callback, which is needed to\n     *   manually remove the callback from the event stack.\n     */\n\n  }, {\n    key: 'on',\n    value: function on(event$$1, callback, times) {\n      if (!isFunction(callback)) {\n        return false;\n      }\n\n      var normTimes = isFinite(times) ? parseInt(times, 10) : Infinity;\n\n      if (isArray(this.stack[event$$1])) {\n        return this.stack[event$$1].push({ callback: callback, times: normTimes }) - 1;\n      }\n      this.stack[event$$1] = [{ callback: callback, times: normTimes }];\n      return 0;\n    }\n\n    /**\n     * Removes a callback function from an event stack given its index.\n     *\n     * @method  off\n     * @author  Fritz Lekschas\n     * @date    2016-01-07\n     *\n     * @param   {String}   event  Event identifier.\n     * @param   {Number}   index  Index of the callback to be removed.\n     * @return  {Boolean}         Returns `true` if event callback was found and\n     *   successfully removed.\n     */\n\n  }, {\n    key: 'off',\n    value: function off(event$$1, index) {\n      try {\n        this.stack[event$$1].splice(index, 1);\n        return true;\n      } catch (e) {\n        return false;\n      }\n    }\n\n    /**\n     * Trigger an event stack\n     *\n     * @method  trigger\n     * @author  Fritz Lekschas\n     * @date    2016-01-07\n     *\n     * @param   {String}   event  Event identifier.\n     * @return  {Boolean}         Returns `true` if an event stack was found.\n     */\n\n  }, {\n    key: 'trigger',\n    value: function trigger(event$$1, data) {\n      if (isArray(this.stack[event$$1])) {\n        // Traversing from the end to the start, which has the advantage that\n        // deletion of events, i.e. calling `Event.off()` doesn't affect the index\n        // of event listeners in the next step.\n        for (var i = this.stack[event$$1].length; i--;) {\n          // Instead of checking whether `stack[event][i]` is a function here,\n          // we do it just once when we add the function to the stack.\n          if (this.stack[event$$1][i].times--) {\n            this.stack[event$$1][i].callback(data);\n          } else {\n            this.off(event$$1, i);\n          }\n        }\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: 'stack',\n    get: function get() {\n      return this._stack;\n    }\n  }]);\n  return Events;\n}();\n\nfunction objectOrFunction(x) {\n  return typeof x === 'function' || (typeof x === 'object' && x !== null);\n}\n\nfunction isFunction$2(x) {\n  return typeof x === 'function';\n}\n\n\n\nvar _isArray;\nif (!Array.isArray) {\n  _isArray = function (x) {\n    return Object.prototype.toString.call(x) === '[object Array]';\n  };\n} else {\n  _isArray = Array.isArray;\n}\n\nvar isArray$2 = _isArray;\n\nvar len = 0;\nvar vertxNext;\nvar customSchedulerFn;\n\nvar asap = function asap(callback, arg) {\n  queue[len] = callback;\n  queue[len + 1] = arg;\n  len += 2;\n  if (len === 2) {\n    // If len is 2, that means that we need to schedule an async flush.\n    // If additional callbacks are queued before the queue is flushed, they\n    // will be processed by this flush that we are scheduling.\n    if (customSchedulerFn) {\n      customSchedulerFn(flush);\n    } else {\n      scheduleFlush();\n    }\n  }\n}\n\nfunction setScheduler(scheduleFn) {\n  customSchedulerFn = scheduleFn;\n}\n\nfunction setAsap(asapFn) {\n  asap = asapFn;\n}\n\nvar browserWindow = (typeof window !== 'undefined') ? window : undefined;\nvar browserGlobal = browserWindow || {};\nvar BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\nvar isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';\n\n// test for web worker but not in IE10\nvar isWorker = typeof Uint8ClampedArray !== 'undefined' &&\n  typeof importScripts !== 'undefined' &&\n  typeof MessageChannel !== 'undefined';\n\n// node\nfunction useNextTick() {\n  // node version 0.10.x displays a deprecation warning when nextTick is used recursively\n  // see https://github.com/cujojs/when/issues/410 for details\n  return function() {\n    process.nextTick(flush);\n  };\n}\n\n// vertx\nfunction useVertxTimer() {\n  return function() {\n    vertxNext(flush);\n  };\n}\n\nfunction useMutationObserver() {\n  var iterations = 0;\n  var observer = new BrowserMutationObserver(flush);\n  var node = document.createTextNode('');\n  observer.observe(node, { characterData: true });\n\n  return function() {\n    node.data = (iterations = ++iterations % 2);\n  };\n}\n\n// web worker\nfunction useMessageChannel() {\n  var channel = new MessageChannel();\n  channel.port1.onmessage = flush;\n  return function () {\n    channel.port2.postMessage(0);\n  };\n}\n\nfunction useSetTimeout() {\n  return function() {\n    setTimeout(flush, 1);\n  };\n}\n\nvar queue = new Array(1000);\nfunction flush() {\n  for (var i = 0; i < len; i+=2) {\n    var callback = queue[i];\n    var arg = queue[i+1];\n\n    callback(arg);\n\n    queue[i] = undefined;\n    queue[i+1] = undefined;\n  }\n\n  len = 0;\n}\n\nfunction attemptVertx() {\n  try {\n    var r = require;\n    var vertx = r('vertx');\n    vertxNext = vertx.runOnLoop || vertx.runOnContext;\n    return useVertxTimer();\n  } catch(e) {\n    return useSetTimeout();\n  }\n}\n\nvar scheduleFlush;\n// Decide what async method to use to triggering processing of queued callbacks:\nif (isNode) {\n  scheduleFlush = useNextTick();\n} else if (BrowserMutationObserver) {\n  scheduleFlush = useMutationObserver();\n} else if (isWorker) {\n  scheduleFlush = useMessageChannel();\n} else if (browserWindow === undefined && typeof require === 'function') {\n  scheduleFlush = attemptVertx();\n} else {\n  scheduleFlush = useSetTimeout();\n}\n\nfunction then(onFulfillment, onRejection) {\n  var parent = this;\n\n  var child = new this.constructor(noop);\n\n  if (child[PROMISE_ID] === undefined) {\n    makePromise(child);\n  }\n\n  var state = parent._state;\n\n  if (state) {\n    var callback = arguments[state - 1];\n    asap(function(){\n      invokeCallback(state, child, callback, parent._result);\n    });\n  } else {\n    subscribe(parent, child, onFulfillment, onRejection);\n  }\n\n  return child;\n}\n\n/**\n  `Promise.resolve` returns a promise that will become resolved with the\n  passed `value`. It is shorthand for the following:\n\n  ```javascript\n  var promise = new Promise(function(resolve, reject){\n    resolve(1);\n  });\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = Promise.resolve(1);\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  @method resolve\n  @static\n  @param {Any} value value that the returned promise will be resolved with\n  Useful for tooling.\n  @return {Promise} a promise that will become fulfilled with the given\n  `value`\n*/\nfunction resolve$1(object) {\n  /*jshint validthis:true */\n  var Constructor = this;\n\n  if (object && typeof object === 'object' && object.constructor === Constructor) {\n    return object;\n  }\n\n  var promise = new Constructor(noop);\n  resolve(promise, object);\n  return promise;\n}\n\nvar PROMISE_ID = Math.random().toString(36).substring(16);\n\nfunction noop() {}\n\nvar PENDING   = void 0;\nvar FULFILLED = 1;\nvar REJECTED  = 2;\n\nvar GET_THEN_ERROR = new ErrorObject();\n\nfunction selfFulfillment() {\n  return new TypeError(\"You cannot resolve a promise with itself\");\n}\n\nfunction cannotReturnOwn() {\n  return new TypeError('A promises callback cannot return that same promise.');\n}\n\nfunction getThen(promise) {\n  try {\n    return promise.then;\n  } catch(error) {\n    GET_THEN_ERROR.error = error;\n    return GET_THEN_ERROR;\n  }\n}\n\nfunction tryThen(then$$1, value, fulfillmentHandler, rejectionHandler) {\n  try {\n    then$$1.call(value, fulfillmentHandler, rejectionHandler);\n  } catch(e) {\n    return e;\n  }\n}\n\nfunction handleForeignThenable(promise, thenable, then$$1) {\n   asap(function(promise) {\n    var sealed = false;\n    var error = tryThen(then$$1, thenable, function(value) {\n      if (sealed) { return; }\n      sealed = true;\n      if (thenable !== value) {\n        resolve(promise, value);\n      } else {\n        fulfill(promise, value);\n      }\n    }, function(reason) {\n      if (sealed) { return; }\n      sealed = true;\n\n      reject(promise, reason);\n    }, 'Settle: ' + (promise._label || ' unknown promise'));\n\n    if (!sealed && error) {\n      sealed = true;\n      reject(promise, error);\n    }\n  }, promise);\n}\n\nfunction handleOwnThenable(promise, thenable) {\n  if (thenable._state === FULFILLED) {\n    fulfill(promise, thenable._result);\n  } else if (thenable._state === REJECTED) {\n    reject(promise, thenable._result);\n  } else {\n    subscribe(thenable, undefined, function(value) {\n      resolve(promise, value);\n    }, function(reason) {\n      reject(promise, reason);\n    });\n  }\n}\n\nfunction handleMaybeThenable(promise, maybeThenable, then$$1) {\n  if (maybeThenable.constructor === promise.constructor &&\n      then$$1 === then &&\n      constructor.resolve === resolve$1) {\n    handleOwnThenable(promise, maybeThenable);\n  } else {\n    if (then$$1 === GET_THEN_ERROR) {\n      reject(promise, GET_THEN_ERROR.error);\n    } else if (then$$1 === undefined) {\n      fulfill(promise, maybeThenable);\n    } else if (isFunction$2(then$$1)) {\n      handleForeignThenable(promise, maybeThenable, then$$1);\n    } else {\n      fulfill(promise, maybeThenable);\n    }\n  }\n}\n\nfunction resolve(promise, value) {\n  if (promise === value) {\n    reject(promise, selfFulfillment());\n  } else if (objectOrFunction(value)) {\n    handleMaybeThenable(promise, value, getThen(value));\n  } else {\n    fulfill(promise, value);\n  }\n}\n\nfunction publishRejection(promise) {\n  if (promise._onerror) {\n    promise._onerror(promise._result);\n  }\n\n  publish(promise);\n}\n\nfunction fulfill(promise, value) {\n  if (promise._state !== PENDING) { return; }\n\n  promise._result = value;\n  promise._state = FULFILLED;\n\n  if (promise._subscribers.length !== 0) {\n    asap(publish, promise);\n  }\n}\n\nfunction reject(promise, reason) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = REJECTED;\n  promise._result = reason;\n\n  asap(publishRejection, promise);\n}\n\nfunction subscribe(parent, child, onFulfillment, onRejection) {\n  var subscribers = parent._subscribers;\n  var length = subscribers.length;\n\n  parent._onerror = null;\n\n  subscribers[length] = child;\n  subscribers[length + FULFILLED] = onFulfillment;\n  subscribers[length + REJECTED]  = onRejection;\n\n  if (length === 0 && parent._state) {\n    asap(publish, parent);\n  }\n}\n\nfunction publish(promise) {\n  var subscribers = promise._subscribers;\n  var settled = promise._state;\n\n  if (subscribers.length === 0) { return; }\n\n  var child, callback, detail = promise._result;\n\n  for (var i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    if (child) {\n      invokeCallback(settled, child, callback, detail);\n    } else {\n      callback(detail);\n    }\n  }\n\n  promise._subscribers.length = 0;\n}\n\nfunction ErrorObject() {\n  this.error = null;\n}\n\nvar TRY_CATCH_ERROR = new ErrorObject();\n\nfunction tryCatch(callback, detail) {\n  try {\n    return callback(detail);\n  } catch(e) {\n    TRY_CATCH_ERROR.error = e;\n    return TRY_CATCH_ERROR;\n  }\n}\n\nfunction invokeCallback(settled, promise, callback, detail) {\n  var hasCallback = isFunction$2(callback),\n      value, error, succeeded, failed;\n\n  if (hasCallback) {\n    value = tryCatch(callback, detail);\n\n    if (value === TRY_CATCH_ERROR) {\n      failed = true;\n      error = value.error;\n      value = null;\n    } else {\n      succeeded = true;\n    }\n\n    if (promise === value) {\n      reject(promise, cannotReturnOwn());\n      return;\n    }\n\n  } else {\n    value = detail;\n    succeeded = true;\n  }\n\n  if (promise._state !== PENDING) {\n    // noop\n  } else if (hasCallback && succeeded) {\n    resolve(promise, value);\n  } else if (failed) {\n    reject(promise, error);\n  } else if (settled === FULFILLED) {\n    fulfill(promise, value);\n  } else if (settled === REJECTED) {\n    reject(promise, value);\n  }\n}\n\nfunction initializePromise(promise, resolver) {\n  try {\n    resolver(function resolvePromise(value){\n      resolve(promise, value);\n    }, function rejectPromise(reason) {\n      reject(promise, reason);\n    });\n  } catch(e) {\n    reject(promise, e);\n  }\n}\n\nvar id = 0;\nfunction nextId() {\n  return id++;\n}\n\nfunction makePromise(promise) {\n  promise[PROMISE_ID] = id++;\n  promise._state = undefined;\n  promise._result = undefined;\n  promise._subscribers = [];\n}\n\nfunction Enumerator$1(Constructor, input) {\n  this._instanceConstructor = Constructor;\n  this.promise = new Constructor(noop);\n\n  if (!this.promise[PROMISE_ID]) {\n    makePromise(this.promise);\n  }\n\n  if (isArray$2(input)) {\n    this._input     = input;\n    this.length     = input.length;\n    this._remaining = input.length;\n\n    this._result = new Array(this.length);\n\n    if (this.length === 0) {\n      fulfill(this.promise, this._result);\n    } else {\n      this.length = this.length || 0;\n      this._enumerate();\n      if (this._remaining === 0) {\n        fulfill(this.promise, this._result);\n      }\n    }\n  } else {\n    reject(this.promise, validationError());\n  }\n}\n\nfunction validationError() {\n  return new Error('Array Methods must be provided an Array');\n}\n\nEnumerator$1.prototype._enumerate = function() {\n  var length  = this.length;\n  var input   = this._input;\n\n  for (var i = 0; this._state === PENDING && i < length; i++) {\n    this._eachEntry(input[i], i);\n  }\n};\n\nEnumerator$1.prototype._eachEntry = function(entry, i) {\n  var c = this._instanceConstructor;\n  var resolve$$1 = c.resolve;\n\n  if (resolve$$1 === resolve$1) {\n    var then$$1 = getThen(entry);\n\n    if (then$$1 === then &&\n        entry._state !== PENDING) {\n      this._settledAt(entry._state, i, entry._result);\n    } else if (typeof then$$1 !== 'function') {\n      this._remaining--;\n      this._result[i] = entry;\n    } else if (c === Promise$2) {\n      var promise = new c(noop);\n      handleMaybeThenable(promise, entry, then$$1);\n      this._willSettleAt(promise, i);\n    } else {\n      this._willSettleAt(new c(function(resolve$$1) { resolve$$1(entry); }), i);\n    }\n  } else {\n    this._willSettleAt(resolve$$1(entry), i);\n  }\n};\n\nEnumerator$1.prototype._settledAt = function(state, i, value) {\n  var promise = this.promise;\n\n  if (promise._state === PENDING) {\n    this._remaining--;\n\n    if (state === REJECTED) {\n      reject(promise, value);\n    } else {\n      this._result[i] = value;\n    }\n  }\n\n  if (this._remaining === 0) {\n    fulfill(promise, this._result);\n  }\n};\n\nEnumerator$1.prototype._willSettleAt = function(promise, i) {\n  var enumerator = this;\n\n  subscribe(promise, undefined, function(value) {\n    enumerator._settledAt(FULFILLED, i, value);\n  }, function(reason) {\n    enumerator._settledAt(REJECTED, i, reason);\n  });\n};\n\n/**\n  `Promise.all` accepts an array of promises, and returns a new promise which\n  is fulfilled with an array of fulfillment values for the passed promises, or\n  rejected with the reason of the first passed promise to be rejected. It casts all\n  elements of the passed iterable to promises as it runs this algorithm.\n\n  Example:\n\n  ```javascript\n  var promise1 = resolve(1);\n  var promise2 = resolve(2);\n  var promise3 = resolve(3);\n  var promises = [ promise1, promise2, promise3 ];\n\n  Promise.all(promises).then(function(array){\n    // The array here would be [ 1, 2, 3 ];\n  });\n  ```\n\n  If any of the `promises` given to `all` are rejected, the first promise\n  that is rejected will be given as an argument to the returned promises's\n  rejection handler. For example:\n\n  Example:\n\n  ```javascript\n  var promise1 = resolve(1);\n  var promise2 = reject(new Error(\"2\"));\n  var promise3 = reject(new Error(\"3\"));\n  var promises = [ promise1, promise2, promise3 ];\n\n  Promise.all(promises).then(function(array){\n    // Code here never runs because there are rejected promises!\n  }, function(error) {\n    // error.message === \"2\"\n  });\n  ```\n\n  @method all\n  @static\n  @param {Array} entries array of promises\n  @param {String} label optional string for labeling the promise.\n  Useful for tooling.\n  @return {Promise} promise that is fulfilled when all `promises` have been\n  fulfilled, or rejected if any of them become rejected.\n  @static\n*/\nfunction all(entries) {\n  return new Enumerator$1(this, entries).promise;\n}\n\n/**\n  `Promise.race` returns a new promise which is settled in the same way as the\n  first passed promise to settle.\n\n  Example:\n\n  ```javascript\n  var promise1 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve('promise 1');\n    }, 200);\n  });\n\n  var promise2 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve('promise 2');\n    }, 100);\n  });\n\n  Promise.race([promise1, promise2]).then(function(result){\n    // result === 'promise 2' because it was resolved before promise1\n    // was resolved.\n  });\n  ```\n\n  `Promise.race` is deterministic in that only the state of the first\n  settled promise matters. For example, even if other promises given to the\n  `promises` array argument are resolved, but the first settled promise has\n  become rejected before the other promises became fulfilled, the returned\n  promise will become rejected:\n\n  ```javascript\n  var promise1 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve('promise 1');\n    }, 200);\n  });\n\n  var promise2 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      reject(new Error('promise 2'));\n    }, 100);\n  });\n\n  Promise.race([promise1, promise2]).then(function(result){\n    // Code here never runs\n  }, function(reason){\n    // reason.message === 'promise 2' because promise 2 became rejected before\n    // promise 1 became fulfilled\n  });\n  ```\n\n  An example real-world use case is implementing timeouts:\n\n  ```javascript\n  Promise.race([ajax('foo.json'), timeout(5000)])\n  ```\n\n  @method race\n  @static\n  @param {Array} promises array of promises to observe\n  Useful for tooling.\n  @return {Promise} a promise which settles in the same way as the first passed\n  promise to settle.\n*/\nfunction race(entries) {\n  /*jshint validthis:true */\n  var Constructor = this;\n\n  if (!isArray$2(entries)) {\n    return new Constructor(function(resolve, reject) {\n      reject(new TypeError('You must pass an array to race.'));\n    });\n  } else {\n    return new Constructor(function(resolve, reject) {\n      var length = entries.length;\n      for (var i = 0; i < length; i++) {\n        Constructor.resolve(entries[i]).then(resolve, reject);\n      }\n    });\n  }\n}\n\n/**\n  `Promise.reject` returns a promise rejected with the passed `reason`.\n  It is shorthand for the following:\n\n  ```javascript\n  var promise = new Promise(function(resolve, reject){\n    reject(new Error('WHOOPS'));\n  });\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = Promise.reject(new Error('WHOOPS'));\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  @method reject\n  @static\n  @param {Any} reason value that the returned promise will be rejected with.\n  Useful for tooling.\n  @return {Promise} a promise rejected with the given `reason`.\n*/\nfunction reject$1(reason) {\n  /*jshint validthis:true */\n  var Constructor = this;\n  var promise = new Constructor(noop);\n  reject(promise, reason);\n  return promise;\n}\n\nfunction needsResolver() {\n  throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n}\n\nfunction needsNew() {\n  throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n}\n\n/**\n  Promise objects represent the eventual result of an asynchronous operation. The\n  primary way of interacting with a promise is through its `then` method, which\n  registers callbacks to receive either a promise's eventual value or the reason\n  why the promise cannot be fulfilled.\n\n  Terminology\n  -----------\n\n  - `promise` is an object or function with a `then` method whose behavior conforms to this specification.\n  - `thenable` is an object or function that defines a `then` method.\n  - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).\n  - `exception` is a value that is thrown using the throw statement.\n  - `reason` is a value that indicates why a promise was rejected.\n  - `settled` the final resting state of a promise, fulfilled or rejected.\n\n  A promise can be in one of three states: pending, fulfilled, or rejected.\n\n  Promises that are fulfilled have a fulfillment value and are in the fulfilled\n  state.  Promises that are rejected have a rejection reason and are in the\n  rejected state.  A fulfillment value is never a thenable.\n\n  Promises can also be said to *resolve* a value.  If this value is also a\n  promise, then the original promise's settled state will match the value's\n  settled state.  So a promise that *resolves* a promise that rejects will\n  itself reject, and a promise that *resolves* a promise that fulfills will\n  itself fulfill.\n\n\n  Basic Usage:\n  ------------\n\n  ```js\n  var promise = new Promise(function(resolve, reject) {\n    // on success\n    resolve(value);\n\n    // on failure\n    reject(reason);\n  });\n\n  promise.then(function(value) {\n    // on fulfillment\n  }, function(reason) {\n    // on rejection\n  });\n  ```\n\n  Advanced Usage:\n  ---------------\n\n  Promises shine when abstracting away asynchronous interactions such as\n  `XMLHttpRequest`s.\n\n  ```js\n  function getJSON(url) {\n    return new Promise(function(resolve, reject){\n      var xhr = new XMLHttpRequest();\n\n      xhr.open('GET', url);\n      xhr.onreadystatechange = handler;\n      xhr.responseType = 'json';\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send();\n\n      function handler() {\n        if (this.readyState === this.DONE) {\n          if (this.status === 200) {\n            resolve(this.response);\n          } else {\n            reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));\n          }\n        }\n      };\n    });\n  }\n\n  getJSON('/posts.json').then(function(json) {\n    // on fulfillment\n  }, function(reason) {\n    // on rejection\n  });\n  ```\n\n  Unlike callbacks, promises are great composable primitives.\n\n  ```js\n  Promise.all([\n    getJSON('/posts'),\n    getJSON('/comments')\n  ]).then(function(values){\n    values[0] // => postsJSON\n    values[1] // => commentsJSON\n\n    return values;\n  });\n  ```\n\n  @class Promise\n  @param {function} resolver\n  Useful for tooling.\n  @constructor\n*/\nfunction Promise$2(resolver) {\n  this[PROMISE_ID] = nextId();\n  this._result = this._state = undefined;\n  this._subscribers = [];\n\n  if (noop !== resolver) {\n    typeof resolver !== 'function' && needsResolver();\n    this instanceof Promise$2 ? initializePromise(this, resolver) : needsNew();\n  }\n}\n\nPromise$2.all = all;\nPromise$2.race = race;\nPromise$2.resolve = resolve$1;\nPromise$2.reject = reject$1;\nPromise$2._setScheduler = setScheduler;\nPromise$2._setAsap = setAsap;\nPromise$2._asap = asap;\n\nPromise$2.prototype = {\n  constructor: Promise$2,\n\n/**\n  The primary way of interacting with a promise is through its `then` method,\n  which registers callbacks to receive either a promise's eventual value or the\n  reason why the promise cannot be fulfilled.\n\n  ```js\n  findUser().then(function(user){\n    // user is available\n  }, function(reason){\n    // user is unavailable, and you are given the reason why\n  });\n  ```\n\n  Chaining\n  --------\n\n  The return value of `then` is itself a promise.  This second, 'downstream'\n  promise is resolved with the return value of the first promise's fulfillment\n  or rejection handler, or rejected if the handler throws an exception.\n\n  ```js\n  findUser().then(function (user) {\n    return user.name;\n  }, function (reason) {\n    return 'default name';\n  }).then(function (userName) {\n    // If `findUser` fulfilled, `userName` will be the user's name, otherwise it\n    // will be `'default name'`\n  });\n\n  findUser().then(function (user) {\n    throw new Error('Found user, but still unhappy');\n  }, function (reason) {\n    throw new Error('`findUser` rejected and we're unhappy');\n  }).then(function (value) {\n    // never reached\n  }, function (reason) {\n    // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.\n    // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.\n  });\n  ```\n  If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.\n\n  ```js\n  findUser().then(function (user) {\n    throw new PedagogicalException('Upstream error');\n  }).then(function (value) {\n    // never reached\n  }).then(function (value) {\n    // never reached\n  }, function (reason) {\n    // The `PedgagocialException` is propagated all the way down to here\n  });\n  ```\n\n  Assimilation\n  ------------\n\n  Sometimes the value you want to propagate to a downstream promise can only be\n  retrieved asynchronously. This can be achieved by returning a promise in the\n  fulfillment or rejection handler. The downstream promise will then be pending\n  until the returned promise is settled. This is called *assimilation*.\n\n  ```js\n  findUser().then(function (user) {\n    return findCommentsByAuthor(user);\n  }).then(function (comments) {\n    // The user's comments are now available\n  });\n  ```\n\n  If the assimliated promise rejects, then the downstream promise will also reject.\n\n  ```js\n  findUser().then(function (user) {\n    return findCommentsByAuthor(user);\n  }).then(function (comments) {\n    // If `findCommentsByAuthor` fulfills, we'll have the value here\n  }, function (reason) {\n    // If `findCommentsByAuthor` rejects, we'll have the reason here\n  });\n  ```\n\n  Simple Example\n  --------------\n\n  Synchronous Example\n\n  ```javascript\n  var result;\n\n  try {\n    result = findResult();\n    // success\n  } catch(reason) {\n    // failure\n  }\n  ```\n\n  Errback Example\n\n  ```js\n  findResult(function(result, err){\n    if (err) {\n      // failure\n    } else {\n      // success\n    }\n  });\n  ```\n\n  Promise Example;\n\n  ```javascript\n  findResult().then(function(result){\n    // success\n  }, function(reason){\n    // failure\n  });\n  ```\n\n  Advanced Example\n  --------------\n\n  Synchronous Example\n\n  ```javascript\n  var author, books;\n\n  try {\n    author = findAuthor();\n    books  = findBooksByAuthor(author);\n    // success\n  } catch(reason) {\n    // failure\n  }\n  ```\n\n  Errback Example\n\n  ```js\n\n  function foundBooks(books) {\n\n  }\n\n  function failure(reason) {\n\n  }\n\n  findAuthor(function(author, err){\n    if (err) {\n      failure(err);\n      // failure\n    } else {\n      try {\n        findBoooksByAuthor(author, function(books, err) {\n          if (err) {\n            failure(err);\n          } else {\n            try {\n              foundBooks(books);\n            } catch(reason) {\n              failure(reason);\n            }\n          }\n        });\n      } catch(error) {\n        failure(err);\n      }\n      // success\n    }\n  });\n  ```\n\n  Promise Example;\n\n  ```javascript\n  findAuthor().\n    then(findBooksByAuthor).\n    then(function(books){\n      // found books\n  }).catch(function(reason){\n    // something went wrong\n  });\n  ```\n\n  @method then\n  @param {Function} onFulfilled\n  @param {Function} onRejected\n  Useful for tooling.\n  @return {Promise}\n*/\n  then: then,\n\n/**\n  `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same\n  as the catch block of a try/catch statement.\n\n  ```js\n  function findAuthor(){\n    throw new Error('couldn't find that author');\n  }\n\n  // synchronous\n  try {\n    findAuthor();\n  } catch(reason) {\n    // something went wrong\n  }\n\n  // async with promises\n  findAuthor().catch(function(reason){\n    // something went wrong\n  });\n  ```\n\n  @method catch\n  @param {Function} onRejection\n  Useful for tooling.\n  @return {Promise}\n*/\n  'catch': function(onRejection) {\n    return this.then(null, onRejection);\n  }\n};\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/** Used for built-in method references. */\nvar objectProto$1 = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString$1 = objectProto$1.toString;\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString$1.call(value) == symbolTag);\n}\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\nvar nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\n/**\n * Polyfill-safe method for requesting an animation frame\n *\n * @method  requestAnimationFrame\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Function}  callback  Function to be called after a animation frame\n *   has been delivered.\n * @return  {Integer}             ID of the request.\n */\nvar requestAnimationFrame = function () {\n  var lastTime = 0;\n\n  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) {\n    var currTime = new Date().getTime();\n    var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n    var id = window.setTimeout(function () {\n      callback(currTime + timeToCall);\n    }, timeToCall);\n    lastTime = currTime + timeToCall;\n    return id;\n  };\n}();\n\n/**\n * Polyfill-safe method for canceling a requested animation frame\n *\n * @method  cancelAnimationFrame\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Integer}  id  ID of the animation frame request to be canceled.\n */\nvar cancelAnimationFrame = function () {\n  return window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.mozCancelAnimationFrame || window.oCancelAnimationFrame || window.msCancelAnimationFrame || window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.mozCancelAnimationFrame || window.oCancelAnimationFrame || window.msCancelAnimationFrame || function (id) {\n    window.clearTimeout(id);\n  };\n}();\n\n/**\n * Requests the next animation frame.\n *\n * @method  nextAnimationFrame\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @return  {Object}  Object holding the _request_ and _cancel_ method for\n *   requesting the next animation frame.\n */\nvar nextAnimationFrame = function () {\n  var ids = {};\n\n  function requestId() {\n    var id = void 0;\n    do {\n      id = Math.floor(Math.random() * 1E9);\n    } while (id in ids);\n    return id;\n  }\n\n  return {\n    request: window.requestNextAnimationFrame || function (callback, element) {\n      var id = requestId();\n\n      ids[id] = requestAnimationFrame(function () {\n        ids[id] = requestAnimationFrame(function (ts) {\n          delete ids[id];\n          callback(ts);\n        }, element);\n      }, element);\n\n      return id;\n    },\n    cancel: window.cancelNextAnimationFrame || function (id) {\n      if (ids[id]) {\n        cancelAnimationFrame(ids[id]);\n        delete ids[id];\n      }\n    }\n  };\n}();\n\nvar requestNextAnimationFrame = nextAnimationFrame.request;\n\n// External\n// Internal\n/**\n * Class name assigned to the context menu's root element\n *\n * @type  {String}\n */\nvar CLASS_NAME = 'context-menu';\n\n/**\n * Class name assigned to checkboxes.\n *\n * @type  {String}\n */\nvar CLASS_CHECKBOX = 'checkbox';\n\n/**\n * Size of the dialog arrow in pixel.\n *\n * @type  {Number}\n */\nvar ARROW_SIZE = 6;\n\n/**\n * General transition speed.\n *\n * @type  {Number}\n */\nvar TRANSITION_SPEED = 125;\n\n/**\n * Time in milliseconds before the query button click actially triggers its\n * action.\n *\n * The time is resetted every time the user clicks on the button again within\n * the time interval.\n *\n * @type  {Number}\n */\nvar BUTTON_QUERY_DEBOUNCE = 666;\n\n/**\n * Time in milliseconds before the root button click actially triggers its\n * action.\n *\n * The time is resetted every time the user clicks on the button again within\n * the time interval.\n *\n * @type  {Number}\n */\nvar BUTTON_ROOT_DEBOUNCE = 500;\n\n/**\n * Default time in milliseconds before a button click actially triggers its\n * action.\n *\n * The time is resetted every time the user clicks on the button again within\n * the time interval.\n *\n * @type  {Number}\n */\nvar BUTTON_DEFAULT_DEBOUNCE = 150;\n\n/**\n * [BUTTON_BAM_EFFECT_ANIMATION_TIME description]\n *\n * @type  {Number}\n */\nvar BUTTON_BAM_EFFECT_ANIMATION_TIME = 700;\n\nvar NodeContextMenu = function () {\n  /**\n   * Node context menu constructor\n   *\n   * @description\n   * The `init` object must contain the follow properties:\n   *  - visData: the List Graph App's data. [Object]\n   *  - baseEl: D3 selection of the base element. [Object]\n   *  - events: the List Graph App's event library. [Object]\n   *  - nodes: the List Graph App's nodes. [Object]\n   *  - infoFields: the List Graph App's info field definition. [Object]\n   *  - iconPath: the List Graph App's `iconPath`. [String]\n   *  - isQueryable: If `true` the query button will be shown. [Boolean]\n   *  - isDebounced: If `true` the menu will be debounced. [Boolean]\n   *\n   * @example\n   * ```\n   *  const nodeContextMenu = new NodeContextMenu({\n   *   visData: {...},\n   *   baseEl: {...},\n   *   events: {...},\n   *   nodes: {...},\n   *   infoFields: {...},\n   *   iconPath: '...',\n   *   isQueryable: true,\n   *   isDebounced: true\n   * });\n   * ```\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-09-13\n   * @param   {Object}   init  Initialization object. See example.\n   */\n  function NodeContextMenu(init) {\n    classCallCheck(this, NodeContextMenu);\n\n    var self = this;\n\n    this._x = 0;\n    this._y = 0;\n    this._yOffset = 0;\n    this._scale = 0;\n\n    this.visData = init.visData;\n    this.baseEl = init.baseEl;\n    this.events = init.events;\n    this.nodes = init.nodes;\n    this.isQueryable = init.isQueryable;\n    this.infoFields = init.infoFields;\n    this.isDebounced = init.isDebounced;\n    this.iconPath = init.iconPath;\n\n    this.numButtonRows = 1;\n    this.numButtonRows = this.isQueryable ? ++this.numButtonRows : this.numButtonRows;\n    this.numButtonRows = this.infoFields && this.infoFields.length ? ++this.numButtonRows : this.numButtonRows;\n\n    this.height = this.visData.global.row.height * this.numButtonRows;\n    this.toBottom = false;\n\n    this.nodeInfoId = 0;\n\n    this.wrapper = this.baseEl.append('g').attr('class', CLASS_NAME);\n\n    this.updateAppearance();\n\n    this.bgWrapper = this.wrapper.append('g').classed('bg-outer-wrapper', true).attr('transform', 'translate(' + this.visData.global.column.width / 2 + ' ' + this.height / 2 + ')').append('g').classed('bg-inner-wrapper', true);\n\n    this.bgBorder = this.bgWrapper.append('path').attr('class', 'bgBorder').attr('d', dropMenu({\n      x: -1,\n      y: -1,\n      width: this.visData.global.column.width + 2,\n      height: this.height + 2,\n      radius: ARROW_SIZE - 2,\n      arrowSize: ARROW_SIZE\n    })).attr('transform', 'translate(' + -this.visData.global.column.width / 2 + ' ' + -this.height / 2 + ')');\n\n    this.bg = this.bgWrapper.append('path').attr('class', 'bg').attr('d', dropMenu({\n      x: 0,\n      y: 0,\n      width: this.visData.global.column.width,\n      height: this.height,\n      radius: ARROW_SIZE - 1,\n      arrowSize: ARROW_SIZE\n    })).style('filter', 'url(#drop-shadow-context-menu)').attr('transform', 'translate(' + -this.visData.global.column.width / 2 + ' ' + -this.height / 2 + ')');\n\n    if (this.infoFields && this.infoFields.length) {\n      this.textNodeInfo = this.wrapper.append('g').call(this.createTextField.bind(this), {\n        alignRight: false,\n        classNames: [],\n        distanceFromCenter: this.isQueryable ? 2 : 1,\n        fullWidth: true,\n        labels: this.infoFields\n      }, this.infoFields.length > 1);\n\n      if (this.infoFields.length > 1) {\n        var toggler = this.textNodeInfo.append('g').attr('class', 'toggler').on('click', function () {\n          self.clickNodeInfo.call(self, this);\n        });\n\n        var togglerX = this.visData.global.column.width - this.visData.global.row.contentHeight - this.visData.global.row.padding + this.visData.global.cell.padding;\n\n        var togglerY = this.visData.global.row.padding + this.visData.global.cell.padding;\n\n        toggler.append('rect').attr('class', 'bg').attr('x', togglerX).attr('y', togglerY).attr('width', this.visData.global.row.contentHeight).attr('height', this.visData.global.row.contentHeight);\n\n        toggler.append('use').attr('x', togglerX + (this.visData.global.row.contentHeight - 10) / 2).attr('y', togglerY + (this.visData.global.row.contentHeight - 10) / 2).attr('width', 10).attr('height', 10).attr('xlink:href', this.iconPath + '#arrow-right');\n      }\n    }\n\n    if (this.isQueryable) {\n      this.buttonQuery = this.wrapper.append('g').call(this.createButton.bind(this), {\n        alignRight: false,\n        classNames: [],\n        distanceFromCenter: 1,\n        fullWidth: true,\n        label: 'Query',\n        labelTwo: true,\n        bamEffect: true,\n        unselectable: true\n      }).on('click', function () {\n        self.clickQueryHandler.call(self, this);\n      });\n      this.buttonQueryFill = this.buttonQuery.select('.bg-fill-effect');\n      this.buttonQueryBamEffect = this.buttonQuery.select('.bam-effect');\n    }\n\n    this.buttonRoot = this.wrapper.append('g').call(this.createButton.bind(this), {\n      alignRight: false,\n      classNames: [],\n      distanceFromCenter: 0,\n      fullWidth: false,\n      label: 'Root',\n      unselectable: true\n    }).on('click', function () {\n      self.clickRootHandler.call(self, this);\n    });\n    this.buttonRootFill = this.buttonRoot.select('.bg-fill-effect');\n    this.checkboxRoot = this.createCheckbox(this.buttonRoot);\n\n    this.buttonLock = this.wrapper.append('g').call(this.createButton.bind(this), {\n      alignRight: true,\n      classNames: [],\n      distanceFromCenter: 0,\n      fullWidth: false,\n      label: 'Lock',\n      bamEffect: true,\n      unselectable: true\n    }).on('click', function () {\n      self.clickLockHandler.call(self, this);\n    });\n    this.buttonLockFill = this.buttonLock.select('.bg-fill-effect');\n    this.buttonLockBamEffect = this.buttonLock.select('.bam-effect');\n    this.checkboxLock = this.createCheckbox(this.buttonLock);\n\n    this.components = this.wrapper.selectAll('.component');\n\n    this.debouncedQueryHandler = debounce(this.queryHandler, BUTTON_QUERY_DEBOUNCE);\n    this.debouncedRootHandler = debounce(this.rootHandler, BUTTON_ROOT_DEBOUNCE);\n  }\n\n  /* ---------------------------------------------------------------------------\n   * Getter / Setter\n   * ------------------------------------------------------------------------ */\n\n  /**\n   * Generates CSS string for scaling.\n   *\n   * @method  scale\n   * @author  Fritz Lekschas\n   * @date    2016-09-13\n   * @return  {String}  CSS formatted string containing the scale.\n   */\n\n\n  createClass(NodeContextMenu, [{\n    key: 'addLabel',\n\n\n    /* ---------------------------------------------------------------------------\n     * Methods\n     * ------------------------------------------------------------------------ */\n\n    /* ---------------------------------- A ----------------------------------- */\n\n    /**\n     * Adds a XHTML-based text elements for labelling.\n     *\n     * @method  addLabel\n     * @author  Fritz Lekschas\n     * @date    2016-09-15\n     * @param   {Object}   selection      D3 selection where the label should be\n     *   added to.\n     * @param   {Boolean}  fullWidth      If `true` the label is drawn over the\n     *   full width.\n     * @param   {String}   label          First label text.\n     * @param   {String}   labelTwo       Second label text.\n     * @param   {Boolean}  isToggable     If `true` substracts the toggler width.\n     *   This is only needed because the because Firefox's layering system seems\n     *   to be buggy when it comes to `foreignObject`s. For whatever reason the\n     *   `foreignObject` is drawn on top of the following `g` even though in SVG\n     *   it should be the other way around.\n     * @param   {Boolean}  isUnselectable  If `true` adds a class for making the\n     *   div unselectable.\n     */\n    value: function addLabel(selection, fullWidth, label, labelTwo, isToggable, isUnselectable) {\n      var width = this.visData.global.column.width * (fullWidth ? 1 : 0.5) - this.visData.global.row.padding * 4 - (isToggable ? this.visData.global.row.contentHeight : 0);\n\n      var height = this.visData.global.row.contentHeight - this.visData.global.cell.padding * 2;\n\n      var div = selection.append('foreignObject').attr('x', this.visData.global.row.padding * 2).attr('y', this.visData.global.row.padding + this.visData.global.cell.padding).attr('width', width).attr('height', height).classed('label-wrapper', true).classed('unselectable', isUnselectable).append('xhtml:div').style('line-height', height - 2 + 'px').style('width', width + 'px');\n\n      div.append('xhtml:span').attr('class', 'label').text(label);\n\n      if (labelTwo) {\n        div.append('xhtml:span').attr('class', 'separator').text(':');\n        div.append('xhtml:span').attr('class', 'label-two');\n      }\n    }\n\n    /* ---------------------------------- C ----------------------------------- */\n\n    /**\n     * Check the state of the lock button and alter its appearance accordingly.\n     *\n     * @method  checkLock\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @return  {Boolean}  If `true` the lock button is active.\n     */\n\n  }, {\n    key: 'checkLock',\n    value: function checkLock() {\n      var checked = this.node.datum().data.state.lock;\n      this.buttonLock.classed('semi-active', checked);\n      this.checkboxLock.style('transform', 'translateX(' + (checked ? this.checkBoxMovement : 0) + 'px)');\n      if (checked) {\n        NodeContextMenu.fillButton(this.buttonLockFill);\n      } else {\n        NodeContextMenu.emptyButton(this.buttonLockFill);\n      }\n      return checked;\n    }\n\n    /**\n     * Check how the menu needs to be oriented, i.e., above or below the node.\n     *\n     * @method  checkOrientation\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'checkOrientation',\n    value: function checkOrientation() {\n      if (this._y + this._yOffset >= 0) {\n        this.toBottom = false;\n      } else {\n        this.toBottom = true;\n      }\n      this.components.call(this.positionComponent.bind(this));\n      this.bgWrapper.classed('is-mirrored-horizontally', this.toBottom);\n\n      var translate = 'translate(' + -this.visData.global.column.width / 2 + ' ' + -(this.height / 2 + (this.toBottom ? ARROW_SIZE : 0)) + ')';\n\n      this.bg.attr('transform', translate).style('filter', 'url(#drop-shadow-context-menu' + (this.toBottom ? '-inverted' : '') + ')');\n\n      this.bgBorder.attr('transform', translate);\n    }\n\n    /**\n     * Check state of the root button and alter appearance accordingly.\n     *\n     * @method  checkRoot\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Boolean}  debounced  If `true` the root button will be debounced\n     *   by `time`.\n     * @param   {Number}   time       Debounce time in milliseconds.\n     */\n\n  }, {\n    key: 'checkRoot',\n    value: function checkRoot(debounced, time) {\n      var state = this.node.datum().data.state.root;\n      var checked = state;\n\n      if (debounced) {\n        if (typeof this.currentRootState === 'undefined') {\n          this.currentRootState = !!state;\n        }\n        if (typeof this.tempRoot === 'undefined') {\n          this.tempRoot = this.currentRootState;\n        }\n        this.tempRoot = !this.tempRoot;\n        checked = this.tempRoot;\n      }\n\n      if (!state) {\n        if (debounced) {\n          if (checked) {\n            NodeContextMenu.fillButton(this.buttonRootFill, time);\n          } else {\n            NodeContextMenu.hideElement(this.buttonRootFill);\n          }\n        } else {\n          NodeContextMenu.emptyButton(this.buttonRootFill, time);\n        }\n      } else {\n        if (debounced) {\n          if (!checked) {\n            NodeContextMenu.emptyButton(this.buttonRootFill, time);\n          } else {\n            NodeContextMenu.showElement(this.buttonRootFill);\n          }\n        } else {\n          NodeContextMenu.fillButton(this.buttonRootFill, time);\n        }\n      }\n\n      this.buttonRoot.classed('semi-active', checked);\n      this.checkboxRoot.style('transform', 'translateX(' + (checked ? this.checkBoxMovement : 0) + 'px)');\n    }\n\n    /**\n     * Click handler of the lock button.\n     *\n     * @method  clickLockHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'clickLockHandler',\n    value: function clickLockHandler() {\n      var _this = this;\n\n      this.buttonLock.classed('fill-effect', true);\n      this.nodes.lockHandler(this.node);\n      var checked = this.checkLock();\n      if (checked) {\n        this.buttonLock.classed('active', true);\n      } else {\n        this.buttonLock.classed('active', false);\n      }\n      setTimeout(function () {\n        if (checked) {\n          NodeContextMenu.triggerButtonBamEffect(_this.buttonLockBamEffect);\n        }\n        _this.buttonLock.classed('fill-effect', false);\n      }, BUTTON_DEFAULT_DEBOUNCE);\n    }\n\n    /**\n     * Click handler of the info button.\n     *\n     * @method  clickNodeInfo\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'clickNodeInfo',\n    value: function clickNodeInfo() {\n      var _this2 = this;\n\n      this.nodeInfoId = (this.nodeInfoId + 1) % this.infoFields.length;\n\n      var wrapper = this.textNodeInfo.select('.label-wrapper');\n\n      wrapper.attr('opacity', 1).transition().duration(TRANSITION_LIGHTNING_FAST).attr('opacity', 0).call(allTransitionsEnded, function () {\n        _this2.textNodeInfo.select('.label').text(_this2.infoFields[_this2.nodeInfoId].label);\n\n        _this2.textNodeInfo.select('.label-two').text(_this2.getNodeProperty(_this2.infoFields[_this2.nodeInfoId].property));\n\n        wrapper.transition().duration(TRANSITION_LIGHTNING_FAST).attr('opacity', 1);\n      });\n    }\n\n    /**\n     * Click handler of the query button.\n     *\n     * @method  clickQueryHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'clickQueryHandler',\n    value: function clickQueryHandler() {\n      this.buttonQuery.classed('fill-effect', true);\n      this.updateQuery(true, BUTTON_QUERY_DEBOUNCE);\n      if (this.isDebounced) {\n        this.debouncedQueryHandler(true);\n      } else {\n        this.queryHandler();\n      }\n    }\n\n    /**\n     * Click handler of the root button.\n     *\n     * @method  clickRootHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'clickRootHandler',\n    value: function clickRootHandler() {\n      this.buttonRoot.classed('fill-effect', true);\n      this.checkRoot(true, BUTTON_ROOT_DEBOUNCE);\n      if (this.isDebounced) {\n        this.debouncedRootHandler(true);\n      } else {\n        this.rootHandler();\n      }\n    }\n\n    /**\n     * Closes the menu.\n     *\n     * @method  close\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @return  {Object}  Promise resolving to `true` when the menu is closed.\n     */\n\n  }, {\n    key: 'close',\n    value: function close() {\n      var _this3 = this;\n\n      if (!this.closing) {\n        this.closing = new Promise$2(function (resolve) {\n          _this3.opened = false;\n          _this3.updateAppearance();\n\n          setTimeout(function () {\n            _this3.visible = false;\n            _this3.updateAppearance();\n            resolve(_this3.node.datum().id);\n            _this3.node = undefined;\n          }, TRANSITION_SPEED);\n        });\n      }\n      return this.closing;\n    }\n\n    /**\n     * Helper method to create and append a button.\n     *\n     * @description\n     * The `properties` variable needs to contain the following properties:\n     *  - fullWidth: If `true` draws the button over the full width. [Boolean]\n     *  - label: The first label. Considered the main label if `labelTwo` is\n     *    `undefined`. [String]\n     *  - labelTwo: Second label. Considered the main label when given.\n     *\n     * @method  createButton\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection   D3 selection where the button should be\n     *   appended to.\n     * @param   {Object}  properties  The button's properties.\n     */\n\n  }, {\n    key: 'createButton',\n    value: function createButton(selection, properties) {\n      var classNames = 'component button';\n      if (properties.classNames && properties.classNames.length) {\n        classNames += ' ' + properties.classNames.join(' ');\n      }\n      selection.attr('class', classNames);\n\n      selection.datum(properties).call(this.createButtonBg.bind(this), {\n        bamEffect: properties.bamEffect,\n        fullWidth: properties.fullWidth\n      }).call(this.addLabel.bind(this), properties.fullWidth, properties.label, properties.labelTwo, false, properties.unselectable).call(this.positionComponent.bind(this), properties.distanceFromCenter, properties.alignRight);\n    }\n\n    /**\n     * Helper method to create and append a button background.\n     *\n     * @description\n     * The `properties` variable needs to contain the following properties:\n     *  - fullWidth: If `true` draws the button over the full width. [Boolean]\n     *  - bamEffect: If `true` adds an extra element for the click-bam-effect.\n     *\n     * @method  createButtonBg\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection   D3 selection where the background element\n     *   should be appended to.\n     * @param   {Object}  properties  The background element's properties.\n     */\n\n  }, {\n    key: 'createButtonBg',\n    value: function createButtonBg(selection, properties) {\n      var _this4 = this;\n\n      selection.datum(function (data) {\n        data.x = _this4.visData.global.row.padding;\n        data.y = _this4.visData.global.row.padding;\n        data.width = _this4.visData.global.column.width * (properties.fullWidth ? 1 : 0.5) - _this4.visData.global.row.padding * 2;\n        data.height = _this4.visData.global.row.contentHeight;\n        data.rx = 2;\n        data.ry = 2;\n\n        return data;\n      }).append('rect').attr('class', 'bg').attr('x', function (data) {\n        return data.x;\n      }).attr('y', function (data) {\n        return data.y;\n      }).attr('width', function (data) {\n        return data.width;\n      }).attr('height', function (data) {\n        return data.height;\n      }).attr('rx', function (data) {\n        return data.rx;\n      }).attr('ry', function (data) {\n        return data.ry;\n      });\n\n      selection.append('rect').attr('class', 'bg-fill-effect').attr('x', function (data) {\n        return data.x;\n      }).attr('y', function (data) {\n        return data.y;\n      }).attr('width', function (data) {\n        return data.width;\n      }).attr('height', 0).attr('rx', function (data) {\n        return data.rx;\n      }).attr('ry', function (data) {\n        return data.ry;\n      });\n\n      if (properties.bamEffect) {\n        selection.append('g').attr('transform', function (data) {\n          return 'translate(' + data.width / 2 + ' ' + data.height / 2 + ')';\n        }).append('g').attr('class', 'bam-effect').append('rect').attr('class', 'bam-effect-bg').attr('x', function (data) {\n          return data.x;\n        }).attr('y', function (data) {\n          return data.y;\n        }).attr('width', function (data) {\n          return data.width;\n        }).attr('height', function (data) {\n          return data.height;\n        }).attr('rx', function (data) {\n          return data.rx;\n        }).attr('ry', function (data) {\n          return data.ry;\n        }).attr('transform', function (data) {\n          return 'translate(' + -data.width / 2 + ' ' + -data.height / 2 + ')';\n        });\n      }\n    }\n\n    /**\n     * Helper method to create and append a checkbox-like button.\n     *\n     * @method  createCheckbox\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection  D3 selection where the checkbox element\n     *   should be appended to.\n     */\n\n  }, {\n    key: 'createCheckbox',\n    value: function createCheckbox(selection) {\n      var height = Math.round(selection.datum().height / 2);\n      var x = -1.75 * height + this.visData.global.row.padding;\n\n      var container = selection.append('g').attr('class', CLASS_CHECKBOX);\n\n      container.append('rect').attr('class', 'checkbox-bg').attr('x', function (data) {\n        return data.width + x;\n      }).attr('y', height / 2 + this.visData.global.row.padding).attr('width', height * 1.5).attr('height', height).attr('rx', height / 2).attr('ry', height / 2);\n\n      this.checkBoxMovement = (height - 2) / 2;\n\n      return container.append('rect').attr('class', 'checkbox-knob').attr('x', function (data) {\n        return data.width + x + 1;\n      }).attr('y', height / 2 + this.visData.global.row.padding + 1).attr('width', height - 2).attr('height', height - 2).attr('rx', height - 2);\n    }\n\n    /**\n     * Helper method to create and append a text field.\n     *\n     * @method  createTextField\n     * @author  Fritz Lekschas\n     * @date    2016-09-15\n     * @param   {Object}  selection   D3 selection where the text field should be\n     *   appended to.\n     * @param   {Object}  properties  The text field's properties.\n     * @param   {Boolean}  isToggable  If `true` substracts the toggler width.\n     *   This is only needed because the because Firefox's layering system seems\n     *   to be buggy when it comes to `foreignObject`s. For whatever reason the\n     *   `foreignObject` is drawn on top of the following `g` even though in SVG\n     *   it should be the other way around.\n     */\n\n  }, {\n    key: 'createTextField',\n    value: function createTextField(selection, properties, isToggable) {\n      var classNames = 'component text-field';\n      if (properties.classNames && properties.classNames.length) {\n        classNames += ' ' + properties.classNames.join(' ');\n      }\n      selection.attr('class', classNames);\n\n      selection.datum(properties).call(this.addLabel.bind(this), true, properties.labels[this.nodeInfoId].label, true, isToggable).call(this.positionComponent.bind(this), properties.distanceFromCenter, properties.alignRight);\n    }\n\n    /* ---------------------------------- E ----------------------------------- */\n\n    /**\n     * Transitions out an element top down.\n     *\n     * @method  emptyButton\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection   D3 selection of the element to be\n     *   transitioned.\n     * @param   {Number}  time       Transition time in milliseconds.\n     */\n\n  }, {\n    key: 'getNodeProperty',\n\n\n    /* ---------------------------------- G ----------------------------------- */\n\n    /**\n     * Helper method to access a node property.\n     *\n     * @method  getNodeProperty\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Function}  callback  Callback returning a property of the node.\n     * @return  {*}                   The value returned by the callback.\n     */\n    value: function getNodeProperty(callback) {\n      try {\n        return callback(this.node.datum());\n      } catch (e) {\n        return undefined;\n      }\n    }\n\n    /* ---------------------------------- H ----------------------------------- */\n\n    /**\n     * Hide an element by setting the height to zero.\n     *\n     * @method  hideElement\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection  D3 selection of element to be hidden.\n     */\n\n  }, {\n    key: 'isOpenSameColumn',\n\n\n    /* ---------------------------------- I ----------------------------------- */\n\n    /**\n     * Check if menu is opened in the same column already.\n     *\n     * @method  isOpenSameColumn\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Number}   columnNum  Column number.\n     * @return  {Boolean}             If `true` menu is opened and in the same\n     *   column.\n     */\n    value: function isOpenSameColumn(columnNum) {\n      return this.opened && this.node.datum().depth === columnNum;\n    }\n\n    /* ---------------------------------- O ----------------------------------- */\n\n    /**\n     * Opens the menu.\n     *\n     * @method  open\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  node  D3 selection of the node the menu relates to.\n     */\n\n  }, {\n    key: 'open',\n    value: function open(node) {\n      var _this5 = this;\n\n      return new Promise$2(function (resolve) {\n        _this5.node = node;\n        _this5.closing = undefined;\n\n        _this5.updateStates();\n\n        _this5._yOffset = _this5.visData.nodes[_this5.node.datum().depth].scrollTop;\n        _this5.translate = {\n          x: _this5.node.datum().x,\n          y: _this5.node.datum().y - _this5.height\n        };\n        _this5.checkOrientation();\n\n        _this5.updateAppearance();\n        _this5.opened = true;\n        _this5.visible = true;\n\n        requestNextAnimationFrame(function () {\n          _this5.updateAppearance();\n          setTimeout(function () {\n            resolve(true);\n          }, TRANSITION_SPEED);\n        });\n      });\n    }\n\n    /* ---------------------------------- P ----------------------------------- */\n\n    /**\n     * Positions component.\n     *\n     * @method  positionComponent\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}   selection           D3 selection of the element to be\n     *   positioned.\n     * @param   {Boolean}  distanceFromCenter  If `true` positions component from\n     *   the center.\n     * @param   {Boolean}  alignRight          If `true` aligns component to the\n     *   right.\n     * @return  {String}                       CSS-formatted translation string.\n     */\n\n  }, {\n    key: 'positionComponent',\n    value: function positionComponent(selection, distanceFromCenter, alignRight) {\n      var _this6 = this;\n\n      selection.datum(function (data) {\n        // Lets cache some values to make our lives easier when checking the\n        // position again in `checkOrientation`.\n        if (distanceFromCenter) {\n          data.distanceFromCenter = distanceFromCenter;\n        }\n        if (alignRight) {\n          data.alignRight = alignRight;\n        }\n        return data;\n      }).attr('transform', function (data) {\n        var x = data.alignRight ? _this6.visData.global.column.width / 2 : 0;\n        // When the buttons are created I assume self the menu is positioned\n        // above the node; i.e. `distanceFromCenter` needs to be inverted.\n        var y = _this6.visData.global.row.height * (_this6.toBottom ? data.distanceFromCenter : _this6.numButtonRows - data.distanceFromCenter - 1) + (_this6.toBottom ? ARROW_SIZE : 0);\n\n        return 'translate(' + x + ', ' + y + ')';\n      });\n    }\n\n    /* ---------------------------------- Q ----------------------------------- */\n\n    /**\n     * Handle the four different query states: none, or, and, and not.\n     *\n     * @method  queryHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Boolean}  debounced  If `true` the handler will debounce.\n     */\n\n  }, {\n    key: 'queryHandler',\n    value: function queryHandler(debounced) {\n      if (debounced) {\n        if (this.tempQueryMode !== this.currentQueryMode) {\n          if (this.tempQueryMode) {\n            this.nodes.queryHandler(this.node, 'query', this.tempQueryMode);\n            NodeContextMenu.triggerButtonBamEffect(this.buttonQueryBamEffect);\n            this.buttonQuery.classed('active', true);\n          } else {\n            this.nodes.queryHandler(this.node, 'unquery');\n            this.buttonQuery.classed('active', false);\n          }\n        }\n      } else {\n        this.nodes.queryHandler(this.node);\n      }\n\n      // Reset temporary query modes.\n      this.tempQueryMode = undefined;\n      this.currentQueryMode = undefined;\n      this.buttonQuery.classed('fill-effect', false);\n    }\n\n    /* ---------------------------------- R ----------------------------------- */\n\n    /**\n     * Handle re-rooting of the graph.\n     *\n     * @method  rootHandler\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Boolean}  debounced  If `true` the handler will debounce.\n     */\n\n  }, {\n    key: 'rootHandler',\n    value: function rootHandler(debounced) {\n      if (!debounced || this.tempRoot !== this.currentRootState) {\n        this.close();\n        this.nodes.rootHandler(this.node);\n      }\n\n      // Reset temporary root values.\n      this.tempRoot = undefined;\n      this.currentRootState = undefined;\n      this.buttonRoot.classed('fill-effect', false);\n\n      this.buttonRoot.classed('active', this.node.datum().data.state.root);\n    }\n\n    /* ---------------------------------- S ----------------------------------- */\n\n    /**\n     * Scrolls the menu vertically.\n     *\n     * @method  scrollY\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Number}  offset  Scroll related offset.\n     */\n\n  }, {\n    key: 'scrollY',\n    value: function scrollY(offset) {\n      this._yOffset = offset;\n      this.updateAppearance();\n    }\n\n    /**\n     * Transition element in by resetting its original height.\n     *\n     * @method  showElement\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection  D3 selection to be transitioned in.\n     */\n\n  }, {\n    key: 'toggle',\n\n\n    /* ---------------------------------- T ----------------------------------- */\n\n    /**\n     * Toggle menu visibility\n     *\n     * @method  toggle\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  node  D3 selection of the related node.\n     */\n    value: function toggle(node) {\n      var _this7 = this;\n\n      return new Promise$2(function (resolve) {\n        var nodeId = node.datum().id;\n        var closed = Promise$2.resolve();\n\n        if (_this7.visible) {\n          closed = _this7.close();\n        }\n\n        closed.then(function (previousNodeId) {\n          if (nodeId !== previousNodeId) {\n            _this7.open(node).then(function () {\n              resolve(nodeId);\n            });\n          } else {\n            resolve(nodeId);\n          }\n        });\n      });\n    }\n\n    /**\n     * Call button BAM effect.\n     *\n     * @method  triggerButtonBamEffect\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  node  D3 selection of the button to be BAM-effected.\n     */\n\n  }, {\n    key: 'updateAppearance',\n\n\n    /* ---------------------------------- U ----------------------------------- */\n\n    /**\n     * Update appearance of the menu.\n     *\n     * @method  updateAppearance\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n    value: function updateAppearance() {\n      var centerY = this.toBottom ? 0 : this.height + this.visData.global.row.height;\n\n      this.wrapper.classed('transitionable', this.visible).classed('open', this.opened).style('transform', this.translate + ' ' + this.scale).style('transform-origin', this.visData.global.column.width / 2 + 'px ' + centerY + 'px');\n    }\n\n    /**\n     * Toggle through the info text fields.\n     *\n     * @method  updateInfoText\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'updateInfoText',\n    value: function updateInfoText() {\n      if (!this.infoFields || !this.infoFields.length) {\n        return;\n      }\n\n      this.textNodeInfo.select('.label').text(this.infoFields[this.nodeInfoId].label);\n\n      this.textNodeInfo.select('.label-two').text(this.getNodeProperty(this.infoFields[this.nodeInfoId].property));\n    }\n\n    /**\n     * Open menu on another node.\n     *\n     * @description\n     * Updates the position of the menu and its content.\n     *\n     * @method  updatePosition\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'updatePosition',\n    value: function updatePosition() {\n      if (this.node && this.opened) {\n        this.open(this.node);\n      }\n    }\n\n    /**\n     * Update querying when toggling through different query options.\n     *\n     * @method  updateQuery\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Boolean}  debounced  If `true` debounces querying.\n     * @param   {Number}   time       Debounce time in milliseconds.\n     */\n\n  }, {\n    key: 'updateQuery',\n    value: function updateQuery(debounced, time) {\n      if (!this.isQueryable) {\n        return;\n      }\n\n      var state = this.node.datum().data.state.query;\n      var queryMode = state;\n\n      function nextQueryMode(mode) {\n        switch (mode) {\n          case 'or':\n            return 'and';\n          case 'and':\n            return 'not';\n          case 'not':\n            return null;\n          default:\n            return 'or';\n        }\n      }\n\n      if (debounced) {\n        if (typeof this.currentQueryMode === 'undefined') {\n          this.currentQueryMode = state;\n        }\n        if (typeof this.tempQueryMode === 'undefined') {\n          this.tempQueryMode = this.currentQueryMode;\n        }\n        this.tempQueryMode = nextQueryMode(this.tempQueryMode);\n        queryMode = this.tempQueryMode;\n      }\n\n      if (debounced) {\n        if (queryMode) {\n          if (queryMode === state) {\n            NodeContextMenu.showElement(this.buttonQueryFill);\n          } else {\n            NodeContextMenu.fillButton(this.buttonQueryFill, time);\n          }\n        } else {\n          if (state) {\n            NodeContextMenu.emptyButton(this.buttonQueryFill, time);\n          } else {\n            NodeContextMenu.hideElement(this.buttonQueryFill);\n          }\n        }\n      } else {\n        NodeContextMenu.emptyButton(this.buttonQueryFill, time);\n      }\n\n      this.buttonQuery.classed('semi-active', !!queryMode).classed('active', !!state).select('.label-two').text(queryMode || 'not queried').classed('inactive', !queryMode);\n    }\n\n    /**\n     * Helper method to trigger a check of all buttons and text fields.\n     *\n     * @method  updateStates\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     */\n\n  }, {\n    key: 'updateStates',\n    value: function updateStates() {\n      if (this.node) {\n        this.checkLock();\n        this.checkRoot();\n        this.updateQuery();\n        this.updateInfoText();\n      }\n    }\n  }, {\n    key: 'scale',\n    get: function get() {\n      return 'scale(' + (this.opened ? 1 : 0.5) + ')';\n    }\n\n    /**\n     * Generates a CSS string for translation\n     *\n     * @method  translate\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @return  {String}  CSS formatted string containing the translate.\n     */\n\n  }, {\n    key: 'translate',\n    get: function get() {\n      var y = this.toBottom ? this._y + this.height + this.visData.global.row.height - ARROW_SIZE : this._y;\n\n      return 'translate(' + this._x + 'px,' + (y + this._yOffset) + 'px)';\n    }\n\n    /**\n     * Set x and y values.\n     *\n     * @method  translate\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  position  Object containing x and y coordinates.\n     */\n    ,\n    set: function set(position) {\n      this._x = position.x;\n      this._y = position.y;\n    }\n  }], [{\n    key: 'emptyButton',\n    value: function emptyButton(selection, time) {\n      selection.transition().duration(0).attr('y', function (data) {\n        return data.y;\n      }).attr('height', function (data) {\n        return data.height;\n      }).call(allTransitionsEnded, function () {\n        selection.transition().duration(time || BUTTON_DEFAULT_DEBOUNCE).ease(d3.easeLinear).attr('y', function (data) {\n          return data.height;\n        }).attr('height', 0);\n      });\n    }\n\n    /* ---------------------------------- F ----------------------------------- */\n\n    /**\n     * Transitions in an element top down.\n     *\n     * @method  fillButton\n     * @author  Fritz Lekschas\n     * @date    2016-09-13\n     * @param   {Object}  selection   D3 selection of the element to be\n     *   transitioned.\n     * @param   {Number}  time       Transition time in milliseconds.\n     */\n\n  }, {\n    key: 'fillButton',\n    value: function fillButton(selection, time) {\n      selection.transition().duration(0).attr('y', function (data) {\n        return data.y;\n      }).attr('height', 0).call(allTransitionsEnded, function () {\n        selection.transition().duration(time || BUTTON_DEFAULT_DEBOUNCE).ease(d3.easeLinear).attr('height', function (data) {\n          return data.height;\n        });\n      });\n    }\n  }, {\n    key: 'hideElement',\n    value: function hideElement(selection) {\n      selection.transition().duration(0).attr('height', 0);\n    }\n  }, {\n    key: 'showElement',\n    value: function showElement(selection) {\n      selection.transition().duration(0).attr('y', function (data) {\n        return data.y;\n      }).attr('height', function (data) {\n        return data.height;\n      });\n    }\n  }, {\n    key: 'triggerButtonBamEffect',\n    value: function triggerButtonBamEffect(button) {\n      button.classed('trigger', true);\n      setTimeout(function () {\n        button.classed('trigger', false);\n      }, BUTTON_BAM_EFFECT_ANIMATION_TIME);\n    }\n  }]);\n  return NodeContextMenu;\n}();\n\n/* eslint no-shadow: 0 */\n\n// External\n// Internal\nvar LimitsUnsupportedFormat = function (_ExtendableError) {\n  inherits(LimitsUnsupportedFormat, _ExtendableError);\n\n  function LimitsUnsupportedFormat(message) {\n    classCallCheck(this, LimitsUnsupportedFormat);\n    return possibleConstructorReturn(this, (LimitsUnsupportedFormat.__proto__ || Object.getPrototypeOf(LimitsUnsupportedFormat)).call(this, message || 'The limits are wrongly formatted. Please provide an ' + 'object of the following format: `{ x: { min: 0, max: 1 }, y: { min: ' + '0, max: 1 } }`'));\n  }\n\n  return LimitsUnsupportedFormat;\n}(ExtendableError);\n\n/**\n * Drap and drop event handler that works via translation.\n *\n * @method  onDragDrop\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}  selection        D3 selection to listen for the drag\n *   event.\n * @param   {Object}           dragMoveHandler         Handler for drag-move.\n * @param   {Object}           dropHandler             Handler for drag-end,\n *   i.e. drop.\n * @param   {Array}            elsToBeDragged          Array of D3 selections to\n *   be moved according to the drag event. If empty or undefined `selection`\n *   will be used.\n * @param   {String}           orientation             Can either be\n *   \"horizontal\", \"vertical\" or `undefined`, i.e. both directions.\n * @param   {Object|Function}  limits                  X and Y drag limits. E.g.\n *   `{ x: { min: 0, max: 10 } }`.\n * @param   {Array}             noDraggingWhenTrue     List if function\n *   returning a Boolean value which should prevent the dragMoveHandler from\n *   working.\n * @param   {String}           clickTolerance          Specify the number of\n *   pixel that are allowed to move but still trigger a click event. Sometimes\n *   it is useful to allow the user to move 1 or 2 pixel, especially in high\n *   res environments. [Default is 0]\n */\nfunction onDragDrop(selection, dragStartHandler, dragMoveHandler, dropHandler, elsToBeDragged, orientation, limits, noDraggingWhenTrue, dragData, clickTolerance) {\n  var drag$$1 = d3.drag();\n  var checkWhenDragging = isFunction(noDraggingWhenTrue);\n\n  var appliedLimits = limits || {}; // eslint-disable-line no-param-reassign\n\n  var filter = function filter() {\n    return !(checkWhenDragging && noDraggingWhenTrue());\n  };\n\n  drag$$1.filter(filter);\n\n  var d2 = void 0;\n\n  drag$$1.on('start', function () {\n    d2 = 0;\n    if (typeof limits === 'function') {\n      appliedLimits = limits();\n    }\n  });\n\n  if (dragMoveHandler) {\n    drag$$1.on('drag', function (data) {\n      if (checkWhenDragging && noDraggingWhenTrue()) {\n        return;\n      }\n      d3.event.sourceEvent.preventDefault();\n      dragStartHandler();\n      dragMoveHandler.call(this, data, elsToBeDragged, orientation, appliedLimits);\n\n      d2 += d3.event.dx * d3.event.dx + d3.event.dy * d3.event.dy;\n    });\n  }\n\n  if (dropHandler) {\n    drag$$1.on('end', function () {\n      dropHandler.call(this);\n\n      if (d2 <= (clickTolerance || 0)) {\n        // Don't supress the click event for minor mouse movements.\n        d3.select(window).on('click.drag', null);\n      }\n    });\n  }\n\n  selection.each(function (data) {\n    var el = d3.select(this);\n\n    // Set default data if not available.\n    if (!data) {\n      data = { drag: dragData }; // eslint-disable-line no-param-reassign\n      el.datum(data);\n    }\n\n    // Add drag event handler\n    el.call(drag$$1);\n  });\n}\n\n/**\n * Custom drag-move handler used by the custom drag-drop handler.\n *\n * @method  dragMoveHandler\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}           data            D3's drag event object.\n * @param   {Array}            elsToBeDragged  Array of D3 selections.\n * @param   {String}           orientation     Can either be \"horizontal\",\n *   \"vertical\" or `undefined`, i.e. both directions.\n * @param   {Object|Function}  limits          X and Y drag limits. E.g.\n *   `{ x: { min: 0, max: 10 } }`.\n */\nfunction dragMoveHandler$1(data, elsToBeDragged, orientation, limits) {\n  var els = d3.select(this);\n\n  if (elsToBeDragged && elsToBeDragged.length) {\n    els = mergeSelections(elsToBeDragged);\n  }\n\n  function withinLimits(value, applyingLimits) {\n    var restrictedValue = void 0;\n\n    if (applyingLimits) {\n      try {\n        restrictedValue = Math.min(applyingLimits.max, Math.max(applyingLimits.min, value));\n      } catch (e) {\n        throw new LimitsUnsupportedFormat();\n      }\n    }\n    return restrictedValue;\n  }\n\n  if (orientation === 'horizontal' || orientation === 'vertical') {\n    if (orientation === 'horizontal') {\n      data.drag.x += d3.event.dx;\n      data.drag.x = withinLimits(data.drag.x + d3.event.dx, limits.x);\n      els.style('transform', 'translateX(' + data.drag.x + 'px)');\n    }\n    if (orientation === 'vertical') {\n      data.drag.y += d3.event.dy;\n      data.drag.x = withinLimits(data.drag.y + d3.event.dy, limits.y);\n      els.style('transform', 'translateY(' + data.drag.y + 'px)');\n    }\n  } else {\n    data.drag.x += d3.event.dx;\n    data.drag.y += d3.event.dy;\n    els.style('transform', 'translate(' + data.drag.x + 'px,' + data.drag.y + 'px)');\n  }\n}\n\n/**\n * Creates SVG filter element for simulating drop shadow.\n *\n * @description\n * Adapted from: http://bl.ocks.org/cpbotha/5200394\n *\n * @method  dropShadow\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {Object}  el       D3 selection.\n * @param   {String}  name     Filter name.\n * @param   {Number}  dx       Shadow x-distance.\n * @param   {Number}  dy       Shadow y-distance.\n * @param   {Number}  blur     Blurness.\n * @param   {Number}  opacity  Opacity of the shadow with in [0,1].\n */\nfunction dropShadow(el, name, dx, dy, blur, opacity) {\n  var defs = el.select('defs');\n\n  if (defs.empty()) {\n    defs = el.append('defs');\n  }\n\n  // create filter with id #drop-shadow\n  // height = 130% so that the shadow is not clipped\n  var filter = defs.append('filter').attr('id', 'drop-shadow' + (name ? '-' + name : '')).attr('height', '130%');\n\n  // SourceAlpha refers to opacity of graphic that this filter will be applied to\n  // convolve that with a Gaussian with standard deviation 3 and store result\n  // in blur\n  filter.append('feGaussianBlur').attr('in', 'SourceAlpha').attr('stdDeviation', blur);\n\n  // translate output of Gaussian blur to the right and downwards with 2px\n  // store result in offsetBlur\n  filter.append('feOffset').attr('dx', dx).attr('dy', dy).attr('result', 'offsetBlur');\n\n  filter.append('feComponentTransfer').append('feFuncA').attr('type', 'linear').attr('slope', opacity || 1);\n\n  // overlay original SourceGraphic over translated blurred opacity by using\n  // feMerge filter. Order of specifying inputs is important!\n  var feMerge = filter.append('feMerge');\n\n  feMerge.append('feMergeNode');\n  feMerge.append('feMergeNode').attr('in', 'SourceGraphic');\n}\n\n/**\n * Helper method to set a value if available and otherwise fall back to a\n * default value\n *\n * @method  setOption\n * @author  Fritz Lekschas\n * @date    2016-09-12\n * @param   {*}        value  Value to be set if available.\n * @param   {*}        defaultValue  Default value to be set when `value` is\n *   not available.\n * @param   {Boolean}  noFalsyValue  No falsy values are allowed. E.g., an empty\n *   string or the number zero are regarded as falsy.\n */\nfunction setOption(value, defaultValue, noFalsyValue) {\n  if (noFalsyValue) {\n    return value || defaultValue;\n  }\n\n  return typeof value !== 'undefined' ? value : defaultValue;\n}\n\n// External\n// Internal\n/**\n * Private d3 object. Needed to handle cases where D3.js v3 and v4 are used.\n *\n * @type  {Object}\n */\nvar _d3 = d3;\n\nvar ListGraph = function () {\n  /**\n   * ListGraph App constructor.\n   *\n   * @method  constructor\n   * @author  Fritz Lekschas\n   * @date    2016-10-02\n   * @param   {Object}  init  Config object.\n   */\n  function ListGraph(init) {\n    var _this = this;\n\n    classCallCheck(this, ListGraph);\n\n    if (init.d3) {\n      _d3 = init.d3;\n    }\n\n    if (_d3.version[0] !== '4') {\n      throw new D3VersionFourRequired(_d3.version);\n    }\n\n    if (!_d3.listGraph) {\n      throw new LayoutNotAvailable();\n    }\n\n    var self = this;\n\n    this.baseEl = init.element;\n    this.baseEl.__d3ListGraphBase__ = true;\n\n    this.baseElD3 = _d3.select(this.baseEl);\n    this.baseElJq = $(this.baseEl);\n    this.svgD3 = this.baseElD3.select('svg.base');\n    this.svgEl = this.svgD3.node();\n    this.outsideClickHandler = {};\n    this.outsideClickClassHandler = {};\n\n    if (this.svgD3.empty()) {\n      this.svgD3 = this.baseElD3.append('svg').attr('class', 'base');\n      this.svgJq = $(this.svgD3.node());\n    } else {\n      this.svgJq = $(this.svgD3.node());\n    }\n\n    // Array of root node IDs.\n    this.rootNodes = init.rootNodes;\n\n    // Width of the vis. If `undefined` the SVG's width will be used.\n    this.width = setOption(init.width, this.svgJq.width(), true);\n\n    // Height of the vis. If `undefined` the SVG's height will be used.\n    this.height = setOption(init.height, this.svgJq.height(), true);\n\n    // Refresh top and left position of the base `svg` everytime the user enters\n    // the element with his/her mouse cursor. This will avoid relying on complex\n    // browser resize events and other layout manipulations as they most likely\n    // won't happen when the user tries to interact with the visualization.\n    this.svgD3.on('mouseenter', this.getBoundingRect.bind(this));\n\n    // With of the column's scrollbars\n    this.scrollbarWidth = setOption(init.scrollbarWidth, SCROLLBAR_WIDTH, true);\n\n    // Number of visible columns\n    this.columns = setOption(init.columns, COLUMNS, true);\n\n    // Number of visible rows.\n    this.rows = setOption(init.rows, ROWS, true);\n\n    // Path to SVG icon file.\n    this.iconPath = setOption(init.iconPath, ICON_PATH, true);\n\n    // If `true` query icons and controls are enabled.\n    this.querying = setOption(init.querying, QUERYING);\n\n    // If `true` hide links that point to invisible nodes.\n    this.hideOutwardsLinks = setOption(init.hideOutwardsLinks, HIDE_OUTWARDS_LINKS);\n\n    // If `true` and `this.hideOutwardsLinks === true` indicates the location of\n    // target nodes of invisible nodes connected via links.\n    this.showLinkLocation = setOption(init.showLinkLocation, SHOW_LINK_LOCATION);\n\n    // The visual size of a location bucket. E.g. `3` pixel.\n    this.linkLocationBucketSize = init.linkLocationBucketSize;\n\n    // If `true` the currently rooted level will softly be highlighted.\n    this.highlightActiveLevel = setOption(init.highlightActiveLevel, HIGHLIGHT_ACTIVE_LEVEL);\n\n    // Determines which level from the rooted node will be regarded as active.\n    // Zero means that the level of the rooted node is regarded.\n    this.activeLevel = setOption(init.activeLevel, ACTIVE_LEVEL);\n\n    // When no manually rooted node is available the active level will be\n    // `this.activeLevel` minus `this.noRootActiveLevelDiff`.\n    // WAT?\n    // In some cases it makes sense to hide the original root node just to save\n    // a column, so having no manually set root node means that the invisible\n    // root node is active. Using this option it can be assured that the\n    // approriate column is being highlighted.\n    this.noRootActiveLevelDiff = setOption(init.noRootActiveLevelDiff, NO_ROOT_ACTIVE_LEVEL_DIFF);\n\n    // Determine the level of transitions\n    // - 0 [Default]: Show all transitions\n    // - 1: Show only CSS transitions\n    // - 2: Show no transitions\n    this.lessTransitionsJs = init.lessTransitions > 0;\n    this.lessTransitionsCss = init.lessTransitions > 1;\n\n    // Enable or disable\n    this.disableDebouncedContextMenu = setOption(init.disableDebouncedContextMenu, DISABLE_DEBOUNCED_CONTEXT_MENU);\n\n    // Create custom topbar buttons\n    this.customTopbarButtons = setOption(init.customTopbarButtons, []);\n\n    this.baseElD3.classed('less-animations', this.lessTransitionsCss);\n\n    // Holds the key of the property to be sorted initially. E.g. `precision`.\n    this.sortBy = init.sortBy;\n\n    // Initial sort order. Anything other than `asc` will fall back to `desc`.\n    this.sortOrder = init.sortOrder === 'asc' ? 1 : DEFAULT_SORT_ORDER;\n\n    this.nodeInfoContextMenu = isArray(init.nodeInfoContextMenu) ? init.nodeInfoContextMenu : [];\n\n    this.events = new Events(this.baseEl, init.dispatcher);\n\n    this.baseElJq.addClass(CLASSNAME);\n\n    this.dragged = { x: 0, y: 0 };\n\n    if (init.forceWidth) {\n      this.baseElJq.width(this.width);\n    }\n\n    this.layout = new _d3.listGraph({ // eslint-disable-line new-cap\n      size: [this.width, this.height],\n      grid: [this.columns, this.rows],\n      d3: _d3\n    });\n\n    this.data = init.data;\n    this.visData = this.layout.process(this.data, this.rootNodes, {\n      showLinkLocation: this.showLinkLocation,\n      linkLocationBucketSize: this.linkLocationBucketSize,\n      sortBy: this.sortBy,\n      sortOrder: this.sortOrder\n    });\n\n    /**\n     * Stores current sorting, e.g. type, order and a reference to the element.\n     *\n     * @type  {Object}\n     */\n    this.currentSorting = {\n      global: {\n        type: this.sortBy,\n        order: this.sortOrder\n      },\n      local: {}\n    };\n\n    this.barMode = init.barMode || DEFAULT_BAR_MODE;\n    this.svgD3.classed(this.barMode + '-bar', true);\n\n    this.topbar = new Topbar(this, this.baseElD3, this.visData, this.customTopbarButtons);\n\n    this.svgD3.attr('viewBox', '0 0 ' + this.width + ' ' + this.height);\n\n    this.container = this.svgD3.append('g').attr('class', 'main-container');\n\n    this.levels = new Levels(this.container, this, this.visData);\n\n    this.links = new Links(this, this.levels.groups, this.visData, this.layout);\n    this.nodes = new Nodes(this, this.levels.groups, this.visData, this.links, this.events);\n    this.levels.scrollPreparation(this.scrollbarWidth);\n    this.scrollbars = new Scrollbars(this.levels.groups, this.visData, this.scrollbarWidth);\n\n    this.nodeContextMenu = new NodeContextMenu({\n      visData: this.visData,\n      baseEl: this.container,\n      events: this.events,\n      nodes: this.nodes,\n      iconPath: this.iconPath,\n      infoFields: this.nodeInfoContextMenu,\n      isQueryable: this.querying,\n      isDebounced: !this.disableDebouncedContextMenu\n    });\n\n    this.nodeContextMenu.wrapper.on('mousedown', function () {\n      _this.mouseDownOnContextMenu = true;\n    });\n\n    dropShadow(this.svgD3, 'context-menu', 0, 1, 2, 0.2);\n    dropShadow(this.svgD3, 'context-menu-inverted', 0, -1, 2, 0.2);\n\n    // jQuery's mousewheel plugin is much nicer than D3's half-baked zoom event.\n    // We are using delegated event listeners to provide better scaling\n    this.svgJq.on('mousewheel', '.' + Levels.className, function (event$$1) {\n      if (!self.zoomedOut) {\n        self.mousewheelColumn(this, event$$1);\n      }\n    });\n\n    this.svgJq.on('click', function (event$$1) {\n      self.checkGlobalClick.call(self, event$$1.target);\n    });\n\n    // Add jQuery delegated event listeners instead of direct listeners of D3.\n    this.svgJq.on('click', '.' + Nodes.classNodeVisible, function () {\n      // Add a new global outside click listener using this node and the\n      // node context menu as the related elements.\n      requestNextAnimationFrame(function () {\n        self.registerOutSideClickHandler('nodeContextMenu', [self.nodeContextMenu.wrapper.node()], ['visible-node'], function () {\n          // The context of this method is the context of the outer click\n          // handler.\n          self.nodeContextMenu.close();\n          self.unregisterOutSideClickHandler.call(self, 'nodeContextMenu');\n        });\n      });\n\n      self.nodeContextMenu.toggle.call(self.nodeContextMenu, _d3.select(this.parentNode));\n    });\n\n    this.svgJq.on('click', '.' + Nodes.classFocusControls + '.' + Nodes.classRoot, function () {\n      self.nodes.rootHandler.call(self.nodes, _d3.select(this), true);\n    });\n\n    if (this.querying) {\n      this.svgJq.on('click', '.' + Nodes.classFocusControls + '.' + Nodes.classQuery, function () {\n        self.nodes.queryHandler.call(self.nodes, _d3.select(this.parentNode), 'unquery');\n        self.nodeContextMenu.updateStates();\n      });\n    }\n\n    this.svgJq.on('mouseenter', '.' + Nodes.classNodeVisible, function () {\n      self.interactionWrapper.call(self, function (domEl, data) {\n        if (!this.vis.activeScrollbar) {\n          this.enterHandler.call(this, domEl, data);\n        }\n      }.bind(self.nodes), [this, _d3.select(this).datum()]);\n    });\n\n    this.svgJq.on('mouseleave', '.' + Nodes.classNodeVisible, function () {\n      self.interactionWrapper.call(self, function (domEl, data) {\n        if (!this.vis.activeScrollbar) {\n          this.leaveHandler.call(this, domEl, data);\n        }\n      }.bind(self.nodes), [this, _d3.select(this).datum()]);\n    });\n\n    // Normally we would reference a named methods but since we need to access\n    // the class' `this` property instead of the DOM element we need to use an\n    // arrow function.\n    this.scrollbars.all.on('mousedown', function () {\n      self.scrollbarMouseDown(this, _d3.event);\n    });\n\n    // We need to listen to `mouseup` and `mousemove` globally otherwise\n    // scrolling will only work as long as the cursor hovers the actual\n    // scrollbar, which is super annoying.\n    _d3.select(document).on('mouseup', function () {\n      _this.globalMouseUp(_d3.event);\n    });\n\n    // Enable dragging of the whole graph.\n    this.svgD3.call(onDragDrop, this.dragStartHandler.bind(this), this.dragMoveHandler.bind(this), this.dragEndHandler.bind(this), [this.container, this.topbar.localControlWrapper], 'horizontal', this.getDragLimits.bind(this), this.noDragging.bind(this), this.dragged, 2);\n\n    this.events.on('d3ListGraphLevelFocus', function (levelId) {\n      return _this.levels.focus(levelId);\n    });\n\n    this.events.on('d3ListGraphNodeRoot', function () {\n      _this.nodes.bars.updateAll(_d3.listGraph.updateBars(_this.data), _this.currentSorting.global.type);\n      _this.updateSorting();\n    });\n\n    this.events.on('d3ListGraphNodeUnroot', function () {\n      _this.nodes.bars.updateAll(_d3.listGraph.updateBars(_this.data), _this.currentSorting.global.type);\n      _this.updateSorting();\n    });\n\n    this.events.on('d3ListGraphUpdateBars', function () {\n      _this.nodes.bars.updateAll(_d3.listGraph.updateBars(_this.data), _this.currentSorting.global.type);\n      _this.updateSorting();\n    });\n\n    this.events.on('d3ListGraphActiveLevel', function (nextLevel) {\n      var oldLevel = _this.activeLevel;\n      _this.activeLevel = Math.max(nextLevel, 0);\n      if (_this.nodes.rootedNode) {\n        var rootNodeDepth = _this.nodes.rootedNode.datum().depth;\n        _this.levels.blur(rootNodeDepth + oldLevel);\n        _this.levels.focus(rootNodeDepth + _this.activeLevel);\n      } else {\n        _this.levels.blur(oldLevel - _this.noRootActiveLevelDiff);\n        _this.levels.focus(_this.activeLevel - _this.noRootActiveLevelDiff);\n      }\n    });\n\n    // Initialize `this.left` and `this.top`\n    this.getBoundingRect();\n  }\n\n  /**\n   * Get visually used area of the container\n   *\n   * @method  area\n   * @author  Fritz Lekschas\n   * @date    2016-10-02\n   * @return  {Object}  Bounding client rectangle.\n   */\n\n\n  createClass(ListGraph, [{\n    key: 'checkGlobalClick',\n\n\n    /**\n     * Check global mouse click\n     *\n     * @method  checkGlobalClick\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  target  DOM element\n     */\n    value: function checkGlobalClick(target) {\n      var found = {};\n      var checkClass = Object.keys(this.outsideClickClassHandler).length;\n\n      var el = target;\n      try {\n        while (!el.__d3ListGraphBase__) {\n          if (el.__id__) {\n            for (var i = el.__id__.length; i--;) {\n              found[el.__id__[i]] = true;\n            }\n          }\n          if (checkClass) {\n            var classNames = Object.keys(this.outsideClickClassHandler);\n            for (var _i = classNames.length; _i--;) {\n              var className = el.getAttribute('class');\n              if (className && className.indexOf(classNames[_i]) >= 0) {\n                found[this.outsideClickClassHandler[classNames[_i]].id] = true;\n              }\n            }\n          }\n          el = el.parentNode;\n        }\n      } catch (e) {\n        return;\n      }\n\n      var handlerIds = Object.keys(this.outsideClickHandler);\n      for (var _i2 = handlerIds.length; _i2--;) {\n        if (!found[handlerIds[_i2]]) {\n          this.outsideClickHandler[handlerIds[_i2]].callback.call(this);\n        }\n      }\n    }\n\n    /**\n     * Check which nodes of a level are visible.\n     *\n     * @method  checkNodeVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Number}  level            Index of the level or column.\n     * @param   {[type]}             customScrollTop  [description]\n     */\n\n  }, {\n    key: 'checkNodeVisibility',\n    value: function checkNodeVisibility(level, customScrollTop) {\n      var nodes = level ? this.nodes.nodes.filter(function (data) {\n        return data.depth === level;\n      }) : this.nodes.nodes;\n\n      nodes.call(this.nodes.isInvisible.bind(this.nodes), customScrollTop);\n    }\n\n    /**\n     * Drag end handler\n     *\n     * @method  dragEndHandler\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'dragEndHandler',\n    value: function dragEndHandler() {\n      if (this.dragging) {\n        this.noInteractions = this.dragging = false;\n      }\n    }\n\n    /**\n     * Get the minimal drag X value\n     *\n     * @method  dragMinX\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @return  {Number}  Minimal drag x value.\n     */\n\n  }, {\n    key: 'dragMoveHandler',\n\n\n    /**\n     * Drag-move handler instance.\n     *\n     * @method  dragMoveHandler\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}           data            D3's drag event object.\n     * @param   {Array}            elsToBeDragged  Array of D3 selections.\n     * @param   {String}           orientation     Can either be \"horizontal\",\n     *   \"vertical\" or `undefined`, i.e. both directions.\n     * @param   {Object|Function}  limits          X and Y drag limits. E.g.\n     *   `{ x: { min: 0, max: 10 } }`.\n     */\n    value: function dragMoveHandler(data, elsToBeDragged, orientation, limits) {\n      dragMoveHandler$1(data, elsToBeDragged, orientation, limits);\n      this.checkNodeVisibility();\n    }\n\n    /**\n     * Method for scrolling a column of nodes when the scrollbar is dragged.\n     *\n     * @method  dragScrollbar\n     * @author  Fritz Lekschas\n     * @date    2016-09-12\n     * @param   {Object}  event  D3's _mousemove_ event object.\n     */\n\n  }, {\n    key: 'dragScrollbar',\n    value: function dragScrollbar(event$$1) {\n      event$$1.preventDefault();\n      var data = this.activeScrollbar.datum();\n      var deltaY = data.scrollbar.clientY - event$$1.clientY;\n\n      // Scroll scrollbar\n      ListGraph.scrollElVertically(this.activeScrollbar.node(), Math.min(Math.max(data.scrollbar.scrollTop - deltaY, 0), data.scrollbar.scrollHeight));\n\n      // Scroll content\n      var contentScrollTop = Math.max(Math.min(data.scrollTop + data.invertedHeightScale(deltaY), 0), -data.scrollHeight);\n\n      ListGraph.scrollElVertically(data.nodes, contentScrollTop);\n\n      // Scroll Links\n      if (data.level !== this.visData.nodes.length) {\n        this.links.scroll(data.linkSelections.outgoing, this.layout.offsetLinks(data.level, contentScrollTop, 'source'));\n      }\n\n      if (data.level > 0) {\n        this.links.scroll(data.linkSelections.incoming, this.layout.offsetLinks(data.level - 1, contentScrollTop, 'target'));\n      }\n\n      if (this.showLinkLocation) {\n        this.nodes.updateLinkLocationIndicators(data.level - 1, data.level + 1);\n      }\n\n      if (this.nodeContextMenu.opened) {\n        this.nodeContextMenu.scrollY(contentScrollTop);\n      }\n\n      // Check if nodes are visible.\n      this.checkNodeVisibility(data.level, contentScrollTop);\n    }\n\n    /**\n     * Drag start handler\n     *\n     * @method  dragStartHandler\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'dragStartHandler',\n    value: function dragStartHandler() {\n      if (!this.dragging) {\n        this.noInteractions = this.dragging = true;\n      }\n    }\n\n    /**\n     * Helper method to get the top and left position of the base `svg`.\n     *\n     * @Description\n     * Calling `getBoundingClientRect()` right at the beginning leads to errornous\n     * values, probably because the function is called because HTML has been fully\n     * rendered.\n     *\n     * @method  getBoundingRect\n     * @author  Fritz Lekschas\n     * @date    2016-02-24\n     */\n\n  }, {\n    key: 'getBoundingRect',\n    value: function getBoundingRect() {\n      this.left = this.svgEl.getBoundingClientRect().left;\n      this.top = this.svgEl.getBoundingClientRect().top;\n    }\n\n    /**\n     * Get drag limits\n     *\n     * @method  dragLimits\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @return  {Object}  Min and max drag limits.\n     */\n\n  }, {\n    key: 'getDragLimits',\n    value: function getDragLimits() {\n      return {\n        x: {\n          min: this.dragMinX,\n          max: 0\n        }\n      };\n    }\n\n    /**\n     * Global _mouseUp_ event handler\n     *\n     * @method  globalMouseUp\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {[type]}       event  [description]\n     * @return  {[type]}              [description]\n     */\n\n  }, {\n    key: 'globalMouseUp',\n    value: function globalMouseUp(event$$1) {\n      this.noInteractions = false;\n      this.mouseDownOnContextMenu = false;\n\n      if (this.activeScrollbar) {\n        var data = this.activeScrollbar.datum();\n        var deltaY = data.scrollbar.clientY - event$$1.clientY;\n\n        // Save final vertical position\n        // Scrollbar\n        data.scrollbar.scrollTop = Math.min(Math.max(data.scrollbar.scrollTop - deltaY, 0), data.scrollbar.scrollHeight);\n\n        // Content\n        data.scrollTop = Math.max(Math.min(data.scrollTop + data.invertedHeightScale(deltaY), 0), -data.scrollHeight);\n\n        this.activeScrollbar.classed('active', false);\n\n        this.activeScrollbar = undefined;\n\n        ListGraph.stopScrollBarMouseMove();\n      }\n    }\n\n    /**\n     * Show the complete graph by zooming out\n     *\n     * @method  globalView\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  selectionInterst  D3 selection of nodes of interest,\n     *   which restrict the amount of zoom-out. If `undefined` the whole graph\n     *   will be shown.\n     */\n\n  }, {\n    key: 'globalView',\n    value: function globalView(selectionInterst) {\n      var _this2 = this;\n\n      if (!this.zoomedOut) {\n        (function () {\n          var x = 0;\n          var y = 0;\n          var width = 0;\n          var height = 0;\n          var cRect = void 0;\n          var contBBox = _this2.container.node().getBBox();\n\n          var globalCRect = _this2.svgD3.node().getBoundingClientRect();\n\n          if (selectionInterst && !selectionInterst.empty()) {\n            selectionInterst.each(function () {\n              cRect = this.getBoundingClientRect();\n              width = Math.max(width, cRect.left - (globalCRect.left + cRect.width));\n              height = Math.max(height, cRect.top - (globalCRect.top + cRect.height));\n            });\n            width = _this2.width > width ? _this2.width : width;\n            height = _this2.height > height ? _this2.height : height;\n          } else {\n            width = _this2.width > contBBox.width ? _this2.width : contBBox.width;\n            height = _this2.height > contBBox.height ? _this2.height : contBBox.height;\n          }\n\n          x = contBBox.x + _this2.dragged.x;\n          y = contBBox.y;\n\n          _this2.nodes.makeAllTempVisible();\n          _this2.links.makeAllTempVisible();\n\n          _this2.svgD3.classed('zoomedOut', true).transition().duration(TRANSITION_SEMI_FAST).attr('viewBox', x + ' ' + y + ' ' + width + ' ' + height);\n        })();\n      }\n    }\n\n    /**\n     * Interaction wrapper\n     *\n     * @description\n     * Cheks if interacctions are allowed first.\n     *\n     * @method  interactionWrapper\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Function}  callback  Callback function.\n     * @param   {Object}    params    Parameters of the callback function.\n     */\n\n  }, {\n    key: 'interactionWrapper',\n    value: function interactionWrapper(callback, params) {\n      if (!this.noInteractions) {\n        callback.apply(this, params);\n      }\n    }\n\n    /**\n     * Check if an element is actually visible, i.e. within the boundaries of the\n     * SVG element.\n     *\n     * @method  isHidden\n     * @author  Fritz Lekschas\n     * @date    2016-02-24\n     * @param   {Object}    el  DOM element to be checked.\n     * @return  {Boolean}       If `true` element is not visible.\n     */\n\n  }, {\n    key: 'isHidden',\n    value: function isHidden(el) {\n      var boundingRect = el.getBoundingClientRect();\n      return boundingRect.top + boundingRect.height <= this.top || boundingRect.left + boundingRect.width <= this.left || boundingRect.top >= this.top + this.height || boundingRect.left >= this.left + this.width;\n    }\n\n    /**\n     * Assesses whether a link's end points outwards\n     *\n     * @method  linkPointsOutside\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}  data  Link data.\n     * @return  {Number}  If link ends inwards returns `0`, if it points outwards\n     *   to the top returns `1` or `2` when it points to the bottom. If the node\n     *   pointed to is hidden return `16`.\n     */\n\n  }, {\n    key: 'linkPointsOutside',\n    value: function linkPointsOutside(data) {\n      var y = data.node.y + data.offsetY;\n      if (data.node.hidden) {\n        return 16;\n      }\n      if (y + this.visData.global.row.height - this.visData.global.row.padding <= 0) {\n        return 1;\n      }\n      if (y + this.visData.global.row.padding >= this.height) {\n        return 2;\n      }\n      return 0;\n    }\n\n    /**\n     * Scroll column by the mouseWheel action\n     *\n     * @method  mousewheelColumn\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  el     DOM element\n     * @param   {Object}  event  jQuery event object.\n     */\n\n  }, {\n    key: 'mousewheelColumn',\n    value: function mousewheelColumn(el, event$$1) {\n      event$$1.preventDefault();\n\n      var data = _d3.select(el).datum();\n\n      if (data.scrollHeight > 0) {\n        // Scroll nodes\n        data.scrollTop = Math.max(Math.min(data.scrollTop + event$$1.deltaY, 0), -data.scrollHeight);\n\n        this.scrollY(data);\n      }\n\n      // Check if nodes are visible.\n      this.checkNodeVisibility(data.level);\n    }\n\n    /**\n     * Check if dragging should be disabled.\n     *\n     * @description\n     * When the scrollbar or context menu is clicked the graph shouldn#t be\n     * draggable.\n     *\n     * @method  noDragging\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @return  {Boolean}  If `true` the graph shouldn't be draggable.\n     */\n\n  }, {\n    key: 'noDragging',\n    value: function noDragging() {\n      return !!this.activeScrollbar || this.mouseDownOnContextMenu;\n    }\n\n    /**\n     * Assesses any of the two ends of a link points outwards.\n     *\n     * @description\n     * In order to be able to determine where a link points to, the output of\n     * `linkPointsOutside` for the source and target location is shifted bitwise\n     * in such a way that this method return 11 unique numbers.\n     * - 0: link is completely inwards\n     * - 1: source is outwards to the top\n     * - 2: source is outwards to the bottom\n     * - 4: target is outwards to the top\n     * - 8: target is outwards to the bottom\n     * - 5: source and target are outwards to the top\n     * - 6: source is outwards to the bottom and target is outwards to the top\n     * - 9: source is outwards to the top and target is outwards to the bottom\n     * - 10: source and target are outwards to the bottom\n     * - 16: source is invisible\n     * - 64: target is invisible\n     *\n     * If you're asking yourself: \"WAT?!?!!\" Think of a 4x4 binary matrix:\n     * |    target    |    source    |\n     * | bottom | top | bottom | top |\n     * |    0   |  0  |    0   |  0  | (=0)\n     * |    0   |  0  |    0   |  1  | (=1)\n     * |    0   |  0  |    1   |  0  | (=2)\n     * |    0   |  1  |    0   |  0  | (=4)\n     * |    1   |  0  |    0   |  0  | (=8)\n     * |    0   |  1  |    0   |  1  | (=5)\n     * |    0   |  1  |    1   |  0  | (=6)\n     * |    1   |  0  |    0   |  1  | (=9)\n     * |    1   |  0  |    1   |  0  | (=10)\n     *\n     * *Note: 16 and 64 are two special values when the source or target node is\n     * hidden. The numbers are so hight just because that the bitwise-and with 4\n     * and 8 results to 0.\n     *\n     * To check whether the source or target location is above, below or within\n     * the global SVG container is very simple. For example, to find out if the\n     * target location is above, all we need to do is `<VALUE> & 4 > 0`. This\n     * performs a bit-wise AND operation with only two possible outcomes: 4 and 0.\n     *\n     * @method  pointsOutside\n     * @author  Fritz Lekschas\n     * @date    2016-09-14\n     * @param   {Object}  data  Link data.\n     * @return  {Number}  Numberical represenation of the links constallation. See\n     *   description for details.\n     */\n\n  }, {\n    key: 'pointsOutside',\n    value: function pointsOutside(data) {\n      var source = this.linkPointsOutside(data.source);\n      var target = this.linkPointsOutside(data.target) << 2;\n      return source | target;\n    }\n\n    /**\n     * Register an outside mouse click handler\n     *\n     * @method  registerOutSideClickHandler\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {String}     id            ID of the handler to be removed.\n     * @param   {Array}      els           Array of elements to be registered.\n     * @param   {[type]}     elClassNames  Element class names.\n     * @param   {Function}   callback      Callback function\n     * @return  {Number}                   Return number of outside click\n     *   handlers.\n     */\n\n  }, {\n    key: 'registerOutSideClickHandler',\n    value: function registerOutSideClickHandler(id, els, elClassNames, callback) {\n      // We need to register a unique property to be able to efficiently identify\n      // the element later.\n      for (var i = els.length; i--;) {\n        if (els[i].__id__) {\n          els[i].__id__.push(id);\n        } else {\n          els[i].__id__ = [id];\n        }\n      }\n      var newLength = this.outsideClickHandler[id] = {\n        id: id, els: els, elClassNames: elClassNames, callback: callback\n      };\n      for (var _i3 = elClassNames.length; _i3--;) {\n        this.outsideClickClassHandler[elClassNames[_i3]] = this.outsideClickHandler[id];\n      }\n      return newLength;\n    }\n\n    /**\n     * Helper method to scroll all columns to the top.\n     *\n     * @method  resetAllScrollPositions\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'resetAllScrollPositions',\n    value: function resetAllScrollPositions() {\n      return this.scrollYTo(this.levels.groups, 0);\n    }\n\n    /**\n     * Scrollbar _mouseDown_ handler\n     *\n     * @method  scrollbarMouseDown\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  el     DOM element.\n     * @param   {Object}  event  D3 _mouseDown_ event object.\n     */\n\n  }, {\n    key: 'scrollbarMouseDown',\n    value: function scrollbarMouseDown(el, event$$1) {\n      this.noInteractions = true;\n      this.activeScrollbar = _d3.select(el).classed('active', true);\n      this.activeScrollbar.datum().scrollbar.clientY = event$$1.clientY;\n      this.startScrollBarMouseMove();\n    }\n\n    /**\n     * Scroll an element vertically\n     *\n     * @method  scrollElVertically\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  el      DOM element to be scrolled.\n     * @param   {Number}  offset  Number of pixel to be scrolled.\n     */\n\n  }, {\n    key: 'scrollY',\n\n\n    /**\n     * Scroll column of nodes.\n     *\n     * @method  scrollY\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}   columnData         D3 data object of the column.\n     * @param   {Boolean}  scrollbarDragging  If `true` column is scrolled by\n     *   dragging the scrollbar.\n     */\n    value: function scrollY(columnData, scrollbarDragging) {\n      ListGraph.scrollElVertically(columnData.nodes, columnData.scrollTop);\n\n      if (!scrollbarDragging) {\n        // Scroll scrollbar\n        columnData.scrollbar.scrollTop = columnData.scrollbar.heightScale(-columnData.scrollTop);\n\n        ListGraph.scrollElVertically(columnData.scrollbar.el, columnData.scrollbar.scrollTop);\n      }\n\n      // Scroll Links\n      if (columnData.level !== this.visData.nodes.length) {\n        this.links.scroll(columnData.linkSelections.outgoing, this.layout.offsetLinks(columnData.level, columnData.scrollTop, 'source'));\n      }\n\n      if (columnData.level > 0) {\n        this.links.scroll(columnData.linkSelections.incoming, this.layout.offsetLinks(columnData.level - 1, columnData.scrollTop, 'target'));\n      }\n\n      if (this.showLinkLocation) {\n        this.nodes.updateLinkLocationIndicators(columnData.level - 1, columnData.level + 1);\n      }\n\n      if (this.nodeContextMenu.isOpenSameColumn(columnData.level)) {\n        this.nodeContextMenu.scrollY(columnData.scrollTop);\n      }\n    }\n\n    /**\n     * Scroll to a certain vertical position in a column\n     *\n     * @method  scrollYTo\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Object}  selection  D3 selection of columns.\n     * @param   {Number}  positionY  Position in pixel to be scrolled to.\n     */\n\n  }, {\n    key: 'scrollYTo',\n    value: function scrollYTo(selection, positionY) {\n      var _this3 = this;\n\n      return selection.transition().duration(TRANSITION_SEMI_FAST).tween('scrollY', function (data) {\n        var scrollPositionY = _d3.interpolateNumber(data.scrollTop, positionY);\n        return function (time) {\n          data.scrollTop = scrollPositionY(time);\n          _this3.scrollY(data);\n        };\n      });\n    }\n\n    /**\n     * Select elements by column\n     *\n     * @method  selectByLevel\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Number}  level     Index of the column or level.\n     * @param   {String}  selector  Query selector string.\n     * @return  {Object}            D3 selection.\n     */\n\n  }, {\n    key: 'selectByLevel',\n    value: function selectByLevel(level, selector) {\n      return _d3.select(this.levels.groups._groups[0][level]).selectAll(selector);\n    }\n\n    /**\n     * Sort all columns or levels\n     *\n     * @method  sortAllColumns\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {String}   property     Node property to be sorted by.\n     * @param   {Boolean}  newSortType  If `true` sorted by a new type.\n     */\n\n  }, {\n    key: 'sortAllColumns',\n    value: function sortAllColumns(property, newSortType) {\n      this.currentSorting.global.order = this.currentSorting.global.order === -1 && !newSortType ? 1 : -1;\n\n      this.nodes.sort(this.layout.sort(undefined, property, this.currentSorting.global.order).updateNodesVisibility().nodes(), newSortType);\n\n      this.links.sort(this.layout.links());\n      this.nodeContextMenu.updatePosition();\n      this.checkNodeVisibility();\n    }\n\n    /**\n     * Sort a column or level\n     *\n     * @method  sortColumn\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {Integer}   level        Specifies the level which should be\n     *   sorted.\n     * @param   {String}    property     The property used for sorting. Can be one\n     *   of ['precision', 'recall', 'name'].\n     * @param   {Integer}   sortOrder    If `1` sort asc. If `-1` sort desc.\n     * @param   {String}    newSortType  Property to be sorted by.\n     */\n\n  }, {\n    key: 'sortColumn',\n    value: function sortColumn(level, property, sortOrder, newSortType) {\n      this.nodes.sort(this.layout.sort(level, property, sortOrder).updateNodesVisibility().nodes(level), newSortType);\n      this.links.sort(this.layout.links(level - 1, level + 1));\n      this.nodeContextMenu.updatePosition();\n      this.checkNodeVisibility();\n    }\n\n    /**\n     * Start listening to the _mouseMove_ event when the scroll drag is started\n     *\n     * @method  startScrollBarMouseMove\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'startScrollBarMouseMove',\n    value: function startScrollBarMouseMove() {\n      var _this4 = this;\n\n      _d3.select(document).on('mousemove', function () {\n        _this4.dragScrollbar(_d3.event);\n      });\n    }\n\n    /**\n     * Stop listening to the _mouseMove_ event when the scroll bar drag is over\n     *\n     * @method  stopScrollBarMouseMove\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'switchBarMode',\n\n\n    /**\n     * Switch node bar mode\n     *\n     * @method  switchBarMode\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {String}  mode  Bar mode. Either \"one\" or \"two\".\n     */\n    value: function switchBarMode(mode) {\n      this.svgD3.classed('one-bar', mode === 'one');\n      this.svgD3.classed('two-bar', mode === 'two');\n      this.nodes.bars.switchMode(mode, this.currentSorting);\n    }\n\n    /**\n     * Helper method to trigger an event\n     *\n     * @method  trigger\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {[type]}    event  [description]\n     * @param   {[type]}    data   [description]\n     * @return  {[type]}           [description]\n     */\n\n  }, {\n    key: 'trigger',\n    value: function trigger(event$$1, data) {\n      this.events.trigger(event$$1, data);\n    }\n\n    /**\n     * Toggle between the global and zoomed graph view.\n     *\n     * @method  toggleView\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'toggleView',\n    value: function toggleView() {\n      if (this.zoomedOut) {\n        this.zoomedOut = false;\n        this.zoomedView();\n      } else {\n        this.globalView();\n        this.zoomedOut = true;\n      }\n    }\n\n    /**\n     * Remove outside mouse click handler\n     *\n     * @method  unregisterOutSideClickHandler\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {String}  id  ID of the handler to be removed.\n     */\n\n  }, {\n    key: 'unregisterOutSideClickHandler',\n    value: function unregisterOutSideClickHandler(id) {\n      var handler = this.outsideClickHandler[id];\n\n      // Remove element `__id__` property.\n      for (var i = handler.els.length; i--;) {\n        handler.els[i].__id__ = undefined;\n        delete handler.els[i].__id__;\n      }\n\n      // Remove handler.\n      this.outsideClickHandler[id] = undefined;\n      delete this.outsideClickHandler[id];\n    }\n\n    /**\n     * Helper method to trigger an update of the columns' or levels' visibility\n     *\n     * @method  updateLevelsVisibility\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'updateLevelsVisibility',\n    value: function updateLevelsVisibility() {\n      this.levels.updateVisibility();\n    }\n\n    /**\n     * Update the scroll position and scroll-bar visibility.\n     *\n     * @description\n     * This method needs to be called after hiding or showing nodes.\n     *\n     * @method  updateScrolling\n     * @author  Fritz Lekschas\n     * @date    2016-02-21\n     */\n\n  }, {\n    key: 'updateScrolling',\n    value: function updateScrolling() {\n      var _this5 = this;\n\n      this.resetAllScrollPositions().call(allTransitionsEnded, function () {\n        _this5.levels.updateScrollProperties();\n        _this5.scrollbars.updateVisibility();\n      });\n    }\n\n    /**\n     * Update column sorting given the current sort settings.\n     *\n     * @method  updateSorting\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'updateSorting',\n    value: function updateSorting() {\n      var levels = Object.keys(this.currentSorting.local);\n      for (var i = levels.length; i--;) {\n        this.sortColumn(i, this.currentSorting.local[levels[i]].type, this.currentSorting.local[levels[i]].order, this.currentSorting.local[levels[i]].type);\n      }\n    }\n\n    /**\n     * Show original zoomed graph\n     *\n     * @method  zoomedView\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     */\n\n  }, {\n    key: 'zoomedView',\n    value: function zoomedView() {\n      if (!this.zoomedOut) {\n        this.nodes.makeAllTempVisible(true);\n        this.links.makeAllTempVisible(true);\n\n        this.svgD3.classed('zoomedOut', false).transition().duration(TRANSITION_SEMI_FAST).attr('viewBox', '0 0 ' + this.width + ' ' + this.height);\n      }\n    }\n  }, {\n    key: 'area',\n    get: function get() {\n      return this.container.node().getBoundingClientRect();\n    }\n\n    /**\n     * Get current bar mode.\n     *\n     * @method  barMode\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @return  {String}  Bar mode. Either \"one\" or \"two\".\n     */\n\n  }, {\n    key: 'barMode',\n    get: function get() {\n      if (this.bars) {\n        return this.nodes.bars.mode;\n      }\n      return this._barMode;\n    }\n\n    /**\n     * Set bar mode.\n     *\n     * @method  barMode\n     * @author  Fritz Lekschas\n     * @date    2016-10-02\n     * @param   {String}  mode  Bar mode. Either \"one\" or \"two\".\n     */\n    ,\n    set: function set(mode) {\n      if (this.bars) {\n        this.nodes.bars.mode = mode;\n      }\n      this._barMode = mode;\n    }\n  }, {\n    key: 'dragMinX',\n    get: function get() {\n      return Math.min(0, this.width - this.area.width);\n    }\n  }], [{\n    key: 'scrollElVertically',\n    value: function scrollElVertically(el, offset) {\n      _d3.select(el).attr('transform', 'translate(0, ' + offset + ')');\n    }\n  }, {\n    key: 'stopScrollBarMouseMove',\n    value: function stopScrollBarMouseMove() {\n      _d3.select(document).on('mousemove', null);\n    }\n  }]);\n  return ListGraph;\n}();\n\nListGraph.version = '0.17.0';\n\nreturn ListGraph;\n\n})));\n"],"sourceRoot":"/source/"}