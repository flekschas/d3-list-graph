/* Copyright Fritz Lekschas: D3 layout for list-based graphs */
!function(t){"use strict";function e(t){return t&&t.Object===Object?t:null}function r(t){return"number"==typeof t&&F(t)}function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t,e){return t===e||t!==t&&e!==e}function i(t,e,r){var n=t[e];_.call(t,e)&&o(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function a(t,e,r,n){r||(r={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=n?n(r[s],t[s],s,r,t):t[s];i(r,s,c)}return r}function s(t){return function(e){return null==e?void 0:e[t]}}function c(t){var e=n(t)?X.call(t):"";return e==z||e==D}function u(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=q}function l(t){return null!=t&&u(Y(t))&&!c(t)}function h(t,e){return e=null==e?H:e,!!e&&("number"==typeof t||V.test(t))&&t>-1&&t%1==0&&t<e}function f(t,e,r){if(!n(r))return!1;var i=typeof e;return!!("number"==i?l(r)&&h(e,r.length):"string"==i&&e in r)&&o(r[e],t)}function d(t,e,r){var n=r.length;switch(n){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function p(t){return!!t&&"object"==typeof t}function g(t){return"symbol"==typeof t||p(t)&&K.call(t)==W}function b(t){if("number"==typeof t)return t;if(g(t))return Q;if(n(t)){var e=c(t.valueOf)?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(U,"");var r=tt.test(t);return r||et.test(t)?rt(t.slice(2),r?2:8):Z.test(t)?Q:+t}function v(t){if(!t)return 0===t?t:0;if(t=b(t),t===nt||t===-nt){var e=t<0?-1:1;return e*ot}return t===t?t:0}function y(t){var e=v(t),r=e%1;return e===e?r?e-r:e:0}function m(t,e){if("function"!=typeof t)throw new TypeError(it);return e=at(void 0===e?t.length-1:y(e),0),function(){for(var r=arguments,n=-1,o=at(r.length-e,0),i=Array(o);++n<o;)i[n]=r[e+n];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,r[0],i);case 2:return t.call(this,r[0],r[1],i)}var a=Array(e+1);for(n=-1;++n<e;)a[n]=r[n];return a[e]=i,d(t,this,a)}}function O(t){return m(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,a=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,a&&f(r[0],r[1],a)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var s=r[n];s&&t(e,s,n,i)}return e})}function w(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||st;return t===r}function j(t){return ct(Object(t))}function k(t,e){return null!=t&&(lt.call(t,e)||"object"==typeof t&&e in t&&null===j(t))}function I(t){return ht(Object(t))}function S(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function x(t){return p(t)&&l(t)}function M(t){return x(t)&&pt.call(t,"callee")&&(!bt.call(t,"callee")||gt.call(t)==ft)}function N(t){return"string"==typeof t||!E(t)&&p(t)&&mt.call(t)==vt}function P(t){var e=t?t.length:void 0;return u(e)&&(E(t)||N(t)||M(t))?S(e,String):null}function C(t){var e=w(t);if(!e&&!l(t))return I(t);var r=P(t),n=!!r,o=r||[],i=o.length;for(var a in t)!k(t,a)||n&&("length"==a||h(a,i))||e&&"constructor"==a||o.push(a);return o}function R(t,e,r,o,i,a){function s(t){if(t.data.bars)if(E(t.data.bars)){t.data.barRefs={};for(var e=0,r=t.data.bars.length;e<r;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(n(t.data.bars)){var o=[],i=Object.keys(t.data.bars);t.data.barRefs={};for(var a=0,s=i.length;a<s;a++)t.data.barRefs[i[a]]=Math.max(Math.min(t.data.bars[i[a]],1),0),o.push({barId:t.id+"."+i[a],id:i[a],value:t.data.barRefs[i[a]]});t.data.bars=o}}function c(t,e){var r="("+t.id+")->("+e.id+")";a[r]={id:r,source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}},t.links.outgoing.refs.push(a[r]),e.links.incoming.refs.push(a[r]),t.links.outgoing.total++,e.links.incoming.total++}function u(e,n,a,u){var l=e.toString(),h=n,f=!1;if(u){for(var d=n.clones.length;d--;)if(n.clones[d].depth===a.depth+1){f=!0,l=n.clones[d].cloneId,h=n.clones[d];break}if(a.depth+1!==n.depth&&!f){var p=e+"."+(n.clones.length+1);t[p]={children:[],clone:!0,cloneId:p,cloneNum:n.clones.length+1,data:n.data,originalId:e.toString(),originalNode:n},l=p,h=t[p],n.clones.push(h),n.parents[a.id]=void 0,delete n.parents[a.id]}}else h.clones=[];h.id=l,h.parents||(h.parents={}),a?h.parents[a.id]=a:h.parents={},h.data.state||(h.data.state={}),h.childRefs||(h.childRefs=[]),a?(h.depth=a.depth+1,a.childRefs.push(h)):h.depth=0,h.links||(h.links={incoming:{refs:[],above:0,below:0,total:0},outgoing:{refs:[],above:0,below:0,total:0}}),r[h.depth]||(r[h.depth]={},o[h.depth]=[]),r[h.depth][l]||(r[h.depth][l]=!0,o[h.depth].push(h),h.x=i.x(h.depth),h.y=i.y(Object.keys(r[h.depth]).length-1)),s(h),a&&c(a,h)}function l(){for(var r=e.length;r--;)for(var n=e.length;n--;)r!==n&&(t[e[r]].siblings||(t[e[r]].siblings={}),t[e[r]].siblings[e[n]]=t[e[n]])}for(var h={},f=[],d=e.length;d--;){if(!t[e[d]])return;for(u(e[d],t[e[d]]),f.push(e[d]),h[e[d]]=!0;f.length>0;)for(var p=t[f.shift()],g=p.children.length;g--;){var b=p.children[g],v=t[b];if(v){var y=!0;h[b]||(f.push(b),h[b]=!0,y=!1),u(b,v,p,y)}}}l()}var E=Array.isArray,T=e("object"==typeof global&&global),A=e("object"==typeof self&&self),$=e(!1),B=T||A||$||Function("return this")(),F=B.isFinite,G=Object.prototype,_=G.hasOwnProperty,Y=s("length"),z="[object Function]",D="[object GeneratorFunction]",L=Object.prototype,X=L.toString,q=9007199254740991,H=9007199254740991,V=/^(?:0|[1-9]\d*)$/,W="[object Symbol]",J=Object.prototype,K=J.toString,Q=NaN,U=/^\s+|\s+$/g,Z=/^[-+]0x[0-9a-f]+$/i,tt=/^0b[01]+$/i,et=/^0o[0-7]+$/i,rt=parseInt,nt=1/0,ot=1.7976931348623157e308,it="Expected a function",at=Math.max,st=Object.prototype,ct=Object.getPrototypeOf,ut=Object.prototype,lt=ut.hasOwnProperty,ht=Object.keys,ft="[object Arguments]",dt=Object.prototype,pt=dt.hasOwnProperty,gt=dt.toString,bt=dt.propertyIsEnumerable,vt="[object String]",yt=Object.prototype,mt=yt.toString,Ot=Object.prototype,wt=Ot.hasOwnProperty,jt=Ot.propertyIsEnumerable,kt=!jt.call({valueOf:1},"valueOf"),It=O(function(t,e){if(kt||w(e)||l(e))return void a(e,C(e),t);for(var r in e)wt.call(e,r)&&i(t,r,e[r])}),St={width:300,height:300},xt={columns:3,rows:3},Mt=.2,Nt=.05,Pt=.05,Ct=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Rt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Et=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Tt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},At=function(t){function e(t){Ct(this,e);var r=Tt(this,Object.getPrototypeOf(e).call(this,t));return r.name=r.constructor.name,r.message=t,Error.captureStackTrace(r,r.constructor.name),r}return Et(e,t),e}(Error),$t=function(t){function e(t){return Ct(this,e),Tt(this,Object.getPrototypeOf(e).call(this,t||"No root node IDs specified."))}return Et(e,t),e}(At),Bt=Pt,Ft={columns:xt.columns,rows:xt.rows},Gt={width:St.width,height:St.height},_t={},Yt=Mt,zt=Nt,Dt=void 0,Lt=void 0,Xt=void 0,qt=void 0,Ht=void 0,Vt=void 0,Wt=void 0,Jt=function(){function e(r,n){Ct(this,e),this.scale={x:t.scale.linear(),y:t.scale.linear(),linkPosition:{}},this.grid(n),this.size(r),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return Rt(e,[{key:"nodesToMatrix",value:function(t){var e=[],n=0,o=Object.keys(this.columnCache).length;r(t)&&(n=t,o=t+1);for(var i=n;i<o;i++){e.push({y:0,x:this.scale.x(i),level:i,rows:[],sortBy:this.columnSorting[i].by,sortOrder:this.columnSorting[i].order});for(var a=Object.keys(this.columnCache[i]),s=a.length;s--;)e[i-n].rows.push(this.data[a[s]])}return e}},{key:"process",value:function(t,e,n){if(this.data=t||this.data,this.rootIds=e||this.rootIds,!E(this.rootIds)){if(!r(this.rootIds))throw new $t("No root node IDs specified.");this.rootIds=[this.rootIds]}var o=It({},n);R(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.scale,_t);for(var i=Object.keys(this.columnCache).length;i--;)this.columnSorting[i]={};return o.sortBy&&this.sort(void 0,n.sortBy,n.sortOrder||"desc"),{global:this.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"sort",value:function(t,e,n){var o=0,i=Object.keys(this.columnCache).length,a=void 0,s=void 0,c=1===n?1:-1;switch(e){case"precision":s="precision",a=function(t){return t.data.barRefs.precision};break;case"recall":s="recall",a=function(t){return t.data.barRefs.recall};break;default:a=function(t){return t.data.name.toLowerCase()},s="name"}for(r(t)&&(o=t,i=t+1),o;o<i;o++){this.columnNodeOrder[o].sort(function(t,e){var r=a(t),n=a(e);return r>n?c:r<n?-c:0}),this.columnSorting[o].by=s,this.columnSorting[o].order=c;for(var u=this.columnNodeOrder[o].length;u--;)this.columnNodeOrder[o][u].y=this.scale.y(u)}return this}},{key:"compileGlobalProps",value:function(){return{column:{width:Dt,height:Gt.height,padding:Xt,contentWidth:qt},row:{height:Lt,padding:Ht,contentHeight:Vt},cell:{padding:Wt}}}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,e){var n=[],o=[];if(r(t))for(var i=Math.max(t,0),a=r(e)?Math.min(e,Object.keys(this.columnCache).length):i+1,s=i;s<a;s++)o=o.concat(Object.keys(this.columnCache[s]));else o=Object.keys(this.data);for(var c=o.length;c--;)this.data[o[c]].links&&(n=n.concat(this.data[o[c]].links.outgoing.refs));return n}},{key:"offsetLinks",value:function(t,e,n){var o=this.links(t);if(("source"===n||"target"===n)&&r(e))for(var i=o.length;i--;)o[i][n].offsetY=e;return o}},{key:"grid",value:function(t){return t?(E(t)&&(Ft.columns=parseInt(t[0],10)||Ft.columns,Ft.rows=parseInt(t[1],10)||Ft.rows,this.updateScaling()),n(t)&&(Ft.columns=parseInt(t.columns,10)||Ft.columns,Ft.rows=parseInt(t.rows,10)||Ft.rows,this.updateScaling()),this):Ft}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),r=[],n=e.length;n--;)for(var o=t[e[n]].data.bars.length;o--;)r.push({barId:e[n]+"."+t[e[n]].data.bars[o].id,id:t[e[n]].data.bars[o].id,value:t[e[n]].data.bars[o].value});return r}},{key:"updateNodesVisibility",value:function(){for(var t=void 0,e=Object.keys(this.columnCache).length;e--;){t=0;for(var r=0,n=this.columnNodeOrder[e].length;r<n;r++)this.columnNodeOrder[e][r].hidden&&!this.columnNodeOrder[e][r].data.queryMode&&t++,this.columnNodeOrder[e][r].y=this.scale.y(r-t)}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,Ft.columns]).range([0,Gt.width]),this.scale.y.domain([0,Ft.rows]).range([0,Gt.height]),Dt=Gt.width/Ft.columns,Lt=Gt.height/Ft.rows,Xt=Dt*Yt,qt=Dt*(1-2*Yt),Ht=Math.max(Lt*zt,2),Vt=Lt-2*Ht,Wt=Bt*Math.min(qt,Vt,1),this}},{key:"size",value:function(t){return t?(E(t)&&(Gt.width=parseInt(t[0],10)||Gt.width,Gt.height=parseInt(t[1],10)||Gt.height,this.updateScaling()),n(t)&&(Gt.width=parseInt(t.width,10)||Gt.width,Gt.height=parseInt(t.height,10)||Gt.height,this.updateScaling()),this):Gt}},{key:"columnPadding",value:function(t,e){if(!t)return Yt;if(r(t)){var n=t;e&&r(Dt)&&(n=t/Dt),Yt=Math.max(Math.min(n,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,e){if(!t)return zt;if(r(t)){var n=t;e&&r(Lt)&&(n=t/Lt),zt=Math.max(Math.min(n,.5),0),this.updateScaling()}return this}}]),e}();t.layout.listGraph=Jt}(d3);
//# sourceMappingURL=d3.layout.listGraph.min.js.map
