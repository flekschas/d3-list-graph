/* Copyright Fritz Lekschas: D3 layout for list-based graphs */
!function(t){"use strict";function e(t){return t&&t.Object===Object?t:null}function i(t){return"number"==typeof t&&p(t)}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function n(t,e,i,n,r,a,h){function d(t){if(t.data.bars)if(o(t.data.bars)){t.data.barRefs={};for(var e=0,i=t.data.bars.length;i>e;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(s(t.data.bars)){var n=[],r=Object.keys(t.data.bars);t.data.barRefs={};for(var e=0,i=r.length;i>e;e++)t.data.barRefs[r[e]]=Math.max(Math.min(t.data.bars[r[e]],1),0),n.push({barId:t.id+"."+r[e],id:r[e],value:t.data.barRefs[r[e]]});t.data.bars=n}}function l(t,e){t.links.push({id:"("+t.id+")->("+e.id+")",source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}})}function c(e,s,r,o){var c=e.toString(),u=s,f=!1;if(o){for(var g=s.clones.length;g--;)if(s.clones[g].depth===r.depth+1){f=!0,c=s.clones[g].cloneId,u=s.clones[g];break}r.depth+1===s.depth||f||(y=e+"."+(s.clones.length+1),t[y]={children:[],clone:!0,cloneId:y,cloneNum:s.clones.length+1,data:s.data,originalId:e.toString(),originalNode:s},c=y,u=t[y],s.clones.push(u),s.parents[r.id]=void 0,delete s.parents[r.id])}else u.clones=[];u.id=c,u.parents||(u.parents={}),r?u.parents[r.id]=r:u.parents={},u.childRefs||(u.childRefs=[]),r?(u.depth=r.depth+1,r.childRefs.push(u)):u.depth=0,u.links||(u.links=[]),i[u.depth]||(i[u.depth]={},n[u.depth]=[]),i[u.depth][c]||(i[u.depth][c]=!0,n[u.depth].push(u),u.x=a(u.depth),u.y=h(Object.keys(i[u.depth]).length-1)),d(u),r&&l(r,u)}function u(){for(var i=e.length;i--;)for(var s=e.length;s--;)i!==s&&(t[e[i]].siblings||(t[e[i]].siblings={}),t[e[i]].siblings[e[s]]=t[e[s]])}for(var f={},g=[],p=void 0,b=void 0,m=void 0,v=void 0,y=void 0,_=e.length;_--;){if(!t[e[_]])return;for(c(e[_],t[e[_]]),g.push(e[_]),f[e[_]]=!0;g.length>0;){v=t[g.shift()];for(var w=v.children.length;w--;)b=v.children[w],p=t[b],p&&(f[b]?m=!0:(g.push(b),f[b]=!0,m=!1),c(b,p,v,m))}}u()}var r={};r.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var o=Array.isArray,a={"function":!0,object:!0},h=a[typeof exports]&&exports&&!exports.nodeType?exports:void 0,d=a[typeof module]&&module&&!module.nodeType?module:void 0,l=e(h&&d&&"object"==typeof global&&global),c=e(a[typeof self]&&self),u=e(a[typeof window]&&window),f=e(a[typeof this]&&this),g=l||u!==(f&&f.window)&&u||c||f||Function("return this")(),p=g.isFinite,b=function(t){function e(t){r.classCallCheck(this,e);var i=r.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.name=i.constructor.name,i.message=t,Error.captureStackTrace(i,i.constructor.name),i}return r.inherits(e,t),e}(Error),m=function(t){function e(t){return r.classCallCheck(this,e),r.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"No root node IDs specified."))}return r.inherits(e,t),e}(b),v={width:300,height:300},y={columns:3,rows:3},_=.2,w=.05,k=.05,O=function(){function e(i,s){r.classCallCheck(this,e),this.scale={x:t.scale.linear(),y:t.scale.linear()},this._colRelPadding=_,this._rowRelPadding=w,this._cellRelInnerPadding=k,this._grid={columns:y.columns,rows:y.rows},this._size={width:v.width,height:v.height},this.grid(s),this.size(i),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return r.createClass(e,[{key:"nodesToMatrix",value:function(t){var e=[],s=void 0,n=0,r=Object.keys(this.columnCache).length;i(t)&&(n=t,r=t+1);for(var o=n;r>o;o++){e.push({y:0,x:this.scale.x(o),level:o,rows:[],sortBy:this.columnSorting[o].by,sortOrder:this.columnSorting[o].order}),s=Object.keys(this.columnCache[o]);for(var a=s.length;a--;)e[o-n].rows.push(this.data[s[a]])}return e}},{key:"process",value:function(t,e,s){if(this.data=t||this.data,this.rootIds=e||this.rootIds,!o(this.rootIds)){if(!i(this.rootIds))throw new m("No root node IDs specified.");this.rootIds=[this.rootIds]}n(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.links,this.scale.x,this.scale.y);for(var r=Object.keys(this.columnCache).length;r--;)this.columnSorting[r]={};return s&&s.sortBy&&this.sort(void 0,s.sortBy,s.sortOrder||"desc"),{global:this.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"sort",value:function(t,e,s){var n=0,r=Object.keys(this.columnCache).length,o=void 0,a=void 0,h=1===s?1:-1;switch(e){case"precision":a="precision",o=function(t){return t.data.barRefs.precision};break;case"recall":a="recall",o=function(t){return t.data.barRefs.recall};break;default:o=function(t){return t.data.name.toLowerCase()},a="name"}for(i(t)&&(n=t,r=t+1),n;r>n;n++){this.columnNodeOrder[n].sort(function(t,e){var i=o(t),s=o(e);return i>s?h:s>i?-h:0}),this.columnSorting[n].by=a,this.columnSorting[n].order=h;for(var d=this.columnNodeOrder[n].length;d--;)this.columnNodeOrder[n][d].y=this.scale.y(d)}return this}},{key:"compileGlobalProps",value:function(){return{column:{width:this._columnWidth,height:this._size.height,padding:this._colAbsPadding,contentWidth:this._colAbsContentWidth},row:{height:this._rowHeight,padding:this._rowAbsPadding,contentHeight:this._rowAbsContentHeight},cell:{padding:this._cellAbsInnerPadding}}}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,e){var s=[],n=[],r=void 0,o=void 0,a=void 0;if(i(t)){o=Math.max(t,0),a=i(e)?Math.min(e,Object.keys(this.columnCache).length):o+1;for(var h=o;a>h;h++)n=n.concat(Object.keys(this.columnCache[h]))}else n=Object.keys(this.data);for(var h=n.length;h--;){r=this.data[n[h]].links;for(var d=r.length;d--;)s.push(r[d])}return s}},{key:"offsetLinks",value:function(t,e,s){var n=this.links(t);if(("source"===s||"target"===s)&&i(e))for(var r=n.length;r--;)n[r][s].offsetY=e;return n}},{key:"grid",value:function(t){return t?(o(t)&&(this._grid.columns=parseInt(t[0],10)||this._grid.columns,this._grid.rows=parseInt(t[1],10)||this._grid.rows,this.updateScaling()),s(t)&&(this._grid.columns=parseInt(t.columns,10)||this._grid.columns,this._grid.rows=parseInt(t.rows,10)||this._grid.rows,this.updateScaling()),this):this._grid}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),i=[],s=e.length;s--;)for(var n=t[e[s]].data.bars.length;n--;)i.push({barId:e[s]+"."+t[e[s]].data.bars[n].id,id:t[e[s]].data.bars[n].id,value:t[e[s]].data.bars[n].value});return i}},{key:"updateNodesVisibility",value:function(){for(var t={},e=Object.keys(this.columnCache).length;e--;){t[e]=0;for(var i=0,s=this.columnNodeOrder[e].length;s>i;i++)this.columnNodeOrder[e][i].hidden&&!this.columnNodeOrder[e][i].data.queryMode&&t[e]++,this.columnNodeOrder[e][i].y=this.scale.y(i-t[e])}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,this._grid.columns]).range([0,this._size.width]),this.scale.y.domain([0,this._grid.rows]).range([0,this._size.height]),this._columnWidth=this._size.width/this._grid.columns,this._rowHeight=this._size.height/this._grid.rows,this._colAbsPadding=this._columnWidth*this._colRelPadding,this._colAbsContentWidth=this._columnWidth*(1-2*this._colRelPadding),this._rowAbsPadding=Math.max(this._rowHeight*this._rowRelPadding,2),this._rowAbsContentHeight=this._rowHeight-2*this._rowAbsPadding,this._cellAbsInnerPadding=this._cellRelInnerPadding*Math.min(this._colAbsContentWidth,this._rowAbsContentHeight,1),this}},{key:"size",value:function(t){return t?(o(t)&&(this._size.width=parseInt(t[0],10)||this._size.width,this._size.height=parseInt(t[1],10)||this._size.height,this.updateScaling()),s(t)&&(this._size.width=parseInt(t.width,10)||this._size.width,this._size.height=parseInt(t.height,10)||this._size.height,this.updateScaling()),this):this._size}},{key:"columnPadding",value:function(t,e){if(!t)return this._colRelPadding;if(i(t)){var s=t;e&&i(this._columnWidth)&&(s=t/this._columnWidth),this._colRelPadding=Math.max(Math.min(s,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,e){if(!t)return this._rowRelPadding;if(i(t)){var s=t;e&&i(this._rowHeight)&&(s=t/this._rowHeight),this._rowRelPadding=Math.max(Math.min(s,.5),0),this.updateScaling()}return this}}]),e}();t.layout.listGraph=O}(d3);
//# sourceMappingURL=d3.layout.listGraph.min.js.map
