/* Copyright Fritz Lekschas: D3 layout for list-based graphs */
!function(t){"use strict";function e(t){return t&&t.Object===Object?t:null}function r(t){return"number"==typeof t&&D(t)}function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t,e){return t===e||t!==t&&e!==e}function i(t,e,r){var n=t[e];X.call(t,e)&&o(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function a(t,e,r,n){r||(r={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=n?n(r[s],t[s],s,r,t):t[s];i(r,s,c)}return r}function s(t,e,r){return a(t,e,r)}function c(t){return function(e){return null==e?void 0:e[t]}}function u(t){var e=n(t)?J.call(t):"";return e==H||e==V}function l(t){return"number"==typeof t&&t>-1&&t%1==0&&K>=t}function h(t){return null!=t&&l(q(t))&&!u(t)}function f(t,e){return t="number"==typeof t||U.test(t)?+t:-1,e=null==e?Q:e,t>-1&&t%1==0&&e>t}function d(t,e,r){if(!n(r))return!1;var i=typeof e;return("number"==i?h(r)&&f(e,r.length):"string"==i&&e in r)?o(r[e],t):!1}function p(t,e,r){var n=r.length;switch(n){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function b(t){return!!t&&"object"==typeof t}function v(t){return"symbol"==typeof t||b(t)&&et.call(t)==Z}function g(t){if("number"==typeof t)return t;if(v(t))return rt;if(n(t)){var e=u(t.valueOf)?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(nt,"");var r=it.test(t);return r||at.test(t)?st(t.slice(2),r?2:8):ot.test(t)?rt:+t}function y(t){if(!t)return 0===t?t:0;if(t=g(t),t===ct||t===-ct){var e=0>t?-1:1;return e*ut}var r=t%1;return t===t?r?t-r:t:0}function m(t,e){if("function"!=typeof t)throw new TypeError(lt);return e=ht(void 0===e?t.length-1:y(e),0),function(){for(var r=arguments,n=-1,o=ht(r.length-e,0),i=Array(o);++n<o;)i[n]=r[e+n];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,r[0],i);case 2:return t.call(this,r[0],r[1],i)}var a=Array(e+1);for(n=-1;++n<e;)a[n]=r[n];return a[e]=i,p(t,this,a)}}function O(t){return m(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,a=o>2?r[2]:void 0;for(i="function"==typeof i?(o--,i):void 0,a&&d(r[0],r[1],a)&&(i=3>o?void 0:i,o=1),e=Object(e);++n<o;){var s=r[n];s&&t(e,s,n,i)}return e})}function w(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||ft;return t===r}function k(t){return dt(Object(t))}function j(t,e){return bt.call(t,e)||"object"==typeof t&&e in t&&null===k(t)}function I(t){return vt(Object(t))}function C(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function S(t){return b(t)&&h(t)}function x(t){return S(t)&&mt.call(t,"callee")&&(!wt.call(t,"callee")||Ot.call(t)==gt)}function M(t){return"string"==typeof t||!T(t)&&b(t)&&It.call(t)==kt}function N(t){var e=t?t.length:void 0;return l(e)&&(T(t)||M(t)||x(t))?C(e,String):null}function P(t){var e=w(t);if(!e&&!h(t))return I(t);var r=N(t),n=!!r,o=r||[],i=o.length;for(var a in t)!j(t,a)||n&&("length"==a||f(a,i))||e&&"constructor"==a||o.push(a);return o}function R(t,e,r,o,i,a){function s(t){if(t.data.bars)if(T(t.data.bars)){t.data.barRefs={};for(var e=0,r=t.data.bars.length;r>e;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(n(t.data.bars)){var o=[],i=Object.keys(t.data.bars);t.data.barRefs={};for(var a=0,s=i.length;s>a;a++)t.data.barRefs[i[a]]=Math.max(Math.min(t.data.bars[i[a]],1),0),o.push({barId:t.id+"."+i[a],id:i[a],value:t.data.barRefs[i[a]]});t.data.bars=o}}function c(t,e){var r="("+t.id+")->("+e.id+")";a[r]={id:r,source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}},t.links.outgoing.refs.push(a[r]),e.links.incoming.refs.push(a[r]),t.links.outgoing.total++,e.links.incoming.total++}function u(e,n,a,u){var l=e.toString(),h=n,f=!1;if(u){for(var d=n.clones.length;d--;)if(n.clones[d].depth===a.depth+1){f=!0,l=n.clones[d].cloneId,h=n.clones[d];break}if(a.depth+1!==n.depth&&!f){var p=e+"."+(n.clones.length+1);t[p]={children:[],clone:!0,cloneId:p,cloneNum:n.clones.length+1,data:n.data,originalId:e.toString(),originalNode:n},l=p,h=t[p],n.clones.push(h),n.parents[a.id]=void 0,delete n.parents[a.id]}}else h.clones=[];h.id=l,h.parents||(h.parents={}),a?h.parents[a.id]=a:h.parents={},h.data.state||(h.data.state={}),h.childRefs||(h.childRefs=[]),a?(h.depth=a.depth+1,a.childRefs.push(h)):h.depth=0,h.links||(h.links={incoming:{refs:[],above:0,below:0,total:0},outgoing:{refs:[],above:0,below:0,total:0}}),r[h.depth]||(r[h.depth]={},o[h.depth]=[]),r[h.depth][l]||(r[h.depth][l]=!0,o[h.depth].push(h),h.x=i.x(h.depth),h.y=i.y(Object.keys(r[h.depth]).length-1)),s(h),a&&c(a,h)}function l(){for(var r=e.length;r--;)for(var n=e.length;n--;)r!==n&&(t[e[r]].siblings||(t[e[r]].siblings={}),t[e[r]].siblings[e[n]]=t[e[n]])}for(var h={},f=[],d=e.length;d--;){if(!t[e[d]])return;for(u(e[d],t[e[d]]),f.push(e[d]),h[e[d]]=!0;f.length>0;)for(var p=t[f.shift()],b=p.children.length;b--;){var v=p.children[b],g=t[v];if(g){var y=!0;h[v]||(f.push(v),h[v]=!0,y=!1),u(v,g,p,y)}}}l()}var E={};E.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},E.createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),E.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},E.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var T=Array.isArray,A={"function":!0,object:!0},$=A[typeof exports]&&exports&&!exports.nodeType?exports:void 0,B=A[typeof module]&&module&&!module.nodeType?module:void 0,F=e($&&B&&"object"==typeof global&&global),G=e(A[typeof self]&&self),_=e(A[typeof window]&&window),Y=e(A[typeof this]&&this),z=F||_!==(Y&&Y.window)&&_||G||Y||Function("return this")(),D=z.isFinite,L=Object.prototype,X=L.hasOwnProperty,q=c("length"),H="[object Function]",V="[object GeneratorFunction]",W=Object.prototype,J=W.toString,K=9007199254740991,Q=9007199254740991,U=/^(?:0|[1-9]\d*)$/,Z="[object Symbol]",tt=Object.prototype,et=tt.toString,rt=NaN,nt=/^\s+|\s+$/g,ot=/^[-+]0x[0-9a-f]+$/i,it=/^0b[01]+$/i,at=/^0o[0-7]+$/i,st=parseInt,ct=1/0,ut=1.7976931348623157e308,lt="Expected a function",ht=Math.max,ft=Object.prototype,dt=Object.getPrototypeOf,pt=Object.prototype,bt=pt.hasOwnProperty,vt=Object.keys,gt="[object Arguments]",yt=Object.prototype,mt=yt.hasOwnProperty,Ot=yt.toString,wt=yt.propertyIsEnumerable,kt="[object String]",jt=Object.prototype,It=jt.toString,Ct=Object.prototype,St=Ct.hasOwnProperty,xt=Ct.propertyIsEnumerable,Mt=!xt.call({valueOf:1},"valueOf"),Nt=O(function(t,e){if(Mt||w(e)||h(e))return void s(e,P(e),t);for(var r in e)St.call(e,r)&&i(t,r,e[r])}),Pt={width:300,height:300},Rt={columns:3,rows:3},Et=.2,Tt=.05,At=.05,$t=function(t){function e(t){E.classCallCheck(this,e);var r=E.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.name=r.constructor.name,r.message=t,Error.captureStackTrace(r,r.constructor.name),r}return E.inherits(e,t),e}(Error),Bt=function(t){function e(t){return E.classCallCheck(this,e),E.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"No root node IDs specified."))}return E.inherits(e,t),e}($t),Ft=At,Gt={columns:Rt.columns,rows:Rt.rows},_t={width:Pt.width,height:Pt.height},Yt={},zt=Et,Dt=Tt,Lt=void 0,Xt=void 0,qt=void 0,Ht=void 0,Vt=void 0,Wt=void 0,Jt=void 0,Kt=function(){function e(r,n){E.classCallCheck(this,e),this.scale={x:t.scale.linear(),y:t.scale.linear(),linkPosition:{}},this.grid(n),this.size(r),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return E.createClass(e,[{key:"nodesToMatrix",value:function(t){var e=[],n=0,o=Object.keys(this.columnCache).length;r(t)&&(n=t,o=t+1);for(var i=n;o>i;i++){e.push({y:0,x:this.scale.x(i),level:i,rows:[],sortBy:this.columnSorting[i].by,sortOrder:this.columnSorting[i].order});for(var a=Object.keys(this.columnCache[i]),s=a.length;s--;)e[i-n].rows.push(this.data[a[s]])}return e}},{key:"process",value:function(t,e,n){if(this.data=t||this.data,this.rootIds=e||this.rootIds,!T(this.rootIds)){if(!r(this.rootIds))throw new Bt("No root node IDs specified.");this.rootIds=[this.rootIds]}var o=Nt({},n);R(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.scale,Yt);for(var i=Object.keys(this.columnCache).length;i--;)this.columnSorting[i]={};return o.sortBy&&this.sort(void 0,n.sortBy,n.sortOrder||"desc"),{global:this.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"sort",value:function(t,e,n){var o=0,i=Object.keys(this.columnCache).length,a=void 0,s=void 0,c=1===n?1:-1;switch(e){case"precision":s="precision",a=function(t){return t.data.barRefs.precision};break;case"recall":s="recall",a=function(t){return t.data.barRefs.recall};break;default:a=function(t){return t.data.name.toLowerCase()},s="name"}for(r(t)&&(o=t,i=t+1),o;i>o;o++){this.columnNodeOrder[o].sort(function(t,e){var r=a(t),n=a(e);return r>n?c:n>r?-c:0}),this.columnSorting[o].by=s,this.columnSorting[o].order=c;for(var u=this.columnNodeOrder[o].length;u--;)this.columnNodeOrder[o][u].y=this.scale.y(u)}return this}},{key:"compileGlobalProps",value:function(){return{column:{width:Lt,height:_t.height,padding:qt,contentWidth:Ht},row:{height:Xt,padding:Vt,contentHeight:Wt},cell:{padding:Jt}}}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,e){var n=[],o=[];if(r(t))for(var i=Math.max(t,0),a=r(e)?Math.min(e,Object.keys(this.columnCache).length):i+1,s=i;a>s;s++)o=o.concat(Object.keys(this.columnCache[s]));else o=Object.keys(this.data);for(var c=o.length;c--;)this.data[o[c]].links&&(n=n.concat(this.data[o[c]].links.outgoing.refs));return n}},{key:"offsetLinks",value:function(t,e,n){var o=this.links(t);if(("source"===n||"target"===n)&&r(e))for(var i=o.length;i--;)o[i][n].offsetY=e;return o}},{key:"grid",value:function(t){return t?(T(t)&&(Gt.columns=parseInt(t[0],10)||Gt.columns,Gt.rows=parseInt(t[1],10)||Gt.rows,this.updateScaling()),n(t)&&(Gt.columns=parseInt(t.columns,10)||Gt.columns,Gt.rows=parseInt(t.rows,10)||Gt.rows,this.updateScaling()),this):Gt}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),r=[],n=e.length;n--;)for(var o=t[e[n]].data.bars.length;o--;)r.push({barId:e[n]+"."+t[e[n]].data.bars[o].id,id:t[e[n]].data.bars[o].id,value:t[e[n]].data.bars[o].value});return r}},{key:"updateNodesVisibility",value:function(){for(var t=void 0,e=Object.keys(this.columnCache).length;e--;){t=0;for(var r=0,n=this.columnNodeOrder[e].length;n>r;r++)this.columnNodeOrder[e][r].hidden&&!this.columnNodeOrder[e][r].data.queryMode&&t++,this.columnNodeOrder[e][r].y=this.scale.y(r-t)}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,Gt.columns]).range([0,_t.width]),this.scale.y.domain([0,Gt.rows]).range([0,_t.height]),Lt=_t.width/Gt.columns,Xt=_t.height/Gt.rows,qt=Lt*zt,Ht=Lt*(1-2*zt),Vt=Math.max(Xt*Dt,2),Wt=Xt-2*Vt,Jt=Ft*Math.min(Ht,Wt,1),this}},{key:"size",value:function(t){return t?(T(t)&&(_t.width=parseInt(t[0],10)||_t.width,_t.height=parseInt(t[1],10)||_t.height,this.updateScaling()),n(t)&&(_t.width=parseInt(t.width,10)||_t.width,_t.height=parseInt(t.height,10)||_t.height,this.updateScaling()),this):_t}},{key:"columnPadding",value:function(t,e){if(!t)return zt;if(r(t)){var n=t;e&&r(Lt)&&(n=t/Lt),zt=Math.max(Math.min(n,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,e){if(!t)return Dt;if(r(t)){var n=t;e&&r(Xt)&&(n=t/Xt),Dt=Math.max(Math.min(n,.5),0),this.updateScaling()}return this}}]),e}();t.layout.listGraph=Kt}(d3);
//# sourceMappingURL=d3.layout.listGraph.min.js.map
