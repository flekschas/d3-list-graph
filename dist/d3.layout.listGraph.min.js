/* Copyright Fritz Lekschas: D3 layout for list-based graphs */
!function(t){"use strict";function e(t){return"number"==typeof t&&m(t)}function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function n(t){return i(t)&&_.call(t)==y}function s(t){return!!t&&"object"==typeof t}function r(t){return null==t?!1:n(t)?C.test(O.call(t)):s(t)&&w.test(t)}function o(t,e){var i=null==t?void 0:t[e];return r(i)?i:void 0}function a(t){return"number"==typeof t&&t>-1&&t%1==0&&P>=t}function h(t,e,n,s,r,o,a){function h(t){if(t.data.bars)if(z(t.data.bars)){t.data.barRefs={};for(var e=0,n=t.data.bars.length;n>e;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(i(t.data.bars)){var s=[],r=Object.keys(t.data.bars);t.data.barRefs={};for(var e=0,n=r.length;n>e;e++)t.data.barRefs[r[e]]=Math.max(Math.min(t.data.bars[r[e]],1),0),s.push({barId:t.id+"."+r[e],id:r[e],value:t.data.barRefs[r[e]]});t.data.bars=s}}function l(t,e){t.links.push({id:"("+t.id+")->("+e.id+")",source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}})}function d(e,i,r,d){var c=e.toString(),u=i;d?r.depth+1!==i.depth&&(y=e+"."+(i.clones.length+1),t[y]={children:[],clone:!0,cloneId:i.clones.length+1,data:i.data,originalId:e.toString(),originalNode:i},c=y,u=t[y],i.clones.push(u),i.parents[r.id]=void 0,delete i.parents[r.id]):u.clones=[],u.id=c,u.parents||(u.parents={}),r?u.parents[r.id]=r:u.parents={},u.childRefs||(u.childRefs=[]),r?(u.depth=r.depth+1,r.childRefs.push(u)):u.depth=0,u.links||(u.links=[]),n[u.depth]||(n[u.depth]={},s[u.depth]=[]),n[u.depth][c]||(n[u.depth][c]=!0,s[u.depth].push(u),u.x=o(u.depth),u.y=a(Object.keys(n[u.depth]).length-1)),h(u),r&&l(r,u)}function c(){for(var i=e.length;i--;)for(var n=e.length;n--;)i!==n&&(t[e[i]].siblings||(t[e[i]].siblings={}),t[e[i]].siblings[e[n]]=t[e[n]])}for(var u={},f=[],g=void 0,p=void 0,b=void 0,m=void 0,y=void 0,v=e.length;v--;){if(!t[e[v]])return;for(d(e[v],t[e[v]]),f.push(e[v]),u[e[v]]=!0;f.length>0;){m=t[f.shift()];for(var _=m.children.length;_--;)p=m.children[_],g=t[p],g&&(u[p]?b=!0:(f.push(p),u[p]=!0,b=!1),d(p,g,m,b))}}c()}var l={};l.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},l.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var d={"function":!0,object:!0},c=d[typeof exports]&&exports&&!exports.nodeType&&exports,u=d[typeof module]&&module&&!module.nodeType&&module,f=c&&u&&"object"==typeof global&&global&&global.Object&&global,g=d[typeof self]&&self&&self.Object&&self,p=d[typeof window]&&window&&window.Object&&window,b=f||p!==(this&&this.window)&&p||g||this,m=b.isFinite,y="[object Function]",v=Object.prototype,_=v.toString,w=/^\[object .+?Constructor\]$/,k=Object.prototype,O=Function.prototype.toString,j=k.hasOwnProperty,C=RegExp("^"+O.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=9007199254740991,I="[object Array]",R=Object.prototype,x=R.toString,S=o(Array,"isArray"),z=S||function(t){return s(t)&&a(t.length)&&x.call(t)==I},A=function(t){function e(t){l.classCallCheck(this,e);var i=l.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.name=i.constructor.name,i.message=t,Error.captureStackTrace(i,i.constructor.name),i}return l.inherits(e,t),e}(Error),M=function(t){function e(t){return l.classCallCheck(this,e),l.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t||"No root node IDs specified."))}return l.inherits(e,t),e}(A),N={width:300,height:300},H={columns:3,rows:3},W=.2,T=.05,E=.05,$=function(){function n(e,i){l.classCallCheck(this,n),this.scale={x:t.scale.linear(),y:t.scale.linear()},this._colRelPadding=W,this._rowRelPadding=T,this._cellRelInnerPadding=E,this._grid={columns:H.columns,rows:H.rows},this._size={width:N.width,height:N.height},this.grid(i),this.size(e),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return l.createClass(n,[{key:"nodesToMatrix",value:function(t){var i=[],n=void 0,s=0,r=Object.keys(this.columnCache).length;e(t)&&(s=t,r=t+1);for(var o=s;r>o;o++){i.push({y:0,x:this.scale.x(o),level:o,rows:[],sortBy:this.columnSorting[o].by,sortOrder:this.columnSorting[o].order}),n=Object.keys(this.columnCache[o]);for(var a=n.length;a--;)i[o-s].rows.push(this.data[n[a]])}return i}},{key:"process",value:function(t,i,n){if(this.data=t||this.data,this.rootIds=i||this.rootIds,!z(this.rootIds)){if(!e(this.rootIds))throw new M("No root node IDs specified.");this.rootIds=[this.rootIds]}h(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.links,this.scale.x,this.scale.y);for(var s=Object.keys(this.columnCache).length;s--;)this.columnSorting[s]={};return n&&n.sortBy&&this.sort(void 0,n.sortBy,n.sortOrder||"desc"),{global:this.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"sort",value:function(t,i,n){var s=0,r=Object.keys(this.columnCache).length,o=void 0,a=void 0,h=1===n?1:-1;switch(i){case"precision":a="precision",o=function(t){return t.data.barRefs.precision};break;case"recall":a="recall",o=function(t){return t.data.barRefs.recall};break;default:o=function(t){return t.data.name.toLowerCase()},a="name"}for(e(t)&&(s=t,r=t+1),s;r>s;s++){this.columnNodeOrder[s].sort(function(t,e){var i=o(t),n=o(e);return i>n?h:n>i?-h:0}),this.columnSorting[s].by=a,this.columnSorting[s].order=h;for(var l=this.columnNodeOrder[s].length;l--;)this.columnNodeOrder[s][l].y=this.scale.y(l)}return this}},{key:"compileGlobalProps",value:function(){return{column:{width:this._columnWidth,height:this._size.height,padding:this._colAbsPadding,contentWidth:this._colAbsContentWidth},row:{height:this._rowHeight,padding:this._rowAbsPadding,contentHeight:this._rowAbsContentHeight},cell:{padding:this._cellAbsInnerPadding}}}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,i){var n=[],s=[],r=void 0,o=void 0,a=void 0;if(e(t)){o=Math.max(t,0),a=e(i)?Math.min(i,Object.keys(this.columnCache).length):o+1;for(var h=o;a>h;h++)s=s.concat(Object.keys(this.columnCache[h]))}else s=Object.keys(this.data);for(var h=s.length;h--;){r=this.data[s[h]].links;for(var l=r.length;l--;)n.push(r[l])}return n}},{key:"offsetLinks",value:function(t,i,n){var s=this.links(t);if(("source"===n||"target"===n)&&e(i))for(var r=s.length;r--;)s[r][n].offsetY=i;return s}},{key:"grid",value:function(t){return arguments.length?(z(t)&&(this._grid.columns=parseInt(t[0],10)||this._grid.columns,this._grid.rows=parseInt(t[1],10)||this._grid.rows,this.updateScaling()),i(t)&&(this._grid.columns=parseInt(t.columns,10)||this._grid.columns,this._grid.rows=parseInt(t.rows,10)||this._grid.rows,this.updateScaling()),this):this._grid}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),i=[],n=e.length;n--;)for(var s=t[e[n]].data.bars.length;s--;)i.push({barId:e[n]+"."+t[e[n]].data.bars[s].id,id:t[e[n]].data.bars[s].id,value:t[e[n]].data.bars[s].value});return i}},{key:"updateNodesVisibility",value:function(){for(var t={},e=Object.keys(this.columnCache).length;e--;){t[e]=0;for(var i=0,n=this.columnNodeOrder[e].length;n>i;i++)this.columnNodeOrder[e][i].hidden&&!this.columnNodeOrder[e][i].data.queryMode&&t[e]++,this.columnNodeOrder[e][i].y=this.scale.y(i-t[e])}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,this._grid.columns]).range([0,this._size.width]),this.scale.y.domain([0,this._grid.rows]).range([0,this._size.height]),this._columnWidth=this._size.width/this._grid.columns,this._rowHeight=this._size.height/this._grid.rows,this._colAbsPadding=this._columnWidth*this._colRelPadding,this._colAbsContentWidth=this._columnWidth*(1-2*this._colRelPadding),this._rowAbsPadding=Math.max(this._rowHeight*this._rowRelPadding,2),this._rowAbsContentHeight=this._rowHeight-2*this._rowAbsPadding,this._cellAbsInnerPadding=this._cellRelInnerPadding*Math.min(this._colAbsContentWidth,this._rowAbsContentHeight,1),this}},{key:"size",value:function(t){return arguments.length?(z(t)&&(this._size.width=parseInt(t[0],10)||this._size.width,this._size.height=parseInt(t[1],10)||this._size.height,this.updateScaling()),i(t)&&(this._size.width=parseInt(t.width,10)||this._size.width,this._size.height=parseInt(t.height,10)||this._size.height,this.updateScaling()),this):this._size}},{key:"columnPadding",value:function(t,i){if(!arguments.length)return this._colRelPadding;if(e(t)){var n=t;i&&e(this._columnWidth)&&(n=t/this._columnWidth),this._colRelPadding=Math.max(Math.min(n,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,i){if(!arguments.length)return this._rowRelPadding;if(e(t)){var n=t;i&&e(this._rowHeight)&&(n=t/this._rowHeight),this._rowRelPadding=Math.max(Math.min(n,.5),0),this.updateScaling()}return this}}]),n}();t.layout.listGraph=$}(d3);
//# sourceMappingURL=d3.layout.listGraph.min.js.map
