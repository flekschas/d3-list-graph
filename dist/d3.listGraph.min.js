/* Copyright Fritz Lekschas: D3 layout for list-like graphs */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.d3=t.d3||{},t.d3)}(this,function(t,e){"use strict";function n(t){return"number"==typeof t&&N(t)}function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t,e){return t===e||t!==t&&e!==e}function i(t,e,n){var r=t[e];R.call(t,e)&&o(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function a(t,e,n,r){n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=r?r(n[s],t[s],s,n,t):void 0;i(n,s,void 0===c?t[s]:c)}return n}function s(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function c(t,e){return e=E(void 0===e?t.length-1:e,0),function(){for(var n=arguments,r=-1,o=E(n.length-e,0),i=Array(o);++r<o;)i[r]=n[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=n[r];return a[e]=i,s(t,this,a)}}function u(t){var e=r(t)?F.call(t):"";return e==T||e==A}function l(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=B}function h(t){return null!=t&&l(t.length)&&!u(t)}function d(t,e){return e=null==e?G:e,!!e&&("number"==typeof t||L.test(t))&&t>-1&&t%1==0&&t<e}function f(t,e,n){if(!r(n))return!1;var i=typeof e;return!!("number"==i?h(n)&&d(e,n.length):"string"==i&&e in n)&&o(n[e],t)}function p(t){return c(function(e,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,a&&f(n[0],n[1],a)&&(i=o<3?void 0:i,o=1),e=Object(e);++r<o;){var s=n[r];s&&t(e,s,r,i)}return e})}function g(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||q;return t===n}function b(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function v(t){return!!t&&"object"==typeof t}function y(t){return v(t)&&h(t)}function m(t){return y(t)&&X.call(t,"callee")&&(!V.call(t,"callee")||H.call(t)==z)}function O(t,e){var n=P(t)||m(t)?b(t.length,String):[],r=n.length,o=!!r;for(var i in t)!e&&!$.call(t,i)||o&&("length"==i||d(i,r))||n.push(i);return n}function w(t,e){return function(n){return t(e(n))}}function j(t){if(!g(t))return J(t);var e=[];for(var n in Object(t))Q.call(t,n)&&"constructor"!=n&&e.push(n);return e}function k(t){return h(t)?O(t):j(t)}function I(t,e,n,o,i,a){function s(t){if(t.data.bars)if(P(t.data.bars)){t.data.barRefs={};for(var e=0,n=t.data.bars.length;e<n;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(r(t.data.bars)){var o=[],i=Object.keys(t.data.bars);t.data.barRefs={};for(var a=0,s=i.length;a<s;a++)t.data.barRefs[i[a]]=Math.max(Math.min(t.data.bars[i[a]],1),0),o.push({barId:t.id+"."+i[a],id:i[a],value:t.data.barRefs[i[a]]});t.data.bars=o}}function c(t,e){var n="("+t.id+")->("+e.id+")";a[n]={id:n,source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}},t.links.outgoing.refs.push(a[n]),e.links.incoming.refs.push(a[n]),t.links.outgoing.total++,e.links.incoming.total++}function u(e,r,a,u){var l=e.toString(),h=r,d=!1;if(u){for(var f=r.clones.length;f--;)if(r.clones[f].depth===a.depth+1){d=!0,l=r.clones[f].cloneId,h=r.clones[f];break}if(a.depth+1!==r.depth&&!d){var p=e+"."+(r.clones.length+1);t[p]={children:[],clone:!0,cloneId:p,cloneNum:r.clones.length+1,data:r.data,originalId:e.toString(),originalNode:r},l=p,h=t[p],r.clones.push(h),r.parents[a.id]=void 0,delete r.parents[a.id]}}else h.clones=[];h.id=l,h.parents||(h.parents={}),a?h.parents[a.id]=a:h.parents={},h.data.state||(h.data.state={}),h.childRefs||(h.childRefs=[]),a?(h.depth=a.depth+1,a.childRefs.push(h)):h.depth=0,h.links||(h.links={incoming:{refs:[],above:0,below:0,total:0},outgoing:{refs:[],above:0,below:0,total:0}}),n[h.depth]||(n[h.depth]={},o[h.depth]=[]),n[h.depth][l]||(n[h.depth][l]=!0,o[h.depth].push(h),h.x=i.x(h.depth),h.y=i.y(Object.keys(n[h.depth]).length-1)),s(h),a&&c(a,h)}function l(){for(var n=e.length;n--;)for(var r=e.length;r--;)n!==r&&(t[e[n]].siblings||(t[e[n]].siblings={}),t[e[n]].siblings[e[r]]=t[e[r]])}for(var h={},d=[],f=e.length;f--;){if(!t[e[f]])return;for(u(e[f],t[e[f]]),d.push(e[f]),h[e[f]]=!0;d.length>0;)for(var p=t[d.shift()],g=p.children.length;g--;){var b=p.children[g],v=t[b];if(v){var y=!0;h[b]||(d.push(b),h[b]=!0,y=!1),u(b,v,p,y)}}}l()}function _(t,e,n){return n?t||e:"undefined"!=typeof t?t:e}var P=Array.isArray,x="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,M=x||S||Function("return this")(),N=M.isFinite,C=Object.prototype,R=C.hasOwnProperty,E=Math.max,T="[object Function]",A="[object GeneratorFunction]",D=Object.prototype,F=D.toString,B=9007199254740991,G=9007199254740991,L=/^(?:0|[1-9]\d*)$/,q=Object.prototype,z="[object Arguments]",Y=Object.prototype,X=Y.hasOwnProperty,H=Y.toString,V=Y.propertyIsEnumerable,W=Object.prototype,$=W.hasOwnProperty,J=w(Object.keys,Object),K=Object.prototype,Q=K.hasOwnProperty,U=Object.prototype,Z=U.hasOwnProperty,tt=U.propertyIsEnumerable,et=!tt.call({valueOf:1},"valueOf"),nt=p(function(t,e){if(et||g(e)||h(e))return void a(e,k(e),t);for(var n in e)Z.call(e,n)&&i(t,n,e[n])}),rt={width:300,height:300},ot={columns:3,rows:3},it=.2,at=.05,st=.05,ct=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ut=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),lt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},ht=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},dt=function(t){function e(t){ct(this,e);var n=ht(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name=n.constructor.name,n.message=t,Error.captureStackTrace(n,n.constructor.name),n}return lt(e,t),e}(Error),ft=function(t){function e(t){return ct(this,e),ht(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"D3 version 4 is required to run the code. Found version "+t))}return lt(e,t),e}(dt),pt=function(t){function e(t){return ct(this,e),ht(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,'The "'+t+'" must be an object.'))}return lt(e,t),e}(dt),gt=function(t){function e(t){return ct(this,e),ht(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||"No root node IDs specified."))}return lt(e,t),e}(dt),bt={columns:ot.columns,rows:ot.rows},vt={width:rt.width,height:rt.height},yt={},mt=e,Ot=void 0,wt=void 0,jt=void 0,kt=void 0,It=void 0,_t=void 0,Pt=void 0,xt=void 0,St=void 0,Mt=void 0,Nt=function(){function t(e){if(ct(this,t),!r(e))throw new pt("options");if(e.specificD3){if(!r(e.specificD3))throw new pt("d3");mt=e.specificD3}if("4"!==mt.version[0])throw new ft(mt.version);this.scale={x:mt.scaleLinear(),y:mt.scaleLinear(),linkPosition:{}},Ot=_(e.innerNodePadding,st),wt=_(e.columnPadding,it),jt=_(e.rowPadding,at),this.grid(e.grid),this.size(e.size),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return ut(t,[{key:"nodesToMatrix",value:function(t){var e=[],r=0,o=Object.keys(this.columnCache).length;n(t)&&(r=t,o=t+1);for(var i=r;i<o;i++){e.push({y:0,x:this.scale.x(i),level:i,rows:[],sortBy:this.columnSorting[i].by,sortOrder:this.columnSorting[i].order});for(var a=Object.keys(this.columnCache[i]),s=a.length;s--;)e[i-r].rows.push(this.data[a[s]])}return e}},{key:"process",value:function(t,e,r){if(this.data=t||this.data,this.rootIds=e||this.rootIds,!P(this.rootIds)){if(!n(this.rootIds))throw new gt("No root node IDs specified.");this.rootIds=[this.rootIds]}var o=nt({},r);I(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.scale,yt);for(var i=Object.keys(this.columnCache).length;i--;)this.columnSorting[i]={};return o.sortBy&&this.sort(void 0,r.sortBy,r.sortOrder||"desc"),{global:this.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"sort",value:function(t,e,r){var o=0,i=Object.keys(this.columnCache).length,a=void 0,s=void 0,c=1===r?1:-1;switch(e){case"precision":s="precision",a=function(t){return t.data.barRefs.precision};break;case"recall":s="recall",a=function(t){return t.data.barRefs.recall};break;default:a=function(t){return t.data.name.toLowerCase()},s="name"}for(n(t)&&(o=t,i=t+1),o;o<i;o++){this.columnNodeOrder[o].sort(function(t,e){var n=a(t),r=a(e);return n>r?c:n<r?-c:0}),this.columnSorting[o].by=s,this.columnSorting[o].order=c;for(var u=this.columnNodeOrder[o].length;u--;)this.columnNodeOrder[o][u].y=this.scale.y(u)}return this}},{key:"compileGlobalProps",value:function(){return{column:{width:kt,height:vt.height,padding:_t,contentWidth:Pt},row:{height:It,padding:xt,contentHeight:St},cell:{padding:Mt}}}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,e){var r=[],o=[];if(n(t))for(var i=Math.max(t,0),a=n(e)?Math.min(e,Object.keys(this.columnCache).length):i+1,s=i;s<a;s++)o=o.concat(Object.keys(this.columnCache[s]));else o=Object.keys(this.data);for(var c=o.length;c--;)this.data[o[c]].links&&(r=r.concat(this.data[o[c]].links.outgoing.refs));return r}},{key:"offsetLinks",value:function(t,e,r){var o=this.links(t);if(("source"===r||"target"===r)&&n(e))for(var i=o.length;i--;)o[i][r].offsetY=e;return o}},{key:"grid",value:function(t){return t?(P(t)&&(bt.columns=parseInt(t[0],10)||bt.columns,bt.rows=parseInt(t[1],10)||bt.rows,this.updateScaling()),r(t)&&(bt.columns=parseInt(t.columns,10)||bt.columns,bt.rows=parseInt(t.rows,10)||bt.rows,this.updateScaling()),this):bt}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),n=[],r=e.length;r--;)for(var o=t[e[r]].data.bars.length;o--;)n.push({barId:e[r]+"."+t[e[r]].data.bars[o].id,id:t[e[r]].data.bars[o].id,value:t[e[r]].data.bars[o].value});return n}},{key:"updateNodesVisibility",value:function(){for(var t=void 0,e=Object.keys(this.columnCache).length;e--;){t=0;for(var n=0,r=this.columnNodeOrder[e].length;n<r;n++)this.columnNodeOrder[e][n].hidden&&!this.columnNodeOrder[e][n].data.queryMode&&t++,this.columnNodeOrder[e][n].y=this.scale.y(n-t)}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,bt.columns]).range([0,vt.width]),this.scale.y.domain([0,bt.rows]).range([0,vt.height]),kt=vt.width/bt.columns,It=vt.height/bt.rows,_t=kt*wt,Pt=kt*(1-2*wt),xt=Math.max(It*jt,2),St=It-2*xt,Mt=Ot*Math.min(Pt,St,1),this}},{key:"size",value:function(t){return t?(P(t)&&(vt.width=parseInt(t[0],10)||vt.width,vt.height=parseInt(t[1],10)||vt.height,this.updateScaling()),r(t)&&(vt.width=parseInt(t.width,10)||vt.width,vt.height=parseInt(t.height,10)||vt.height,this.updateScaling()),this):vt}},{key:"columnPadding",value:function(t,e){if(!t)return wt;if(n(t)){var r=t;e&&n(kt)&&(r=t/kt),wt=Math.max(Math.min(r,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,e){if(!t)return jt;if(n(t)){var r=t;e&&n(It)&&(r=t/It),jt=Math.max(Math.min(r,.5),0),this.updateScaling()}return this}}]),t}();t.listGraph=Nt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=d3.listGraph.min.js.map
