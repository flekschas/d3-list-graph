/* Copyright Fritz Lekschas: D3 layout for list-like graphs */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.d3=t.d3||{},t.d3)}(this,function(t,e){"use strict";function r(t){return"number"==typeof t&&P(t)}function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t,e){return t===e||t!==t&&e!==e}function i(t,e,r){var n=t[e];C.call(t,e)&&o(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function a(t,e,r,n){r||(r={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=n?n(r[s],t[s],s,r,t):void 0;i(r,s,void 0===c?t[s]:c)}return r}function s(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function c(t,e){return e=R(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=R(r.length-e,0),i=Array(o);++n<o;)i[n]=r[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=r[n];return a[e]=i,s(t,this,a)}}function u(t){var e=n(t)?F.call(t):"";return e==E||e==A}function l(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=B}function h(t){return null!=t&&l(t.length)&&!u(t)}function d(t,e){return e=null==e?G:e,!!e&&("number"==typeof t||L.test(t))&&t>-1&&t%1==0&&t<e}function f(t,e,r){if(!n(r))return!1;var i=typeof e;return!!("number"==i?h(r)&&d(e,r.length):"string"==i&&e in r)&&o(r[e],t)}function p(t){return c(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,a=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,a&&f(r[0],r[1],a)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var s=r[n];s&&t(e,s,n,i)}return e})}function g(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||q;return t===r}function b(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function v(t){return!!t&&"object"==typeof t}function y(t){return v(t)&&h(t)}function m(t){return y(t)&&z.call(t,"callee")&&(!H.call(t,"callee")||X.call(t)==D)}function O(t,e){var r=x(t)||m(t)?b(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!W.call(t,i)||o&&("length"==i||d(i,n))||r.push(i);return r}function w(t,e){return function(r){return t(e(r))}}function j(t){if(!g(t))return $(t);var e=[];for(var r in Object(t))K.call(t,r)&&"constructor"!=r&&e.push(r);return e}function k(t){return h(t)?O(t):j(t)}function I(t,e,r,o,i,a){function s(t){if(t.data.bars)if(x(t.data.bars)){t.data.barRefs={};for(var e=0,r=t.data.bars.length;e<r;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(n(t.data.bars)){var o=[],i=Object.keys(t.data.bars);t.data.barRefs={};for(var a=0,s=i.length;a<s;a++)t.data.barRefs[i[a]]=Math.max(Math.min(t.data.bars[i[a]],1),0),o.push({barId:t.id+"."+i[a],id:i[a],value:t.data.barRefs[i[a]]});t.data.bars=o}}function c(t,e){var r="("+t.id+")->("+e.id+")";a[r]={id:r,source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}},t.links.outgoing.refs.push(a[r]),e.links.incoming.refs.push(a[r]),t.links.outgoing.total++,e.links.incoming.total++}function u(e,n,a,u){var l=e.toString(),h=n,d=!1;if(u){for(var f=n.clones.length;f--;)if(n.clones[f].depth===a.depth+1){d=!0,l=n.clones[f].cloneId,h=n.clones[f];break}if(a.depth+1!==n.depth&&!d){var p=e+"."+(n.clones.length+1);t[p]={children:[],clone:!0,cloneId:p,cloneNum:n.clones.length+1,data:n.data,originalId:e.toString(),originalNode:n},l=p,h=t[p],n.clones.push(h),n.parents[a.id]=void 0,delete n.parents[a.id]}}else h.clones=[];h.id=l,h.parents||(h.parents={}),a?h.parents[a.id]=a:h.parents={},h.data.state||(h.data.state={}),h.childRefs||(h.childRefs=[]),a?(h.depth=a.depth+1,a.childRefs.push(h)):h.depth=0,h.links||(h.links={incoming:{refs:[],above:0,below:0,total:0},outgoing:{refs:[],above:0,below:0,total:0}}),r[h.depth]||(r[h.depth]={},o[h.depth]=[]),r[h.depth][l]||(r[h.depth][l]=!0,o[h.depth].push(h),h.x=i.x(h.depth),h.y=i.y(Object.keys(r[h.depth]).length-1)),s(h),a&&c(a,h)}function l(){for(var r=e.length;r--;)for(var n=e.length;n--;)r!==n&&(t[e[r]].siblings||(t[e[r]].siblings={}),t[e[r]].siblings[e[n]]=t[e[n]])}for(var h={},d=[],f=e.length;f--;){if(!t[e[f]])return;for(u(e[f],t[e[f]]),d.push(e[f]),h[e[f]]=!0;d.length>0;)for(var p=t[d.shift()],g=p.children.length;g--;){var b=p.children[g],v=t[b];if(v){var y=!0;h[b]||(d.push(b),h[b]=!0,y=!1),u(b,v,p,y)}}}l()}var x=Array.isArray,S="object"==typeof global&&global&&global.Object===Object&&global,M="object"==typeof self&&self&&self.Object===Object&&self,_=S||M||Function("return this")(),P=_.isFinite,N=Object.prototype,C=N.hasOwnProperty,R=Math.max,E="[object Function]",A="[object GeneratorFunction]",T=Object.prototype,F=T.toString,B=9007199254740991,G=9007199254740991,L=/^(?:0|[1-9]\d*)$/,q=Object.prototype,D="[object Arguments]",Y=Object.prototype,z=Y.hasOwnProperty,X=Y.toString,H=Y.propertyIsEnumerable,V=Object.prototype,W=V.hasOwnProperty,$=w(Object.keys,Object),J=Object.prototype,K=J.hasOwnProperty,Q=Object.prototype,U=Q.hasOwnProperty,Z=Q.propertyIsEnumerable,tt=!Z.call({valueOf:1},"valueOf"),et=p(function(t,e){if(tt||g(e)||h(e))return void a(e,k(e),t);for(var r in e)U.call(e,r)&&i(t,r,e[r])}),rt={width:300,height:300},nt={columns:3,rows:3},ot=.2,it=.05,at=.05,st=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ct=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),ut=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},lt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},ht=function(t){function e(t){st(this,e);var r=lt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.name=r.constructor.name,r.message=t,Error.captureStackTrace(r,r.constructor.name),r}return ut(e,t),e}(Error),dt=function(t){function e(t){return st(this,e),lt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"D3 version 4 is required to run the code. Found version "+t))}return ut(e,t),e}(ht),ft=function(t){function e(t){return st(this,e),lt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||"No root node IDs specified."))}return ut(e,t),e}(ht),pt=e,gt=at,bt={columns:nt.columns,rows:nt.rows},vt={width:rt.width,height:rt.height},yt={},mt=ot,Ot=it,wt=void 0,jt=void 0,kt=void 0,It=void 0,xt=void 0,St=void 0,Mt=void 0,_t=function(){function t(e,r,n){if(st(this,t),n&&(pt=n),"4"!==pt.version[0])throw new dt(pt.version);this.scale={x:pt.scaleLinear(),y:pt.scaleLinear(),linkPosition:{}},this.grid(r),this.size(e),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return ct(t,[{key:"nodesToMatrix",value:function(t){var e=[],n=0,o=Object.keys(this.columnCache).length;r(t)&&(n=t,o=t+1);for(var i=n;i<o;i++){e.push({y:0,x:this.scale.x(i),level:i,rows:[],sortBy:this.columnSorting[i].by,sortOrder:this.columnSorting[i].order});for(var a=Object.keys(this.columnCache[i]),s=a.length;s--;)e[i-n].rows.push(this.data[a[s]])}return e}},{key:"process",value:function(t,e,n){if(this.data=t||this.data,this.rootIds=e||this.rootIds,!x(this.rootIds)){if(!r(this.rootIds))throw new ft("No root node IDs specified.");this.rootIds=[this.rootIds]}var o=et({},n);I(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.scale,yt);for(var i=Object.keys(this.columnCache).length;i--;)this.columnSorting[i]={};return o.sortBy&&this.sort(void 0,n.sortBy,n.sortOrder||"desc"),{global:this.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"sort",value:function(t,e,n){var o=0,i=Object.keys(this.columnCache).length,a=void 0,s=void 0,c=1===n?1:-1;switch(e){case"precision":s="precision",a=function(t){return t.data.barRefs.precision};break;case"recall":s="recall",a=function(t){return t.data.barRefs.recall};break;default:a=function(t){return t.data.name.toLowerCase()},s="name"}for(r(t)&&(o=t,i=t+1),o;o<i;o++){this.columnNodeOrder[o].sort(function(t,e){var r=a(t),n=a(e);return r>n?c:r<n?-c:0}),this.columnSorting[o].by=s,this.columnSorting[o].order=c;for(var u=this.columnNodeOrder[o].length;u--;)this.columnNodeOrder[o][u].y=this.scale.y(u)}return this}},{key:"compileGlobalProps",value:function(){return{column:{width:wt,height:vt.height,padding:kt,contentWidth:It},row:{height:jt,padding:xt,contentHeight:St},cell:{padding:Mt}}}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,e){var n=[],o=[];if(r(t))for(var i=Math.max(t,0),a=r(e)?Math.min(e,Object.keys(this.columnCache).length):i+1,s=i;s<a;s++)o=o.concat(Object.keys(this.columnCache[s]));else o=Object.keys(this.data);for(var c=o.length;c--;)this.data[o[c]].links&&(n=n.concat(this.data[o[c]].links.outgoing.refs));return n}},{key:"offsetLinks",value:function(t,e,n){var o=this.links(t);if(("source"===n||"target"===n)&&r(e))for(var i=o.length;i--;)o[i][n].offsetY=e;return o}},{key:"grid",value:function(t){return t?(x(t)&&(bt.columns=parseInt(t[0],10)||bt.columns,bt.rows=parseInt(t[1],10)||bt.rows,this.updateScaling()),n(t)&&(bt.columns=parseInt(t.columns,10)||bt.columns,bt.rows=parseInt(t.rows,10)||bt.rows,this.updateScaling()),this):bt}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),r=[],n=e.length;n--;)for(var o=t[e[n]].data.bars.length;o--;)r.push({barId:e[n]+"."+t[e[n]].data.bars[o].id,id:t[e[n]].data.bars[o].id,value:t[e[n]].data.bars[o].value});return r}},{key:"updateNodesVisibility",value:function(){for(var t=void 0,e=Object.keys(this.columnCache).length;e--;){t=0;for(var r=0,n=this.columnNodeOrder[e].length;r<n;r++)this.columnNodeOrder[e][r].hidden&&!this.columnNodeOrder[e][r].data.queryMode&&t++,this.columnNodeOrder[e][r].y=this.scale.y(r-t)}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,bt.columns]).range([0,vt.width]),this.scale.y.domain([0,bt.rows]).range([0,vt.height]),wt=vt.width/bt.columns,jt=vt.height/bt.rows,kt=wt*mt,It=wt*(1-2*mt),xt=Math.max(jt*Ot,2),St=jt-2*xt,Mt=gt*Math.min(It,St,1),this}},{key:"size",value:function(t){return t?(x(t)&&(vt.width=parseInt(t[0],10)||vt.width,vt.height=parseInt(t[1],10)||vt.height,this.updateScaling()),n(t)&&(vt.width=parseInt(t.width,10)||vt.width,vt.height=parseInt(t.height,10)||vt.height,this.updateScaling()),this):vt}},{key:"columnPadding",value:function(t,e){if(!t)return mt;if(r(t)){var n=t;e&&r(wt)&&(n=t/wt),mt=Math.max(Math.min(n,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,e){if(!t)return Ot;if(r(t)){var n=t;e&&r(jt)&&(n=t/jt),Ot=Math.max(Math.min(n,.5),0),this.updateScaling()}return this}}]),t}();t.listGraph=_t,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=d3.listGraph.min.js.map
