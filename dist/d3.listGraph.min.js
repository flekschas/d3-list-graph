/* Copyright Fritz Lekschas: D3 layout for list-like graphs */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.d3=t.d3||{},t.d3)}(this,function(t,e){"use strict";function n(t){return"number"==typeof t&&G(t)}function r(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function o(t,e,n){"__proto__"==e&&L?L(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function i(t,e){return t===e||t!==t&&e!==e}function a(t,e,n){var r=t[e];z.call(t,e)&&i(r,n)&&(void 0!==n||e in t)||o(t,e,n)}function u(t,e,n,r){var i=!n;n||(n={});for(var u=-1,s=e.length;++u<s;){var c=e[u],l=r?r(n[c],t[c],c,n,t):void 0;void 0===l&&(l=t[c]),i?o(n,c,l):a(n,c,l)}return n}function s(t){return t}function c(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function l(t,e,n){return e=Y(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Y(r.length-e,0),a=Array(i);++o<i;)a[o]=r[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=r[o];return u[e]=n(a),c(t,this,u)}}function h(t){return function(){return t}}function f(t){var e=r(t)?W.call(t):"";return e==X||e==H}function d(t){return!!K&&K in t}function p(t){if(null!=t){try{return U.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function v(t){if(!r(t)||d(t))return!1;var e=f(t)?it:tt;return e.test(p(t))}function b(t,e){return null==t?void 0:t[e]}function g(t,e){var n=b(t,e);return v(n)?n:void 0}function y(t){var e=0,n=0;return function(){var r=lt(),o=ct-(r-n);if(n=r,o>0){if(++e>=st)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function m(t,e){return ht(l(t,e,s),t+"")}function w(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=ft}function O(t){return null!=t&&w(t.length)&&!f(t)}function k(t,e){return e=null==e?dt:e,!!e&&("number"==typeof t||pt.test(t))&&t>-1&&t%1==0&&t<e}function j(t,e,n){if(!r(n))return!1;var o=typeof e;return!!("number"==o?O(n)&&k(e,n.length):"string"==o&&e in n)&&i(n[e],t)}function _(t){return m(function(e,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,a&&j(n[0],n[1],a)&&(i=o<3?void 0:i,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,i)}return e})}function x(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||vt;return t===n}function P(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function I(t){return null!=t&&"object"==typeof t}function S(t){return I(t)&&O(t)}function M(t){return S(t)&&yt.call(t,"callee")&&(!wt.call(t,"callee")||mt.call(t)==bt)}function N(t,e){var n=F(t)||M(t)?P(t.length,String):[],r=n.length,o=!!r;for(var i in t)!e&&!kt.call(t,i)||o&&("length"==i||k(i,r))||n.push(i);return n}function C(t,e){return function(n){return t(e(n))}}function R(t){if(!x(t))return jt(t);var e=[];for(var n in Object(t))xt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function D(t){return O(t)?N(t):R(t)}function E(t,e,n,o,i,a){function u(t){if(t.data.bars)if(F(t.data.bars)){t.data.barRefs={};for(var e=0,n=t.data.bars.length;e<n;e++)t.data.bars[e].value=Math.max(Math.min(t.data.bars[e].value,1),0),t.data.bars[e].barId=t.id+"."+t.data.bars[e].id,t.data.barRefs[t.data.bars[e].id]=t.data.bars[e].value}else if(r(t.data.bars)){var o=[],i=Object.keys(t.data.bars);t.data.barRefs={};for(var a=0,u=i.length;a<u;a++)t.data.barRefs[i[a]]=Math.max(Math.min(t.data.bars[i[a]],1),0),o.push({barId:t.id+"."+i[a],id:i[a],value:t.data.barRefs[i[a]]});t.data.bars=o}}function s(t,e){var n="("+t.id+")->("+e.id+")";a[n]||(a[n]={id:n,source:{node:t,offsetX:0,offsetY:0},target:{node:e,offsetX:0,offsetY:0}},t.links.outgoing.refs.push(a[n]),e.links.incoming.refs.push(a[n]),t.links.outgoing.total++,e.links.incoming.total++)}function c(e,r,a,c){var l=e.toString(),h=r,f=!1;if(c){for(var d=r.clones.length;d--;)if(r.clones[d].depth===a.depth+1){f=!0,l=r.clones[d].cloneId,h=r.clones[d];break}if(a.depth+1!==r.depth&&!f){var p=e+"."+(r.clones.length+1);t[p]||(t[p]={children:[],clone:!0,cloneId:p,cloneNum:r.clones.length+1,data:r.data,originalId:e.toString(),originalNode:r}),l=p,h=t[p],r.clones.push(h),r.parents[a.id]=void 0,delete r.parents[a.id]}}else h.clones=[];h.id=l,h.parents||(h.parents={}),a?h.parents[a.id]=a:h.parents={},h.data.state||(h.data.state={}),h.childRefs||(h.childRefs=[]),a?(h.depth=a.depth+1,a.childRefs.push(h)):h.depth=0,h.links||(h.links={incoming:{refs:[],above:0,below:0,total:0},outgoing:{refs:[],above:0,below:0,total:0}}),n[h.depth]||(n[h.depth]={},o[h.depth]=[]),n[h.depth][l]||(n[h.depth][l]=!0,o[h.depth].push(h),h.x=i.x(h.depth),h.y=i.y(Object.keys(n[h.depth]).length-1)),u(h),a&&s(a,h)}function l(){for(var n=e.length;n--;)for(var r=e.length;r--;)n!==r&&(t[e[n]].siblings||(t[e[n]].siblings={}),t[e[n]].siblings[e[r]]=t[e[r]])}for(var h={},f=[],d=e.length;d--;){if(!t[e[d]])return;for(c(e[d],t[e[d]]),f.push(e[d]),h[e[d]]=!0;f.length>0;)for(var p=t[f.shift()],v=p.children.length;v--;){var b=p.children[v],g=t[b];if(g){var y=!0;h[b]||(f.push(b),h[b]=!0,y=!1),c(b,g,p,y)}}}l()}function T(t,e,n){return n?t||e:"undefined"!=typeof t?t:e}var F=Array.isArray,$="object"==typeof global&&global&&global.Object===Object&&global,A="object"==typeof self&&self&&self.Object===Object&&self,B=$||A||Function("return this")(),G=B.isFinite,L=Object.defineProperty,q=Object.prototype,z=q.hasOwnProperty,Y=Math.max,X="[object Function]",H="[object GeneratorFunction]",V=Object.prototype,W=V.toString,J=B["__core-js_shared__"],K=function(){var t=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Q=Function.prototype,U=Q.toString,Z=/[\\^$.*+?()[\]{}|]/g,tt=/^\[object .+?Constructor\]$/,et=Function.prototype,nt=Object.prototype,rt=et.toString,ot=nt.hasOwnProperty,it=RegExp("^"+rt.call(ot).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),at=g(Object,"defineProperty"),ut=at?function(t,e){return at(t,"toString",{configurable:!0,enumerable:!1,value:h(e),writable:!0})}:s,st=500,ct=16,lt=Date.now,ht=y(ut),ft=9007199254740991,dt=9007199254740991,pt=/^(?:0|[1-9]\d*)$/,vt=Object.prototype,bt="[object Arguments]",gt=Object.prototype,yt=gt.hasOwnProperty,mt=gt.toString,wt=gt.propertyIsEnumerable,Ot=Object.prototype,kt=Ot.hasOwnProperty,jt=C(Object.keys,Object),_t=Object.prototype,xt=_t.hasOwnProperty,Pt=Object.prototype,It=Pt.hasOwnProperty,St=_(function(t,e){if(x(e)||O(e))return void u(e,D(e),t);for(var n in e)It.call(e,n)&&a(t,n,e[n])}),Mt={width:300,height:300},Nt={columns:3,rows:3},Ct=.2,Rt=.05,Dt=.05,Et=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,o){var u={key:t,arg:e,resolve:n,reject:o,next:null};a?a=a.next=u:(i=a=u,r(t,e))})}function r(n,i){try{var a=e[n](i),u=a.value;u instanceof t?Promise.resolve(u.value).then(function(t){r("next",t)},function(t){r("throw",t)}):o(a.done?"return":"normal",a.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),Tt=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Ft=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},$t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},At=function(t){function e(t){Et(this,e);var n=$t(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name=n.constructor.name,n.message=t,Error.captureStackTrace(n,n.constructor.name),n}return Ft(e,t),e}(Error),Bt=function(t){function e(t){return Et(this,e),$t(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"D3 version 4 is required to run the code. Found version "+t))}return Ft(e,t),e}(At),Gt=function(t){function e(t){return Et(this,e),$t(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,'The "'+t+'" must be an object.'))}return Ft(e,t),e}(At),Lt=function(t){function e(t){return Et(this,e),$t(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||"No root node IDs specified."))}return Ft(e,t),e}(At),qt={columns:Nt.columns,rows:Nt.rows},zt={width:Mt.width,height:Mt.height},Yt={},Xt=e,Ht=void 0,Vt=void 0,Wt=void 0,Jt=void 0,Kt=void 0,Qt=void 0,Ut=void 0,Zt=void 0,te=void 0,ee=void 0,ne=function(){function t(e){if(Et(this,t),!r(e))throw new Gt("options");if(e.specificD3){if(!r(e.specificD3))throw new Gt("d3");Xt=e.specificD3}if("4"!==Xt.version[0])throw new Bt(Xt.version);this.scale={x:Xt.scaleLinear(),y:Xt.scaleLinear(),linkPosition:{}},Ht=T(e.innerNodePadding,Dt),Vt=T(e.columnPadding,Ct),Wt=T(e.rowPadding,Rt),this.grid(e.grid),this.size(e.size),this.columnCache={},this.columns={},this.columnNodeOrder={},this.columnSorting={}}return Tt(t,[{key:"getData",value:function(){return{global:t.compileGlobalProps(),nodes:this.nodesToMatrix()}}},{key:"nodesToMatrix",value:function(t){var e=[],r=0,o=Object.keys(this.columnCache).length;n(t)&&(r=t,o=t+1);for(var i=r;i<o;i++){e.push({y:0,x:this.scale.x(i),level:i,rows:[],sortBy:this.columnSorting[i].by,sortOrder:this.columnSorting[i].order});for(var a=Object.keys(this.columnCache[i]),u=a.length;u--;)e[i-r].rows.push(this.data[a[u]])}return e}},{key:"process",value:function(t,e,r){if(this.data=t||this.data,this.rootIds=e||this.rootIds,this.columnCache={},!F(this.rootIds)){if(!n(this.rootIds))throw new Lt("No root node IDs specified.");this.rootIds=[this.rootIds]}var o=St({},r);E(this.data,this.rootIds,this.columnCache,this.columnNodeOrder,this.scale,Yt);for(var i=Object.keys(this.columnCache).length;i--;)this.columnSorting[i]={};return o.sortBy&&this.sort(void 0,r.sortBy,r.sortOrder||"desc"),this.getData()}},{key:"sort",value:function(t,e,r){var o=0,i=Object.keys(this.columnCache).length,a=void 0,u=void 0,s=1===r?1:-1;switch(e){case"precision":u="precision",a=function(t){return t.data.barRefs.precision};break;case"recall":u="recall",a=function(t){return t.data.barRefs.recall};break;default:a=function(t){return t.data.name.toLowerCase()},u="name"}for(n(t)&&(o=t,i=t+1),o;o<i;o++){this.columnNodeOrder[o].sort(function(t,e){var n=a(t),r=a(e);return n>r?s:n<r?-s:0}),this.columnSorting[o].by=u,this.columnSorting[o].order=s;for(var c=this.columnNodeOrder[o].length;c--;)this.columnNodeOrder[o][c].y=this.scale.y(c)}return this}},{key:"nodes",value:function(t){return this.nodesToMatrix(t)}},{key:"links",value:function(t,e){var r=[],o=[];if(n(t))for(var i=Math.max(t,0),a=n(e)?Math.min(e,Object.keys(this.columnCache).length):i+1,u=i;u<a;u++)o=o.concat(Object.keys(this.columnCache[u]));else o=Object.keys(this.data);for(var s=o.length;s--;)this.data[o[s]].links&&(r=r.concat(this.data[o[s]].links.outgoing.refs));return r}},{key:"offsetLinks",value:function(t,e,r){var o=this.links(t);if(("source"===r||"target"===r)&&n(e))for(var i=o.length;i--;)o[i][r].offsetY=e;return o}},{key:"grid",value:function(t){return t?(F(t)&&(qt.columns=parseInt(t[0],10)||qt.columns,qt.rows=parseInt(t[1],10)||qt.rows,this.updateScaling()),r(t)&&(qt.columns=parseInt(t.columns,10)||qt.columns,qt.rows=parseInt(t.rows,10)||qt.rows,this.updateScaling()),this):qt}},{key:"updateNodesVisibility",value:function(){for(var t=void 0,e=Object.keys(this.columnCache).length;e--;){t=0;for(var n=0,r=this.columnNodeOrder[e].length;n<r;n++)this.columnNodeOrder[e][n].hidden&&!this.columnNodeOrder[e][n].data.queryMode&&t++,this.columnNodeOrder[e][n].y=this.scale.y(n-t)}return this}},{key:"updateScaling",value:function(){return this.scale.x.domain([0,qt.columns]).range([0,zt.width]),this.scale.y.domain([0,qt.rows]).range([0,zt.height]),Jt=zt.width/qt.columns,Kt=zt.height/qt.rows,Qt=Jt*Vt,Ut=Jt*(1-2*Vt),Zt=Math.max(Kt*Wt,2),te=Kt-2*Zt,ee=Ht*Math.min(Ut,te,1),this}},{key:"size",value:function(t){return t?(F(t)&&(zt.width=parseInt(t[0],10)||zt.width,zt.height=parseInt(t[1],10)||zt.height,this.updateScaling()),r(t)&&(zt.width=parseInt(t.width,10)||zt.width,zt.height=parseInt(t.height,10)||zt.height,this.updateScaling()),this):zt}},{key:"columnPadding",value:function(t,e){if(!t)return Vt;if(n(t)){var r=t;e&&n(Jt)&&(r=t/Jt),Vt=Math.max(Math.min(r,.66),.1),this.updateScaling()}return this}},{key:"rowPadding",value:function(t,e){if(!t)return Wt;if(n(t)){var r=t;e&&n(Kt)&&(r=t/Kt),Wt=Math.max(Math.min(r,.5),0),this.updateScaling()}return this}}],[{key:"compileGlobalProps",value:function(){return{column:{width:Jt,height:zt.height,padding:Qt,contentWidth:Ut},row:{height:Kt,padding:Zt,contentHeight:te},cell:{padding:ee}}}},{key:"updateBars",value:function(t){for(var e=Object.keys(t),n=[],r=e.length;r--;)for(var o=t[e[r]].data.bars.length;o--;)n.push({barId:e[r]+"."+t[e[r]].data.bars[o].id,id:t[e[r]].data.bars[o].id,value:t[e[r]].data.bars[o].value});return n}}]),t}();t.listGraph=ne,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=d3.listGraph.min.js.map
